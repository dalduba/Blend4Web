var b4w="object"===typeof b4w?b4w:function(a){var t={};a.module=t;var v={};a.cleanup=function(a,b){var e=t[a];e&&(e._compiled=null);v[b||"__b4w_default"]=null};a.register=function(a,b){t[a]||(t[a]=b)};a.require=function(a,b){if(!t[a])throw Error('Module "'+a+'" not found');b=b||"__b4w_default";v[b]||(v[b]=function(a){return function(b){var c=t[b];if(!c)throw Error('Module "'+b+'" not found');c._compiled||(c._compiled={});c._compiled[a]||(c._compiled[a]={},c(c._compiled[a],v[a]));return c._compiled[a]}}(b));
return v[b](a)};a.module_check=function(a){return t[a]?!0:!1};a.get_namespace=function(a){for(var b in v)if(v[b]==a)return b;return""};a.worker_listeners=[];a.worker_namespaces=[];return a}({});"object"==typeof module&&module.exports&&(GLOBAL.b4w={module:{}});
b4w.module.__version=function(a,t){function v(){var a=c,b=a.getDate(),b=10>b?"0"+String(b):String(b),l=a.getMonth()+1,l=10>l?"0"+String(l):String(l),n=String(a.getFullYear()),q=a.getHours(),q=10>q?"0"+String(q):String(q),g=a.getMinutes(),g=10>g?"0"+String(g):String(g),a=a.getSeconds(),a=10>a?"0"+String(a):String(a);return b+"."+l+"."+n+" "+q+":"+g+":"+a}var c=new Date(2015,10,26,18,57,51),b=[15,11];a.version=function(){return b};a.version_str=function(){for(var a="",d=0;d<b.length;d++)a=1==d?a+(10>
b[d]?"0"+b[d]:b[d]):a+b[d],d!=b.length-1&&(a+=".");return a};a.type=function(){return"RELEASE"};a.date=function(){return c};a.date_str=v;a.timestamp=function(){var a=v(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.exports&&b4w.module.__version(exports);b4w.module.__config=function(a,t){function v(){return b4w.module_check(a.paths.built_in_data_module)}function c(){for(var d=a.paths,c=null,e=document.getElementsByTagName("script"),q=0;q<e.length;q++){for(var g=e[q].src,u=0;u<d.js_src_search_paths.length;u++)if(0<=g.indexOf(d.js_src_search_paths[u])){c=g;break}if(null!==c)break}c||(b.warn("Couldn't determine path to ancillary resources, fallback to the current page directory"),c=document.location.href);d=c.indexOf("?");0<=d&&(c=c.substring(0,d));
return c.substring(0,c.lastIndexOf("/")+1)}var b=t("__print"),e=t("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.context_save=e.clone_object_r(a.context);a.defaults={alpha_sort:!0,alpha_sort_threshold:.1,alpha_clip_filtering_hack:!1,min_format_version:[5,7],max_fps:1E4,console_verbose:!1,do_not_load_resources:!1,use_min50:!1,fps_measurement_interval:1.5,fps_callback_interval:10,background_color:[0,0,0,0],lod_transition_ratio:.01,canvas_resolution_factor:1,
texture_min_filter:3,allow_cors:!1,force_low_quality_nodes:!1,anisotropic_filtering:!0,show_hud_debug_info:!1,depth_textures:!0,shadows:!0,anaglyph_use:!1,reflections:!0,refractions:!0,ssao:!0,dof:!0,god_rays:!0,bloom:!0,motion_blur:!0,compositing:!0,antialiasing:!0,smaa:!1,wireframe_debug:!1,water_wireframe_debug:!1,foam:!0,parallax:!0,dynamic_grass:!0,procedural_fog:!0,water_dynamic:!0,shore_smoothing:!0,shore_distance:!0,max_texture_size:1024,max_cube_map_size:512,use_dds:!0,precision:"highp",
quality:a.P_HIGH,allow_vertex_textures:!0,no_phy_interp_hack:!1,shader_constants_hack:!1,disable_blend_shadows_hack:!1,vert_anim_mix_normals_hack:!1,is_mobile_device:!1,disable_doppler_hack:!1,cors_chrome_hack:!1,init_wa_context_hack:!1,clear_procedural_sky_hack:!1,sky_update_hack:!1,seq_video_fallback:!1,allow_hidpi:!1,gyro_use:!1,firefox_shadows_slink_hack:!1,mobile_firefox_media_hack:!1,enable_selectable:!0,enable_outlining:!0,glow_materials:!0,max_vertex_uniform_vectors:128,ie11_edge_touchscreen_hack:!1,
ios_depth_hack:!1,macos_tex_reuse_hack:!1,loaded_data_version:[0,0],edge_min_tex_size_hack:!1,quality_aa_method:!0,amd_skinning_hack:!1,url_params:null,webgl2:!0,msaa_samples:4,safari_canvas_alpha_hack:!1,resize_cubemap_canvas_hack:!1,arch_mesa_clear_depth_hack:!1};a.defaults_save=e.clone_object_r(a.defaults);a.animation={framerate:-1,frames_blending_hack:!1,frame_steps:1};a.controls={mouse_wheel_notch_multiplier:1/120};a.assets={dir:"ASSETS=../../assets/",max_requests:15,prevent_caching:!0,min50_available:!1,
dds_available:!1};a.assets_save=e.clone_object_r(a.assets);a.paths={shaders_dir:"",shaders_include_dir:"include/",shaders_postp_dir:"postprocessing/",built_in_data_module:"built_in_data",js_src_search_paths:"b4w.min.js b4w.full.min.js b4w.simple.min.js b4w.whitespace.min.js src/b4w.js USER_DEFINED_MODULE".split(" "),resources_dir:"./",smaa_search_texture_path:"",smaa_area_texture_path:""};a.physics={enabled:!0,max_fps:60,uranium_path:"",calc_fps:!1,ping:!1,use_workers:!0};a.physics_save=e.clone_object_r(a.physics);
a.scenes={grass_tex_size:1024,cubemap_tex_size:384,cube_reflect_low:32,cube_reflect_medium:128,cube_reflect_high:256,plane_reflect_low:.25,plane_reflect_medium:.5,plane_reflect_high:1};a.scenes_save=e.clone_object_r(a.scenes);a.sfx={webaudio:!0,mix_mode:!1,audio_loading_hack:!1,clamp_playback_rate_hack:!1,disable_playback_rate_hack:!1};a.sfx_save=e.clone_object_r(a.sfx);a.outlining={outlining_overview_mode:!1,outline_color:[1,.4,.05],outline_duration:.2,outline_period:3.8,outline_relapses:1};a.debug_subs=
{enabled:!1,subs_type:"MAIN_BLEND",subs_number:0,slink_type:"COLOR"};a.debug_subs_save=e.clone_object_r(a.debug_subs);a.apply_quality=function(){var b=a.defaults,c=a.physics,e=a.scenes;switch(b.quality){case a.P_ULTRA:b.shadows=!0;b.shore_smoothing=!0;b.ssao=!0;b.dof=!0;b.god_rays=!0;b.bloom=!0;b.reflections=!0;b.refractions=!0;b.foam=!0;b.parallax=!0;b.dynamic_grass=!0;b.procedural_fog=!0;e.grass_tex_size=2048;b.texture_min_filter=3;b.anisotropic_filtering=!0;b.use_min50=!1;b.precision="highp";b.water_dynamic=
!0;b.shore_distance=!0;b.antialiasing=!0;b.smaa=!1;b.compositing=!0;b.motion_blur=!0;b.allow_hidpi=!0;b.enable_outlining=!0;b.glow_materials=!0;b.msaa_samples=16;c.max_fps=120;break;case a.P_HIGH:b.shadows=!0;b.shore_smoothing=!0;b.ssao=!0;b.dof=!0;b.god_rays=!0;b.bloom=!0;b.reflections=!0;b.refractions=!0;b.foam=!0;b.parallax=!0;b.dynamic_grass=!0;b.procedural_fog=!0;e.grass_tex_size=1024;b.texture_min_filter=3;b.anisotropic_filtering=!0;b.use_min50=!1;b.precision="highp";b.water_dynamic=!0;b.shore_distance=
!0;b.antialiasing=!0;b.smaa=!1;b.compositing=!0;b.motion_blur=!0;b.allow_hidpi=!1;b.enable_outlining=!0;b.glow_materials=!0;b.msaa_samples=4;c.max_fps=60;break;case a.P_LOW:b.shadows=!1,b.shore_smoothing=!1,b.ssao=!1,b.dof=!1,b.god_rays=!1,b.bloom=!1,b.reflections=!1,b.refractions=!1,b.foam=!1,b.parallax=!1,b.dynamic_grass=!1,b.procedural_fog=!1,e.grass_tex_size=512,b.texture_min_filter=2,b.anisotropic_filtering=!1,b.use_min50=!0,b.precision="mediump",b.water_dynamic=!1,b.shore_distance=!1,b.antialiasing=
!1,b.smaa=!1,b.compositing=!1,b.motion_blur=!1,b.allow_hidpi=!1,b.enable_outlining=!1,b.glow_materials=!1,b.msaa_samples=1,c.max_fps=60}};a.set=function(d,c){switch(d){case "allow_cors":a.defaults.allow_cors=c;break;case "allow_hidpi":a.defaults.allow_hidpi=c;break;case "alpha":a.context.alpha=c;break;case "alpha_sort":a.defaults.alpha_sort=c;break;case "alpha_sort_threshold":a.defaults.alpha_sort_threshold=c;break;case "anaglyph_use":a.defaults.anaglyph_use=c;break;case "animation_framerate":a.animation.framerate=
c;break;case "antialiasing":a.defaults.antialiasing=c;break;case "assets_dds_available":a.assets.dds_available=c;break;case "assets_min50_available":a.assets.min50_available=c;break;case "audio":a.sfx.webaudio=c;break;case "background_color":a.defaults.background_color=c;break;case "built_in_module_name":a.paths.built_in_data_module=c;break;case "canvas_resolution_factor":a.defaults.canvas_resolution_factor=c;break;case "console_verbose":a.defaults.console_verbose=c;break;case "do_not_load_resources":a.defaults.do_not_load_resources=
c;break;case "gyro_use":a.defaults.gyro_use=c;break;case "physics_enabled":a.physics.enabled=c;break;case "physics_uranium_path":a.physics.uranium_path=c;break;case "physics_calc_fps":a.physics.calc_fps=c;break;case "physics_use_workers":a.physics.use_workers=c;break;case "precision":a.defaults.precision=c;break;case "quality":a.defaults.quality=c;break;case "sfx_mix_mode":a.sfx.mix_mode=c;break;case "shaders_dir":a.paths.shaders_dir=c;break;case "show_hud_debug_info":a.defaults.show_hud_debug_info=
c;break;case "smaa":a.defaults.smaa=c;break;case "smaa_search_texture_path":a.paths.smaa_search_texture_path=c;break;case "smaa_area_texture_path":a.paths.smaa_area_texture_path=c;break;case "wireframe_debug":a.defaults.wireframe_debug=c;break;case "enable_selectable":a.defaults.enable_selectable=c;break;case "enable_outlining":a.defaults.enable_outlining=c;break;case "outlining_overview_mode":a.outlining.outlining_overview_mode=c;break;case "glow_materials":a.defaults.glow_materials=c;break;case "url_params":a.defaults.url_params=
c;break;default:b.error("Unknown config property: "+d)}};a.get=function(d){switch(d){case "allow_cors":return a.defaults.allow_cors;case "allow_hidpi":return a.defaults.allow_hidpi;case "alpha":return a.context.alpha;case "alpha_sort":return a.defaults.alpha_sort;case "alpha_sort_threshold":return a.defaults.alpha_sort_threshold;case "anaglyph_use":return a.defaults.anaglyph_use;case "animation_framerate":return a.animation.framerate;case "antialiasing":return a.defaults.antialiasing;case "assets_dds_available":return a.assets.dds_available;
case "assets_min50_available":return a.assets.min50_available;case "audio":return a.sfx.webaudio;case "background_color":return a.defaults.background_color;case "built_in_module_name":return a.paths.built_in_data_module;case "canvas_resolution_factor":return a.defaults.canvas_resolution_factor;case "console_verbose":return a.defaults.console_verbose;case "do_not_load_resources":return a.defaults.do_not_load_resources;case "gyro_use":return a.defaults.gyro_use;case "physics_enabled":return a.physics.enabled;
case "physics_uranium_path":return a.physics.uranium_path;case "physics_calc_fps":return a.physics.calc_fps;case "physics_use_workers":return a.physics.use_workers;case "precision":return a.defaults.precision;case "quality":return a.defaults.quality;case "sfx_mix_mode":return a.sfx.mix_mode;case "shaders_dir":return a.paths.shaders_dir;case "show_hud_debug_info":return a.defaults.show_hud_debug_info;case "smaa":return a.defaults.smaa;case "smaa_search_texture_path":return a.paths.smaa_search_texture_path;
case "smaa_area_texture_path":return a.paths.smaa_area_texture_path;case "wireframe_debug":return a.defaults.wireframe_debug;case "enable_selectable":return a.defaults.enable_selectable;case "enable_outlining":return a.defaults.enable_outlining;case "outlining_overview_mode":return a.outlining.outlining_overview_mode;case "glow_materials":return a.defaults.glow_materials;case "url_params":return a.defaults.url_params;default:b.error("Unknown config property: "+d)}};a.reset=function(){a.context=e.clone_object_r(a.context_save);
a.defaults=e.clone_object_r(a.defaults_save);a.assets=e.clone_object_r(a.assets_save);a.physics=e.clone_object_r(a.physics_save);a.scenes=e.clone_object_r(a.scenes_save);a.sfx=e.clone_object_r(a.sfx_save);a.debug_subs=e.clone_object_r(a.debug_subs_save)};a.is_built_in_data=v;a.set_paths=function(){var b=a.paths,e=a.physics;v()||""!=b.shaders_dir||(b.shaders_dir=c()+"../shaders/");if(v())b.smaa_search_texture_path="smaa_search_texture.png",b.smaa_area_texture_path="smaa_area_texture.png";else if(""==
b.smaa_search_texture_path||""==b.smaa_area_texture_path){var n=c()+b.resources_dir;b.smaa_search_texture_path=b.smaa_search_texture_path||n+"smaa_search_texture.png";b.smaa_area_texture_path=b.smaa_area_texture_path||n+"smaa_area_texture.png"}e.enabled&&""==e.uranium_path&&(n=c()+b.resources_dir,e.uranium_path=n+"uranium.js")};a.get_std_assets_path=function(){return a.assets.dir.replace("ASSETS=","")}};b4w.module.__anchors=function(a,t){function v(a,k){var f=document.createElement("div"),m=f.style;m.position="absolute";m.backgroundColor="black";m.borderRadius="20px 20px 20px 0px";m.boxShadow="0px 0px 10px rgb(180, 180, 200)";m.opacity=1;m.padding="8px 12px";m.lineHeight="15px";m.visibility="hidden";m.fontSize="12px";var d=g.get_container();d.appendChild(f);var p=u.get_meta_tags(a);if(p)var h=p.title||a.name,r=p.description;else h=a.name,r="";var C=document.createElement("span"),I=C.style;C.innerHTML=
h;I.fontWeight="bold";I.fontSize="12px";I.lineHeight="15px";I.color="#fff";I.fontFamily="Arial";e(C);f.appendChild(C);if(r){var p=document.createElement("div"),x=p.style;x.position="absolute";x.bottom="0px";x.left="0px";x.backgroundColor="#000";x.borderRadius="20px 20px 20px 0px";x.boxShadow="0px 0px 10px rgb(180, 180, 200)";x.visibility="hidden";x.padding="8px 12px";x.overflow="hidden";x.lineHeight="15px";x.fontSize="12px";x.zIndex="2";f.appendChild(p);var h=document.createElement("span"),G=h.style;
h.innerHTML=r;G.fontSize="12px";G.fontFamily="Arial";G.fontWeight="bold";G.lineHeight="15px";G.color="#fff";G.visibility="hidden";p.appendChild(h);var z=!1,n=!1;d.addEventListener("mousedown",function(a){if(!(z||n||A))if(a.target!=C&&a.target!=f||"hidden"!=x.visibility||1!=m.opacity)"visible"==x.visibility&&(m.visibility="visible",I.visibility="visible",x.visibility="hidden",G.visibility="hidden");else{m.visibility="hidden";I.visibility="hidden";x.visibility="visible";z=n=!0;a=f.offsetWidth-24;var d=
f.offsetHeight-16,p=Math.min(k,c(r,"12px")),h=b(r,"12px",p);h==d&&(x.height=h+"px");p!=a?K.animate(a,p,200,function(a){a==p&&("visible"==x.visibility&&(G.visibility="visible"),z=!1);x.width=a+"px"}):z=!1;h!=d?K.animate(d,h,200,function(a){a==h&&("visible"==x.visibility&&(G.visibility="visible"),n=!1);x.height=a+"px"}):n=!1;n||z||(G.visibility="visible")}},!1)}return f}function c(a,b,k){k=document.createElement("div");var f=document.createElement("span"),m=k.style;f.innerHTML=a;f.style.fontSize=b;
f.style.fontFamily="Arial";f.style.fontWeight="bold";f.style.color="#fff";f.style.visibility="hidden";m.lineHeight="15px";k.appendChild(f);m.position="absolute";m.visibility="hidden";m.fontSize=b;m.display="inline-block";m.lineHeight="15px";document.body.appendChild(k);a=k.offsetWidth+1;document.body.removeChild(k);return a}function b(a,b,k){var f=document.createElement("div"),m=document.createElement("span"),d=f.style;m.innerHTML=a;m.style.fontSize=b;m.style.fontFamily="Arial";m.style.fontWeight=
"bold";m.style.color="#fff";m.style.visibility="hidden";d.lineHeight="15px";f.appendChild(m);d.position="absolute";d.visibility="hidden";d.fontSize=b;d.display="inline-block";d.width=k+"px";d.lineHeight="15px";document.body.appendChild(f);a=f.offsetHeight;document.body.removeChild(f);return a}function e(a){a.style["-webkit-touch-callout"]="none";a.style["-webkit-user-select"]="none";a.style["-khtml-user-select"]="none";a.style["-moz-user-select"]="none";a.style["-ms-user-select"]="none";a.style["user-select"]=
"none";a.style.cursor="default"}function d(){for(var a=0,b=0;b<h.length;b++)h[b].detect_visibility&&a++;x=new Float32Array(3*a)}function l(a,b){return b.depth-a.depth}var n=t("__batch"),q=t("__camera"),g=t("__container"),u=t("__objects"),k=t("__print"),f=t("__renderer"),p=t("__scenes"),K=t("__time"),D=t("__tsr");t("__util");t("__config");var A=!1,h=[],x=new Float32Array(0),w=new Uint8Array(16),r=new Float32Array(2),m=new Float32Array(3);a.append=function(a){var b;a:{for(b=0;b<h.length;b++)if(h[b].obj==
a){b=!0;break a}b=!1}if(!b){b=a.anchor.detect_visibility&&Boolean(p.get_subs(p.get_main(),"ANCHOR_VISIBILITY"));b={type:a.anchor.type,obj:a,x:0,y:0,depth:0,appearance:"out",detect_visibility:b,element:null,move_cb:null,annotation_max_width:a.anchor.max_width,annotation_height:0,element_id:a.anchor.element_id};switch(b.type){case "ANNOTATION":b.element=v(a,b.annotation_max_width);b.annotation_height=b.element.offsetHeight;break;case "ELEMENT":b.element=document.getElementById(a.anchor.element_id),
b.element||(k.warn("Anchor HTML element was not found, making it generic"),b.type="GENERIC")}h.push(b);d()}};a.remove=function(a){for(var b=0;b<h.length;b++){var k=h[b];if(k.obj==a){"ANNOTATION"==k.type&&(a=k,g.get_container().removeChild(a.element));h.splice(b,1);d();break}}};a.update=function(){for(var a=0,b=h.length;b--;){var k=h[b];if(k.detect_visibility){var f=D.get_trans_view(k.obj.render.world_tsr);x.set(f,3*a++)}var d;d=k;var f=m,c=p.get_camera(p.get_main());d=D.get_trans_view(d.obj.render.world_tsr);
d=f=q.project_point(c,d,f);f=d[0];c=d[1];d=d[2];if(f!=k.x||c!=k.y||d!=k.depth){switch(k.type){case "ANNOTATION":var e=k.element;e.style.left=Math.floor(f)+"px";e.style.top=Math.floor(c-k.annotation_height)+"px";break;case "ELEMENT":var e=k.element,r=e.getBoundingClientRect();e.style.cssText+="left:"+Math.floor(f-r.width/2)+"px;top:"+Math.floor(c-r.height/2)+"px;"}k.x=f;k.y=c;k.depth=d;k.move_cb&&k.move_cb(f,c,k.appearance,k.obj,e)}}h.sort(l);for(b=0;b<h.length;b++)k=h[b],"GENERIC"!=k.type&&(k.element.style.zIndex=
b);0<a&&(a=p.get_subs(p.get_main(),"ANCHOR_VISIBILITY").bundles[0].batch,n.update_anchor_visibility_batch(a,x))};a.update_visibility=function(){for(var a=g.get_container(),b=h.length;b--;){var k=h[b],m=k.obj,d=k.x,c=k.y,e=k.depth,e=0>d||0>c||0>e||1<e||p.is_hidden(m)||d>=a.clientWidth||c>=a.clientHeight?"out":"visible";if(k.detect_visibility&&"out"!=e){var e=k,x=p.get_subs(p.get_main(),"ANCHOR_VISIBILITY").camera,C=g.canvas_to_viewport_coords(e.x,e.y,r,x);f.read_pixels(x.framebuffer,C[0],x.height-
C[1],2,2,w);e=1020==w[0]+w[4]+w[8]+w[12]?"visible":"out"==e.appearance||0==w[0]+w[4]+w[8]+w[12]?"covered":e.appearance}if(e!=k.appearance){switch(k.type){case "ANNOTATION":case "ELEMENT":var I=k.element;if(!I)break;"out"==e?(I.style.visibility="hidden",I.children.length&&(I.children[0].style.visibility="hidden"),"ANNOTATION"==k.type&&1<I.children.length&&(x=I.children[1],x.style.visibility="hidden",x.children.length&&(x.children[0].style.visibility="hidden"))):"visible"==e?(I.style.visibility="visible",
I.children.length&&(I.children[0].style.visibility="visible"),I.style.opacity=1):(I.style.visibility="visible",I.style.opacity=.1,I.children.length&&(I.children[0].style.visibility="visible"),"ANNOTATION"==k.type&&1<I.children.length&&(x=I.children[1],x.style.visibility="hidden",x.children.length&&(x.children[0].style.visibility="hidden")))}k.appearance=e;k.move_cb&&k.move_cb(d,c,k.appearance,m,I)}}};a.attach_move_cb=function(a,b){for(var k=0;k<h.length;k++)h[k].obj==a&&(h[k].move_cb=b)};a.detach_move_cb=
function(a){for(var b=0;b<h.length;b++)h[b].obj==a&&(h[b].move_cb=null)};a.cleanup=function(){for(var a=0;a<h.length;a++){var b=h[a];"ANNOTATION"==b.type&&g.get_container().removeChild(b.element)}h.length=0};a.is_anchor=function(a){for(var b=0;b<h.length;b++)if(h[b].obj==a)return!0;return!1};a.get_element_id=function(a){for(var b=0;b<h.length;b++)if(h[b].obj==a)return h[b].element_id;return!1};a.pause=function(){A=!0};a.resume=function(){A=!1}};b4w.module.__armature=function(a,t){function v(a){a=a.render;for(var b=a.skinned_renders,k=a.mesh_to_arm_bone_maps,f=0;f<b.length;f++){for(var d=b[f],c=k[f],e=0;e<c.length;e+=2)for(var r=c[e],m=c[e+1],g=0;4>g;g++)d.quats_before[r+g]=a.quats_before[m+g],d.quats_after[r+g]=a.quats_after[m+g],d.trans_before[r+g]=a.trans_before[m+g],d.trans_after[r+g]=a.trans_after[m+g];d.frame_factor=a.frame_factor}}function c(a,b,k,f){var d=a.tsr_bone_pose,x=a.tsr_local_rest,n=a.tsr_local_pose,r=a.parent_bone_ptr;r?
(r=r.tsr_local_pose,b?e.multiply(r,d,n):(b=g,e.invert(r,b),e.multiply(b,n,d))):b?e.copy(d,n):e.copy(n,d);d=q;e.invert(x,d);e.multiply(n,d,d);x=a.bone_index;k[4*x]=d[0];k[4*x+1]=d[1];k[4*x+2]=d[2];k[4*x+3]=d[3];f[4*x]=d[4];f[4*x+1]=d[5];f[4*x+2]=d[6];f[4*x+3]=d[7];a=a.descend_bones_ptrs;for(x=0;x<a.length;x++)n=a[x],n.constraint||c(n,!0,k,f)}var b=t("__util"),e=t("__tsr"),d=t("__quat"),l=t("__mat4"),n=t("__vec3"),q=e.create(),g=e.create(),u=new Float32Array(4),k=new Float32Array(4),f=new Float32Array(4);
a.update_object=function(a,k){for(var f=a.data.bones,d=a.pose.bones,c={},x=0;x<d.length;x++){var g=d[x],r=g.bone,m=r.name,E=m,m={bone_index:0,vgroup_index:-1,parent_bone_ptr:null,descend_bones_ptrs:[],chain:[],constraint:null,tsr_bone_rest:e.create(),tsr_bone_pose:e.create(),tsr_local_rest:e.create(),tsr_local_pose:e.create(),tsr_basis:e.create(),tsr_channel_cache:e.create(),tsr_channel_cache_valid:!1,tail:new Float32Array(3)},E=c[E]=m,m=new Float32Array(r.matrix_local),y=new Float32Array(16);l.invert(m,
y);var g=new Float32Array(g.matrix_basis),u=E.tail;n.subtract(r.tail_local,r.head_local,u);b.vecdir_multiply_matrix(u,y,u);e.from_mat4(m,E.tsr_local_rest);e.from_mat4(g,E.tsr_basis);e.copy(E.tsr_local_rest,E.tsr_local_pose)}for(x=0;x<f.length;x++){m=f[x].name;g=b.keysearch("name",m,d);E=c[m];r=g.parent_recursive;E.chain.push(E);for(g=0;g<r.length;g++)y=r[g],y=y.name,y=c[y],E.chain.push(y);r.length?(y=r[0],y=y.name,y=c[y],E.parent_bone_ptr=y,e.invert(y.tsr_local_rest,q),e.multiply(q,E.tsr_local_rest,
E.tsr_bone_rest),y.descend_bones_ptrs.push(E)):e.copy(E.tsr_local_rest,E.tsr_bone_rest);E.bone_index=x;E.name=m;e.multiply(E.tsr_bone_rest,E.tsr_basis,E.tsr_bone_pose)}k.render.bone_pointers=c};a.get_bone_tsr=function(a,b,c,n,h){var x=a.render,l=x.frame_factor;b=x.bone_pointers[b];var r=b.bone_index;a=b.tsr_local_rest;var m=x.trans_before,E=x.trans_after,y=x.quats_before,x=x.quats_after,M=m[4*r+1],L=m[4*r+2],N=m[4*r+3],B=E[4*r+1],O=E[4*r+2],F=E[4*r+3];u[0]=(1-l)*m[4*r]+l*E[4*r];u[1]=(1-l)*M+l*B;u[2]=
(1-l)*L+l*O;u[3]=(1-l)*N+l*F;k[0]=y[4*r];k[1]=y[4*r+1];k[2]=y[4*r+2];k[3]=y[4*r+3];f[0]=x[4*r];f[1]=x[4*r+1];f[2]=x[4*r+2];f[3]=x[4*r+3];d.slerp(k,f,l,k);l=q;e.set_transcale(u,l);e.set_quat(k,l);c?(c=g,e.translate(a,b.tail,c),e.multiply(l,c,l)):e.multiply(l,a,l);if(n){if(n=b.parent_bone_ptr)c=g,e.invert(n.tsr_local_pose,c),e.multiply(c,l,l);n=g;e.invert(b.tsr_bone_rest,n);e.multiply(n,l,l)}e.copy(l,h)};a.set_bone_tsr=function(a,b,k,f){var d=a.render;b=d.bone_pointers[b];var g=d.trans_before,n=d.quats_before;
f?e.multiply(b.tsr_bone_rest,k,b.tsr_bone_pose):e.copy(k,b.tsr_local_pose);c(b,f,g,n);d.frame_factor=0;v(a)};a.update_skinned_renders=v;a.update_bone_tsr_r=c;a.check_bone=function(a,b){return b in a.render.bone_pointers}};b4w.module.__boundings=function(a,t){function v(a,b){for(var d=a[0],c=a[1],e=a[2],g=a[0],h=a[1],x=a[2],n=3;n<a.length;n+=3)var r=a[n],m=a[n+1],l=a[n+2],d=Math.max(d,r),c=Math.max(c,m),e=Math.max(e,l),g=Math.min(g,r),h=Math.min(h,m),x=Math.min(x,l);b.max_x=d;b.max_y=c;b.max_z=e;b.min_x=g;b.min_y=h;b.min_z=x;return b}function c(a,b){b||(b=new Float32Array(24));var d=a.max_x,c=a.max_y,e=a.max_z,g=a.min_x,h=a.min_y,n=a.min_z;b[0]=g;b[1]=h;b[2]=n;b[3]=d;b[4]=h;b[5]=n;b[6]=d;b[7]=c;b[8]=n;b[9]=g;b[10]=
c;b[11]=n;b[12]=g;b[13]=h;b[14]=e;b[15]=d;b[16]=h;b[17]=e;b[18]=d;b[19]=c;b[20]=e;b[21]=g;b[22]=c;b[23]=e;return b}function b(a,b,d){l.add(b,d,a.center);l.scale(a.center,.5,a.center);a.radius=l.distance(a.center,b);return a}var e=t("__tsr"),d=t("__util"),l=t("__vec3"),n=new Float32Array(24),q=new Float32Array(3),g=new Float32Array(3),u=new Float32Array(3);a.copy_bb=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.big_bounding_box=function(){return{max_x:1E12,
min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12}};a.zero_bounding_box=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.expand_bounding_box=function(a,b){var d=a.max_y,c=a.max_z,e=a.min_x,g=a.min_y,h=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,d);a.max_z=Math.max(b.max_z,c);a.min_x=Math.min(b.min_x,e);a.min_y=Math.min(b.min_y,g);a.min_z=Math.min(b.min_z,h);return a};a.bb_from_coords=v;a.bounding_box_transform=function(b,
f,d){d||(d=a.zero_bounding_box());b=c(b,n);e.transform_vectors(b,f,b);return v(b,d)};a.extract_bb_corners=c;a.shrink_bounding_box=function(b,d,c){c||(c=a.zero_bounding_box());var e=d.min_x,g=d.max_x,n=d.min_y,h=d.max_y,x=d.min_z;d=d.max_z;if(e>=b.max_x||g<=b.min_x||n>=b.max_y||h<=b.min_y||x>=b.max_z||d<=b.min_z)return c.min_x=-.1,c.max_x=.1,c.min_y=-.1,c.max_y=.1,c.min_z=-.2,c.max_z=-.1,c;c.min_x=Math.max(b.min_x,e);c.max_x=Math.min(b.max_x,g);c.min_y=Math.max(b.min_y,n);c.max_y=Math.min(b.max_y,
h);c.min_z=Math.max(b.min_z,x);c.max_z=Math.min(b.max_z,d);return c};a.stretch_bounding_box=function(b,d,c){c||(c=a.zero_bounding_box());var e=b.max_x-b.min_x,g=b.max_y-b.min_y,n=b.max_z-b.min_z;c.min_x=b.min_x-.5*(d-1)*e;c.max_x=b.max_x+.5*(d-1)*e;c.min_y=b.min_y-.5*(d-1)*g;c.max_y=b.max_y+.5*(d-1)*g;c.min_z=b.min_z-.5*(d-1)*n;c.max_z=b.max_z+.5*(d-1)*n;return c};a.bounding_sphere_transform=function(b,d,c){c||(c=a.zero_bounding_sphere());e.transform_vec3(b.center,d,c.center);c.radius=b.radius*e.get_scale(d);
return c};a.bounding_ellipsoid_transform=function(a,b,d){d||(d={axis_x:new Float32Array(3),axis_y:new Float32Array(3),axis_z:new Float32Array(3),center:new Float32Array([0,0,0])});e.transform_vec3(a.center,b,d.center);l.copy(a.axis_x,d.axis_x);l.copy(a.axis_y,d.axis_y);l.copy(a.axis_z,d.axis_z);e.transform_dir_vec3(d.axis_x,b,d.axis_x);e.transform_dir_vec3(d.axis_y,b,d.axis_y);e.transform_dir_vec3(d.axis_z,b,d.axis_z);return d};a.create_bounding_sphere=function(a,b){return{radius:a,center:new Float32Array(b)}};
a.zero_bounding_sphere=function(){return{center:new Float32Array([0,0,0]),radius:0}};a.create_bounding_ellipsoid=function(a,b,d,c){return{axis_x:new Float32Array(a),axis_y:new Float32Array(b),axis_z:new Float32Array(d),center:new Float32Array([c[0],c[1],c[2]])}};a.big_bounding_sphere=function(){return{center:new Float32Array([0,0,0]),radius:1E12}};a.expand_bounding_sphere=function(a,b){var d=l.subtract(b.center,a.center,l.create());0==l.length(d)&&l.set(1,0,0,d);var c=l.normalize(d,l.create()),d=
l.scale(c,a.radius,l.create());l.add(d,a.center,d);var e=l.scale(c,-a.radius,l.create());l.add(e,a.center,e);var g=l.scale(c,b.radius,l.create());l.add(g,b.center,g);var h=l.scale(c,-b.radius,l.create());l.add(h,b.center,h);d=[d,e,g,h];c=l.normalize(c,l.create());e=d[0];g=d[0];for(h=1;h<d.length;h++){var n=l.dot(d[h],c);n<l.dot(e,c)&&(e=d[h]);n>l.dot(g,c)&&(g=d[h])}c=[e,g];d=c[0];c=c[1];a.center=l.scale(l.add(d,c,l.create()),.5,l.create());a.radius=l.length(l.subtract(c,d,l.create()))/2};a.create_bounding_capsule=
function(a,b){var d=b.max_y,c=b.min_y,e=Math.max(0,d-c-2*a);return{radius:a,height:e,center:new Float32Array([0,(d+c)/2,0])}};a.create_bounding_cylinder=function(a,b){var d=b.max_y,c=b.min_y,e=Math.max(0,d-c);return{radius:a,height:e,center:new Float32Array([0,(d+c)/2,0])}};a.create_bounding_cone=function(a,b){var d=b.max_y,c=b.min_y,e=Math.max(0,d-c);return{radius:a,height:e,center:new Float32Array([0,(d+c)/2,0])}};a.check_bb_intersection=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:
a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.recalculate_mesh_boundings=function(a){for(var b=0,d=0,c=0,e=0,g=0,h=0,n=0,l=0,r=0;r<a.submeshes.length;r++){var m=a.submeshes[r];if(m.position.length){b=e=m.position[0];d=g=m.position[1];c=h=m.position[2];break}}for(r=0;r<a.submeshes.length;r++)for(var m=a.submeshes[r],m=m.position,q=0;q<m.length/3;q++)var y=m[3*q],u=m[3*q+1],L=m[3*q+2],b=Math.max(y,b),d=Math.max(u,d),c=Math.max(L,c),e=Math.min(y,e),g=Math.min(u,g),h=Math.min(L,
h),n=Math.max(Math.sqrt(y*y+u*u+L*L),n),l=Math.max(Math.sqrt(y*y+L*L),l);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=e;a.b4w_bounding_box.max_y=d;a.b4w_bounding_box.min_y=g;a.b4w_bounding_box.max_z=c;a.b4w_bounding_box.min_z=h;a.b4w_bounding_box_source.max_x=b;a.b4w_bounding_box_source.min_x=e;a.b4w_bounding_box_source.max_y=d;a.b4w_bounding_box_source.min_y=g;a.b4w_bounding_box_source.max_z=c;a.b4w_bounding_box_source.min_z=h;a.b4w_bounding_sphere_radius=n;a.b4w_bounding_cylinder_radius=
l};a.get_frustum_mec=function(k){var f=k.subarray(0,3),c=k.subarray(6,9),e=k.subarray(12,15),n=k.subarray(18,21);k=l.subtract(c,f,q);l.normalize(k,k);var A=d.get_plane_normal(f,c,e,g),A=l.cross(A,k,A);l.normalize(A,A);var h=l.create(),x=l.create();l.subtract(c,f,u);x[0]=l.dot(u,k);x[1]=l.dot(u,A);c=l.create();l.subtract(e,f,u);c[0]=l.dot(u,k);c[1]=l.dot(u,A);e=l.create();l.subtract(n,f,u);e[0]=l.dot(u,k);e[1]=l.dot(u,A);n=a.zero_bounding_sphere();e=[h,x,c,e];h=b(n,e[0],e[1]);for(n=2;n<e.length;n++)if(l.distance(h.center,
e[n])>h.radius){for(var w=h,h=e,x=e[n],c=n-1,w=b(w,x,h[0]),r=1;r<=c;r++)if(l.distance(w.center,h[r])>w.radius){for(var m=w,w=h,E=x,y=h[r],M=r-1,m=b(m,E,y),L=0;L<=M;L++)if(l.distance(m.center,w[L])>m.radius){var N=E,B=y,O=w[L],F=l.subtract(B,O,u),F=l.squaredLength(F),C=l.subtract(N,O,u),I=l.squaredLength(C),C=l.subtract(N,B,u),Q=l.squaredLength(C),C=F*(I+Q-F),G=I*(Q+F-I),F=Q*(F+I-Q),I=C+G+F;l.copy(N,m.center);l.scale(m.center,C/I,m.center);l.scaleAndAdd(m.center,B,G/I,m.center);l.scaleAndAdd(m.center,
O,F/I,m.center);m.radius=l.distance(m.center,N)}w=m}h=w}n=h;k=l.scale(k,n.center[0],u);l.scaleAndAdd(k,A,n.center[1],k);l.add(k,f,n.center);return n}};b4w.module.__compat=function(a,t){function v(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}function c(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function b(){return!window.ActiveXObject&&"ActiveXObject"in window}var e=t("__config"),d=t("__extensions"),l=t("__print");
t("__util");var n="R600;RV610;RV630;RV620;RV635;RV670;RS780;RS880;RV770;RV730;RV710;RV740;CEDAR;REDWOOD;JUNIPER;CYPRESS;PALM (Wrestler/Ontario);SUMO (Llano);SUMO2 (Llano);ARUBA (Trinity/Richland);BARTS;TURKS;CAICOS;CAYMAN".split(";"),q=e.animation,g=e.defaults,u=e.context,k=e.scenes,f=e.sfx,p=e.physics;a.detect_tegra_invalid_enum_issue=function(a){a.getError()==a.INVALID_ENUM&&l.warn("Possible Tegra invalid enum issue detected, ignoring")};a.set_hardware_defaults=function(a){g.max_vertex_uniform_vectors=
a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS);g.max_texture_size=a.getParameter(a.MAX_TEXTURE_SIZE);g.max_cube_map_size=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);g.msaa_samples=g.webgl2?Math.min(g.msaa_samples,a.getParameter(a.MAX_SAMPLES)):1;var e=Boolean(d.get_depth_texture());v("Firefox/28.0")&&(v("Linux")||v("Macintosh"))&&(l.warn("Firefox 28 detected, applying depth hack"),e=!1);v("Windows Phone")||(v("iPad")||v("iPhone")?(l.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack, applying ios depth hack and disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),
u.alpha||(g.background_color[3]=1),g.vert_anim_mix_normals_hack=!0,g.smaa=!1,g.ssao=!1,g.precision="highp",g.init_wa_context_hack=!0,g.ios_depth_hack=!0):v("Mac OS X")&&v("Safari")&&!v("Chrome")&&(l.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures. Applying canvas alpha hack."),g.safari_canvas_alpha_hack=!0,f.audio_loading_hack=!0,f.clamp_playback_rate_hack=!0));v("Windows")&&(v("Chrome/40")||v("Firefox/33")||v("Firefox/34")||v("Firefox/35")||
v("Firefox/36"))&&(l.warn("Windows/Chrome40 or Firefox33-36 detected. Applying clear procedural skydome hack."),g.clear_procedural_sky_hack=!0);c()&&(l.warn("Mobile detected, applying various hacks for video textures."),g.is_mobile_device=!0,v("iPad")||v("iPhone")||v("Windows Phone")||(l.warn("Mobile (not iOS) detected, disable playback rate for video textures."),f.disable_playback_rate_hack=!0));(v("Firefox/35.0")||v("Firefox/36.0"))&&v("Windows")&&(l.warn("Windows/Firefox 35/36 detected, applying shadows slink hack"),
g.firefox_shadows_slink_hack=!0);if(v("iPhone")||b()||v("Edge"))l.warn("iPhone, IE11 or Edge detected. Enable sequential video fallback for video textures."),g.seq_video_fallback=!0;10>a.getParameter(a.MAX_VARYING_VECTORS)&&(l.warn("Not enough varyings, disable shadows on blend objects"),g.disable_blend_shadows_hack=!0);v("Windows Phone")&&(l.warn("Windows Phone detected. Disable wireframe mode, glow materials, ssao, smaa, shadows, reflections, refractions."),g.wireframe_debug=!1,g.precision="highp",
g.glow_materials=!1,g.ssao=!1,g.smaa=!1,g.shadows=!1,g.reflections=!1,g.refractions=!1,g.quality_aa_method=!1);v("Firefox")&&g.is_mobile_device&&(l.warn("Mobile Firefox detected, applying depth hack, disable workers."),e=p.use_workers=!1);var A=d.get_renderer_info();if(A){var h=a.getParameter(A.UNMASKED_VENDOR_WEBGL),A=a.getParameter(A.UNMASKED_RENDERER_WEBGL),x=/\b4\d{2}\b/;v("Macintosh")&&-1<A.indexOf("Intel HD Graphics 3000")&&(l.warn("OS X / Intel HD 3000 detected, applying depth hack"),e=!1);
-1<h.indexOf("ARM")&&x.test(A)&&(l.warn("ARM Mali-400 series detected, applying depth and frames blending hacks"),e=!1,q.frames_blending_hack=!0);-1<h.indexOf("ARM")&&-1<A.indexOf("Mali-T604")&&(l.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),g.precision="highp",g.shadows=!1);-1<h.indexOf("ARM")&&-1<A.indexOf("Mali-T760")&&(l.warn('ARM Mali-T760 detected, set "highp" precision and disable SSAO.'),g.precision="highp",g.ssao=!1,g.amd_skinning_hack=!0);-1<h.indexOf("Qualcomm")&&
-1<A.indexOf("Adreno")&&(l.warn("Qualcomm Adreno detected, applying shader constants hack."),g.shader_constants_hack=!0,-1<A.indexOf("305")&&(l.warn('Qualcomm Adreno305 detected, set "highp" precision.'),g.precision="highp"),-1<A.indexOf("330")&&(l.warn('Qualcomm Adreno330 detected, set "highp" precision.'),g.precision="highp"));-1<h.indexOf("NVIDIA")&&-1<A.indexOf("Tegra 3")&&(l.warn("NVIDIA Tegra 3 detected, force low quality for B4W_LEVELS_OF_QUALITY nodes."),g.force_low_quality_nodes=!0);v("Windows")&&
v("Chrome")&&!v("Edge")&&(A.match(/NVIDIA GeForce 8..0/)||A.match(/NVIDIA GeForce 9..0/))&&(l.warn("Chrome / Windows / NVIDIA GeForce 8000/9000 series detected, setting max cubemap size to 256, use canvas for resizing."),g.max_cube_map_size=256,g.resize_cubemap_canvas_hack=!0);h="";for(x=0;x<n.length;x++)if(-1<A.indexOf(n[x])){h=n[x];break}h&&(l.warn("Architecture "+h+" detected. Blending between frames and shadows on blend objects will be disabled. Applying clear depth hack."),g.arch_mesa_clear_depth_hack=
!0,g.amd_skinning_hack=!0,g.disable_blend_shadows_hack=!0)}0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(l.warn("Vertex textures are not allowed. Disabling vertex textures"),g.allow_vertex_textures=!1);e||(g.foam=!1,g.parallax=!1,g.dynamic_grass=!1,g.water_dynamic=!1,g.shore_smoothing=!1,g.shore_distance=!1,g.smaa=!1);g.use_dds=Boolean(d.get_s3tc());g.depth_tex_available=e;e=a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT);a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT);
0===e.precision&&(g.precision="mediump");b()&&(l.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),k.cubemap_tex_size=512);if(b()&&v("Touch")||v("Edge"))l.warn("IE11 and touchscreen or Edge detected. Behaviour of the mouse move sensor will be changed."),g.ie11_edge_touchscreen_hack=!0;128>=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)&&(l.warn("Not enough fragment uniforms, force low quality for B4W_LEVELS_OF_QUALITY nodes."),g.force_low_quality_nodes=!0);v("Chrome")&&!v("Edge")&&
(l.log("Chrome detected. Some of deprecated functions related to the Doppler effect won't be called."),g.cors_chrome_hack=!0);if(v("Chrome")&&!v("Edge")||v("Firefox"))g.disable_doppler_hack=!0;if(b()||v("iPad"))l.warn("iPad or Internet Explorer detected. Applying alpha clip hack."),g.alpha_clip_filtering_hack=!0;c()&&v("Firefox")&&(l.log("Mobile firefox detected. Applying autoplay media hack."),g.mobile_firefox_media_hack=!0);v("Edge")&&(l.warn("Microsoft Edge detected, set up new minimal texture size."),
g.edge_min_tex_size_hack=!0)};a.check_user_agent=v;a.detect_mobile=c;a.apply_context_alpha_hack=function(){v("Firefox/35.0")&&v("Windows")&&(l.warn("Windows/Firefox 35 detected, forcing context's alpha"),e.context.alpha=!0)};a.is_ie11=b};b4w.module.__constraints=function(a,t){function v(a){var b={};b.type=a;return b}function c(a,d){a.constraint&&a.constraint.obj_parent&&b(a.constraint.obj_parent,a);if(d.obj_parent){var m=d.obj_parent;if(-1==m.cons_descends.indexOf(a))m.cons_descends.push(a);else throw"Descendant object override is forbidden";}a.constraint=d}function b(a,b){var d=a.cons_descends.indexOf(b);if(-1!=d)a.cons_descends.splice(d,1);else throw"No descendant object";}function e(a,b,d){switch(b.type){case 1:var c=k.get_quat_view(a.render.world_tsr),
C=b.obj_parent.render.world_tsr;d=k.get_quat_view(b.obj_parent.render.world_tsr);b.rotation_offset?(u.copy(b.rotation_offset,c),u.multiply(d,c,c)):u.copy(d,c);var e=k.transform_vec3(b.offset,C,h);k.set_trans(e,a.render.world_tsr);e=k.get_scale(b.obj_parent.render.world_tsr);k.set_scale(b.scale_offset*e,a.render.world_tsr);break;case 9:e=k.get_trans_view(a.render.world_tsr);c=k.get_quat_view(a.render.world_tsr);C=b.obj_parent.render.world_tsr;d=k.get_quat_view(b.obj_parent.render.world_tsr);u.multiply(u.invert(b.parent_prev_rotation,
b.parent_prev_rotation),c,c);u.multiply(d,c,c);k.transform_vec3(b.offset,C,e);u.copy(d,b.parent_prev_rotation);break;case 10:e=k.get_trans_view(a.render.world_tsr);c=k.get_quat_view(a.render.world_tsr);C=b.obj_parent.render.world_tsr;d=k.get_quat_view(b.obj_parent.render.world_tsr);u.multiply(u.invert(b.parent_prev_rotation,b.parent_prev_rotation),c,c);u.multiply(d,c,c);k.transform_vec3(b.offset,C,e);u.copy(d,b.parent_prev_rotation);e=k.get_quat_view(a.render.world_tsr);c=k.get_quat_view(b.obj_parent.render.world_tsr);
c=u.multiply(c,b.rotation_offset,m);c=q.get_camera_angles_from_quat(c,D);d=q.get_camera_angles_from_quat(e,A);e=f.calc_returning_angle(d[0],c[0]+b.clamp_right,c[0]+b.clamp_left);c=f.calc_returning_angle(d[1],c[1]+b.clamp_down,c[1]+b.clamp_up);q.rotate_eye_camera(a,e,c);break;case 13:var e=k.get_trans_view(a.render.world_tsr),c=k.get_quat_view(a.render.world_tsr),C=b.obj_parent.render.world_tsr,r=k.get_trans_view(C),G=b.softness,z=h,x=m;k.transform_vec3(b.offset,C,z);f.smooth_v(z,e,d,G,e);C=h;p.sub(r,
e,C);p.normalize(C,C);var U=c,e=E,r=e.subarray(0,3),z=e.subarray(3,6),w=e.subarray(6,9);p.copy(C,z);p.negate(z,z);p.normalize(z,z);Boolean(.999999<Math.abs(p.dot(C,f.AXIS_Y)))?(C=g.fromQuat(u.normalize(U,x),y),p.copy(C.subarray(0,3),r)):p.cross(f.AXIS_Y,z,r);p.normalize(r,r);p.cross(r,z,w);p.normalize(w,w);u.fromMat3(e,x);u.normalize(x,x);f.smooth_q(x,c,d,.16*G,c);break;case 2:c=k.get_quat_view(a.render.world_tsr);d=M;K.get_bone_tsr(b.obj_parent,b.bone_name,!0,!1,d);k.multiply(b.obj_parent.render.world_tsr,
d,d);c[0]=d[4];c[1]=d[5];c[2]=d[6];c[3]=d[7];b.rotation_offset&&(u.copy(b.rotation_offset,c),u.multiply(c,b.rotation_offset,c));k.set_scale(b.scale_offset*d[3],a.render.world_tsr);e=k.get_trans_view(a.render.world_tsr);k.transform_vec3(b.offset,d,e);break;case 3:e=k.get_trans_view(a.render.world_tsr);c=k.get_quat_view(a.render.world_tsr);d=k.get_trans_view(b.obj_parent.render.world_tsr);l(e,c,d);break;case 4:e=k.get_trans_view(a.render.world_tsr);c=k.get_quat_view(a.render.world_tsr);d=b.target;l(e,
c,d);break;case 5:e=k.get_trans_view(a.render.world_tsr);c=k.get_quat_view(a.render.world_tsr);d=k.get_trans_view(b.obj_parent.render.world_tsr);l(e,c,d);c=p.dist(e,d);if(c=c>b.dist_max?c-b.dist_max:c<b.dist_min?c-b.dist_min:0)p.sub(d,e,h),p.normalize(h,h),p.scale(h,c,h),p.add(e,h,e);break;case 6:e=k.get_trans_view(a.render.world_tsr);c=k.get_quat_view(a.render.world_tsr);d=b.target;l(e,c,d);c=p.dist(e,d);if(c=c>b.dist_max?c-b.dist_max:c<b.dist_min?c-b.dist_min:0)p.sub(d,e,h),p.normalize(h,h),p.scale(h,
c,h),p.add(e,h,e);break;case 7:C=b.obj_parent.render.world_tsr;e=k.get_trans_view(a.render.world_tsr);k.transform_vec3(b.offset,C,e);break;case 8:r=k.get_trans_view(b.obj_parent.render.world_tsr);e=k.get_trans_view(a.render.world_tsr);p.add(r,b.offset,e);break;case 14:c=k.get_quat_view(a.render.world_tsr);C=b.obj_parent.render.world_tsr;d=k.get_quat_view(b.obj_parent.render.world_tsr);b.rotation_offset?(u.copy(b.rotation_offset,c),u.multiply(d,c,c)):u.copy(d,c);e=k.get_trans_view(a.render.world_tsr);
k.transform_vec3(b.offset,C,e);break;case 11:k.multiply(b.obj_parent.render.world_tsr,b.tsr_offset,a.render.world_tsr);break;case 12:e=b.tsr_offset;d=M;K.get_bone_tsr(b.obj_parent,b.bone_name,!0,!1,d);k.multiply(b.obj_parent.render.world_tsr,d,d);k.multiply(d,e,a.render.world_tsr);break;case 15:c=b.obj_parent,d=q.get_first_cam(c),e=k.get_trans_view(a.render.world_tsr),G=q.get_edge(d,"TOP"),x=q.get_edge(d,"BOTTOM"),C=G-x,b.left_edge?(r=q.get_edge(d,"LEFT"),e[0]=r+C*b.left_right_dist):(r=q.get_edge(d,
"RIGHT"),e[0]=r-C*b.left_right_dist),e[2]=b.top_edge?-(G-C*b.top_bottom_dist):-(x+C*b.top_bottom_dist),q.is_ortho(d)?e[1]=-b.distance:(e[1]=-1,p.normalize(e,e),d=b.distance/Math.abs(e[1]),p.scale(e,d,e)),k.transform_dir_vec3(e,c.render.world_tsr,e),d=k.get_trans_view(c.render.world_tsr),p.add(d,e,e),e=k.get_quat_view(a.render.world_tsr),c=k.get_quat_view(c.render.world_tsr),b.rotation_offset?(u.copy(b.rotation_offset,e),u.multiply(c,e,e)):u.copy(c,e)}"CAMERA"==a.render.type&&(e=f.AXIS_Y,10==b.type&&
(d=k.get_quat_view(b.obj_parent.render.world_tsr),e=p.transformQuat(e,d,L)),q.update_camera_upside_down(a),n(a,e))}function d(a,b){switch(b.type){case 1:var d=b.target.render.world_tsr,c=M;k.invert(a.render.world_tsr,c);k.multiply(c,d,c);K.set_bone_tsr(a,b.bone_name,c,!1)}a.need_update_transform=!0}function l(a,b,d){var c=h;f.quat_to_dir(b,f.AXIS_MY,c);p.normalize(c,c);var m=x;p.subtract(d,a,m);p.normalize(m,m);a=f.rotation_to_stable(c,m,r);u.multiply(a,b,b);u.normalize(b,b)}function n(a,b,d){var c=
a.render,C=k.get_quat_view(c.world_tsr),e=f.quat_to_dir(C,f.AXIS_Y,h);p.normalize(e,e);if(.999999<Math.abs(p.dot(b,e)))e=u.identity(m);else{var r=p.cross(b,e,x);p.normalize(r,r);c.move_style==q.MS_TARGET_CONTROLS?c.target_cam_upside_down&&p.negate(r,r):(c=f.quat_to_dir(C,f.AXIS_Z,w),0<p.dot(c,b)&&p.negate(r,r));c=f.quat_to_dir(C,f.AXIS_X,w);p.normalize(c,c);var G=f.clamp(p.dot(c,r),-1,1);-.999999>=G?(r=Math.acos(G),e=u.setAxisAngle(e,r,m)):e=u.rotationTo(c,r,m);u.normalize(e,e)}u.multiply(e,C,C);
d&&(d=f.quat_to_dir(C,f.AXIS_MZ,h),0>p.dot(b,d)&&u.rotateY(C,Math.PI,C));q.update_camera_upside_down(a)}var q=t("__camera"),g=t("__mat3"),u=t("__quat"),k=t("__tsr"),f=t("__util"),p=t("__vec3"),K=t("__armature");a.CONS_TYPE_STIFF_OBJ=1;a.CONS_TYPE_STIFF_BONE=2;a.CONS_TYPE_TRACK_OBJ=3;a.CONS_TYPE_TRACK_POINT=4;a.CONS_TYPE_FOLLOW_OBJ=5;a.CONS_TYPE_FOLLOW_POINT=6;a.CONS_TYPE_STIFF_TRANS_OBJ=7;a.CONS_TYPE_COPY_TRANS_OBJ=8;a.CONS_TYPE_SEMI_STIFF_OBJ=9;a.CONS_TYPE_SEMI_STIFF_CAM_OBJ=10;a.CONS_TYPE_CHILD_OF=
11;a.CONS_TYPE_CHILD_OF_BONE=12;a.CONS_TYPE_SEMI_SOFT_CAM_OBJ=13;a.CONS_TYPE_STIFF_TRANS_ROT_OBJ=14;a.CONS_TYPE_STIFF_VIEWPORT=15;a.BONE_CONS_TYPE_STIFF_OBJ=1;var D=new Float32Array(2),A=new Float32Array(2),h=new Float32Array(3),x=new Float32Array(3),w=new Float32Array(3),r=new Float32Array(4),m=new Float32Array(4),E=new Float32Array(9),y=new Float32Array(9),M=k.create(),L=new Float32Array(3);a.append_stiff_obj=function(a,b,d,m,k){var f=v(1);f.obj_parent=b;f.offset=new Float32Array(d);f.rotation_offset=
m?new Float32Array(m):null;f.scale_offset=k;c(a,f);e(a,f,0)};a.append_stiff_bone=function(a,b,d,m,k,f){var h=v(2);h.obj_parent=b;h.bone_name=d;h.offset=new Float32Array(m);h.rotation_offset=k?new Float32Array(k):null;h.scale_offset=f;c(a,h);e(a,h,0)};a.append_semi_stiff_obj=function(a,b,d,m){var f=v(9),h=k.get_quat_view(a.render.world_tsr),r=k.get_quat_view(b.render.world_tsr);f.obj_parent=b;f.offset=new Float32Array(d);f.parent_prev_rotation=new Float32Array(r);m&&(u.copy(m,h),u.multiply(r,h,h));
c(a,f);e(a,f,0)};a.append_semi_stiff_cam_obj=function(a,b,d,m,C,h,r,G){var z=v(10),g=k.get_quat_view(a.render.world_tsr),p=k.get_quat_view(b.render.world_tsr);z.obj_parent=b;z.offset=new Float32Array(d);z.parent_prev_rotation=new Float32Array(p);z.clamp_left=f.angle_wrap_0_2pi(C);z.clamp_right=f.angle_wrap_0_2pi(h);z.clamp_up=f.angle_wrap_periodic(r,-Math.PI,Math.PI);z.clamp_down=f.angle_wrap_periodic(G,-Math.PI,Math.PI);m?(z.rotation_offset=new Float32Array(m),u.copy(m,g),u.multiply(p,g,g)):z.rotation_offset=
u.create();c(a,z);e(a,z,0)};a.append_semi_soft_cam_obj=function(a,b,d,m){var k=v(13);k.obj_parent=b;k.offset=new Float32Array(d);k.softness=m;c(a,k);e(a,k,0)};a.append_stiff_trans_rot_obj=function(a,b,d,m,k){var f=v(14);f.obj_parent=b;f.offset=new Float32Array(d);f.scale_offset=k||1;f.rotation_offset=m?new Float32Array(m):null;c(a,f);e(a,f,0)};a.remove_parent_descendant=b;a.append_track_obj=function(a,b){var d=v(3);d.obj_parent=b;c(a,d);e(a,d,0)};a.append_track_point=function(a,b){var d=v(4);d.target=
new Float32Array(b);c(a,d);e(a,d,0)};a.append_follow_obj=function(a,b,d,m){var k=v(5);k.obj_parent=b;k.dist_min=d;k.dist_max=m;c(a,k);e(a,k,0)};a.append_follow_point=function(a,b,d,m){var k=v(6);k.target=new Float32Array(b);k.dist_min=d;k.dist_max=m;c(a,k);e(a,k,0)};a.append_stiff_trans_obj=function(a,b,d){var m=v(7);m.obj_parent=b;m.offset=new Float32Array(d);c(a,m);e(a,m,0)};a.append_copy_trans_obj=function(a,b,d){var m=v(8);m.obj_parent=b;m.offset=new Float32Array(d);c(a,m);e(a,m,0)};a.append_child_of=
function(a,b,d){var m=v(11);m.obj_parent=b;m.tsr_offset=new Float32Array(d);c(a,m);e(a,m,0)};a.append_child_of_bone=function(a,b,d,m){var k=v(12);k.obj_parent=b;k.bone_name=d;k.tsr_offset=new Float32Array(m);c(a,k);e(a,k,0)};a.append_stiff_viewport=function(a,b,d){var m=v(15);m.obj_parent=b;if("left"in d)m.left_edge=!0,m.left_right_dist=d.left;else if("right"in d)m.left_edge=!1,m.left_right_dist=d.right;else{m_print.error("append_stiff_viewport: Wrong positioning params");return}if("top"in d)m.top_edge=
!0,m.top_bottom_dist=d.top;else if("bottom"in d)m.top_edge=!1,m.top_bottom_dist=d.bottom;else{m_print.error("append_stiff_viewport: Wrong positioning params");return}"distance"in d?(m.distance=d.distance,m.rotation_offset="rotation"in d?new Float32Array(d.rotation):null,c(a,m),e(a,m,0)):m_print.error("append_stiff_viewport: Wrong positioning params")};a.update_constraint=function(a,b){a.constraint&&e(a,a.constraint,b)};a.append_stiff_bone_to_obj=function(a,b,m,c,k,f){var e=v(1);e.bone_name=m;e.target=
b;e.offset=new Float32Array(c);e.rotation_offset=k?new Float32Array(k):null;e.scale_offset=f;b=e.target;m=e.bone_name;c=a.render.bone_pointers[m];k=b.cons_armat_bone_descends;for(f=0;f<k;f++){var G=k[f];if(G[0]==a&&G[1]==m){k.splice(f,1);break}}b.cons_armat_bone_descends.push([a,m]);c.constraint=e;d(a,e)};a.update_bone_constraint=function(a,b){var m=a.render.bone_pointers[b];m.constraint&&d(a,m.constraint)};a.rotate_to=l;a.correct_up=n;a.check_constraint=function(a){return a.constraint?!0:!1};a.remove=
function(a){a.constraint.obj_parent&&b(a.constraint.obj_parent,a);a.constraint=null};a.get_type=function(a){return a.constraint?a.constraint.type:null};a.has_child_of=function(a){a=a.constraint;return!a||11!=a.type&&12!=a.type?!1:!0};a.get_child_of_parent_tsr=function(a){if((a=a.constraint)&&11==a.type)return a.obj_parent.render.world_tsr;if(a&&12==a.type){var b=M;K.get_bone_tsr(a.obj_parent,a.bone_name,!0,!1,b);k.multiply(a.obj_parent.render.world_tsr,b,b);return b}return null};a.get_child_of_offset=
function(a){a=a.constraint;return!a||11!=a.type&&12!=a.type?null:a.tsr_offset}};b4w.module.__container=function(a,t){var v,c,b,e,d;function l(a,b){v=a;c=b}function n(){var a=w.getBoundingClientRect();l(a.left,a.top)}function q(){return x.allow_hidpi&&2<=window.devicePixelRatio?!0:!1}var g=t("__anchors"),u=t("__config"),k=t("__data"),f=t("__hud");t("__objects");var p=t("__print"),K=t("__scenes"),D=t("__time"),A=t("__transform"),h=t("__util"),x=u.defaults,w=null,r=null,m=null,E=!1;e=b=0;d=1;v=c=0;var y=null;a.DEFAULT_CANVAS_W=320;a.DEFAULT_CANVAS_H=240;a.setup_context=function(a){y=
a};a.get_canvas=function(){return w};a.get_canvas_hud=function(){return r};a.get_container=function(){return m};a.init=function(a,b){a&&a.parentNode?(w=a,r=b,m=a.parentNode):h.panic("canvas container is not available")};a.insert_to_container=function(a,b){b=b||"LAST";switch(b){case "FIRST":m.insertBefore(a,m.firstElementChild);break;case "JUST_BEFORE_CANVAS":m.insertBefore(a,w);break;case "JUST_AFTER_CANVAS":w.nextElementSibling?m.insertBefore(a,w.nextElementSibling):m.appendChild(a,w);break;case "LAST":m.appendChild(a,
w);break;default:p.error(b+" invalid stack order")}};a.get_viewport_width=function(){return b};a.get_viewport_height=function(){return e};a.set_canvas_offsets=l;a.update_canvas_offsets=n;a.setup_viewport_dim=function(a,m,c){b=a;e=m;d=c;n()};a.force_offsets_updating=function(){E=!0};a.client_to_canvas_coords=function(a,b,d){d||(d=new Float32Array(2));var m=d;E&&(n(),E=!1);m[0]=a-v;a=d;E&&(n(),E=!1);a[1]=b-c;return d};a.canvas_to_viewport_coords=function(a,m,c,k){c||(c=new Float32Array(2));c[0]=a*d;
c[1]=m*d;k&&(a=k.width/b,c[0]*=a,c[1]*=a);return c};a.viewport_to_canvas_coords=function(a,m,c,k){c||(c=new Float32Array(2));c[0]=a/d;c[1]=m/d;k&&(a=k.width/b,c[0]/=a,c[1]/=a);return c};a.is_child=function(b){return b&&b.parentNode?b.parentNode==m?!0:a.is_child(b.parentNode):!1};a.is_hidpi=q;a.find_script=function(a){var b=document.getElementsByTagName("script");a=h.normpath_preserve_protocol(a);for(var d=0;d<b.length;d++)if(b[d].src==a)return b[d];return null};a.resize=function(b,d,c){if(!b||!d){b=
a.DEFAULT_CANVAS_W;d=a.DEFAULT_CANVAS_H;var e=m;e.style.width=a.DEFAULT_CANVAS_W+"px";e.style.height=a.DEFAULT_CANVAS_H+"px"}var e=w,h=r;!1!==c&&(e.style.width=b+"px",e.style.height=d+"px",h&&(h.style.width=b+"px",h.style.height=d+"px"));h&&(h.width=b,h.height=d,f.update_dim());if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))x.canvas_resolution_factor=1;c=Math.floor(b*x.canvas_resolution_factor);d=Math.floor(d*x.canvas_resolution_factor);
q()&&(c*=window.devicePixelRatio,d*=window.devicePixelRatio);k.is_primary_loaded()&&(h=K.get_active()._render,c=Math.floor(c*h.resolution_factor),d=Math.floor(d*h.resolution_factor));e.width=c;e.height=d;if(c>y.drawingBufferWidth||d>y.drawingBufferHeight)p.warn("Canvas size exceeds platform limits, downscaling"),h=Math.min(y.drawingBufferWidth/c,y.drawingBufferHeight/d),c*=h,d*=h,e.width=c,e.height=d;K.setup_dim(c,d,c/b);K.check_active()&&A.update_transform(K.get_active()._camera);k.update_media_controls(e.width,
e.height);k.is_primary_loaded()&&(g.update(),K.update(D.get_timeline(),0),g.update_visibility())}};b4w.module.__controls=function(a,t){function v(a){return{type:a,value:0,payload:null,do_activation:!1,key:0,collision_id:"",calc_pos_norm:!1,collision_obj:null,collision_cb:function(){},col_imp_obj:null,col_imp_cb:function(){},source_object:null,from:new Float32Array(3),to:new Float32Array(3),is_binary_value:!1,ign_src_rot:!1,ray_test_id:0,ray_test_cb:function(){},axis:"",time_last:0,trans_last:new Float32Array(3),quat_last:new Float32Array(4),threshold:0,quat_temp:new Float32Array(4),avg_linear_vel:0,
avg_angular_vel:0,rotation_threshold:0,avg_vertical_vel:0,period:0,repeat:!1,auto_release:!1,gyro_gamma_new:0,gyro_beta_new:0,gyro_alpha_new:0,gyro_gamma_last:0,gyro_beta_last:0,gyro_alpha_last:0}}function c(a,b){a.value=Number(b)}function b(a){for(var b=a.sensors,d=a.sensor_values,c=0;c<b.length;c++)d[c]=b[c].value;return a.logic_fun(d)}function e(a){a=I.indexOf(a);-1<a?I.splice(a,1):E.error("Wrong object")}function d(a,b){for(var d=0,c=0;c<b.length;c++)for(var m=b[c].sensor_manifolds_arr,k=0;k<
m.length;k++)for(var f=m[k].sensors,e=0;e<f.length;e++)f[e]===a&&d++;return d}function l(a,b){switch(a.type){case 80:y.remove_collision_test(a.collision_obj,a.collision_id,a.collision_cb);a.do_activation=!0;break;case 90:y.clear_collision_impulse_test(a.col_imp_obj);a.do_activation=!0;break;case 100:y.remove_ray_test(a.ray_test_id);a.do_activation=!0;break;case 130:a.do_activation=!0}var d=b.indexOf(a);-1<d&&b.splice(d,1)}function n(a){for(var b=0;b<Q.length;b++){var d=Q[b];20==d.type&&a.keyCode==
d.key&&c(d,1)}S&&a.preventDefault();ja&&ja(a)}function q(a){for(var b=0;b<Q.length;b++){var d=Q[b];20==d.type&&0==a.keyCode&&16==d.key&&c(d,0);20==d.type&&a.keyCode==d.key&&c(d,0)}S&&a.preventDefault();ja&&ja(a)}function g(a){var b=!1,d=null;fa=!0;P=a.clientX;da=a.clientY;Y=a.clientX;U=a.clientY;for(var k=0;k<Q.length;k++){var f=Q[k];50==f.type&&(c(f,1),f.payload=a.which);160==f.type&&(b||(b=r.client_to_canvas_coords(a.clientX,a.clientY,ba),d=m.pick_object(b[0],b[1]),b=!0),f.value=d==f.source_object?
1:0)}R&&a.preventDefault();ta&&ta(a)}function u(a){for(var b=0;b<Q.length;b++){var d=Q[b];50==d.type&&c(d,0);160==d.type&&d.auto_release&&(d.value=0)}fa=!1;R&&!na&&a.preventDefault();ta&&ta(a)}function k(a){var b=a.clientX,d=a.clientY;Y=b;U=d;if(!C.ie11_edge_touchscreen_hack||fa)for(var m=b-P,k=d-da,f=Math.sqrt(m*m+k*k),e=0;e<Q.length;e++){var z=Q[e];if(40===z.type)switch(z.axis){case "X":c(z,m);z.payload=b;break;case "Y":c(z,k);z.payload=d;break;case "XY":c(z,f),z.payload[0]=b,z.payload[1]=d}}R&&
!na&&a.preventDefault();ta&&ta(a)}function f(a){r.is_child(a.relatedTarget)||u(a)}function p(a){var b=a.wheelDelta||-40*a.detail,b=b*F.mouse_wheel_notch_multiplier;z+=b;for(b=0;b<Q.length;b++){var d=Q[b];30===d.type&&c(d,z)}ua&&a.preventDefault();ea&&ea(a)}function K(a){var b=a.targetTouches;if(1==b.length){for(var d=b[0],b=d.clientX,d=d.clientY,c=!1,k=null,f=0;f<Q.length;f++){var e=Q[f];160==e.type&&(c||(c=r.client_to_canvas_coords(b,d,ba),k=m.pick_object(c[0],c[1]),c=!0),e.value=k==e.source_object)}T[0]=
b;T[1]=-1;Z[0]=d;Z[1]=-1}else 1<b.length&&(ga=ka=x(b),T[0]=b[0].clientX,T[1]=b[1].clientX,Z[0]=b[0].clientY,Z[1]=b[1].clientY);aa.set(T);W.set(Z);qa&&qa(a)}function D(b){var d=b.targetTouches;if(0!==d.length){if(1===d.length){aa[0]=d[0].clientX;aa[1]=-1;W[0]=d[0].clientY;W[1]=-1;var d=aa[0]-T[0],m=W[0]-Z[0],k=Math.sqrt(d*d+m*m);if(-1!=T[1]&&-1!=Z[1]){var f=aa[0]-T[1],e=W[0]-Z[1],C=Math.sqrt(f*f+e*e);C<k&&(d=f,m=e,k=C)}for(C=0;C<Q.length;C++){var z=Q[C];if(60===z.type)switch(z.payload=a.PL_SINGLE_TOUCH_MOVE,
z.axis){case "X":c(z,d);break;case "Y":c(z,m);break;case "XY":c(z,k)}}}else if(1<d.length){aa[0]=d[0].clientX;aa[1]=d[1].clientX;W[0]=d[0].clientY;W[1]=d[1].clientY;ga=x(d);k=ga-ka;f=ba;f[0]=(aa[0]+aa[1])/2;f[1]=(W[0]+W[1])/2;e=pa;e[0]=(T[0]+T[1])/2;e[1]=(Z[0]+Z[1])/2;var G,d=f[0],m=f[1],C=e[0],z=e[1];G=Math.sqrt((d-C)*(d-C)+(m-z)*(m-z));for(C=0;C<Q.length;C++)if(z=Q[C],70===z.type&&Math.abs(G)<Math.abs(k)&&(z.payload=a.PL_MULTITOUCH_MOVE_ZOOM,c(z,k)),60===z.type&&Math.abs(G)>Math.abs(k))switch(z.payload=
a.PL_MULTITOUCH_MOVE_PAN,z.axis){case "X":d=f[0]-e[0];c(z,d);break;case "Y":m=f[1]-e[1];c(z,m);break;case "XY":c(z,G)}}ia&&b.preventDefault();qa&&qa(b)}}function A(a){if(0==a.targetTouches.length)for(var b=0;b<Q.length;b++){var d=Q[b];160==d.type&&d.auto_release&&c(d,0)}qa&&qa(a)}function h(a){for(var b=0;b<Q.length;b++){var d=Q[b];if(170==d.type||180==d.type)d.gyro_beta_new=a.beta,d.gyro_gamma_new=a.gamma,d.gyro_alpha_new=a.alpha,d.value||(d.gyro_gamma_last=a.gamma,d.gyro_beta_last=a.beta,d.gyro_alpha_last=
a.alpha,c(d,1))}}function x(a){var b=a[0],d=a[1];a=b.clientX;var b=b.clientY,c=d.clientX,d=d.clientY;return Math.sqrt((a-c)*(a-c)+(b-d)*(b-d))}var w=t("__config"),r=t("__container"),m=t("__objects"),E=t("__print"),y=t("__physics"),M=t("__quat"),L=t("__time"),N=t("__tsr"),B=t("__util"),O=t("__vec3"),F=w.controls,C=w.defaults,I=[],Q=[],G={},z=0,Y=0,U=0,P=0,da=0,fa=!1,aa=new Float32Array(2),W=new Float32Array(2),T=new Float32Array(2),Z=new Float32Array(2),ba=new Float32Array(2),pa=new Float32Array(2),
ga=0,ka=0,J=!1,V=0,S=!1,R=!1,ua=!1,ia=!1,na=!1,ja=null,ta=null,ea=null,qa=null;a.CT_CONTINUOUS=10;a.CT_TRIGGER=20;a.CT_SHOT=30;a.CT_LEVEL=40;a.CT_CHANGE=50;a.PL_SINGLE_TOUCH_MOVE=0;a.PL_MULTITOUCH_MOVE_ZOOM=1;a.PL_MULTITOUCH_MOVE_PAN=2;a.update=function(d,m){for(var k=0;k<Q.length;k++){var f=Q[k],e=d,C=m;if(C)switch(f.type){case 110:var h=f.source_object,r=N.get_trans_view(h.render.world_tsr),h=N.get_quat_view(h.render.world_tsr),g=O.dist(f.trans_last,r),p=f.quat_temp;M.invert(f.quat_last,p);M.multiply(h,
p,p);M.normalize(p,p);p=Math.abs(2*Math.acos(p[3]));g/=C;f.avg_linear_vel=B.smooth(g,f.avg_linear_vel,C,.3);f.payload[0]=g;g=p/C;f.avg_angular_vel=B.smooth(g,f.avg_angular_vel,C,.3);f.payload[1]=g;f.avg_linear_vel>=f.threshold||f.avg_angular_vel>=f.rotation_threshold?c(f,1):c(f,0);O.copy(r,f.trans_last);M.copy(h,f.quat_last);f.time_last=e;break;case 120:h=f.source_object;r=N.get_trans_view(h.render.world_tsr);h=Math.abs(r[1]-f.trans_last[1])/C;f.avg_vertical_vel=B.smooth(h,f.avg_vertical_vel,C,.3);
f.payload=h;f.avg_vertical_vel>=f.threshold?c(f,1):c(f,0);O.copy(r,f.trans_last);f.time_last=e;break;case 130:!f.do_activation&&0<=f.period&&e-f.time_last>=f.period&&(c(f,1),f.repeat?f.time_last=e:f.period=-f.period);break;case 140:f.time_last||(f.time_last=e);c(f,e-f.time_last);f.time_last=e;break;case 150:c(f,e);break;case 170:f.payload[0]=Math.PI*(f.gyro_gamma_new-f.gyro_gamma_last)/180;f.payload[1]=Math.PI*(f.gyro_beta_new-f.gyro_beta_last)/180;f.payload[2]=Math.PI*(f.gyro_alpha_new-f.gyro_alpha_last)/
180;f.gyro_gamma_last=f.gyro_gamma_new;f.gyro_beta_last=f.gyro_beta_new;f.gyro_alpha_last=f.gyro_alpha_new;break;case 180:f.payload[0]=Math.PI*f.gyro_gamma_new/180,f.payload[1]=Math.PI*f.gyro_beta_new/180,f.payload[2]=Math.PI*f.gyro_alpha_new/180}}for(k=0;k<I.length;k++)for(C=I[k],f=C.sensor_manifolds_arr,e=0;e<f.length;e++)if(r=f[e],r.update_counter!=V){r.update_counter=V;p=r;h=0;switch(p.type){case a.CT_CONTINUOUS:h=p.last_pulse;(g=b(p))?(h=1,p.last_pulse=1):1==h?(h=-1,p.last_pulse=-1):h=0;break;
case a.CT_TRIGGER:h=p.last_pulse;(g=b(p))&&-1==h?(h=1,p.last_pulse=1):g||1!=h?h=0:(h=-1,p.last_pulse=-1);break;case a.CT_SHOT:h=p.last_pulse;(g=b(p))&&-1==h?(h=1,p.last_pulse=1):g||1!=h?h=0:(h=0,p.last_pulse=-1);break;case a.CT_LEVEL:g=b(p);p.last_logic_result!=g?(h=1,p.last_logic_result=g):h=0;break;case a.CT_CHANGE:for(var g=p.sensors,p=p.last_sensor_values,n=0;n<g.length;n++){var y=g[n].value;h||y==p[n]||(h=1);p[n]=y}break;default:B.panic("Wrong sensor manifold type: "+p.type)}if(h&&(g=C==G?null:
C,J=!1,r.callback(g,r.id,h,r.callback_param),J)){k=-1;break}}for(k=0;k<I.length;k++)for(C=I[k],f=C.sensor_manifolds_arr,e=0;e<f.length;e++)for(r=f[e],C=r.sensors,r=0;r<C.length;r++)switch(h=C[r],h.type){case 30:c(h,0);break;case 40:c(h,0);break;case 60:c(h,0);break;case 70:c(h,0);break;case 130:c(h,0)}z=0;P=Y;da=U;T.set(aa);Z.set(W);ka=ga;V++};a.create_custom_sensor=function(a){var b=v(10);c(b,a);return b};a.create_keyboard_sensor=function(a){var b=v(20);b.key=a;return b};a.create_collision_sensor=
function(a,b,d){if(!a||!y.obj_has_physics(a))return E.error("Wrong collision object"),null;var m=v(80);m.collision_obj=a;m.collision_id=b;m.calc_pos_norm=d;m.payload={coll_obj:null,coll_pos:d?new Float32Array(3):null,coll_norm:d?new Float32Array(3):null,coll_dist:0};m.collision_cb=function(a,b,d,f,k){c(m,a);a=m.payload;a.coll_obj=b;m.calc_pos_norm&&(a.coll_pos.set(d),a.coll_norm.set(f),a.coll_dist=k)};m.do_activation=!0;return m};a.create_collision_impulse_sensor=function(a){if(!a||!a.physics)return E.error("Wrong collision impulse object"),
null;var b=v(90);b.col_imp_obj=a;b.col_imp_cb=function(a){c(b,a)};b.do_activation=!0;return b};a.create_ray_sensor=function(a,b,d,m,f,k,e){var C=v(100);C.source_object=a;C.from=b;C.to=d;C.collision_id=m;C.is_binary_value=f;C.calc_pos_norm=k;C.ign_src_rot=e;C.payload={hit_fract:0,obj_hit:null,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3)};C.ray_test_cb=function(a,b,d,m,f,k){C.is_binary_value?c(C,-1==b?0:1):c(C,b);C.payload.hit_fract=b;C.payload.obj_hit=d;C.payload.hit_time=m;
C.calc_pos_norm&&(C.payload.hit_pos.set(f),C.payload.hit_norm.set(k))};C.do_activation=!0;return C};a.create_mouse_click_sensor=function(){return v(50)};a.create_mouse_wheel_sensor=function(){return v(30)};a.create_mouse_move_sensor=function(a){var b=v(40);b.axis=a||"XY";b.payload="XY"==b.axis?new Float32Array(2):0;return b};a.create_touch_move_sensor=function(a){var b=v(60);b.axis=a||"XY";b.payload=0;return b};a.create_touch_zoom_sensor=function(){var a=v(70);a.payload=0;return a};a.create_motion_sensor=
function(a,b,d){if(!a)return E.error("Wrong collision object"),null;var c=v(110);c.source_object=a;var m=N.get_trans_view(a.render.world_tsr);a=N.get_quat_view(a.render.world_tsr);c.quat_temp=new Float32Array(4);c.trans_last=new Float32Array(m);c.quat_last=new Float32Array(a);c.avg_linear_vel=0;c.avg_angular_vel=0;c.threshold=b||.1;c.rotation_threshold=d||.1;c.time_last=0;c.payload=new Float32Array([0,0]);return c};a.create_vertical_velocity_sensor=function(a,b){if(!a)return E.error("Wrong collision object"),
null;var d=v(120);d.source_object=a;var c=N.get_trans_view(a.render.world_tsr),m=N.get_quat_view(a.render.world_tsr);d.trans_last=new Float32Array(c);d.quat_last=new Float32Array(m);d.avg_vertical_vel=0;d.threshold=b||1;d.time_last=0;d.payload=0;return d};a.create_timer_sensor=function(a,b){var d=v(130);d.period=a;d.repeat=b;d.do_activation=!0;return d};a.reset_timer_sensor=function(a,b,d,c){a=a||G;a=a.sensor_manifolds;if(!a||!a[b])return E.error("reset_timer_sensor(): wrong object"),null;b=a[b].sensors[d];
if(!b)return E.error("reset_timer_sensor(): sensor not found"),null;b.time_last=L.get_timeline();b.period=c};a.create_elapsed_sensor=function(){var a=v(140);a.time_last=0;return a};a.create_gyro_delta_sensor=function(){var a=v(170);a.payload=new Float32Array(3);return a};a.create_gyro_angles_sensor=function(){var a=v(180);a.payload=new Float32Array(3);return a};a.create_timeline_sensor=function(){return v(150)};a.create_selection_sensor=function(a,b){var d=v(160);d.source_object=a;d.auto_release=
b;return d};a.sensor_set_value=c;a.get_sensor_value=function(a,b,d){a=a||G;a=a.sensor_manifolds;if(!a||!a[b])return E.error("get_sensor_value(): wrong object"),null;b=a[b].sensors[d];return b?b.value:(E.error("get_sensor_value(): sensor not found"),null)};a.get_sensor_payload=function(a,b,d){a=a||G;a=a.sensor_manifolds;if(!a||!a[b])return E.error("get_sensor_payload(): wrong object"),null;b=a[b].sensors[d];return b?b.payload:(E.error("get_sensor_payload(): sensor not found"),null)};a.cleanup=function(){I=
[];Q=[];G={}};a.check_sensor_manifold=function(a,b){a=a||G;if(!a.sensor_manifolds)return!1;if(b&&a.sensor_manifolds[b])return!0;if(!b)for(var d in a.sensor_manifolds)return!0;return!1};a.remove_sensor_manifold=function(a,b){a=a||G;var c=a.sensor_manifolds;if(c){var m=a.sensor_manifolds_arr;if(b){var f=c[b];if(f){for(var k=f.sensors,C=0;C<k.length;C++)1===d(k[C],I)&&l(k[C],Q);delete c[b];f=m.indexOf(f);-1<f?m.splice(f,1):B.panic("Incorrect manifolds array");Object.getOwnPropertyNames(c).length||e(a)}}else{for(b in c){f=
c[b];k=f.sensors;for(C=0;C<k.length;C++)1===d(k[C],I)&&l(k[C],Q);delete c[b];f=m.indexOf(f);-1<f?m.splice(f,1):B.panic("Incorrect manifolds array")}e(a);J=!0}}};a.create_sensor_manifold=function(a,b,c,m,f,k,C){a=a||G;a.sensor_manifolds_arr=a.sensor_manifolds_arr||[];a.sensor_manifolds=a.sensor_manifolds||{};var e=a.sensor_manifolds,z=a.sensor_manifolds_arr,h=e[b];if(h){m=h.sensors;for(var r=0;r<m.length;r++)1===d(m[r],I)&&l(m[r],Q);h=z.indexOf(h);-1<h?z.splice(h,1):B.panic("Incorrect manifolds array")}c=
{id:b,type:c,sensors:m.slice(0),logic_fun:f,sensor_values:Array(m.length),callback:k,callback_param:C,last_pulse:-1,last_logic_result:0,last_sensor_values:Array(m.length),update_counter:-1};e[b]=c;z.push(c);-1==I.indexOf(a)&&I.push(a);a=c.sensors;for(b=0;b<a.length;b++){e=a[b];if(e.do_activation){switch(e.type){case 80:y.append_collision_test(e.collision_obj,e.collision_id,e.collision_cb,e.calc_pos_norm);break;case 90:y.apply_collision_impulse_test(e.col_imp_obj,e.col_imp_cb);break;case 100:e.ray_test_id=
y.append_ray_test(e.source_object,e.from,e.to,e.collision_id,e.ray_test_cb,!1,!1,e.calc_pos_norm,e.ign_src_rot);break;case 130:e.time_last=L.get_timeline(),0>e.period&&(e.period=-e.period)}e.do_activation=!1}-1==Q.indexOf(e)&&Q.push(e)}J=!0};a.default_AND_logic_fun=function(a){for(var b=0;b<a.length;b++)if(!a[b])return a[b];return a[a.length-1]};a.default_OR_logic_fun=function(a){for(var b=0;b<a.length;b++)if(a[b])return a[b];return a[a.length-1]};a.reset=function(){for(var a=0;a<I.length;a++){var b=
I[a],d=b.sensor_manifolds,b=b.sensor_manifolds_arr,c;for(c in d)delete d[c];b.splice(0,b.length)}for(a=0;a<Q.length;a++)l(Q[a],Q),a--;I.splice(0,I.length)};a.debug=function(){E.log(String(I.length)+" objects with manifolds",I);E.log(String(Q.length)+" sensors",Q);for(var a=[],b=[],d=0;d<Q.length;d++){var c=Q[d];80==c.type&&a.push(c);100==c.type&&b.push(c)}E.log(String(a.length)+" collision sensors",a);E.log(String(b.length)+" ray sensors",b)};a.register_keyboard_events=function(a,b){a.addEventListener("keydown",
n,!1);a.addEventListener("keyup",q,!1);S=b};a.register_mouse_events=function(a,b,d){if(d)var c=window;else c=a,c.addEventListener("mouseout",f,!1);a.addEventListener("mousedown",g,!1);c.addEventListener("mousemove",k,!1);c.addEventListener("mouseup",u,!1);R=b;na=d};a.register_wheel_events=function(a,b){a.addEventListener("mousewheel",p,!1);a.addEventListener("DOMMouseScroll",p,!1);ua=b};a.register_touch_events=function(a,b){a.addEventListener("touchstart",K,!1);a.addEventListener("touchend",A,!1);
a.addEventListener("touchmove",D,!1);document.addEventListener("touchstart",function(){});ia=b};a.register_device_orientation=function(){window.DeviceOrientationEvent&&C.gyro_use&&window.addEventListener("deviceorientation",h,!1)};a.unregister_keyboard_events=function(a){a.removeEventListener("keydown",n,!1);a.removeEventListener("keyup",q,!1)};a.unregister_mouse_events=function(a){a.removeEventListener("mousedown",g,!1);a.removeEventListener("mousemove",k,!1);a.removeEventListener("mouseout",f,!1);
a.removeEventListener("mouseup",u,!1)};a.unregister_wheel_events=function(a){a.removeEventListener("mousewheel",p,!1);a.removeEventListener("DOMMouseScroll",p,!1)};a.unregister_touch_events=function(a){a.removeEventListener("touchstart",K,!1);a.removeEventListener("touchmove",D,!1);document.removeEventListener("touchstart",function(){})};a.unregister_device_orientation=function(){window.DeviceOrientationEvent&&C.gyro_use&&window.removeEventListener("deviceorientation",h,!1)};a.assign_keyboard_callback=
function(a){ja=a};a.assign_mouse_callback=function(a){ta=a};a.assign_wheel_callback=function(a){ea=a};a.assign_touch_callback=function(a){qa=a}};b4w.module.__curve=function(a,t){function v(a,b,c,e,g){var u=e.length;g||(g=new Float32Array(u));for(var k=u+a,f=new Float32Array(k),p=1;p<=k-1;p++)f[p-1]=b>=c[p-1]&&b<c[p+1-1]?1:0;for(var K=2;K<=a;K++)for(p=1;p<=k-K;p++)f[p-1]=(0!=f[p-1]?(b-c[p-1])*f[p-1]/(c[p+K-1-1]-c[p-1]):0)+(0!=f[p+1-1]?(c[p+K-1]-b)*f[p+1-1]/(c[p+K-1]-c[p+1-1]):0);b==c[k-1]&&(f[u-1]=1);a=0;for(p=1;p<=u;p++)a+=f[p-1]*e[p-1];for(p=1;p<=u;p++)g[p-1]=0!=a?f[p-1]*e[p-1]/a:0;return g}function c(a){a=a.knot;return a[a.length-1]}function b(a){a=
a.cumulative_length;return a[a.length-1]}t("__print");var e=t("__util");a.create_spline=function(a){var b={},c=a.data;a=c.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var e=a.order_u;b.order=e;a=a.points;var g=a.length/5,u=[],k=g+e,g=g+2;u[0]=0;for(var f=2;f<=k;f++)u[f-1]=f>e&&f<g?u[f-2]+1:u[f-2];b.knot=u;if("2D"==c.dimensions)b.is_3d=!1;else if("3D"==c.dimensions)b.is_3d=!0;else throw"Wrong curve dimensions";e=[];u=[];for(c=0;c<a.length;c+=5)e.push(a[c]),e.push(a[c+1]),e.push(a[c+
2]),b.is_3d&&e.push(a[c+3]),u.push(a[c+4]);b.cpoints=e;b.weights=u;a=[];for(var c=b.cpoints,e=b.is_3d?4:3,u=b.weights,k=b.knot,g=b.order,f=c.length/e,p=f+g,K=0,t=k[p-1]/999,A=0;1E3>A;A++){5E-6>k[p-1]-K&&(K=k[p-1]);for(var h=v(g,K,k,u),x=0;x<e;x++)for(var w=a[e*A+x]=0;w<f;w++)a[e*A+x]+=h[w]*c[e*w+x];K+=t}e=b.is_3d?4:3;u=new Float32Array(1E3);u[0]=0;for(c=1;1E3>c;c+=1)k=a[(c-1)*e],g=a[(c-1)*e+1],f=a[(c-1)*e+2],p=a[c*e],K=a[c*e+1],t=a[c*e+2],k=Math.sqrt((p-k)*(p-k)+(K-g)*(K-g)+(t-f)*(t-f)),u[c]=u[c-
1]+k;b.cumulative_length=u;return b};a.spline_point=function(a,b,e){e||(e=[]);var q=b,g=Math.max(q,0),g=c(a);b=g=Math.min(q,g);var q=a.cpoints,g=a.is_3d?4:3,u=a.weights,k=a.knot,f=a.order;a=q.length/g;var p=a+f;5E-6>k[p-1]-b&&(b=k[p-1]);p=new Float32Array(a);v(f,b,k,u,p);for(b=0;b<g;b++)for(u=e[b]=0;u<a;u++)e[b]+=p[u]*q[g*u+b];return e};a.spline_derivative=function(a,b,c){c||(c=[]);var e=a.cpoints,g=a.is_3d?4:3,u=a.weights,k=a.knot,f=a.order;a=e.length/g;var p=a+f;5E-6>k[p-1]-b&&(b=k[p-1]);var p=
new Float32Array(a),K=b;b=p;var t=u.length;b||(b=new Float32Array(t));var A=new Float32Array(t),h=new Float32Array(t),x=A,w=h;x||(x=new Float32Array(t));w||(w=new Float32Array(t));for(var r=t+f,m=new Float32Array(r),E=new Float32Array(r),y=1;y<=r-1;y++)m[y-1]=K>=k[y-1]&&K<k[y+1-1]?1:0;K==k[r-1]&&(m[t-1]=1);for(var M=2;M<=f;M++)for(y=1;y<=r-M;y++){var L=0!=m[y-1]?m[y-1]/(k[y+M-1-1]-k[y-1]):0,N=0!=m[y+1-1]?-m[y+1-1]/(k[y+M-1]-k[y+1-1]):0,B=0!=E[y-1]?(K-k[y-1])*E[y-1]/(k[y+M-1-1]-k[y-1]):0,O=0!=E[y+
1-1]?(k[y+M-1]-K)*E[y+1-1]/(k[y+M-1]-k[y+1-1]):0;m[y-1]=(0!=m[y-1]?(K-k[y-1])*m[y-1]/(k[y+M-1-1]-k[y-1]):0)+(0!=m[y+1-1]?(k[y+M-1]-K)*m[y+1-1]/(k[y+M-1]-k[y+1-1]):0);E[y-1]=L+N+B+O}for(y=1;y<=t;y++)x[y-1]=m[y-1],w[y-1]=E[y-1];k=0;for(f=1;f<=t;f++)k+=A[f-1]*u[f-1];K=0;for(f=1;f<=t;f++)K+=h[f-1]*u[f-1];for(f=1;f<=t;f++)b[f-1]=0!=k?h[f-1]*u[f-1]/k+A[f-1]*u[f-1]*K/(k*k):0;for(u=0;u<g;u++)for(k=c[u]=0;k<a;k++)c[u]+=p[k]*e[g*k+u];return c};a.spline_max_t=c;a.spline_length=b;a.spline_len_to_t=function(a,
l){if(0>=l)return 0;var n=c(a);if(l>=b(a))return n;var q=a.cumulative_length,g=e.binary_search_max(q,l,0,q.length-1);return n*(g+(l-q[g])/(q[g+1]-q[g]))/1E3}};b4w.module.__dds=function(a,t){function v(a,b,d,c){var e=new Uint16Array(4),g=new Uint16Array(d*c),n=0,h=0,x=0,l=h=n=0,r=0,m=0,E=0,y=d/4;c/=4;for(var q=0;q<c;q++)for(var L=0;L<y;L++)x=b+4*(q*y+L),e[0]=a[x],e[1]=a[x+1],n=e[0]&31,h=e[0]&2016,l=e[0]&63488,r=e[1]&31,m=e[1]&2016,E=e[1]&63488,e[2]=5*n+3*r>>3|5*h+3*m>>3&2016|5*l+3*E>>3&63488,e[3]=5*r+3*n>>3|5*m+3*h>>3&2016|5*E+3*l>>3&63488,n=a[x+2],h=4*q*d+4*L,g[h]=e[n&3],g[h+1]=e[n>>2&3],g[h+2]=e[n>>4&3],g[h+3]=e[n>>6&3],h+=d,g[h]=e[n>>8&3],g[h+1]=e[n>>
10&3],g[h+2]=e[n>>12&3],g[h+3]=e[n>>14],n=a[x+3],h+=d,g[h]=e[n&3],g[h+1]=e[n>>2&3],g[h+2]=e[n>>4&3],g[h+3]=e[n>>6&3],h+=d,g[h]=e[n>>8&3],g[h+1]=e[n>>10&3],g[h+2]=e[n>>12&3],g[h+3]=e[n>>14];return g}function c(a,b,c,e){var t=new Int32Array(c,0,31),D,A,h,x,w,r;if(542327876!=t[0])return l.error("Invalid magic number in DDS header"),0;if(!t[20]&4)return l.error("Unsupported format, must contain a FourCC code"),0;D=t[21];switch(D){case n:A=8;h=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case q:A=16;h=
b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case g:A=16;h=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return l.error("Unsupported FourCC code:",d(D)),null}r=1;t[2]&131072&&!1!==e&&(r=Math.max(1,t[7]));x=t[4];w=t[3];t=t[1]+4;if(b)for(D=0;D<r;++D)e=Math.max(4,x)/4*Math.max(4,w)/4*A,b=new Uint8Array(c,t,e),a.compressedTexImage2D(a.TEXTURE_2D,D,h,x,w,0,b),t+=e,x=Math.max(.5*x,1),w=Math.max(.5*w,1);else if(D==n)Math.max(4,x),Math.max(4,w),b=new Uint16Array(c),c=v(b,t/2,x,w),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,x,w,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,c),e&&a.generateMipmap(a.TEXTURE_2D);else return l.error("No manual decoder for",d(D),"and no native support"),0;return r}function b(a,b,d,e,g,n){var l=new XMLHttpRequest;l.open("GET",d,!0);l.responseType="arraybuffer";l.onload=function(){if(200==l.status){a.bindTexture(a.TEXTURE_2D,e);var d=c(a,b,l.response,g);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<d?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}n&&
n(e)};l.send(null);return e}function e(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function d(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var l=t("__print"),n=e("DXT1"),q=e("DXT3"),g=e("DXT5");a.dxt_to_rgb_565=v;a.upload_dds_levels=c;a.get_width_height=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.get_compress_ratio=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case n:b=6;break;case q:case g:b=
4;break;default:l.error("Unsupported FourCC code:",d(a))}return b};a.load_dds_texture_ex=b;a.load_dds_texture=function(a,d,c,e){var g=a.createTexture();b(a,d,c,g,!0,e);return g}};b4w.module.__debug=function(a,t){function v(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function c(a,b){typeof a!=typeof b&&q.panic("Structure assertion failed: incompatible types");if(null!==a&&null!==b&&"object"==typeof a){for(var d in a)d in b||q.panic("Structure assertion failed: missing key in the first object: "+d);for(d in b)d in a||q.panic("Structure assertion failed: missing key in the second object: "+d),typeof a[d]!=typeof b[d]&&q.panic("Structure assertion failed: incompatible types for key "+
d)}}var b=t("__config"),e=t("__extensions"),d=t("__print"),l=t("__textures"),n=t("__time"),q=t("__util"),g=t("__graph"),u=b.defaults,k=null,f={},p=!1,K={},D=[],A=-1,h=null,x=!1;a.WM_NONE=0;a.WM_OPAQUE_WIREFRAME=1;a.WM_TRANSPARENT_WIREFRAME=2;a.WM_FRONT_BACK_VIEW=3;a.WM_DEBUG_SPHERES=4;a.setup_context=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),d;for(d in b){var c=b[d];c in a&&(f[a[c]]=c)}k=a};a.check_gl=
function(a){if(p){var b=k.getError();b!=k.NO_ERROR&&(b in f?q.panic("GL Error: "+b+", gl."+f[b]+" ("+a+")"):q.panic("Unknown GL error: "+b+" ("+a+")"))}};a.check_bound_fb=function(){if(!p)return!0;switch(k.checkFramebufferStatus(k.FRAMEBUFFER)){case k.FRAMEBUFFER_COMPLETE:return!0;case k.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return d.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT"),!1;case k.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return d.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT"),
!1;case k.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return d.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS"),!1;case k.FRAMEBUFFER_UNSUPPORTED:return d.error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED"),!1;default:return d.error("FRAMEBUFFER CHECK FAILED"),!1}};a.check_depth_only_issue=function(){if(-1!=A)return A;var a=k.createFramebuffer();k.bindFramebuffer(k.FRAMEBUFFER,a);a=l.create_texture("DEBUG",l.TT_DEPTH);l.resize(a,1,1);k.framebufferTexture2D(k.FRAMEBUFFER,k.DEPTH_ATTACHMENT,
a.w_target,a.w_texture,0);k.checkFramebufferStatus(k.FRAMEBUFFER)!=k.FRAMEBUFFER_COMPLETE?(A=!0,d.warn("depth-only issue was found")):A=!1;k.bindFramebuffer(k.FRAMEBUFFER,null);return A};a.check_shader_compiling=function(a,b,c){if(p&&!k.getShaderParameter(a,k.COMPILE_STATUS))throw c=v(c),d.error("shader compilation failed:\n"+c+"\n"+k.getShaderInfoLog(a)+" ("+b+")"),"Engine failed: see above for error messages";};a.check_shader_linking=function(a,b,c,f,h,g){if(p&&!k.getProgramParameter(a,k.LINK_STATUS)){var n=
e.get_debug_shaders();n&&(h=n.getTranslatedShaderSource(c),g=n.getTranslatedShaderSource(f));h=v(h);g=v(g);d.error("shader linking failed:\n"+h+"\n\n\n"+g+"\n"+k.getProgramInfoLog(a)+" ("+b+")");throw"Engine failed: see above for error messages";}};a.set_check_gl_errors=function(a){p=a};a.render_time_start=function(a){if(u.show_hud_debug_info){var b=e.get_disjoint_timer_query();if(b){var d=b.createQueryEXT();a.debug_render_time_queries.push(d);b.beginQueryEXT(b.TIME_ELAPSED_EXT,d)}else a.debug_render_time_queries.push(performance.now())}};
a.render_time_stop=function(a){if(u.show_hud_debug_info){var b=a.debug_render_time_queries,d=e.get_disjoint_timer_query();if(d){d.endQueryEXT(d.TIME_ELAPSED_EXT);for(var c=0;c<b.length;c++){var f=b[c],h=d.getQueryObjectEXT(f,d.QUERY_RESULT_AVAILABLE_EXT),g=k.getParameter(d.GPU_DISJOINT_EXT);h&&!g&&(f=d.getQueryObjectEXT(f,d.QUERY_RESULT_EXT)/1E6,a.debug_render_time=q.smooth(f,a.debug_render_time,1,100),b.splice(c,1),c--)}}else f=performance.now()-b.pop(),a.debug_render_time=q.smooth(f,a.debug_render_time,
1,100)}};a.exec_count=function(a){K[a]=a in K?K[a]+1:1};a.update=function(){for(var a in K)d.log(a,K[a]),K[a]=0};a.fbmsg=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var d=arguments[b];if(q.is_vector(d))for(var c=0;c<d.length;c++)a.push(d[c]);else a.push(arguments[b])}D.push(a)};a.msg=function(){for(var a=1,b=0;b<D.length;b++){var d=D[b];d[1]==arguments[0]&&a++}d=[a];for(b=0;b<arguments.length;b++)if(a=arguments[b],q.is_vector(a))for(var c=0;c<a.length;c++)d.push(a[c]);else d.push(arguments[b]);
D.push(d)};var w=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=function(a){a||(a=1);for(var b=0,c={},f=Math.max(0,performance.now()-1E3*a),e=0;e<D.length;e++){var k=D[e];a=k[0];if(!(a<f)){var h=String(k[1]);c[h]||(c[h]=w[b++%w.length]);var g=c[h];a=["%c"+(a/1E3).toFixed(6),g,h];for(h=2;h<k.length;h++)a.push(k[h]);d.log.apply(this,a)}}D.splice(0)};a.plot_telemetry=function(a){a||(a=1);for(var b={},c=Math.max(0,performance.now()-1E3*a),f=0;f<
D.length;f++){var e=D[f];a=e[0];if(!(a<c))for(var k=2;k<e.length;k++){var h=String(e[1]);3<e.length&&(h+="_"+String(k-2));b[h]||(b[h]=h+"\n");b[h]+=String(a)+" "+e[k]+"\n"}}a="";for(h in b)a+=b[h]+"\n\n";d.log(a);D.splice(0)};a.check_browser=function(a){var b=navigator.userAgent.toLowerCase(),d=function(a){return-1<b.indexOf(a)?!0:!1};switch(a.toLowerCase()){case "chrome":return d("mozilla")&&d("applewebkit")&&d("chrome");case "firefox":return d("mozilla")&&d("gecko")&&d("firefox");case "msie":return d("mozilla")&&
d("trident")&&d("msie");case "opera":return d("opera")&&d("presto");case "safari":return d("mozilla")&&d("applewebkit")&&d("safari")&&!d("chrome");default:return!1}};a.check_finite=function(a){if(q.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.assert_cons=function(a,b){a.constructor!=b&&q.panic("Type assertion failed: value <"+a+"> has type <"+a.constructor+">, required <"+b+">")};a.assert_structure=c;a.assert_structure_seq=
function(a){x?c(a,h):x=!0;h=a};a.fake_load=function(a,b,d,c,f){(a=a||null)||q.panic("Stage load callback is undefined");b=b||5E3;d=d||0;c=c||100;100<c&&q.panic("Max percentage must be less than 100");0>d&&q.panic("Min percentage must be greater than 0");d>c&&q.panic("Max percentage must be greater than min percentage");var e=n.animate(d,c,b,function(b){b=b.toFixed();a(b);100==b&&(n.clear_animation(e),f&&f())})};a.nodegraph_to_dot=function(a){return g.debug_dot(a,function(a,b){return b.type},function(b,
d,c){b=g.get_node_attr(a,b);d=g.get_node_attr(a,d);return b.outputs[c[0]].identifier+"\n==>\n"+d.inputs[c[1]].identifier})}};b4w.module.__extensions=function(a,t){function v(a){if(a in l)return l[a];var c=d.getExtension(a)||null;l[a]=c;b.log("%cGET EXTENSION","color: #"+(c?"0a0":"a00"),a);return c}var c=t("__config"),b=t("__print"),e=c.defaults,d=null,l={};a.setup_context=function(a){d=a};a.get_s3tc=function(){return v("WEBGL_compressed_texture_s3tc")||v("WEBKIT_WEBGL_compressed_texture_s3tc")||v("MOZ_WEBGL_compressed_texture_s3tc")};a.get_depth_texture=function(){return e.webgl2?{}:v("WEBGL_depth_texture")||v("WEBKIT_WEBGL_depth_texture")||
v("MOZ_WEBGL_depth_texture")};a.get_aniso=function(){return v("EXT_texture_filter_anisotropic")||v("WEBKIT_EXT_texture_filter_anisotropic")||v("MOZ_EXT_texture_filter_anisotropic")};a.get_debug_shaders=function(){return v("WEBGL_debug_shaders")};a.get_renderer_info=function(){return v("WEBGL_debug_renderer_info")};a.get_elem_index_uint=function(){return e.webgl2?{}:v("OES_element_index_uint")};a.get_standard_derivatives=function(){return e.webgl2?null:v("OES_standard_derivatives")};a.get_disjoint_timer_query=
function(){return v("EXT_disjoint_timer_query")};a.cleanup=function(){l={}}};b4w.module.__graph=function(a,t){function v(a,b,d){d||(d=null);if(c(a,b))throw"Graph already has node with given ID";a.nodes.push(b,d)}function c(a,b){for(var d=a.nodes,c=0;c<d.length;c+=2)if(d[c]==b)return!0;return!1}function b(a,b,d,f){f||(f=null);if(c(a,b)&&c(a,d))a.edges.push(b,d,f);else throw"Wrong node IDs";}function e(a,b){if(!c(a,b))throw"Node not found";for(var d=a.nodes,f=0;f<d.length;f+=2)d[f]==b&&(d.splice(f,2),f-=2)}function d(a,b,d,c){if(!M(a,b,d))throw"Edge not found";a=a.edges;for(var f=
0,e=0;e<a.length;e+=3)if(a[e]==b&&a[e+1]==d){if(-1==c)a.splice(e,3);else{if(c==f){a.splice(e,3);break}f++}e-=3}}function l(a){a=a.nodes;for(var b=-1,d=0;d<a.length;d+=2)b=Math.max(b,a[d]);return++b}function n(a,b){for(var d=a.nodes,c=0;c<d.length;c+=2)if(d[c+1]==b)return d[c];return-1}function q(a){var b=[],d={};g(a,d);for(var c=a.nodes,f=0;f<c.length;f+=2)0==m(a,c[f])&&u(a,c[f],d,b);return{nodes:b,edges:a.edges.slice(0)}}function g(a,b){for(var d=a.nodes,c=0;c<d.length;c+=2)b[d[c]]=!1}function u(a,
b,d,c){if(!d[b]){d[b]=!0;for(var f=0;f<r(a,b);f++){var e=E(a,b,f);u(a,e,d,c)}c.unshift(b,w(a,b))}}function k(a,b,d,c){if(!d[b]){d[b]=!0;if(10==c||30==c)for(var f=0;f<r(a,b);f++){var e=E(a,b,f);k(a,e,d,c)}if(20==c||30==c)for(f=0;f<m(a,b);f++)e=y(a,b,f),k(a,e,d,c)}}function f(a){for(var b=a.edges,d=0;d<b.length;d+=3){var f=b[d+1];c(a,b[d])&&c(a,f)||(b.splice(d,3),d-=3)}}function p(a){for(var b=[],d=a.nodes,c=0;c<d.length;c+=2){var f=d[c];r(a,f)||b.push(f)}return b}function K(a){var b=a.nodes;a=a.edges;
for(var d=[],c=[],f=[],e=0;e<b.length;e++)f[b[2*e]]=e,d.push(e,b[2*e+1]);for(e=0;e<a.length;e+=3)c.push(f[a[e]],f[a[e+1]],a[e+2]);return{nodes:d,edges:c}}function D(a,b,d){if(d.core_len==d.n1){for(var c=0,f=0;c<d.n1;c++)-1!=d.core_1[c]&&(a[f]=c,b[f]=d.core_1[c],f++);return!0}if(d.n1>d.n2||d.t1both_len>d.t2both_len||d.t1out_len>d.t2out_len||d.t1in_len>d.t2in_len)return!1;for(var f=c=-1,e=!1;!e&&A(d,F,c,f);)if(c=F[0],f=F[1],h(d,c,f)){var k;k=d;e={};e.g1=k.g1;e.g2=k.g2;e.node_comp=k.node_comp;e.edge_comp=
k.edge_comp;e.n1=k.n1;e.n2=k.n2;e.order=k.order;e.core_len=e.orig_core_len=k.core_len;e.t1in_len=k.t1in_len;e.t1out_len=k.t1out_len;e.t1both_len=k.t1both_len;e.t2in_len=k.t2in_len;e.t2out_len=k.t2out_len;e.t2both_len=k.t2both_len;e.added_node1=-1;e.core_1=k.core_1;e.core_2=k.core_2;e.in_1=k.in_1;e.in_2=k.in_2;e.out_1=k.out_1;e.out_2=k.out_2;e.share_count=k.share_count;k.share_count[0]+=1;var e=k=e,g=c,p=f,n=e.g1,l=e.g2,q=e.n1,w=e.n2,B=e.core_1,u=e.core_2,O=e.in_1,N=e.in_2,L=e.out_1,J=e.out_2;x(g<
q);x(p<w);x(e.core_len<q);x(e.core_len<w);q=++e.core_len;e.added_node1=g;O[g]||(O[g]=q,e.t1in_len++,L[g]&&e.t1both_len++);L[g]||(L[g]=q,e.t1out_len++,O[g]&&e.t1both_len++);N[p]||(N[p]=q,e.t2in_len++,J[p]&&e.t2both_len++);J[p]||(J[p]=q,e.t2out_len++,N[p]&&e.t2both_len++);B[g]=p;u[p]=g;for(B=0;B<m(n,g);B++)u=y(n,g,B),O[u]||(O[u]=q,e.t1in_len++,L[u]&&e.t1both_len++);for(B=0;B<r(n,g);B++)u=E(n,g,B),L[u]||(L[u]=q,e.t1out_len++,O[u]&&e.t1both_len++);for(B=0;B<m(l,p);B++)u=y(l,p,B),N[u]||(N[u]=q,e.t2in_len++,
J[u]&&e.t2both_len++);for(B=0;B<r(l,p);B++)u=E(l,p,B),J[u]||(J[u]=q,e.t2out_len++,N[u]&&e.t2both_len++);e=D(a,b,k);x(1>=k.core_len-k.orig_core_len);x(-1!=k.added_node1);u=k.g1;g=k.g2;p=k.core_len;n=k.added_node1;l=k.core_1;O=k.core_2;q=k.in_1;N=k.in_2;w=k.out_1;L=k.out_2;if(k.orig_core_len<p){q[n]==p&&(q[n]=0);for(J=0;J<m(u,n);J++)B=y(u,n,J),q[B]==p&&(q[B]=0);w[n]==p&&(w[n]=0);for(J=0;J<r(u,n);J++)B=E(u,n,J),w[B]==p&&(w[B]=0);u=l[n];N[u]==p&&(N[u]=0);for(J=0;J<m(g,u);J++)B=y(g,u,J),N[B]==p&&(N[B]=
0);L[u]==p&&(L[u]=0);for(J=0;J<r(g,u);J++)B=E(g,u,J),L[B]==p&&(L[B]=0);l[n]=-1;O[u]=-1;k.core_len=k.orig_core_len;k.added_node1=-1}}return e}function A(a,b,d,c){-1==d&&(d=0);-1==c?c=0:c++;var e=a.t1both_len,f=a.t2both_len,k=a.t1out_len,m=a.t2out_len,h=a.t1in_len,g=a.t2in_len,p=a.core_len,n=a.n1,x=a.n2,r=a.core_1,y=a.core_2,l=a.in_1,q=a.in_2,w=a.out_1,J=a.out_2;if(e>p&&f>p)for(;d<n&&(-1!=r[d]||0==w[d]||0==l[d]);)d++,c=0;else if(k>p&&m>p)for(;d<n&&(-1!=r[d]||0==w[d]);)d++,c=0;else if(h>p&&g>p)for(;d<
n&&(-1!=r[d]||0==l[d]);)d++,c=0;else if(0==d&&0!=a.order){for(l=0;l<n&&-1!=r[d=a.order[l]];)l++;l==n&&(d=n)}else for(;d<n&&-1!=r[d];)d++,c=0;if(e>p&&f>p)for(;c<x&&(-1!=y[c]||0==J[c]||0==q[c]);)c++;else if(k>p&&m>p)for(;c<x&&(-1!=y[c]||0==J[c]);)c++;else if(h>p&&g>p)for(;c<x&&(-1!=y[c]||0==q[c]);)c++;else for(;c<x&&-1!=y[c];)c++;return d<n&&c<x?(b[0]=d,b[1]=c,!0):!1}function h(a,b,d){var c=a.g1,e=a.g2,f=a.n2,k=a.core_1,h=a.core_2,g=a.in_1,p=a.in_2,n=a.out_1,l=a.out_2;x(b<a.n1);x(d<f);x(-1==k[b]);x(-1==
h[d]);f=(0,a.node_comp)(w(c,b),w(e,d))?!0:!1;if(!f)return!1;for(var q=f=0,B=0,u=0,F=0,O=0,N=0;N<r(c,b);N++){var J=E(c,b,N);if(-1!=k[J]){var V=k[J];if(!M(e,d,V)||!L(a.edge_comp,c,b,J,e,d,V))return!1}else g[J]&&B++,n[J]&&f++,g[J]||n[J]||F++}for(N=0;N<m(c,b);N++)if(J=y(c,b,N),-1!=k[J]){if(V=k[J],!M(e,V,d)||!L(a.edge_comp,c,J,b,e,V,d))return!1}else g[J]&&B++,n[J]&&f++,g[J]||n[J]||F++;for(N=0;N<r(e,d);N++)if(V=E(e,d,N),-1!=h[V]){if(J=h[V],!M(c,b,J))return!1}else p[V]&&u++,l[V]&&q++,p[V]||l[V]||O++;for(N=
0;N<m(e,d);N++)if(V=y(e,d,N),-1!=h[V]){if(J=h[V],!M(c,J,b))return!1}else p[V]&&u++,l[V]&&q++,p[V]||l[V]||O++;return B<=u&&f<=q&&F<=O}function x(a){if(!a)throw"Assertion failed";}function w(a,b){for(var d=a.nodes,c=0;c<d.length;c+=2)if(d[c]==b)return d[c+1];return null}function r(a,b){for(var d=a.edges,c=0,e=0;e<d.length;e+=3)d[e]==b&&c++;return c}function m(a,b){for(var d=a.edges,c=0,e=0;e<d.length;e+=3)d[e+1]==b&&c++;return c}function E(a,b,d){a=a.edges;for(var c=0,e=0;e<a.length;e+=3)if(a[e]==b){if(c==
d)return a[e+1];c++}return-1}function y(a,b,d){a=a.edges;for(var c=0,e=0;e<a.length;e+=3)if(a[e+1]==b){if(c==d)return a[e];c++}return-1}function M(a,b,d){a=a.edges;for(var c=0;c<a.length;c+=3)if(a[c]==b&&a[c+1]==d)return!0;return!1}function L(a,b,d,c,e,f,k){for(var m=N(b,d,c),h=N(e,f,k),g=0;g<m;g++){for(var p=!1,n=0;n<h;n++)if(a(B(b,d,c,g),B(e,f,k,n))){p=!0;break}if(!p)return!1}return!0}function N(a,b,d){var c=0;a=a.edges;for(var e=0;e<a.length;e+=3)a[e]==b&&a[e+1]==d&&c++;return c}function B(a,b,
d,c){a=a.edges;for(var e=0,f=0;f<a.length;f+=3)if(a[f]==b&&a[f+1]==d){if(e==c)return a[f+2];e++}return null}t("__print");var O=t("__util"),F=[-1,-1];a.NULL_NODE=-1;a.FORWARD_DIR=10;a.BACKWARD_DIR=20;a.TWO_WAY=30;a.create=function(){for(var a=arguments,b=[],d=[],c=0;c<a.length;c++){var e=a[c];switch(e.length){case 2:b.push(e[0],e[1]);break;case 3:d.push(e[0],e[1],e[2]);break;default:throw"Wrong graph constructor params";}}return{nodes:b,edges:d}};a.clone=function(a,b,d){if(b)for(var c=Array(a.nodes.length),
e=0;e<a.nodes.length;e+=2)c[e]=a.nodes[e],c[e+1]=b(a.nodes[e+1]);else c=O.clone_object_r(a.nodes);if(d)for(b=Array(a.edges.length),e=0;e<a.edges.length;e+=3)b[e]=a.edges[e],b[e+1]=a.edges[e+1],b[e+2]=d(a.edges[e+2]);else b=O.clone_object_r(a.edges);return a={nodes:c,edges:b}};a.create_node_edge_arr=function(a,b){for(var d=[],c=[],e=0;e<a.length;e++)d.push(a[e][0],a[e][1]);for(e=0;e<b.length;e++)c.push(b[e][0],b[e][1],b[e][2]);return{nodes:d,edges:c}};a.append_node=v;a.has_node=c;a.append_edge=b;a.remove_node=
e;a.remove_edge=d;a.remove_edge_by_attr=function(a,b,d,c){if(!M(a,b,d))throw"Edge not found";a=a.edges;for(var e=0;e<a.length;e+=3)if(a[e]==b&&a[e+1]==d&&a[e+2][0]==c[0]&&a[e+2][1]==c[1]){a.splice(e,3);break}};a.append_node_attr=function(a,b){if(-1==n(a,b)){var d=l(a);v(a,d,b);return d}throw"Non-unique attribute";};a.replace_edge_attr=function(a,b,d,c,e){a=a.edges;for(var f=0;f<a.length;f+=3)a[f]==b&&a[f+1]==d&&a[f+2]==c&&(a[f+2]=e)};a.append_subgraph=function(a,d,c,e){c=c||[];e=e||[];for(var f={},
k=0;k<a.nodes.length;k+=2){var m=a.nodes[k],h=a.nodes[k+1],g=l(d);v(d,g,h);f[m]=g}for(k=0;k<a.edges.length;k+=3)h=f[a.edges[k]],g=f[a.edges[k+1]],m=a.edges[k+2],b(d,h,g,m);for(k=0;k<c.length;k+=3)h=f[c[k]],a=c[k+1],m=c[k+2],b(d,h,a,m);for(k=0;k<e.length;k+=3)c=e[k],g=f[e[k+1]],m=e[k+2],b(d,c,g,m)};a.gen_node_id=l;a.node_by_attr=n;a.append_edge_attr=function(a,d,c,e){d=n(a,d);c=n(a,c);if(-1!=d&&-1!=c)b(a,d,c,e);else throw"Attributes not found";};a.traverse=function(a,b){for(var d=a.nodes,c=0;c<d.length&&
!b(d[c],d[c+1]);c+=2);};a.traverse_edges=function(a,b){for(var d=a.edges,c=0;c<d.length&&!b(d[c],d[c+1],d[c+2]);c+=3);};a.traverse_inputs=function(a,b,d){for(var c=a.edges,e=0;e<c.length;e+=3)if(c[e+1]==b){var f=c[e];if(d(f,w(a,f),c[e+2]))break}};a.traverse_outputs=function(a,b,d){for(var c=a.edges,e=0;e<c.length;e+=3)if(c[e]==b){var f=c[e+1];if(d(f,w(a,f),c[e+2]))break}};a.topsort=q;a.topsort_attr=function(a){a=q(a).nodes;for(var b=[],d=0;d<a.length;d+=2)b.push(a[d+1]);return b};a.is_connected=function(a){};
a.subgraph_node_conn=function(a,b,d){if(!c(a,b))throw"No such node";var e={};g(a,e);k(a,b,e,d);b=[];for(var m in e)e[m]&&(m=Number(m),b.push(m,w(a,m)));a={nodes:b,edges:a.edges.slice(0)};f(a);return a};a.cleanup_loose_edges=f;a.get_source_nodes=function(a){for(var b=[],d=a.nodes,c=0;c<d.length;c+=2){var e=d[c];m(a,e)||b.push(e)}return b};a.get_sink_nodes=p;a.match=function(a,b,d,c){var e={};e.g1=K(a);e.g2=K(b);e.node_comp=d||function(a,b){return a==b};e.edge_comp=c||function(a,b){return a==b};c=a.nodes.length/
2;var f=b.nodes.length/2;e.n1=c;e.n2=f;e.order=0;e.core_len=e.orig_core_len=0;e.t1both_len=e.t1in_len=e.t1out_len=0;e.t2both_len=e.t2in_len=e.t2out_len=0;e.added_node1=-1;e.core_1=Array(c);e.core_2=Array(f);e.in_1=Array(c);e.in_2=Array(f);e.out_1=Array(c);e.out_2=Array(f);e.share_count=[1];for(d=0;d<c;d++)e.core_1[d]=-1,e.in_1[d]=0,e.out_1[d]=0;for(d=0;d<f;d++)e.core_2[d]=-1,e.in_2[d]=0,e.out_2[d]=0;f=Array(c);c=Array(c);if(D(f,c,e)){for(d=0;d<f.length;d++)f[d]=a.nodes[2*f[d]],c[d]=b.nodes[2*c[d]];
return[f,c]}return null};a.get_node_attr=w;a.out_edge_count=r;a.in_edge_count=m;a.get_out_edge=E;a.get_in_edge=y;a.get_edge_count=N;a.get_edge_attr=B;a.replace=function(a,b,d){for(var c=a.edges,f=l(a),k=0;k<b.length;k++){var m=b[k];e(a,m);for(var h=0;h<c.length;h+=3)c[h]==m&&(c[h]=f),c[h+1]==m&&(c[h+1]=f),c[h]==c[h+1]&&(c.splice(h,3),h-=3)}v(a,f,d)};a.reconnect_edges=function(a,b,d,c,e){if(!M(a,b,d))throw"Edge not found";a=a.edges;for(var f=0;f<a.length;f+=3)a[f]==b&&a[f+1]==d&&(a[f]=c,a[f+1]=e)};
a.enforce_acyclic=function(a,b){function c(a,b){if(-1!=h.indexOf(a)){var d=h.slice(h.indexOf(a));if(-1!=f[d[d.length-1]].indexOf(d[0])){g.push([a,d[d.length-1]]);return}}h.push(a);for(d=0;d<b.length;d++)b[d]in f&&c(b[d],f[b[d]])}b||(b=p(a)[0]);var e=a.edges;if(!e.length)return a;for(var f={},k=0,m=0;m<e.length;m+=3)e[m+1]in f?f[e[m+1]].push(e[m]):f[e[m+1]]=[e[m]],k++;var h=[],g=[];c(b,f[b]);for(m=0;m<g.length;m++)for(var n=k=0;n<e.length;n+=3)g[m][1]==e[n+1]&&g[m][0]==e[n]&&d(a,e[n],e[n+1],k),k++;
return a};a.debug_dot=function(a,b,d){var c=a.nodes;a=a.edges;var e;e="digraph debug {\n    node [shape=box];\n";for(var f=0;f<c.length;f+=2){var k=c[f],m=c[f+1],m=b?b(k,m):String(k);e+="    ";e+=String(k)+' [label="'+m.replace(/\"/g,'\\"')+'"];\n'}for(f=0;f<a.length;f+=3)b=a[f],c=a[f+1],m=a[f+2],e+="    ",e+=String(b)+" -> "+String(c),d&&(e+=' [label="'+d(b,c,m)+'"]'),e+=";\n";return e+="}"}};b4w.module.__ipc=function(a,t){function v(a,b,d){for(var c=0;c<f.length;c+=2)f[c+1]==a&&(k[c+Number(!b)]=d)}function c(a){for(var b=0;b<a.length;b++){var d=a[b],c=0,e;for(e in d){var f=d[e];switch(f.constructor){case Float32Array:c+=f.length;break;case Number:c+=1}}--c;d.len=c}}var b=!0;a.IN_LOADED=0;var e=a.IN_COLLISION=1,d=a.IN_COLLISION_POS_NORM=2;a.IN_COLLISION_IMPULSE=3;a.IN_ERROR=4;a.IN_FBMSG=5;a.IN_FLOATER_BOB_TRANSFORM=6;a.IN_LOG=7;var l=a.IN_PROP_OFFSET=8,n=a.IN_RAY_HIT=9,q=a.IN_RAY_HIT_POS_NORM=
10;a.IN_REMOVE_RAY_TEST=11;var g=a.IN_TRANSFORM=12;a.IN_VEHICLE_SPEED=13;a.IN_PING=14;a.IN_FPS=15;a.IN_DEBUG_STATS=16;a.OUT_INIT=100;a.OUT_ACTIVATE=101;a.OUT_ADD_BOAT_BOB=102;a.OUT_ADD_CAR_WHEEL=103;a.OUT_ADD_FLOATER_BOB=104;a.OUT_APPEND_BOUNDING_BODY=105;a.OUT_APPEND_BOAT=106;a.OUT_APPEND_CAR=107;a.OUT_APPEND_CHARACTER=108;a.OUT_APPEND_COLLISION_TEST=109;a.OUT_APPEND_CONSTRAINT=110;a.OUT_APPEND_FLOATER=111;a.OUT_APPEND_GHOST_MESH_BODY=112;a.OUT_APPEND_STATIC_MESH_BODY=113;a.OUT_APPEND_WATER=114;
a.OUT_REMOVE_BODY=115;a.OUT_APPLY_CENTRAL_FORCE=116;a.OUT_APPLY_COLLISION_IMPULSE_TEST=117;a.OUT_APPLY_TORQUE=118;a.OUT_CHARACTER_JUMP=119;a.OUT_CHARACTER_ROTATION_INCREMENT=120;a.OUT_CLEAR_COLLISION_IMPULSE_TEST=121;a.OUT_DISABLE_SIMULATION=122;a.OUT_ENABLE_SIMULATION=123;a.OUT_PAUSE=124;a.OUT_APPEND_RAY_TEST=125;a.OUT_REMOVE_RAY_TEST=126;a.OUT_CHANGE_RAY_TEST_FROM_TO=127;a.OUT_REMOVE_COLLISION_TEST=128;a.OUT_REMOVE_CONSTRAINT=129;a.OUT_RESUME=130;a.OUT_SET_CHARACTER_FLY_VELOCITY=131;a.OUT_SET_CHARACTER_HOR_ROTATION=
132;a.OUT_SET_CHARACTER_MOVE_DIR=133;a.OUT_SET_CHARACTER_MOVE_TYPE=134;a.OUT_SET_CHARACTER_ROTATION=135;a.OUT_SET_CHARACTER_RUN_VELOCITY=136;a.OUT_SET_CHARACTER_VERT_ROTATION=137;a.OUT_SET_CHARACTER_WALK_VELOCITY=138;a.OUT_SET_GRAVITY=139;a.OUT_SET_LINEAR_VELOCITY=140;var u=a.OUT_SET_TRANSFORM=141;a.OUT_SET_WATER_TIME=142;a.OUT_ADD_WATER_WRAPPER=143;a.OUT_UPDATE_BOAT_CONTROLS=144;a.OUT_UPDATE_CAR_CONTROLS=145;a.OUT_PING=146;a.OUT_DEBUG=147;a.OUT_UPDATE_WORLD=148;var k=b4w.worker_listeners,f=b4w.worker_namespaces,
p={msg_id:g,body_id:0,time:0,trans:new Float32Array(3),quat:new Float32Array(4),linvel:new Float32Array(3),angvel:new Float32Array(3),len:0},K={msg_id:l,chassis_hull_body_id:0,prop_ind:0,trans:new Float32Array(3),quat:new Float32Array(4),len:0},D={msg_id:n,id:0,body_id_hit:0,hit_fract:0,hit_time:0,len:0},A={msg_id:q,id:0,body_id_hit:0,hit_fract:0,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3),len:0},h={msg_id:e,body_id_a:0,body_id_b:0,result:0,len:0},x={msg_id:d,body_id_a:0,body_id_b:0,
result:0,coll_point:new Float32Array(3),coll_norm:new Float32Array(3),coll_dist:0,len:0},w={msg_id:u,body_id:0,trans:new Float32Array(3),quat:new Float32Array(4),len:0},r=[p,K,D,A,h,x,w];a.create_worker=function(a,d){var c={is_main:a?!0:!1,web_worker:null,buf_arr:[],fb_worker_ns:""};if(d)if(c.web_worker={addEventListener:function(a,b,d){"message"!=a&&panic("Wrong web worker event");v(c.fb_worker_ns,c.is_main,b)},removeEventListener:function(a,b,d){"message"!=a&&panic("Wrong web worker event");v(c.fb_worker_ns,
c.is_main,null)},postMessage:function(a,b){var d;a:{for(d=0;d<f.length;d+=2)if(f[d+1]==c.fb_worker_ns){d=k[d+Number(!!c.is_main)];break a}d=null}d({data:a})},terminate:function(){for(var a=0;a<f.length;a+=2)if(f[a+1]==c.fb_worker_ns){k.splice(a,2);f.splice(a,2);break}}},c.is_main){var e=t("__util"),h=t("__container"),g=b4w.get_namespace(t),e=e.unique_name(g+"_worker");f.push(g);f.push(e);k.push(null);k.push(null);c.fb_worker_ns=e;(h=h.find_script(a))?b?h.addEventListener("load",function(){b4w.require("__bindings",
c.fb_worker_ns)},!1):(b4w.cleanup("__bindings",c.fb_worker_ns),b4w.cleanup("__ipc",c.fb_worker_ns),b4w.require("__bindings",c.fb_worker_ns)):(h=document.createElement("script"),h.src=a,h.defer="defer",h.async="async",h.addEventListener("load",function(){b=!1;b4w.require("__bindings",c.fb_worker_ns)},!1),document.head.appendChild(h))}else c.fb_worker_ns=b4w.get_namespace(t);else c.web_worker=a?new Worker(a):self;return c};a.attach_handler=function(a,b){c(r);var f=function(c){if(c.constructor==ArrayBuffer)c=
new Float32Array(c);else if(c[0].constructor==ArrayBuffer){for(var k=0;k<c.length;k++)f(c[k]);return}k=c[0]|0;switch(k){case g:var r=p;r.body_id=c[1]|0;r.time=c[2];r.trans[0]=c[3];r.trans[1]=c[4];r.trans[2]=c[5];r.quat[0]=c[6];r.quat[1]=c[7];r.quat[2]=c[8];r.quat[3]=c[9];r.linvel[0]=c[10];r.linvel[1]=c[11];r.linvel[2]=c[12];r.angvel[0]=c[13];r.angvel[1]=c[14];r.angvel[2]=c[15];break;case l:r=K;r.chassis_hull_body_id=c[1]|0;r.prop_ind=c[2]|0;r.trans[0]=c[3];r.trans[1]=c[4];r.trans[2]=c[5];r.quat[0]=
c[6];r.quat[1]=c[7];r.quat[2]=c[8];r.quat[3]=c[9];break;case n:r=D;r.id=c[1]|0;r.body_id_hit=c[2]|0;r.hit_fract=c[3];r.hit_time=c[4];break;case q:r=A;r.id=c[1]|0;r.body_id_hit=c[2]|0;r.hit_fract=c[3];r.hit_time=c[4];r.hit_pos[0]=c[5];r.hit_pos[1]=c[6];r.hit_pos[2]=c[7];r.hit_norm[0]=c[8];r.hit_norm[1]=c[9];r.hit_norm[2]=c[10];break;case e:r=h;r.body_id_a=c[1]|0;r.body_id_b=c[2]|0;r.result=!!c[3];break;case d:r=x;r.body_id_a=c[1]|0;r.body_id_b=c[2]|0;r.result=!!c[3];r.coll_point[0]=c[4];r.coll_point[1]=
c[5];r.coll_point[2]=c[6];r.coll_norm[0]=c[7];r.coll_norm[1]=c[8];r.coll_norm[2]=c[9];r.coll_dist=c[10];break;case u:r=w;r.body_id=c[1]|0;r.trans[0]=c[2];r.trans[1]=c[3];r.trans[2]=c[4];r.quat[0]=c[5];r.quat[1]=c[6];r.quat[2]=c[7];r.quat[3]=c[8];break;default:r=c}b(a,k,r)};a.web_worker.addEventListener("message",function(a){f(a.data)},!1)};a.cleanup=function(){};a.post_msg=function(a,b){if(a)switch(b){case g:var c=p,f=new Float32Array(c.len);f[0]=c.msg_id;f[1]=c.body_id;f[2]=c.time;f[3]=c.trans[0];
f[4]=c.trans[1];f[5]=c.trans[2];f[6]=c.quat[0];f[7]=c.quat[1];f[8]=c.quat[2];f[9]=c.quat[3];f[10]=c.linvel[0];f[11]=c.linvel[1];f[12]=c.linvel[2];f[13]=c.angvel[0];f[14]=c.angvel[1];f[15]=c.angvel[2];a.buf_arr.push(f.buffer);break;case l:c=K;f=new Float32Array(c.len);f[0]=c.msg_id;f[1]=c.chassis_hull_body_id;f[2]=c.prop_ind;f[3]=c.trans[0];f[4]=c.trans[1];f[5]=c.trans[2];f[6]=c.quat[0];f[7]=c.quat[1];f[8]=c.quat[2];f[9]=c.quat[3];a.buf_arr.push(f.buffer);break;case n:c=D;f=new Float32Array(c.len);
f[0]=c.msg_id;f[1]=c.id;f[2]=c.body_id_hit;f[3]=c.hit_fract;f[4]=c.hit_time;a.buf_arr.push(f.buffer);break;case q:c=A;f=new Float32Array(c.len);f[0]=c.msg_id;f[1]=c.id;f[2]=c.body_id_hit;f[3]=c.hit_fract;f[4]=c.hit_time;f[5]=c.hit_pos[0];f[6]=c.hit_pos[1];f[7]=c.hit_pos[2];f[8]=c.hit_norm[0];f[9]=c.hit_norm[1];f[10]=c.hit_norm[2];a.buf_arr.push(f.buffer);break;case e:c=h;f=new Float32Array(c.len);f[0]=c.msg_id;f[1]=c.body_id_a;f[2]=c.body_id_b;f[3]=c.result;a.buf_arr.push(f.buffer);break;case d:c=
x;f=new Float32Array(c.len);f[0]=c.msg_id;f[1]=c.body_id_a;f[2]=c.body_id_b;f[3]=c.result;f[4]=c.coll_point[0];f[5]=c.coll_point[1];f[6]=c.coll_point[2];f[7]=c.coll_norm[0];f[8]=c.coll_norm[1];f[9]=c.coll_norm[2];f[10]=c.coll_dist;a.buf_arr.push(f.buffer);break;case u:c=w;f=new Float32Array(c.len);f[0]=c.msg_id;f[1]=c.body_id;f[2]=c.trans[0];f[3]=c.trans[1];f[4]=c.trans[2];f[5]=c.quat[0];f[6]=c.quat[1];f[7]=c.quat[2];f[8]=c.quat[3];a.buf_arr.push(f.buffer);break;default:f=[];for(c=1;c<arguments.length;c++)f.push(arguments[c]);
a.web_worker.postMessage(f)}};a.post_msg_arr=function(a){a&&a.buf_arr.length&&(a.web_worker.postMessage(a.buf_arr),a.buf_arr.length=0)};a.get_msg_cache=function(a){switch(a){case g:return p;case l:return K;case n:return D;case q:return A;case e:return h;case d:return x;case u:return w;default:return null}};a.terminate=function(a){a.web_worker.terminate();a.web_worker=null};a.is_active=function(a){return!!a.web_worker};a.is_fallback=function(a){return!!a.fb_worker_ns}};b4w.module.__hud=function(a,t){function v(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function c(a){b(' SCENE "'+a.name+'"');if(a._render){var c=0,d=0,e=0;q.traverse(a._render.graph,function(a,f){if("SINK"==f.type)b(" (F)",f.type);else{var k=f.type,g=Math.round(f.camera.width)+"x"+Math.round(f.camera.height),r=f.bundles.length,m=f.debug_render_calls;"MAIN_CUBE_REFLECT"==f.type&&(r*=6);var n=f.enqueue&&f.do_render,l=n?f.debug_render_time:0;b(n?" (A)":" (P)",
k,f.num_lights,g,m,"of",r,"  ",l.toFixed(3));f.debug_render_calls=0;n&&(c+=r,d+=m,e+=l)}});return[c,d,e]}b("No INFO")}function b(){for(var a=80+20*k[0],b=arguments[0],c=1;c<arguments.length;c++){for(var d=g[c]-String(arguments[c]).length,e="",h=0;h<d;h++)e+=" ";b+=e+arguments[c]}k[0]++;u.fillText(b,30,a)}function e(a,b,c,d,e){e.x=a;e.y=b;e.w=c;e.h=d;return e}function d(a,b,c){b*=a.w;c.x=a.x+b;c.y=a.y;c.w=a.w-2*b;c.h=a.h;return c}function l(a){return a.x+a.w/2}function n(a){var b=u,c={x:0,y:0,w:0,
h:0};e(0,0,b.canvas.width,b.canvas.height,c);d(c,.01,c);b=.02*c.h;c.x=c.x;c.y+=b;c.w=c.w;c.h-=2*b;b=c.w/8;c.x+=b*a;c.y=c.y;c.w=b;c.h=c.h;d(c,.02,c);return c}var q=t("__graph");t("__print");var g=[5,19,3,10,4,3,5],u=null,k=[0,0];a.init=function(a){a=a.getContext("2d");v(a);return u=a};a.update_dim=function(){u&&v(u)};a.reset=function(){var a=u;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),k[0]=0,k[1]=0)};a.show_debug_info=
function(a,d){var e=u;if(e){e.textAlign="left";e.fillStyle="rgba(0,255,0,255)";b(" FPS",(1/d).toFixed(2));k[0]++;for(var g=e=0,n=0,h=0;h<a.length;h++){var x=c(a[h]),e=e+x[0],g=g+x[1],n=n+x[2];k[0]++}b(" -----------------------------------------------");b("    ","TOTAL ACTIVE","","",g,"of",e,"  ",n.toFixed(3))}};a.print=function(){var a=u;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",b.apply(Math,arguments))};a.plot_array=function(a,b,c,d,e,k,g){var q=u;if(q){b=n(b);var r=b.h/5;b.x=b.x;b.y+=
4*r;b.w=b.w;b.h=r;q.textAlign="center";q.fillStyle="#00FF00";u.fillText(a,l(b),b.y-10);q.strokeStyle="#00FF00";q.lineWidth=.5;q.beginPath();q.moveTo(b.x,b.y);q.lineTo(b.x+b.w,b.y);q.lineTo(b.x+b.w,b.y+b.h);q.lineTo(b.x,b.y+b.h);q.closePath();q.stroke();if(!k&&!g)for(k=1E6,g=-1E6,a=0;a<c.length;a++)k=Math.min(k,c[a]),g=Math.max(g,c[a]);q.textAlign="right";u.fillText(String(k),b.x-10,b.y+b.h);u.fillText(String(g),b.x-10,b.y);q.textAlign="center";u.fillText(String(d),b.x,b.y+b.h+15);u.fillText(String(e),
b.x+b.w,b.y+b.h+15);q.strokeStyle="#FF0000";q.lineWidth=1.5;q.beginPath();d=b.w/(c.length-1);g=b.h/(g-k);for(a=0;a<c.length;a++)e=b.x+d*a,r=b.y+b.h-(c[a]-k)*g,0==a?q.moveTo(e,r):q.lineTo(e,r);q.stroke()}};a.draw_mixer_strip=function(a,b,c,d,k,h,g){var q=u;if(q)for(q.textAlign="center",q.fillStyle="#00FF00",q.font="bold 12px Courier",c=n(c),u.fillText(b?"["+a+"]":a,l(c),c.y),0<=h&&u.fillText(h?"[M]":"[ ]",l(c)-15,c.y+30),0<=g&&u.fillText(g?"[S]":"[ ]",l(c)+15,c.y+30),a={x:0,y:0,w:0,h:0},b=0;b<d.length;b++){var r=
d[b];(g="VOLUME"==r[0])?e(c.x,c.y+350,c.w,250,a):e(c.x,c.y+10+50*b,c.w,c.h,a);h=q;var m=a,E=b==k,y=r[0],t=r[1],L=r[2],N=r[3],B=r[5],r=(N-L)/r[4],r=1>r?Math.floor(1/r-1E-5).toFixed(0).length:0,B=B?Math.log(t/L)/Math.log(N/L):(t-L)/(N-L);h.textAlign="center";E?h.fillText("["+y+"]",l(m),m.y):h.fillText(y,l(m),m.y);h.strokeStyle="#00FF00";h.lineWidth=g?3:1;g?(h.textAlign="right",h.fillText(N.toFixed(r),l(m)-10,m.y+15),h.textAlign="right",h.fillText(L.toFixed(r),l(m)-10,m.y+m.h-15)):(h.textAlign="right",
h.fillText(L.toFixed(r),m.x+28,m.y+15),h.textAlign="left",h.fillText(N.toFixed(r),m.x+m.w-28,m.y+15));h.beginPath();if(g){var O=m.y+15+(m.h-30)*(1-B);h.moveTo(l(m),m.y+15);h.lineTo(l(m),m.y+m.h-15);h.moveTo(l(m)-5,m.y+15);h.lineTo(l(m)+5,m.y+15);h.moveTo(l(m)-5,m.y+m.h-15);h.lineTo(l(m)+5,m.y+m.h-15);h.moveTo(l(m)-5,O);h.lineTo(l(m)+5,O)}else{var F=m.x+30+(m.w-60)*B;h.moveTo(m.x+30,m.y+15);h.lineTo(m.x+m.w-30,m.y+15);h.moveTo(m.x+30,m.y+15-5);h.lineTo(m.x+30,m.y+15+5);h.moveTo(m.x+m.w-30,m.y+15-5);
h.lineTo(m.x+m.w-30,m.y+15+5);h.moveTo(F,m.y+15-5);h.lineTo(F,m.y+15+5)}h.stroke();"EQ_Q"==y?(E=t,E=1+1/(2*E*E)+Math.sqrt((2+1/(E*E))*(2+1/(E*E))/4-1),E=Math.log(E)/Math.log(2),g?(h.textAlign="left",h.fillText(t.toFixed(r),l(m)+10,O),h.textAlign="left",h.fillText("("+E.toFixed(r+1)+")",l(m)+10,O+10)):(h.textAlign="right",h.fillText(t.toFixed(r),F,m.y+30),h.textAlign="left",h.fillText("("+E.toFixed(r+1)+")",F,m.y+30))):g?(h.textAlign="left",h.fillText(t.toFixed(r),l(m)+10,O)):(h.textAlign="center",
h.fillText(t.toFixed(r),F,m.y+30))}}};b4w.module.__renderer=function(a,t){function v(a){for(var c=a.camera,d=a.bundles,f=0;f<d.length;f++){var k=d[f];if(k.do_render){var h=a,g=c,n=k.obj_render,l=k.batch,C=l.shader;w.useProgram(C.program);for(var k=l.bufs_data,q=l.attribute_setters,u=C.transient_uniform_setters,G=u.length;G--;){var z=u[G];z.fun(w,z.loc,h,n,l,g)}g=l.color_mask;w.colorMask(g,g,g,g);w.depthMask(l.depth_mask);l.use_backface_culling?w.enable(w.CULL_FACE):w.disable(w.CULL_FACE);g=l.textures;for(l=0;l<g.length;l++)u=g[l],w.activeTexture(w.TEXTURE0+
l),w.bindTexture(u.w_target,u.w_texture);if("SKY"==h.type){g=h;C=C.uniforms;l=g.camera.color_attachment.w_texture;u=g.cube_view_matrices;for(G=0;6>G;G++)if(z=e(G),p.clear_procedural_sky_hack?(w.bindTexture(w.TEXTURE_CUBE_MAP,l),w.texImage2D(z,0,w.RGBA,1,1,0,w.RGBA,w.UNSIGNED_BYTE,x)):(w.uniformMatrix4fv(C.u_cube_view_matrix,!1,u[G]),w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,z,l,0),b(k,q,n.va_frame)),g.need_fog_update&&3!=G){var z=g,t=G,U=r;p.clear_procedural_sky_hack?U.set(x):(w.readPixels(191,
191,1,1,w.RGBA,w.UNSIGNED_BYTE,U),255!=U[0]&&255!=U[1]&&255!=U[2]||w.readPixels(191,220,1,1,w.RGBA,w.UNSIGNED_BYTE,U));var P=U[0],A=U[1],U=U[2],P=P/255,A=A/255,U=U/255;2===t?(z.cube_fog[3]=P,z.cube_fog[7]=A,z.cube_fog[11]=U):2>t?(z.cube_fog[4*t]=P,z.cube_fog[4*t+1]=A,z.cube_fog[4*t+2]=U):(z.cube_fog[4*(t-2)]=P,z.cube_fog[4*(t-2)+1]=A,z.cube_fog[4*(t-2)+2]=U)}h.debug_render_calls+=6}else b(k,q,n.va_frame),h.debug_render_calls++}}}function c(a){if(a){var b=(a.clear_color?w.COLOR_BUFFER_BIT:0)|(a.clear_depth?
w.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "MAIN_GLOW":a=h;break;case "SHADOW_CAST":a=K;break;case "DEPTH":a=D;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":case "ANCHOR_VISIBILITY":a=A;break;case "OUTLINE_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=h;break;default:a=p.background_color}}else b=w.COLOR_BUFFER_BIT|w.DEPTH_BUFFER_BIT,a=p.background_color;w.colorMask(!0,!0,!0,!0);w.depthMask(!0);w.clearColor(a[0],a[1],a[2],a[3]);w.clear(b)}function b(a,
b,c){w.bindBuffer(w.ARRAY_BUFFER,a.vbo);for(var d=0;d<b.length;d++){var e=b[d];w.enableVertexAttribArray(e.loc);w.vertexAttribPointer(e.loc,e.num_comp,w.FLOAT,!1,0,e.base_offset+e.frame_length*c)}a.ibo?(w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,a.ibo),w.drawElements(a.mode,a.count,a.ibo_type,0)):w.drawArrays(a.mode,0,a.count);for(d=0;d<b.length;d++)e=b[d],w.disableVertexAttribArray(e.loc)}function e(a){switch(a){case 0:return w.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return w.TEXTURE_CUBE_MAP_NEGATIVE_X;case 2:return w.TEXTURE_CUBE_MAP_POSITIVE_Y;
case 3:return w.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 4:return w.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return w.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function d(a){var b=a.uniforms,c=[],d=[],e={},f;for(f in b){var h=!1;switch(f){case "u_proj_matrix":var g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.proj_matrix)},h=!0;break;case "u_view_matrix":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.view_matrix)};h=!0;break;case "u_view_tsr":case "u_view_tsr_frag":g=function(a,b,c,d,e,f){a.uniformMatrix3fv(b,!1,f.view_tsr)};
h=!0;break;case "u_shadow_cast_billboard_view_tsr":g=function(a,b,c,d,e,f){a.uniformMatrix3fv(b,!1,f.shadow_cast_billboard_view_tsr)};h=!0;break;case "u_view_proj_prev":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.prev_view_proj_matrix)};h=!0;break;case "u_view_proj_matrix":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.view_proj_matrix)};h=!0;break;case "u_view_proj_inverse":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.view_proj_inv_matrix)};h=!0;break;case "u_sky_vp_inverse":g=function(a,
b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.sky_vp_inv_matrix)};h=!0;break;case "u_camera_eye":case "u_camera_eye_frag":g=function(a,b,c,d,e,f){a.uniform3fv(b,k.get_trans_view(f.world_tsr))};h=!0;break;case "u_camera_quat":g=function(a,b,c,d,e,f){a.uniform4fv(b,k.get_quat_view(f.world_tsr))};h=!0;break;case "u_view_max_depth":g=function(a,b,c,d,e,f){a.uniform1f(b,f.far)};h=!0;break;case "u_camera_range":g=function(a,b,c,d,e,f){a.uniform2f(b,f.near,f.far)};break;case "u_csm_center_dists":g=function(a,b,c,
d,e,f){a.uniform4fv(b,f.csm_center_dists)};break;case "u_cam_water_depth":g=function(a,b,c,d,e,f){a.uniform1f(b,c.cam_water_depth)};h=!0;break;case "u_waves_height":g=function(a,b,c,d,e,f){a.uniform1f(b,c.water_waves_height)};break;case "u_waves_length":g=function(a,b,c,d,e,f){a.uniform1f(b,c.water_waves_length)};break;case "u_fog_color_density":g=function(a,b,c,d,e,f){a.uniform4fv(b,c.fog_color_density)};break;case "u_fog_params":g=function(a,b,c,d,e,f){a.uniform4fv(b,c.fog_params)};break;case "u_underwater_fog_color_density":g=
function(a,b,c,d,e,f){a.uniform4fv(b,c.water_fog_color_density)};break;case "u_bloom_key":g=function(a,b,c,d,e,f){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":g=function(a,b,c,d,e,f){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":g=function(a,b,c,d,e,f){a.uniform1f(b,c.time)};h=!0;break;case "u_wind":g=function(a,b,c,d,e,f){a.uniform3fv(b,c.wind)};h=!0;break;case "u_sky_tex_dvar":g=function(a,b,c,d,e,f){a.uniform1f(b,c.sky_tex_default_value)};break;case "u_sky_tex_fac":g=function(a,
b,c,d,e,f){a.uniform4fv(b,c.sky_tex_fac)};break;case "u_sky_tex_color":g=function(a,b,c,d,e,f){a.uniform3fv(b,c.sky_tex_color)};break;case "u_horizon_color":g=function(a,b,c,d,e,f){a.uniform3fv(b,c.horizon_color)};break;case "u_zenith_color":g=function(a,b,c,d,e,f){a.uniform3fv(b,c.zenith_color)};break;case "u_environment_energy":g=function(a,b,c,d,e,f){a.uniform1f(b,c.environment_energy)};break;case "u_sky_color":g=function(a,b,c,d,e,f){a.uniform3fv(b,c.sky_color)};break;case "u_rayleigh_brightness":g=
function(a,b,c,d,e,f){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":g=function(a,b,c,d,e,f){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":g=function(a,b,c,d,e,f){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":g=function(a,b,c,d,e,f){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":g=function(a,b,c,d,e,f){a.uniform1f(b,c.rayleigh_strength)};break;case "u_mie_strength":g=function(a,b,c,d,e,f){a.uniform1f(b,c.mie_strength)};
break;case "u_rayleigh_collection_power":g=function(a,b,c,d,e,f){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":g=function(a,b,c,d,e,f){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":g=function(a,b,c,d,e,f){a.uniform1f(b,c.mie_distribution)};break;case "u_light_positions":g=function(a,b,c,d,e,f){a.uniform3fv(b,c.light_positions)};break;case "u_light_directions":g=function(a,b,c,d,e,f){a.uniform3fv(b,c.light_directions)};break;case "u_light_color_intensities":g=
function(a,b,c,d,e,f){a.uniform3fv(b,c.light_color_intensities)};break;case "u_light_factors":g=function(a,b,c,d,e,f){a.uniform4fv(b,c.light_factors)};break;case "u_sun_quaternion":g=function(a,b,c,d,e,f){a.uniform4fv(b,c.sun_quaternion)};break;case "u_sun_intensity":g=function(a,b,c,d,e,f){a.uniform3fv(b,c.sun_intensity)};break;case "u_sun_direction":g=function(a,b,c,d,e,f){a.uniform3fv(b,c.sun_direction)};break;case "u_height":g=function(a,b,c,d,e,f){a.uniform1f(b,f.height)};h=!0;break;case "u_model_tsr":g=
function(a,b,c,d,e,f){a.uniformMatrix3fv(b,!1,d.world_tsr)};h=!0;break;case "u_transb":g=function(a,b,c,d,e,f){a.uniform4fv(b,d.trans_before)};h=!0;break;case "u_transa":g=function(a,b,c,d,e,f){a.uniform4fv(b,d.trans_after)};h=!0;break;case "u_arm_rel_trans":g=function(a,b,c,d,e,f){a.uniform4fv(b,d.arm_rel_trans)};h=!0;break;case "u_arm_rel_quat":g=function(a,b,c,d,e,f){a.uniform4fv(b,d.arm_rel_quat)};h=!0;break;case "u_quat":g=function(a,b,c,d,e,f){c=k.get_quat_view(d.world_tsr);a.uniform4fv(b,c)};
h=!0;break;case "u_quatsb":g=function(a,b,c,d,e,f){a.uniform4fv(b,d.quats_before)};h=!0;break;case "u_quatsa":g=function(a,b,c,d,e,f){a.uniform4fv(b,d.quats_after)};h=!0;break;case "u_frame_factor":g=function(a,b,c,d,e,f){a.uniform1f(b,d.frame_factor)};h=!0;break;case "au_center_pos":g=function(a,b,c,d,e,f){};h=!0;break;case "au_wind_bending_amp":g=function(a,b,c,d,e,f){a.uniform1f(b,d.wind_bending_amp)};h=!0;break;case "au_wind_bending_freq":g=function(a,b,c,d,e,f){a.uniform1f(b,d.wind_bending_freq)};
h=!0;break;case "au_detail_bending_freq":g=function(a,b,c,d,e,f){a.uniform1f(b,d.detail_bending_freq)};h=!0;break;case "au_detail_bending_amp":g=function(a,b,c,d,e,f){a.uniform1f(b,d.detail_bending_amp)};h=!0;break;case "au_branch_bending_amp":g=function(a,b,c,d,e,f){a.uniform1f(b,d.branch_bending_amp)};h=!0;break;case "u_node_values":g=function(a,b,c,d,e,f){a.uniform1fv(b,d.mats_values)};h=!0;break;case "u_node_rgbs":g=function(a,b,c,d,e,f){a.uniform3fv(b,d.mats_rgbs)};h=!0;break;case "u_diffuse_color":g=
function(a,b,c,d,e,f){a.uniform4fv(b,e.diffuse_color)};h=!0;break;case "u_diffuse_intensity":g=function(a,b,c,d,e,f){a.uniform1f(b,e.diffuse_intensity)};h=!0;break;case "u_diffuse_params":g=function(a,b,c,d,e,f){a.uniform2fv(b,e.diffuse_params)};h=!0;break;case "u_emit":g=function(a,b,c,d,e,f){a.uniform1f(b,e.emit)};h=!0;break;case "u_ambient":g=function(a,b,c,d,e,f){a.uniform1f(b,e.ambient)};h=!0;break;case "u_specular_color":g=function(a,b,c,d,e,f){a.uniform3fv(b,e.specular_color)};h=!0;break;case "u_specular_alpha":g=
function(a,b,c,d,e,f){a.uniform1f(b,e.specular_alpha)};h=!0;break;case "u_specular_params":g=function(a,b,c,d,e,f){a.uniform3fv(b,e.specular_params)};h=!0;break;case "u_reflect_factor":g=function(a,b,c,d,e,f){a.uniform1f(b,e.reflect_factor)};h=!0;break;case "u_mirror_factor":g=function(a,b,c,d,e,f){a.uniform1f(b,e.mirror_factor)};h=!0;break;case "u_grass_map_dim":g=function(a,b,c,d,e,f){a.uniform3fv(b,e.grass_map_dim)};h=!0;break;case "u_grass_size":g=function(a,b,c,d,e,f){a.uniform1f(b,e.grass_size)};
h=!0;break;case "u_scale_threshold":g=function(a,b,c,d,e,f){a.uniform1f(b,e.grass_scale_threshold)};h=!0;break;case "u_cube_fog":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,e.cube_fog)};break;case "u_jitter_amp":g=function(a,b,c,d,e,f){a.uniform1f(b,e.jitter_amp)};h=!0;break;case "u_jitter_freq":g=function(a,b,c,d,e,f){a.uniform1f(b,e.jitter_freq)};h=!0;break;case "u_wireframe_mode":g=function(a,b,c,d,e,f){a.uniform1i(b,e.wireframe_mode)};break;case "u_wireframe_edge_color":g=function(a,b,c,d,
e,f){a.uniform3fv(b,e.wireframe_edge_color)};break;case "u_subpixel_jitter":g=function(a,b,c,d,e,f){a.uniform2fv(b,c.jitter_projection_space)};h=!0;break;case "u_subsample_indices":g=function(a,b,c,d,e,f){a.uniform4fv(b,c.jitter_subsample_ind)};h=!0;break;case "u_refr_bump":g=function(a,b,c,d,e,f){a.uniform1f(b,e.refr_bump)};h=!0;break;case "u_lamp_light_positions":g=function(a,b,c,d,e,f){a.uniform3fv(b,e.lamp_light_positions)};break;case "u_lamp_light_directions":g=function(a,b,c,d,e,f){a.uniform3fv(b,
e.lamp_light_directions)};break;case "u_lamp_light_color_intensities":g=function(a,b,c,d,e,f){a.uniform3fv(b,e.lamp_light_color_intensities)};break;case "u_lamp_light_factors":g=function(a,b,c,d,e,f){a.uniform4fv(b,e.lamp_light_factors)};break;case "u_halo_size":g=function(a,b,c,d,e,f){a.uniform1f(b,e.halo_size)};h=!0;break;case "u_halo_hardness":g=function(a,b,c,d,e,f){a.uniform1f(b,e.halo_hardness)};h=!0;break;case "u_halo_rings_color":g=function(a,b,c,d,e,f){a.uniform3fv(b,e.halo_rings_color)};
h=!0;break;case "u_halo_lines_color":g=function(a,b,c,d,e,f){a.uniform3fv(b,e.halo_lines_color)};h=!0;break;case "u_halo_stars_blend":g=function(a,b,c,d,e,f){a.uniform1f(b,e.halo_stars_blend)};h=!0;break;case "u_halo_stars_height":g=function(a,b,c,d,e,f){a.uniform1f(b,e.halo_stars_height)};h=!0;break;case "u_fresnel_params":g=function(a,b,c,d,e,f){a.uniform4fv(b,e.fresnel_params)};h=!0;break;case "u_texture_scale":g=function(a,b,c,d,e,f){a.uniform3fv(b,e.texture_scale)};h=!0;break;case "u_parallax_scale":g=
function(a,b,c,d,e,f){a.uniform1f(b,e.parallax_scale)};h=!0;break;case "u_color_id":g=function(a,b,c,d,e,f){a.uniform3fv(b,d.color_id)};h=!0;break;case "u_line_points":g=function(a,b,c,d,e,f){a.uniform3fv(b,e.line_points)};h=!0;break;case "u_diffuse_color_factor":g=function(a,b,c,d,e,f){a.uniform1f(b,e.diffuse_color_factor)};h=!0;break;case "u_alpha_factor":g=function(a,b,c,d,e,f){a.uniform1f(b,e.alpha_factor)};h=!0;break;case "u_specular_color_factor":g=function(a,b,c,d,e,f){a.uniform1f(b,e.specular_color_factor)};
h=!0;break;case "u_normal_factor":g=function(a,b,c,d,e,f){a.uniform1f(b,e.normal_factor)};h=!0;break;case "u_normalmap0_scale":g=function(a,b,c,d,e,f){a.uniform2fv(b,e.normalmap_scales[0])};h=!0;break;case "u_normalmap1_scale":g=function(a,b,c,d,e,f){a.uniform2fv(b,e.normalmap_scales[1])};h=!0;break;case "u_normalmap2_scale":g=function(a,b,c,d,e,f){a.uniform2fv(b,e.normalmap_scales[2])};h=!0;break;case "u_normalmap3_scale":g=function(a,b,c,d,e,f){a.uniform2fv(b,e.normalmap_scales[3])};h=!0;break;
case "u_foam_factor":g=function(a,b,c,d,e,f){a.uniform1f(b,e.foam_factor)};h=!0;break;case "u_foam_uv_freq":g=function(a,b,c,d,e,f){a.uniform2fv(b,e.foam_uv_freq)};h=!0;break;case "u_foam_mag":g=function(a,b,c,d,e,f){a.uniform2fv(b,e.foam_mag)};h=!0;break;case "u_foam_scale":g=function(a,b,c,d,e,f){a.uniform2fv(b,e.foam_scale)};h=!0;break;case "u_water_norm_uv_velocity":g=function(a,b,c,d,e,f){a.uniform1f(b,e.water_norm_uv_velocity)};h=!0;break;case "u_shallow_water_col":g=function(a,b,c,d,e,f){a.uniform3fv(b,
e.shallow_water_col)};h=!0;break;case "u_shore_water_col":g=function(a,b,c,d,e,f){a.uniform3fv(b,e.shore_water_col)};h=!0;break;case "u_water_shallow_col_fac":g=function(a,b,c,d,e,f){a.uniform1f(b,e.shallow_water_col_fac)};h=!0;break;case "u_water_shore_col_fac":g=function(a,b,c,d,e,f){a.uniform1f(b,e.shore_water_col_fac)};h=!0;break;case "u_p_length":g=function(a,b,c,d,e,f){a.uniform1f(b,e.particles_data.time_length)};h=!0;break;case "u_p_cyclic":g=function(a,b,c,d,e,f){a.uniform1i(b,e.particles_data.cyclic)};
h=!0;break;case "u_p_max_lifetime":g=function(a,b,c,d,e,f){a.uniform1f(b,e.particles_data.lifetime)};h=!0;break;case "u_p_fade_in":g=function(a,b,c,d,e,f){a.uniform1f(b,e.particles_data.fade_in)};h=!0;break;case "u_p_fade_out":g=function(a,b,c,d,e,f){a.uniform1f(b,e.particles_data.fade_out)};h=!0;break;case "u_p_size":g=function(a,b,c,d,e,f){a.uniform1f(b,e.particles_data.size)};h=!0;break;case "u_p_alpha_start":g=function(a,b,c,d,e,f){a.uniform1f(b,e.particles_data.alpha_start)};h=!0;break;case "u_p_alpha_end":g=
function(a,b,c,d,e,f){a.uniform1f(b,e.particles_data.alpha_end)};h=!0;break;case "u_p_nfactor":g=function(a,b,c,d,e,f){a.uniform1f(b,e.particles_data.nfactor)};h=!0;break;case "u_p_gravity":g=function(a,b,c,d,e,f){a.uniform1f(b,e.particles_data.gravity)};h=!0;break;case "u_p_mass":g=function(a,b,c,d,e,f){a.uniform1f(b,e.particles_data.mass)};h=!0;break;case "u_p_size_ramp":g=function(a,b,c,d,e,f){a.uniform2fv(b,e.particles_data.size_ramp)};h=!0;break;case "u_p_color_ramp":g=function(a,b,c,d,e,f){a.uniform4fv(b,
e.particles_data.color_ramp)};h=!0;break;case "u_p_wind_fac":g=function(a,b,c,d,e,f){a.uniform1f(b,e.particles_data.wind_factor)};h=!0;break;case "u_texel_size":g=function(a,b,c,d,e,f){a.uniform2fv(b,c.texel_size)};h=!0;break;case "u_p_time":g=function(a,b,c,d,e,f){a.uniform1f(b,e.particles_data.time)};h=!0;break;case "u_position":g=function(a,b,c,d,e,f){a.uniform3fv(b,e.positions)};h=!0;break;case "u_va_frame_factor":g=function(a,b,c,d,e,f){a.uniform1f(b,d.va_frame_factor)};h=!0;break;case "u_perspective_cast_far_bound":g=
function(a,b,c,d,e,f){a.uniform1f(b,c.perspective_cast_far_bound)};break;case "u_normal_offset":g=function(a,b,c,d,e,f){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_pcf_blur_radii":g=function(a,b,c,d,e,f){a.uniform4fv(b,f.pcf_blur_radii)};break;case "u_v_light_tsr":g=function(a,b,c,d,e,f){a.uniformMatrix3fv(b,!1,c.v_light_tsr)};h=!0;break;case "u_p_light_matrix0":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,c.p_light_matrix[0])};h=!0;break;case "u_p_light_matrix1":g=function(a,b,c,
d,e,f){a.uniformMatrix4fv(b,!1,c.p_light_matrix[1])};h=!0;break;case "u_p_light_matrix2":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,c.p_light_matrix[2])};h=!0;break;case "u_p_light_matrix3":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,c.p_light_matrix[3])};h=!0;break;case "u_motion_blur_exp":g=function(a,b,c,d,e,f){a.uniform1f(b,c.motion_blur_exp)};h=!0;break;case "u_motion_blur_decay_threshold":g=function(a,b,c,d,e,f){a.uniform1f(b,c.mb_decay_threshold)};h=!0;break;case "u_refl_plane":g=
function(a,b,c,d,e,f){a.uniform4fv(b,d.reflection_plane)};h=!0;break;case "u_radial_blur_step":g=function(a,b,c,d,e,f){a.uniform1f(b,c.radial_blur_step)};break;case "u_god_rays_intensity":g=function(a,b,c,d,e,f){a.uniform1f(b,c.god_rays_intensity)};break;case "u_ssao_radius_increase":g=function(a,b,c,d,e,f){a.uniform1f(b,c.ssao_radius_increase)};break;case "u_ssao_blur_discard_value":g=function(a,b,c,d,e,f){a.uniform1f(b,c.ssao_blur_discard_value)};h=!0;break;case "u_ssao_influence":g=function(a,
b,c,d,e,f){a.uniform1f(b,c.ssao_influence)};break;case "u_ssao_dist_factor":g=function(a,b,c,d,e,f){a.uniform1f(b,c.ssao_dist_factor)};break;case "u_dof_dist":g=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_distance)};h=!0;break;case "u_dof_front":g=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_front)};h=!0;break;case "u_dof_rear":g=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_rear)};h=!0;break;case "u_outline_intensity":g=function(a,b,c,d,e,f){a.uniform1f(b,d.outline_intensity)};h=!0;break;case "u_outline_color":g=
function(a,b,c,d,e,f){a.uniform3fv(b,c.outline_color)};break;case "u_draw_outline":g=function(a,b,c,d,e,f){a.uniform1f(b,c.draw_outline_flag)};h=!0;break;case "u_glow_mask_small_coeff":g=function(a,b,c,d,e,f){a.uniform1f(b,c.small_glow_mask_coeff)};h=!0;break;case "u_glow_mask_large_coeff":g=function(a,b,c,d,e,f){a.uniform1f(b,c.large_glow_mask_coeff)};h=!0;break;case "u_brightness":g=function(a,b,c,d,e,f){a.uniform1f(b,c.brightness)};break;case "u_contrast":g=function(a,b,c,d,e,f){a.uniform1f(b,
c.contrast)};break;case "u_exposure":g=function(a,b,c,d,e,f){a.uniform1f(b,c.exposure)};break;case "u_saturation":g=function(a,b,c,d,e,f){a.uniform1f(b,c.saturation)};break;default:g=null}g&&(g={name:f,fun:g,loc:b[f]},h?c.push(g):(d.push(g),e[f]=g))}a.transient_uniform_setters=c;a.permanent_uniform_setters=d;a.permanent_uniform_setters_table=e}var l=t("__batch"),n=t("__camera"),q=t("__config"),g=t("__debug"),u=t("__textures"),k=t("__tsr"),f=t("__util"),p=q.defaults,K=[1,1,1,1],D=[1,1,1,1],A=[0,0,
0,1],h=[0,0,0,0],x=new Uint8Array([91.8,142.8,.96*255,255]);new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,1,1,0]);new Float32Array([2,2,2,0]);var w=null,r=new Uint8Array(4);new Float32Array(9);new Float32Array(8);p=q.defaults;a.setup_context=function(a){var b=p.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,
a.ONE_MINUS_SRC_ALPHA);w=a};a.draw=function(a){if(a.do_render){g.render_time_start(a);if("RESOLVE"==a.type){var b=a.camera;w.bindFramebuffer(w.READ_FRAMEBUFFER,b.framebuffer_prev);w.bindFramebuffer(w.DRAW_FRAMEBUFFER,b.framebuffer);w.blitFramebuffer(0,0,b.width,b.height,0,0,b.width,b.height,w.COLOR_BUFFER_BIT|w.DEPTH_BUFFER_BIT,w.NEAREST);g.check_gl("draw resolve")}else if("COPY"==a.type)b=a.camera,w.bindFramebuffer(w.FRAMEBUFFER,b.framebuffer_prev),w.bindTexture(w.TEXTURE_2D,b.color_attachment.w_texture),
w.copyTexSubImage2D(w.TEXTURE_2D,0,0,0,0,0,b.width,b.height,0),g.check_gl("draw copy");else{b=a.camera;w.bindFramebuffer(w.FRAMEBUFFER,b.framebuffer);if(a.assign_texture){var f=b.color_attachment;w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,f.w_target,f.w_texture,0)}w.viewport(0,0,b.width,b.height);"MAIN_CUBE_REFLECT"!=a.type&&c(a);a.blend?w.enable(w.BLEND):w.disable(w.BLEND);a.depth_test?w.enable(w.DEPTH_TEST):w.disable(w.DEPTH_TEST);if(a.need_perm_uniforms_update){for(var b=a.camera,
f=a.bundles,h=0;h<f.length;h++){var r=f[h],l=r.batch,x=l.shader;w.useProgram(x.program);r=r.obj_render;x.permanent_uniform_setters.length||d(x);for(var x=x.permanent_uniform_setters,q=x.length;q--;){var u=x[q];u.fun(w,u.loc,a,r,l,b)}}a.need_perm_uniforms_update=!1}switch(a.type){case "DEPTH":p.ios_depth_hack?(w.enable(w.POLYGON_OFFSET_FILL),w.polygonOffset(5,5)):w.disable(w.POLYGON_OFFSET_FILL);w.cullFace(w.BACK);break;case "SHADOW_CAST":w.enable(w.POLYGON_OFFSET_FILL);w.polygonOffset(a.self_shadow_polygon_offset,
a.self_shadow_polygon_offset);w.cullFace(w.BACK);break;case "MAIN_PLANE_REFLECT":w.disable(w.POLYGON_OFFSET_FILL);w.cullFace(w.FRONT);break;case "MAIN_GLOW":if(1<p.msaa_samples){w.enable(w.POLYGON_OFFSET_FILL);w.polygonOffset(-2,-2);break}default:w.disable(w.POLYGON_OFFSET_FILL),w.cullFace(w.BACK)}if("MAIN_CUBE_REFLECT"==a.type)for(b=a.camera,f=b.color_attachment.w_texture,h=0;6>h;h++){l=e(h);b.view_matrix=a.cube_view_matrices[h];k.from_mat4(b.view_matrix,b.view_tsr);n.calc_sky_vp_inverse(b);w.framebufferTexture2D(w.FRAMEBUFFER,
w.COLOR_ATTACHMENT0,l,f,0);c(a);l=a.bundles;for(r=0;r<l.length;r++)l[r].do_render=l[r].do_render_cube[h];v(a)}else v(a);g.check_gl("draw subscene: "+a.type);w.bindFramebuffer(w.FRAMEBUFFER,null)}g.render_time_stop(a)}};a.clear=function(a){w.bindFramebuffer(w.FRAMEBUFFER,a.camera.framebuffer);c(a)};a.assign_attribute_setters=function(a){var b=a.attribute_setters;b.length=0;var c=a.bufs_data;a=a.shader;c&&a||f.panic("Incomplete batch");c=c.pointers;a=a.attributes;for(var d in a){var e=c[d];b.push({loc:a[d],
base_offset:4*e.offset,frame_length:1<e.frames?4*e.length:0,num_comp:e.num_comp})}};a.assign_uniform_setters=d;a.assign_texture_uniforms=function(a){var b=a.shader,c=a.textures;a=a.texture_names;w.useProgram(b.program);for(var d=0;d<c.length;d++)w.uniform1i(b.uniforms[a[d]],d)};a.read_pixels=function(a,b,c,d,e,k){d||(d=1);e||(e=1);k||(k=new Uint8Array(4*d*e));k.length!=4*d*e&&f.panic("read_pixels(): Wrong storage");w.bindFramebuffer(w.FRAMEBUFFER,a);w.readPixels(b,c,d,e,w.RGBA,w.UNSIGNED_BYTE,k);
w.bindFramebuffer(w.FRAMEBUFFER,null);return k};a.update_batch_permanent_uniform=function(a,b){var c=a.shader;w.useProgram(c.program);c.permanent_uniform_setters.length||d(c);c=c.permanent_uniform_setters_table[b];c.fun(w,c.loc,null,null,a,null)};a.render_target_create=function(a,b){var c=w.createFramebuffer();w.bindFramebuffer(w.FRAMEBUFFER,c);if(u.is_renderbuffer(a)){var d=a.w_renderbuffer;w.framebufferRenderbuffer(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.RENDERBUFFER,d)}else if(u.is_texture(a)){var e=
a,d=e.w_texture,e=e.w_target==w.TEXTURE_CUBE_MAP?w.TEXTURE_CUBE_MAP_NEGATIVE_Z:e.w_target;w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,e,d,0)}u.is_renderbuffer(b)?(d=b.w_renderbuffer,w.framebufferRenderbuffer(w.FRAMEBUFFER,w.DEPTH_ATTACHMENT,w.RENDERBUFFER,d)):u.is_texture(b)&&(e=b,d=e.w_texture,e=e.w_target,w.framebufferTexture2D(w.FRAMEBUFFER,w.DEPTH_ATTACHMENT,e,d,0));g.check_bound_fb();w.bindFramebuffer(w.FRAMEBUFFER,null);return c};a.render_target_cleanup=function(a,b,c,d,e){null==
a?(w.bindFramebuffer(w.FRAMEBUFFER,a),w.viewport(0,0,d,e),w.clear(w.COLOR_BUFFER_BIT|w.DEPTH_BUFFER_BIT)):(u.is_renderbuffer(b)?w.deleteRenderbuffer(b.w_renderbuffer):u.is_texture(b)&&w.deleteTexture(b.w_texture),u.is_renderbuffer(c)?w.deleteRenderbuffer(c.w_renderbuffer):u.is_texture(c)&&w.deleteTexture(c.w_texture),w.deleteFramebuffer(a))};a.increment_subpixel_index=function(){};a.draw_resized_cubemap_texture=function(a,c,d,e,f,k){a=a.w_texture;w.viewport(0,0,d,d);w.framebufferTexture2D(w.FRAMEBUFFER,
w.COLOR_ATTACHMENT0,c,a,0);c=l.create_postprocessing_batch("FLIP_CUBEMAP_COORDS");a=c.shader;w.activeTexture(w.TEXTURE0);w.bindTexture(w.TEXTURE_2D,f);var h=f=0;d!=e&&(f=1/(6*e),h=1/(4*e));w.uniform1i(a.uniforms.u_tex_number,k);w.uniform2fv(a.uniforms.u_delta,[f,h]);w.useProgram(a.program);b(c.bufs_data,c.attribute_setters,0);w.bindTexture(w.TEXTURE_2D,null)};a.draw_resized_texture=function(a,c,d,e,f,k){w.bindFramebuffer(w.FRAMEBUFFER,e);e=a.w_texture;a=a.w_target;w.bindTexture(a,e);w.viewport(0,
0,c,d);w.texImage2D(a,0,w.RGBA,c,d,0,w.RGBA,w.UNSIGNED_BYTE,null);w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,a,e,0);c=l.create_postprocessing_batch(k);d=c.shader;w.bindTexture(a,null);w.activeTexture(w.TEXTURE0);w.bindTexture(a,f);w.useProgram(d.program);b(c.bufs_data,c.attribute_setters,0);w.bindFramebuffer(w.FRAMEBUFFER,null);w.bindTexture(a,null)};a.cleanup=function(){}};b4w.module.__shaders=function(a,t){function v(a,b,d){var e=a.directives;"string"==typeof d&&(a=c(a,d))&&(d=a[1]);for(a=0;a<e.length;a++)if(e[a][0]==b){e[a][1]=d;return}e.push([b,d])}function c(a,b){for(var c=a.directives,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function b(a,b){var c=a+b;if(h[c])return h[c];if(x){var d=x[b];if(!d)return null;d=t("__gpp_parser").parser.parse(d)}else if(d=t("shader_texts")[b],!d)return null;return h[c]=d}function e(a,c,e){function f(c){c=c.parts;for(var e=
0;e<c.length;e++){var n=c[e];switch(n.type){case "condition":a:for(var n=n.parts,U=0;U<n.length;U++){var t=n[U];switch(t.type){case "if":case "elif":if(k(t.expression)){f(t.group);break a}break;case "else":f(t.group);break a;case "ifdef":t.name in r&&f(t.group);break;case "ifndef":t.name in r||f(t.group)}}break;case "include":n=b(D.shaders_dir,D.shaders_include_dir+n.file);f(n);break;case "var":case "export":case "import":break;case "define":U=n.name;r[U]=n.tokens;n.params&&(l[U]=n.params);break;
case "error":throw"Shader error: #error "+n.tokens.join(" ");case "line":break;case "pragma":m.push("#pragma "+n.name+" "+n.tokens.join(" "));break;case "undef":n=n.name;delete r[n];delete l[n];break;case "warning":p.warn("Shader warning: #warning "+n.tokens.join(" "));break;case "extension":n=d(n.tokens,r,l,!1);m.push("#extension "+n.join(" "));break;case "#":break;case "node":x[n.name]=n;break;case "nodes_global":n=g;for(U=0;U<n.length;U++){var t=n[U],L=x[t.id];if(L)for(var A=0,v=0;v<L.declarations.length;v++){var J=
L.declarations[v];"node_param"==J.type&&(J=J.qualifier.join(" ")+" ","vert"==a?J+=t.vparams[A]:"frag"==a&&(J+=t.params[A],null!==t.param_values[A]&&(J+=" = "+t.param_values[A])),J+=";",m.push(J),A++)}}break;case "nodes_main":n=g;for(U=0;U<n.length;U++)if(t=n[U],L=x[t.id]){A={};v={};for(J=0;J<t.dirs.length;J++)v[t.dirs[J][0]]=[t.dirs[J][1]];E=u=w=0;for(var J=t,V=L.declarations,S=A,R=v,K=0;K<V.length;K++){var Q=V[K];switch(Q.type){case "node_in":var M=J.inputs[w];if(null!==J.input_values[w]){if(("MATERIAL_BEGIN"==
J.id&&3===w||!R.MATERIAL_EXT&&("MATERIAL_BEGIN"==J.id&&4===w||"MATERIAL_END"==J.id&&3===w||"MATERIAL_END"==J.id&&4===w||"MATERIAL_END"==J.id&&5===w)||"TEXTURE_COLOR"==J.id||"TEXTURE_NORMAL"==J.id)&&Q.is_optional){S[Q.name]=J.input_values[w];w++;continue}var ja=Q.qualifier.join(" ")+" ",ja=ja+M,ja=ja+(" = "+J.input_values[w]),ja=ja+";";m.push(ja)}S[Q.name]=M;w++;break;case "node_out":M=J.outputs[u];if(!Q.is_optional||-1<q.indexOf(M))ja=Q.qualifier.join(" ")+" ",ja+=M,ja+=";",m.push(ja),S[Q.name]=M;
-1<q.indexOf(M)&&(R["USE_OUT_"+Q.name]=[1]);u++;break;case "node_param":"vert"==a?M=J.vparams[E]:"frag"==a&&(M=J.params[E]),S[Q.name]=M,E++}}m.push("{");h(t,L.statements,A,v);m.push("}")}break;case "textline":n=d(n.tokens,r,l,!1);m.push(n.join(" "));break;default:throw"Unknown element type: "+n.type;}}}function k(a,b){var c;c=d(a,r,l,!0,b);for(var e=[],f=0;f<c.length;f++)if(c[f]instanceof Object)switch(c[f].type){case "conditional_expr":var h=e.pop(),g=e.pop();e.pop()?e.push(g):e.push(h);break;case "logical_or_expr":h=
e.pop();for(g=0;g<c[f].places-1;g++)m=e.pop(),h=h||m;e.push(h);break;case "logical_and_expr":h=e.pop();for(g=0;g<c[f].places-1;g++)m=e.pop(),h=h&&m;e.push(h);break;case "logical_bitor_expr":h=e.pop();for(g=0;g<c[f].places-1;g++)h|=e.pop();e.push(h);break;case "logical_bitxor_expr":h=e.pop();for(g=0;g<c[f].places-1;g++)h^=e.pop();e.push(h);break;case "logical_bitand_expr":h=e.pop();for(g=0;g<c[f].places-1;g++)h&=e.pop();e.push(h);break;case "equal_expr":h=e.pop();g=e.pop();e.push(g==h);break;case "non_equal_expr":h=
e.pop();g=e.pop();e.push(g!=h);break;case "le_expr":h=e.pop();g=e.pop();e.push(g<=h);break;case "ge_expr":h=e.pop();g=e.pop();e.push(g>=h);break;case "l_expr":h=e.pop();g=e.pop();e.push(g<h);break;case "g_expr":h=e.pop();g=e.pop();e.push(g>h);break;case "left_shift_expr":g=e.pop();h=e.pop();e.push(g<<h);break;case "right_shift_expr":g=e.pop();h=e.pop();e.push(g>>h);break;case "add_expr":g=e.pop();h=e.pop();e.push(g+h);break;case "sub_expr":g=e.pop();h=e.pop();e.push(g-h);break;case "mul_expr":g=e.pop();
h=e.pop();e.push(g*h);break;case "div_expr":g=e.pop();h=e.pop();e.push(g/h);break;case "mod_expr":g=e.pop();h=e.pop();e.push(g%h);break;case "pre_inc_expr":case "post_inc_expr":m=e.pop();e.push(++m);break;case "pre_dec_expr":case "post_dec_expr":m=e.pop();e.push(--m);break;case "positive_expr":m=e.pop();e.push(+m);break;case "negative_expr":m=e.pop();e.push(-m);break;case "one_compl_expr":m=e.pop();e.push(~m);break;case "logic_negative_expr":m=e.pop();e.push(!m);break;default:K.panic("Unknown operation type: "+
c[f].type)}else{var m=c[f];/^[a-zA-Z_$][a-zA-Z_$0-9]*$/.test(m)?e.push(0):e.push(parseFloat(c[f]))}1==e.length?c=e[0]:(K.panic("Incorrect expression: "+c.join(" ")),c=void 0);return c}function h(a,b,c,e){for(var f=0;f<b.length;f++){var g=b[f];switch(g.type){case "node_condition":a:for(var n=a,g=g.parts,p=c,x=e,q=0;q<g.length;q++){var U=g[q];switch(U.type){case "node_if":case "node_elif":if(k(U.expression,x)){h(n,U.statements,p,x);break a}break;case "node_else":h(n,U.statements,p,x);break a;case "node_ifdef":(U.name in
r||U.name in x)&&h(n,U.statements,p,x);break;case "node_ifndef":U.name in r||U.name in x||h(n,U.statements,p,x)}}break;case "textline":n=[];for(p=0;p<g.tokens.length;p++)x=g.tokens[p],x in c?n.push(c[x]):n.push(x);n=d(n,r,l,!0,e);m.push(n.join(" "))}}}var g=e.node_elements;e=e.directives||[];for(var m=[],r={},n=0;n<e.length;n++)r[e[n][0]]=[e[n][1]];for(n=0;n<g.length;n++)r["USE_NODE_"+g[n].id]=[1];var l={},x={},q=[];for(n in g)for(var U in g[n].inputs)q.push(g[n].inputs[U]);f(c);var w=0,u=0,E=0;return m.join("\n")}
function d(a,b,c,d,e){var f=[];l(a,b,c,d,f,e);return f}function l(a,b,c,d,e,f){for(var k=0;k<a.length;k++){var h=a[k];h in b||f&&h in f?(h=f&&f[h]||b[h],0==h.length&&d?e.push(0):l(h,b,c,d,e,f)):e.push(h)}}function n(a,b,c,d,e){d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);f.check_shader_compiling(d,b,c);return d}function q(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return g(a);case 2:return"vec2("+g(a[0])+","+g(a[1])+")";case 3:return"vec3("+g(a[0])+","+g(a[1])+","+g(a[2])+
")";case 4:return"vec4("+g(a[0])+","+g(a[1])+","+g(a[2])+","+g(a[3])+")";case 9:return"mat3("+g(a[0])+","+g(a[1])+","+g(a[2])+","+g(a[3])+","+g(a[4])+","+g(a[5])+","+g(a[6])+","+g(a[7])+","+g(a[8])+")";case 16:return"mat4("+g(a[0])+","+g(a[1])+","+g(a[2])+","+g(a[3])+","+g(a[4])+","+g(a[5])+","+g(a[6])+","+g(a[7])+","+g(a[8])+","+g(a[9])+","+g(a[10])+","+g(a[11])+","+g(a[12])+","+g(a[13])+","+g(a[14])+","+g(a[15])+")";default:throw"Wrong glsl value dimension";}}function g(a){return a%1?String(a):
String(a)+".0"}var u=t("__assets"),k=t("__config"),f=t("__debug"),p=t("__print"),K=t("__util"),D=k.paths,A={},h={},x=null,w="anchors.glslf anchors.glslv color_id.glslf color_id.glslv depth.glslf depth.glslv grass_map.glslf grass_map.glslv halo.glslf halo.glslv main.glslf main.glslv main_stack.glslf main_stack.glslv particles_color.glslf particles_color.glslv particles_texture.glslf particles_texture.glslv procedural_skydome.glslf procedural_skydome.glslv special_lens_flares.glslf special_lens_flares.glslv special_skydome.glslf special_skydome.glslv special_water.glslf special_water.glslv wireframe.glslf wireframe.glslv postprocessing/anaglyph.glslf postprocessing/antialiasing.glslf postprocessing/bloom_combine.glslf postprocessing/compositing.glslf postprocessing/depth_pack.glslf postprocessing/dof.glslf postprocessing/glow.glslf postprocessing/bloom_blur.glslf postprocessing/god_rays.glslf postprocessing/god_rays.glslv postprocessing/god_rays_combine.glslf postprocessing/luminance.glslf postprocessing/luminance_av.glslf postprocessing/luminance_trunced.glslf postprocessing/luminance_trunced.glslv postprocessing/motion_blur.glslf postprocessing/outline.glslf postprocessing/postprocessing.glslf postprocessing/postprocessing.glslv postprocessing/smaa.glslf postprocessing/smaa.glslv postprocessing/ssao.glslf postprocessing/ssao_blur.glslf include/blending.glslf include/caustics.glslf include/color_util.glslf include/depth_fetch.glslf include/dynamic_grass.glslv include/environment.glslf include/fog.glslf include/fxaa.glslf include/lighting_nodes.glslf include/math.glslv include/mirror.glslf include/nodes.glslf include/nodes.glslv include/pack.glslf include/particles.glslv include/precision_statement.glslf include/procedural.glslf include/refraction.glslf include/scale_texcoord.glslv include/shadow.glslf include/shadow.glslv include/skin.glslv include/std_enums.glsl include/to_world.glslv include/wind_bending.glslv".split(" "),
r=[],m=null,E=!1;a.setup_context=function(a){m=a};a.set_directive=v;a.get_directive=c;a.is_enabled=function(a,b){for(var c=a.directives,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.set_default_directives=function(a){a.directives=[];for(var b="ALPHA ALPHA_CLIP BEND_CENTER_ONLY BILLBOARD_PRES_GLOB_ORIENTATION CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NODES_GLOW NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PERSPECTIVE_SHADOW_CAST PROCEDURAL_FOG PROCEDURAL_SKYDOME REFLECTION REFLECTION_PASS REFLECTION_TYPE REFRACTIVE USE_REFRACTION USE_REFRACTION_CORRECTION SHORE_SMOOTHING SKINNED SKY_COLOR SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA MTEX_NEGATIVE MTEX_RGBTOINT NUM_LIGHTS NUM_LFACTORS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_USAGE POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON USE_ENVIRONMENT_LIGHT USE_FOG WEBGL2 WO_SKYBLEND WO_SKYPAPER WO_SKYREAL WO_SKYTEX WOMAP_BLEND WOMAP_HORIZ WOMAP_ZENUP WOMAP_ZENDOWN WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS".split(" "),
c=0;c<b.length;c++){var d=b[c],e;switch(d){case "ALPHA":case "ALPHA_CLIP":case "BILLBOARD_PRES_GLOB_ORIENTATION":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "MTEX_NEGATIVE":case "MTEX_RGBTOINT":case "NODES_GLOW":case "NUM_LIGHTS":case "NUM_LFACTORS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PERSPECTIVE_SHADOW_CAST":case "PROCEDURAL_FOG":case "PROCEDURAL_SKYDOME":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTION_TYPE":case "REFRACTIVE":case "USE_REFRACTION":case "USE_REFRACTION_CORRECTION":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_COLOR":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "USE_ENVIRONMENT_LIGHT":case "USE_FOG":case "WO_SKYBLEND":case "WO_SKYPAPER":case "WO_SKYREAL":case "WO_SKYTEX":case "WOMAP_BLEND":case "WOMAP_HORIZ":case "WOMAP_ZENUP":case "WOMAP_ZENDOWN":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":e=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":e=1;break;case "WEBGL2":e=k.defaults.webgl2|0;break;case "EPSILON":e="highp"==k.defaults.precision?1E-6:1E-4;break;case "SHADOW_TEX_RES":e=q(2048);break;case "AA_METHOD":e="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":e="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":e="BILLBOARD_ALIGN_VIEW";break;
case "POST_EFFECT":e="POST_EFFECT_NONE";break;case "SHADOW_USAGE":e="NO_SHADOWS";break;case "SSAO_QUALITY":e="SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":e="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":e="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":e=k.defaults.precision;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":e="u_va_frame_factor";break;default:p.error("Unknown directive ("+a.vert+", "+a.frag+"): "+d)}v(a,d,e)}};a.get_vname=function(a){return a.vert};a.get_fname=function(a){return a.frag};
a.inherit_directives=function(a,b){for(var d=b.directives,e=0;e<d.length;e++){var f=d[e][0],k=d[e][1];c(a,f)&&v(a,f,k)}};a.get_compiled_shader=function(a){var c=JSON.stringify(a),d=A[c];if(d)return d;var k=a.frag,d=b(D.shaders_dir,a.vert),k=b(D.shaders_dir,k);if(!d||!k)return null;var h=e("vert",d,a),g=e("frag",k,a),d=m,r=n(d,c,h,d.VERTEX_SHADER,a),l=n(d,c,g,d.FRAGMENT_SHADER,a),k=d.createProgram();d.attachShader(k,r);d.attachShader(k,l);d.linkProgram(k);d.validateProgram(k);d.getProgramParameter(k,
d.VALIDATE_STATUS)==d.FALSE&&p.error("shader program is not valid",c);f.check_shader_linking(k,c,r,l,h,g);a={vshader:r,fshader:l,program:k,attributes:{},uniforms:{},permanent_uniform_setters:[],permanent_uniform_setters_table:{},transient_uniform_setters:[],shaders_info:a};g=d.getProgramParameter(k,d.ACTIVE_ATTRIBUTES);for(h=0;h<g;h++)r=d.getActiveAttrib(k,h).name,l=d.getAttribLocation(k,r),a.attributes[r]=l;g=d.getProgramParameter(k,d.ACTIVE_UNIFORMS);for(h=0;h<g;h++)r=d.getActiveUniform(k,h).name.split("[0]").join(""),
l=d.getUniformLocation(k,r),a.uniforms[r]=l;return A[c]=d=a};a.load_shaders=function(){E=!1;if(b4w.module_check("shader_texts"))E=!0;else{for(var a=[],b=u.AT_TEXT,c=0;c<w.length;c++){var d=K.normpath_preserve_protocol(D.shaders_dir+w[c]);a.push({id:w[c],type:b,url:d})}b=function(a,b,c,d){x||(x={});x[b]=a};a.length?u.enqueue(a,b,function(){E=!0}):p.error("Shaders have not been found.")}};a.check_shaders_loaded=function(){return E};a.debug_get_compilation_stats=function(){return r};a.get_compiled_shaders=
function(){return A};a.cleanup=function(){for(var a in A){var b=A[a];m.deleteProgram(b.program);m.deleteShader(b.vshader);m.deleteShader(b.fshader);delete A[a]}for(var c in h)delete h[c];for(var d in r)delete r[d]};a.debug_shaders_info=function(a){var b=a.directives;p.log("Shader: "+a.vert+" "+a.frag+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)p.log("  "+b[a][0],b[a][1])};a.glsl_value=q;a.check_uniform=function(a,b){return b in a.uniforms?!0:!1};a.get_varyings_count=function(a){return(m.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||
[]).length}};b4w.module.__geometry=function(a,t){function v(a,b){for(var c=1;c<a.shape_keys.length;c++){for(var d=a.shape_keys[c].geometry,e=d.a_position,f=d.a_normal,k=b.a_position,h=b.a_normal,g=e.length,m=a.shape_keys[c].init_value,n=0;n<g;n++)k[n]+=m*e[n],h[n]+=m*f[n];d=d.a_tangent;e=b.a_tangent;f=d.length;for(n=0;n<f;n++)e[n]+=m*d[n]}}function c(a){return 65536<a.base_length?m.get_elem_index_uint()?!1:!0:!1}function b(a){return 0<a.indices.length?!0:!1}function e(a,c,e){if(!b(a))return a;e||E.log('%cDEBUG max vertices exceeded for indexed submesh "'+
a.name+'": '+a.base_length*(c||1)+", will use drawArrays","color: #aa0");c=a.indices;e=a.base_length;var f=a.va_common,k=a.va_frames,h;for(h in f){var g=f[h],m=K(g,e);f[h]=d(c,g,m)}for(f=0;f<k.length;f++){var n=k[f];for(h in n)g=n[h],m=K(g,e),n[h]=d(c,g,m)}for(f=0;f<a.shape_keys.length;f++){h=a.shape_keys[f].geometry;for(var r in h)g=h[r],m=K(g,e),h[r]=d(c,g,m)}a.base_length=c.length;a.indices=new Uint16Array(0);return a}function d(a,b,c){if(0==b.length)return new Float32Array(0);for(var d=new Float32Array(a.length*
c),e=0;e<a.length;e++)for(var f=a[e],k=0;k<c;k++)d[c*e+k]=b[c*f+k];return d}function l(a,b){var c=a.vbo_array,d=a.pointers[b];if(d)return c.subarray(d.offset,d.offset+d.length);throw"extract_array() failed; invalid name: "+b;}function n(b,c){var d,e;switch(c){case a.DM_DEFAULT:case a.DM_TRIANGLES:d=F.TRIANGLES;e=F.STATIC_DRAW;break;case a.DM_POINTS:d=F.POINTS;e=F.STATIC_DRAW;break;case a.DM_DYNAMIC_TRIANGLES:d=F.TRIANGLES;e=F.DYNAMIC_DRAW;break;case a.DM_DYNAMIC_POINTS:d=F.POINTS;e=F.DYNAMIC_DRAW;
break;case a.DM_LINES:d=F.LINES;e=F.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=d;b.usage=e}function q(a){a.ibo_array?(a.ibo||(a.ibo=F.createBuffer()),F.bindBuffer(F.ELEMENT_ARRAY_BUFFER,a.ibo),F.bufferData(F.ELEMENT_ARRAY_BUFFER,a.ibo_array,a.usage),a.debug_ibo_bytes=a.ibo_array.byteLength):a.debug_ibo_bytes=0;a.vbo||(a.vbo=F.createBuffer());F.bindBuffer(F.ARRAY_BUFFER,a.vbo);F.bufferData(F.ARRAY_BUFFER,a.vbo_array,a.usage);a.debug_vbo_bytes=a.vbo_array.byteLength}function g(a){for(var b=
M.create_empty_submesh("JOIN_"+a.length+"_SUBMESHES"),c=0,d=0;d<a.length;d++)c+=a[d].indices.length;b.indices=new Uint32Array(c);var e=c=0,f=0;if(0<a[0].shape_keys.length)for(var k=0;k<a[0].shape_keys.length;k++){for(d=0;d<a.length;d++)c+=a[d].shape_keys[k].geometry.a_position.length,e+=a[d].shape_keys[k].geometry.a_normal.length,f+=a[d].shape_keys[k].geometry.a_tangent.length;d={a_position:new Float32Array(c),a_normal:new Float32Array(e),a_tangent:new Float32Array(f)};b.shape_keys.push({init_value:a[0].shape_keys[k].init_value,
geometry:d})}for(d=c=0;d<a.length;d++)c+=a[d].base_length;b.base_length=c;var e=a[0],h;for(h in e.va_common){for(d=c=0;d<a.length;d++)c+=a[d].va_common[h].length;b.va_common[h]=new Float32Array(c)}for(h in e.va_frames[0]){for(d=c=0;d<a.length;d++)c+=a[d].va_frames[0][h].length;for(d=0;d<e.va_frames.length;d++)b.va_frames[d]=b.va_frames[d]||{},b.va_frames[d][h]=new Float32Array(c)}for(h=e=c=0;h<a.length;h++){for(var f=a[h],g=f.indices,k=f.base_length,m=f.va_common,d=0;d<g.length;d++)b.indices[c+d]=
g[d]+e;var c=c+g.length,n;for(n in m){var g=m[n],r=e*K(g,k);b.va_common[n].set(g,r)}for(d=0;d<f.va_frames.length;d++){var m=f.va_frames[d],p=b.va_frames[d];for(n in m)g=m[n],r=e*K(g,k),p[n].set(g,r)}e+=k}if(0<b.shape_keys.length)for(h=0;h<b.shape_keys.length;h++)for(n=b.shape_keys[h].geometry,d=f=e=c=0;d<a.length;d++)k=a[d].shape_keys[h].geometry,n.a_position.set(k.a_position,c),n.a_normal.set(k.a_normal,e),n.a_tangent.set(k.a_tangent,f),c+=k.a_position.length,e+=k.a_normal.length,f+=k.a_tangent.length;
return b}function u(a,b,c,d,h,g){var m=M.create_empty_submesh("SUBMESH_"+a.name+"_"+b),n=a.submeshes[b],r=n.base_length,l=a.materials[b];m.base_length=r;var q=!1;if(f(c,"a_texcoord")){var w=null,u=a.materials[b];b=a.submeshes[b];if(u.texture_slots.length)switch(u=u.texture_slots[0],u.texture_coords){case "UV":u=a.uv_textures.indexOf(u.uv_layer);0==u?w=new Float32Array(b.texcoord):1==u&&(w=new Float32Array(b.texcoord2));break;case "ORCO":for(var B=a.b4w_bounding_box_source,w=new Float32Array(2*b.base_length),
u=(B.max_x+B.min_x)/2,y=(B.max_z+B.min_z)/2,t=B.max_x-B.min_x,B=B.max_z-B.min_z,A=0,N=0;N<b.position.length;N+=3)w[A++]=(b.position[N]-u)/t+.5,w[A++]=(y-b.position[N+2])/B+.5}null===w&&(w=new Float32Array(2*b.base_length));b=w}else b=new Float32Array(0);if(f(c,"a_orco_tex_coord")){w=a.b4w_bounding_box_source;u=new Float32Array(3*n.base_length);y=w.max_x-w.min_x;t=w.max_y-w.min_y;B=w.max_z-w.min_z;for(N=A=0;N<n.position.length;N+=3)0==y?u[A++]=.5:u[A++]=M.clamp(parseFloat(((n.position[N]-w.min_x)/
y).toFixed(5)),0,1),0==B?u[A++]=.5:u[A++]=M.clamp(parseFloat(((w.max_z-n.position[N+2])/B).toFixed(5)),0,1),0==t?u[A++]=.5:u[A++]=M.clamp(parseFloat(((n.position[N+1]-w.min_y)/t).toFixed(5)),0,1);w=u}else w=new Float32Array(0);var J,u=n.group;if(f(c,"a_influence")&&d){y=new Float32Array(4*r);t=u.length/r;B=new Float32Array(t);for(A=0;A<t;A++)for(J in B[A]=-1,d)if(N=d[J],N.vgroup_index===A){B[A]=N.deform_bone_index;break}var V=3<t?t:4;d=new Float32Array(V);J=new Uint32Array(V);for(var A=new Float32Array(4),
N=new Float32Array(V),V=new Uint32Array(V),S=new Float32Array(4),R=0;R<r;R++)d.set(N),J.set(V),A.set(S),y.set(p(u,t,R,r,B,d,J,A),4*R)}else y=new Float32Array(0);J=y;d=h?M.clone_object_r(h):{};d.a_color={generate_buffer:!0};f(c,"a_color")&&a.active_vcol_name?d.a_color.src=[{name:a.active_vcol_name,mask:7}]:d.a_color.src=[];h={a_texcoord:b,a_influence:J,a_orco_tex_coord:w};J=n.vertex_colors;b=n.color;w=a.name;u=[];for(y=0;y<J.length;y++)u.push(J[y].name);for(var L in d)if(y=d[L].src,y.length){for(B=
t=0;B<y.length;B++)t+=M.rgb_mask_get_channels_count(y[B].mask);h[L]=new Float32Array(t*r);for(B=A=0;B<y.length;B++){var O=y[B].name,N=y[B].mask,V=M.rgb_mask_get_channels_presence(N),v=u.indexOf(O);-1==v&&M.panic('vertex color "'+O+'" for mesh "'+w+'" not found.');S=J[v].mask;R=M.rgb_mask_get_channels_count(S);(N&S)!==N&&E.error("Wrong color extraction from "+O+" to "+L+".");for(var O=J,ja=r,D=0,ea=0;ea<v;ea++)D+=M.rgb_mask_get_channels_count(O[ea].mask);O=D*ja;for(v=0;v<r;v++)for(ja=0;3>ja;ja++)V[ja]&&
(D=A+M.rgb_mask_get_channel_presence_index(N,ja),ea=M.rgb_mask_get_channel_presence_index(S,ja),h[L][v*t+D]=b[O+v*R+ea]);A+=R}}else h[L]=new Float32Array(0);L=a.uv_textures;d=n.texcoord;J=n.texcoord2;if(g)for(var K in g){b=L.indexOf(K);if(0==b)var F=new Float32Array(d);else 1==b&&(F=new Float32Array(J));h[g[K]]=F}m.va_common=h;m.indices=new Uint32Array(n.indices);g=n.position.length/r/3;F=(K=f(c,"a_normal")&&n.normal.length?!0:!1)&&f(c,"a_tangent")&&n.tangent.length?!0:!1;L=l.texture_slots[0];L=K&&
l.texture_slots.length&&f(c,"a_tangent")&&"ORCO"==L.texture_coords&&L.use_map_normal?!0:!1;0<a.b4w_shape_keys.length&&(q=!0);for(h=0;h<g;h++){l=k(m,n,c,r,K,F,L,h,a.name);if(q)if(d={},d.name=a.b4w_shape_keys[h].name,m.shape_keys.push(d),0!=h){d.geometry=l;d.init_value=a.b4w_shape_keys[h].value;continue}else d.geometry=k(m,n,c,r,K,F,L,h,a.name),d.init_value=1;m.va_frames.push(l)}if(1<g&&!q){a=m.va_frames[0];var l={},H;for(H in a)l[H]=new Float32Array(a[H]);m.va_frames.push(l)}f(c,"a_polyindex")&&(e(m,
1,!0),m.va_common.a_polyindex=x(m));return m}function k(a,b,c,d,e,k,h,g,m){a={};var n=new Float32Array(3*d),r=new Float32Array(e?3*d:0),p=new Float32Array(k||h?4*d:0),l=g*d*3;n.set(b.position.subarray(l,l+3*d),0);e&&(l=g*d*3,r.set(b.normal.subarray(l,l+3*d),0));if(k)l=g*d*4,p.set(b.tangent.subarray(l,l+4*d),0);else if(h)for(b=p,E.warn('Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+m+'". Please add a UV-map.'),m=0;m<d;m++)c=N,e=B,c[0]=r[3*m],c[1]=r[3*
m+1],c[2]=r[3*m+2],L.cross(c,M.AXIS_Z,e),0==L.length(e)&&L.cross(c,M.AXIS_X,e),L.normalize(e,e),b[4*m]=e[0],b[4*m+1]=e[1],b[4*m+2]=e[2],b[4*m+3]=1;else if(e&&f(c,"a_tangent"))for(p=new Float32Array(4*d),d=0;d<p.length;d++)p[d]=1;a.a_position=n;a.a_normal=r;a.a_tangent=p;return a}function f(a,b){return-1<a.indexOf(b)?!0:!1}function p(b,c,d,e,f,k,h,g){for(var m=!0,n=0;n<c;n++){var r=b[n*e+d];if(-1!==r){var p=f[n];-1!==p&&(k[n]=r,h[n]=p,m=!1)}}if(m)return g;D(k,h,a.SORT_NUMERIC,!1);for(n=b=0;4>n;n++)b+=
k[n];if(.01>b)return g;for(n=0;4>n;n++)k[n]/=b;if(.01>Math.abs(k[0]-1))g[0]=h[0]+1;else for(n=0;4>n;n++)g[n]=h[n]+k[n];return g}function K(a,b){if(0==b)return 0;var c=a.length,d=c/b;if(d!=Math.floor(d))throw"Array size mismatch during geometry calculation: array length="+c+", base length="+b;return d}function D(b,c,d,e){for(var f=b.length,k=f,h=!1,g=e?-1:1;1<k||h;){1<k&&(k=Math.floor(k/1.247330950103979));for(var h=!1,m=0;k+m<f;m++)if(d==a.SORT_NUMERIC?0>g*(b[m]-b[m+k]):b[m]<b[m+k]&&e)h=b[m],b[m]=
b[m+k],b[m+k]=h,h=c[m],c[m]=c[m+k],c[m+k]=h,h=!0}}function A(a,b,c){var d=[],e=[];L.subtract(b,a,d);L.subtract(c,a,e);L.normalize(d,d);L.normalize(e,e);return Math.acos(L.dot(d,e))}function h(a,c,d){c||(c=[]);d=d?a.va_frames[0].a_normal:a.va_frames[0].a_position;if(b(a)){a=a.indices;for(var e=a.length/3,f=0;f<e;f++){var k=new Float32Array(9),h=a[3*f];k[0]=d[3*h];k[1]=d[3*h+1];k[2]=d[3*h+2];h=a[3*f+1];k[3]=d[3*h];k[4]=d[3*h+1];k[5]=d[3*h+2];h=a[3*f+2];k[6]=d[3*h];k[7]=d[3*h+1];k[8]=d[3*h+2];c[f]=k}}else for(f=
0;f<d.length;f++)k=new Float32Array(9),k[0]=d[9*f],k[1]=d[9*f+1],k[2]=d[9*f+2],k[3]=d[9*f+3],k[4]=d[9*f+4],k[5]=d[9*f+5],k[6]=d[9*f+6],k[7]=d[9*f+7],k[8]=d[9*f+8],c[f]=k;return c}function x(a){for(var b=new Float32Array(a.base_length),c=0;c<a.base_length;c++)b[c]=c%3;return b}function w(a,b,c){var d=L.dist(a,b);a=L.dist(a,c);b=L.dist(b,c);c=(d+a+b)/2;return c*(c-d)*(c-a)*(c-b)}function r(a,b,c,d,e){c-=b;for(var f=0;f<c;f+=d)f%d==e&&vec3.normalize(a.subarray(f+b-e,f+b+1),a.subarray(f+b-e,f+b+1))}var m=
t("__extensions"),E=t("__print"),y=t("__tsr"),M=t("__util"),L=t("__vec3"),N=new Float32Array(3),B=new Float32Array(3),O=new Float32Array(3);a.ZSORT_DISABLED=10;a.ZSORT_BACK_TO_FRONT=20;a.ZSORT_FRONT_TO_BACK=30;a.DM_TRIANGLES=10;a.DM_POINTS=20;a.DM_DYNAMIC_TRIANGLES=30;a.DM_DYNAMIC_POINTS=40;a.DM_LINES=50;a.SORT_NUMERIC=0;a.SORT_STRING=1;a.DM_DEFAULT=a.DM_TRIANGLES;var F=null;a.setup_context=function(a){F=a};a.delete_buffers=function(a){var b=_buffers[a];F.deleteBuffer(b.ibo);F.deleteBuffer(b.vbo);
delete _buffers[a]};a.submesh_to_bufs_data=function(d,f,k,h){c(d)&&e(d);var g=d.indices,m=d.base_length,r=d.va_frames,p={},l;for(l in d.va_common)l in h&&!h[l].generate_buffer||(p[l]=d.va_common[l]);h={ibo_array:null,vbo_array:null,ibo_type:0,count:0,pointers:{},mode:0,usage:0,debug_ibo_bytes:0,debug_vbo_bytes:0,vbo:null,ibo:null,info_for_z_sort_updates:null,shape_keys:null};0<d.shape_keys.length&&v(d,r[0]);if(g.length)if(l=g.length,65536>=m)var x=new Uint16Array(g),w=F.UNSIGNED_SHORT;else x=new Uint32Array(g),
w=F.UNSIGNED_INT;else l=m,x=null;var u=0,E=r.length,B;for(B in r[0])var y=r[0][B],u=u+y.length*E;for(B in p)y=p[B],u+=y.length;B=new Float32Array(u);var u=0,E={},t;for(t in p){var A=p[t];if(y=A.length)B.set(A,u),E[t]={attribute_name:t,num_comp:K(A,m),offset:u,frames:1,length:y},u+=y}p=r.length;for(t in r[0])if(A=r[0][t],y=A.length,A=K(A,m),y){E[t]={num_comp:A,offset:u,frames:p,length:y};1<p&&(E[t+"_next"]={num_comp:A,offset:u+y,frames:p,length:y});for(var N=0;N<p;N++)A=r[N][t],B.set(A,u),u+=y}h.count=
l;h.ibo_array=x;h.vbo_array=B;h.ibo_type=w;h.pointers=E;n(h,k);q(h);f!=a.ZSORT_DISABLED&&b(d)&&(h.info_for_z_sort_updates={median_cache:new Float32Array(g.length),median_world_cache:new Float32Array(g.length),dist_cache:new Float32Array(g.length/3),type:f});h.shape_keys=d.shape_keys;return h};a.submesh_init_shape_keys=v;a.is_long_submesh=c;a.is_indexed=b;a.submesh_drop_indices=e;a.update_bufs_data_index_array=function(a,b,c){n(a,b);a.count=c.length;a.ibo_array=c;a.ibo_type=c instanceof Uint16Array?
F.UNSIGNED_SHORT:F.UNSIGNED_INT;return a};a.update_bufs_data_array=function(a,b,c,d){var e=a.vbo_array,f=a.pointers,k=f[b];k?(c&&k.num_comp!=c&&M.panic('invalid num_comp for "'+b+'"'),e.set(d,k.offset)):(e=e.length,k=new Float32Array(e+d.length),k.set(a.vbo_array),k.set(d,e),a.vbo_array=k,f[b]={num_comp:c,offset:e});q(a);return a};a.extract_array=l;a.make_static=function(a){a.usage=F.STATIC_DRAW};a.make_dynamic=function(a){a.usage=F.DYNAMIC_DRAW};a.update_gl_buffers=q;a.cleanup_bufs_data=function(a){a.ibo&&
F.deleteBuffer(a.ibo);a.vbo&&F.deleteBuffer(a.vbo)};a.has_empty_submesh=function(a,b){return a.submeshes[b].base_length?!1:!0};a.submesh_apply_transform=function(a,b){for(var c=0;c<a.va_frames.length;c++){var d=a.va_frames[c].a_position;y.transform_vectors(d,b,d,0);d=a.va_frames[c].a_normal;0<d.length&&y.transform_dir_vectors(d,b,d,0);d=a.va_frames[c].a_tangent;0<d.length&&y.transform_tangents(d,b,d,0)}(c=a.va_common.au_center_pos)&&c.length&&y.transform_vectors(c,b,c,0);return a};a.submesh_apply_particle_transform=
function(a,b){var c=a.va_common.au_center_pos;if(c&&c.length){var d=new Float32Array(c);y.transform_vectors(d,b,d,0);for(var e=0;e<a.va_frames.length;e++)for(var f=0;f<d.length;f++)a.va_frames[e].a_position[f]+=d[f]-c[f];c.set(d)}else throw'Attribute "au_center_pos" is missing in particle submesh';return a};a.submesh_apply_params=function(a,b){var c=a.base_length,d;for(d in b){var e=b[d].length;a.va_common[d]=new Float32Array(e*c);for(var f=0;f<c;f++)for(var k=0;k<e;k++)a.va_common[d][f*e+k]=b[d][k]}return a};
a.submesh_list_join=g;a.make_clone_submesh=function(a,b,c){if(!a.base_length)return M.create_empty_submesh("EMPTY");var d=c.length;65536<a.base_length*d&&!m.get_elem_index_uint()&&e(a,d);var f=a.indices,k=a.base_length,h=a.va_common;a=a.va_frames;for(var g in b){var n=b[g].length,r=n*k;h[g]=new Float32Array(r);for(var p=0;p<k;p++)for(r=0;r<n;r++)h[g][p*n+r]=b[g][r]}b=M.create_empty_submesh("CLONE_"+d+"_SUBMESHES");b.base_length=k*d;b.indices=new Uint32Array(f.length*d);for(p=0;p<d;p++)for(n=f.length*
p,g=k*p,r=0;r<f.length;r++)b.indices[n+r]=f[r]+g;for(var l in h)for(f=h[l],r=f.length*d,n=K(f,k),b.va_common[l]=new Float32Array(r),p=0;p<d;p++)g=k*n*p,b.va_common[l].set(f,g);for(l in a[0])for(p=0;p<a.length;p++)for(f=a[p][l],r=f.length*d,n=K(f,k),b.va_frames[p]=b.va_frames[p]||{},b.va_frames[p][l]=new Float32Array(r),r=0;r<d;r++)switch(h=c[r],g=k*n*r,l){case "a_position":y.transform_vectors(f,h,b.va_frames[p][l],g);break;case "a_normal":y.transform_dir_vectors(f,h,b.va_frames[p][l],g);break;case "a_tangent":y.transform_tangents(f,
h,b.va_frames[p][l],g);break;default:throw"Wrong attribute name: "+l;}return b};a.extract_submesh=u;a.extract_halo_submesh=function(a){var b=a.base_length,c=a.va_frames[0].a_position,d=new Float32Array(12*b),e=new Float32Array(8*b);a=new Uint32Array(4*a.indices.length);for(var f=0;f<b;f++)d[12*f]=c[3*f],d[12*f+1]=c[3*f+1],d[12*f+2]=c[3*f+2],d[12*f+3]=c[3*f],d[12*f+4]=c[3*f+1],d[12*f+5]=c[3*f+2],d[12*f+6]=c[3*f],d[12*f+7]=c[3*f+1],d[12*f+8]=c[3*f+2],d[12*f+9]=c[3*f],d[12*f+10]=c[3*f+1],d[12*f+11]=
c[3*f+2],e[8*f]=-.5,e[8*f+1]=-.5,e[8*f+2]=-.5,e[8*f+3]=.5,e[8*f+4]=.5,e[8*f+5]=.5,e[8*f+6]=.5,e[8*f+7]=-.5,a[6*f]=4*f+2,a[6*f+1]=4*f+1,a[6*f+2]=4*f,a[6*f+3]=4*f+2,a[6*f+4]=4*f,a[6*f+5]=4*f+3;c=M.create_empty_submesh("HALO");c.va_frames=[];c.va_frames[0]={};c.base_length=4*b;c.va_frames[0].a_position=d;c.va_common.a_halo_bb_vertex=e;c.indices=a;return c};a.has_attr=f;a.extract_submesh_all_mats=function(a,b,c){for(var d=[],e=0;e<a.submeshes.length;e++){var f=u(a,e,b,null,c,null);f.base_length&&d.push(f)}return 0==
d.length?M.create_empty_submesh("EMPTY"):1==d.length?d[0]:g(d)};a.update_buffers_movable=function(a,b,c){for(var d=a.ibo_array,e=l(a,"a_position"),f=a.info_for_z_sort_updates,k=f.median_cache,h=f.median_world_cache,f=f.dist_cache,g=d,m=g.length/3,n=0;n<m;n++){var r=g[3*n],p=g[3*n+1],x=g[3*n+2],q=e[3*r+1],w=e[3*r+2],u=e[3*p+1],E=e[3*p+2],J=e[3*x+1],V=e[3*x+2];k[3*n]=(e[3*r]+e[3*p]+e[3*x])/3;k[3*n+1]=(q+u+J)/3;k[3*n+2]=(w+E+V)/3}y.transform_vectors(k,b,h);b=h.length/3;for(e=0;e<b;e++)k=h[3*e]-c[0],
g=h[3*e+1]-c[1],m=h[3*e+2]-c[2],f[e]=k*k+g*g+m*m;c=d;d=f.length;if(!(2>d))for(h=d,e=!1;1<h||e;)for(1<h&&(h=Math.floor(h/1.247330950103979)),e=!1,b=0;h+b<d;b++)0>f[b]-f[b+h]&&(e=f[b],f[b]=f[b+h],f[b+h]=e,e=c,k=b,g=b+h,m=e[3*k],n=e[3*k+1],r=e[3*k+2],e[3*k]=e[3*g],e[3*k+1]=e[3*g+1],e[3*k+2]=e[3*g+2],e[3*g]=m,e[3*g+1]=n,e[3*g+2]=r,e=!0);d=c;F.bindBuffer(F.ELEMENT_ARRAY_BUFFER,a.ibo);F.bufferData(F.ELEMENT_ARRAY_BUFFER,d,F.DYNAMIC_DRAW)};a.sort_two_arrays=D;a.calc_normals=function(a,b,c){for(var d=b.length/
3,e=a.length/3,f=[],k=Array(3),h=Array(3),g=Array(3),m=0;m<e;m++){for(var n=a[3*m],r=a[3*m+1],p=a[3*m+2],l=0;3>l;l++)k[l]=b[3*n+l],h[l]=b[3*r+l],g[l]=b[3*p+l];if(c)var l=A(k,h,g),x=A(h,g,k),q=Math.PI-l-x;else q=x=l=1;var w=f,u;u=k;var J=g,V=[],E=[],B=[];L.subtract(h,u,V);L.subtract(J,u,E);L.cross(V,E,B);L.normalize(B,B);u=B;for(J=0;3>J;J++)V=3*r+J,E=3*p+J,w[3*n+J]=l*u[J],w[V]=x*u[J],w[E]=q*u[J]}if(c)for(var y in c)for(m=c[y],a=0;3>a;a++){b=3*m[0]+a;for(e=1;e<m.length;e++)k=3*m[e]+a,f[b]+=f[k];for(e=
1;e<m.length;e++)k=3*m[e]+a,f[k]=f[b]}for(m=0;m<d;m++){c=m;y=f;a=new Float32Array(3);for(b=0;3>b;b++)e=3*c+b,a[b]=y[e];L.normalize(a,a);for(b=0;3>b;b++)e=3*c+b,y[e]=a[b]}return f};a.calc_shared_indices=function(a,b,c){for(var d={},e=b.length/3,f=0;f<e;f++){var k=String(b[3*f])+String(b[3*f+1])+String(b[3*f+2]);d[k]=[]}e=a.length;for(f=0;f<e;f++)b=a[f],k=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),k in d&&d[k].push(b);return d};a.geometry_random_points=function(a,b,c,d){var e=h(a,null,!1);if(c)var f=
h(a,null,!0);var k=e.length,g=new Float32Array(k),m=N,n=B;for(a=0;a<k;a++){var r=e[a];m.set(r.subarray(0,3));n.set(r.subarray(3,6));O.set(r.subarray(6));g[a]=Math.sqrt(w(m,n,O))}m=new Float32Array(k);m[0]=g[0];for(a=1;a<k;a++)m[a]=m[a-1]+g[a];k=m[g.length-1];g=[];for(a=0;a<b;a++){var n=k*M.rand_r(d),n=M.binary_search_max(m,n,0,m.length-1),r=c?f[n]:e[n],n=a,p=r,l=d,r=void 0,r=new Float32Array(3),x=p[0],q=p[1],u=p[2],E=p[3],y=p[4],J=p[5],V=p[6],t=p[7],A=p[8],p=M.rand_r(l),l=M.rand_r(l);1<p+l&&(p=1-
p,l=1-l);var L=1-p-l,q=L*q+p*y+l*t,u=L*u+p*J+l*A;r[0]=L*x+p*E+l*V;r[1]=q;r[2]=u;g[n]=r}return g};a.extract_triangles=h;a.extract_polyindices=x;a.triangle_area_squared=w;a.scale_submesh_xyz=function(a,b,c){a=a.va_frames[0].a_position;for(var d=0;d<a.length;d+=3)a[d]=(a[d]-c[0])*b[0]+c[0],a[d+1]=(a[d+1]-c[1])*b[1]+c[1],a[d+2]=(a[d+2]-c[2])*b[2]+c[2]};a.apply_shape_key=function(a,b,c){var d=a.scenes_data[0].batches;a=a.render.shape_keys_values;for(var e=1;e<a.length;e++)a[e].name==b&&(a[e].value=c);
for(e=0;e<d.length;e++)if(!d[e].forked_batch&&d[e].use_shape_keys&&!d[e].debug_sphere){c=d[e].bufs_data.pointers;b=d[e].bufs_data.vbo_array;F.bindBuffer(F.ARRAY_BUFFER,d[e].bufs_data.vbo);var f=c.a_position,k=d[e],h=b,g=a;if(f){for(var m=f.offset,f=f.length+m,n=k.bufs_data.shape_keys[0].geometry.a_position,p=m;p<f;p++)h[p]=n[p-m];for(p=1;p<k.bufs_data.shape_keys.length;p++){var n=k.bufs_data.shape_keys[p].geometry.a_position,l=g[p].value;if(l)for(var x=m;x<f;x++)h[x]+=l*n[x-m]}F.bufferSubData(F.ARRAY_BUFFER,
4*m,h.subarray(m))}f=c.a_normal;k=d[e];h=b;g=a;if(f){m=f.offset;f=f.length+m;n=k.bufs_data.shape_keys[0].geometry.a_normal;for(p=m;p<f;p++)h[p]=n[p-m];for(p=1;p<k.bufs_data.shape_keys.length;p++)if(n=k.bufs_data.shape_keys[p].geometry.a_normal,l=g[p].value)for(x=m;x<f;x++)h[x]+=l*n[x-m];r(h,m,f,3,2);F.bufferSubData(F.ARRAY_BUFFER,4*m,h.subarray(m))}g=c.a_tangent;c=d[e];k=a;if(g){h=g.offset;g=g.length+h;f=c.bufs_data.shape_keys[0].geometry.a_tangent;for(m=h;m<g;m++)b[m]=f[m-h];for(m=1;m<c.bufs_data.shape_keys.length;m++)if(f=
c.bufs_data.shape_keys[m].geometry.a_tangent,p=k[m].value)for(n=h;n<g;n++)b[n]+=p*f[n-h];r(b,h,g,4,3);F.bufferSubData(F.ARRAY_BUFFER,4*h,b.subarray(h))}}};a.check_shape_keys=function(a){return a.render.use_shape_keys};a.get_shape_keys_names=function(a){var b=[];if(a.render)for(var c=1;c<a.render.shape_keys_values.length;c++)b.push(a.render.shape_keys_values[c].name);return b};a.get_shape_key_value=function(a,b){if(a.render)for(var c=1;c<a.render.shape_keys_values.length;c++)if(b==a.render.shape_keys_values[c].name)return a.render.shape_keys_values[c].value;
return 0};a.has_shape_key=function(a,b){var c=a.render.shape_keys_values;if(c)for(var d=1;d<c.length;d++)if(c[d].name==b)return!0;return!1};a.has_dyn_geom=function(a){return a&&a.render&&a.render.dynamic_geometry?!0:!1}};b4w.module.__objects=function(a,t){function v(a){a.render.outline_intensity=0;a=Z.indexOf(a);-1!=a&&Z.splice(a,1)}function c(a){if(a.field)for(var b=a.scenes_data,c=0;c<b.length;c++)C.update_force_scene(b[c].scene,a)}function b(a,b){for(var c=a.scenes_data,d=b.scenes_data,f=0;f<c.length;f++){for(var k=!1,h=0;h<d.length;h++)if(c[f].scene==d[h].scene){k=!0;break}k||e(b,c[f].scene)&&M.append_scene_data(b,c[f].scene)}}function e(a,b){return!b._is_main&&"SPEAKER"==a.type||!b._is_primary_thread&&("LAMP"==
a.type||"CAMERA"==a.type)?!1:!0}function d(a,b){if(a.dg_parent&&a.dg_parent._is_dynamic||a.parent&&a.parent._is_dynamic)return!0;switch(a.type){case "MESH":var c=D.bpy_obj_is_animatable(a,b),d=a.b4w_do_not_batch,e=a.b4w_collision,f=a.b4w_vehicle,k=a.b4w_floating,h=a.b4w_character,g=L.has_dynamic_grass_particles(a),m=y.bpy_obj_has_nla(a),n=0<a.data.b4w_shape_keys.length,r=a.b4w_dynamic_geometry;if(!(c=c||d||e||f||n||k))a:{c=a.data;for(d=0;d<c.materials.length;d++)if("LENS_FLARES"===c.materials[d].name){c=
!0;break a}c=!1}return c||g||h||m||r;case "EMPTY":return h=D.bpy_obj_is_animatable(a,b),g=y.bpy_obj_has_nla(a),m=a.b4w_do_not_batch,r=Boolean(a.b4w_anchor),h||g||m||r;default:return!0}}function l(a,b,c,d,e,f,k,h,g){for(var m=0;m<a.nodes.length;m++){var r=a.nodes[m];if("VALUE"==r.type){var p=q(b,r.name);d.push(r.outputs[0].default_value);e.push(p,e.length/2)}else if("RGB"==r.type)p=q(b,r.name),r=r.outputs[0].default_value.slice(0,3),k.push(r[0],r[1],r[2]),h.push(p,h.length/2);else if("GROUP"==r.type){var p=
r.node_group.node_tree,x=p.animation_data,r=q(b,r.name);l(p,r,x,d,e,f,k,h,g)}}if(c)for((a=c.action)&&a._render.type==D.AT_MATERIAL&&n(a,b,f,e,g,h),c=c.nla_tracks,d=0;d<c.length;d++)for(k=c[d].strips,m=0;m<c[d].strips.length;m++)(a=k[m].action)&&a._render.type==D.AT_MATERIAL&&n(a,b,f,e,g,h)}function n(a,b,c,d,e,f){var k=a._render.params,h;for(h in k){var m=q(b,h.match(/"(.*?)"/)[1]),k=g(d,m);null!=k?(m=q(a.name,h),c.push(m,k)):(k=g(f,m),null!=k&&(m=q(a.name,h),e.push(m,k)))}}function q(a,b){return a+
"%join%"+b}function g(a,b){for(var c=0;c<a.length;c+=2)if(a[c]==b)return a[c+1];return null}function u(a,b){for(var c=a.render.mats_value_inds,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function k(a,b){for(var c=a.render.mats_rgb_inds,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function f(a,b,c){b=fa[b]||[];for(var d=[],e=0;e<b.length;e++){var f=b[e];if(f.render.data_id==c||-1==c)for(var k=f.scenes_data,h=0;h<k.length;h++)k[h].scene==a&&d.push(f)}return d}function p(a,b,
c,d){for(var e=null,f=0;f<b.length;f++){var k=b[f];if((c?k.origin_name:k.name)==a&&(k.render.data_id==d||-1==d)&&(e=k,!M.get_dg_parent(e)))break}return e}function K(a){fa.ALL.push(a);fa[a.type]||(fa[a.type]=[]);fa[a.type].push(a);var b=a.render.plane_reflection_id;if(null!=b)for(var c=0;c<T.length;c++){var d=T[c];d.render.plane_reflection_id==b&&d.reflective_objs.push(a)}}var D=t("__animation"),A=t("__batch"),h=t("__boundings"),x=t("__camera"),w=t("__config"),r=t("__constraints"),m=t("__geometry"),
E=t("__lights"),y=t("__nla"),M=t("__obj_util"),L=t("__particles"),N=t("__physics"),B=t("__print"),O=t("__primitives"),F=t("__quat"),C=t("__scenes"),I=t("__sfx"),Q=t("__transform"),G=t("__tsr"),z=t("__util"),Y=t("__vec3"),U=t("__armature"),P=w.defaults,da=w.outlining,fa={ALL:[]},aa=0,W=0,T=[],Z=[],ba=new Float32Array(3),pa=new Float32Array(4);a.GET_OBJECT_BY_NAME=0;a.GET_OBJECT_BY_DUPLI_NAME=1;a.GET_OBJECT_BY_DUPLI_NAME_LIST=2;a.DATA_ID_ALL=-1;a.update=function(a,b){for(var c=fa.ALL,d=fa.ARMATURE,
e=0;e<c.length;e++)for(var f=c[e],k=f.scenes_data,h=0;h<k.length;h++){var g=k[h].scene;if(g._render.outline){if(-1!=Z.indexOf(f)){var m=f,n=a,r=0,p=m.outline_animation;0==p.time_start&&(p.time_start=n);n-=p.time_start;if(p.relapses&&n/p.period>=p.relapses)v(m);else{n%=p.period;if(n<p.outline_time)switch(p=n/(p.outline_time/5),n=Math.floor(p),n){case 0:r=(p-n)/2;break;case 1:r=(p-n)/2+.5;break;case 2:r=1;break;case 3:r=1-(p-n)/2;break;case 4:r=.5-(p-n)/2}m.render.outline_intensity=r}}f.render.outline_intensity&&
C.request_outline(g)}}if(d)for(e=0;e<d.length;e++)c=d[e],c.need_update_transform&&(Q.update_transform(c),c.need_update_transform=!1)};a.apply_outline_anim=function(a,b,c,d){var e=a.outline_animation;e.time_start=0;e.outline_time=b;e.period=c;e.relapses=d;-1==Z.indexOf(a)&&Z.push(a)};a.clear_outline_anim=v;a.update_object=function(a,b){b.uuid=a.uuid;b.bpy_origin=!0;var c=a.animation_data,e=a.data.animation_data;c&&c.action&&(c=c.action,(c._render.type==D.AT_OBJECT||c._render.type==D.AT_ARMATURE&&"ARMATURE"==
b.type||c._render.type==D.AT_LIGHT&&"LAMP"==b.type)&&b.actions.push(c));e&&e.action&&("SPEAKER"==b.type||"LAMP"==b.type)&&b.actions.push(e.action);"MESH"==b.type&&b.actions.push.apply(b.actions,D.get_bpy_material_actions(a));a._is_dynamic=b.is_dynamic=d(a,b);a._is_updated=!0;b.is_vehicle=a.b4w_vehicle;b.is_character=a.b4w_character;b.is_floating=a.b4w_floating;b.use_obj_physics=a.b4w_collision;b.collision_id=a.b4w_collision_id;b.correct_bounding_offset=a.b4w_correct_bounding_offset;e=a.game;b.physics_settings=
{physics_type:e.physics_type,use_ghost:e.use_ghost,use_sleep:e.use_sleep,mass:e.mass,velocity_min:e.velocity_min,velocity_max:e.velocity_max,damping:e.damping,rotation_damping:e.rotation_damping,lock_location_x:e.lock_location_x,lock_location_y:e.lock_location_y,lock_location_z:e.lock_location_z,lock_rotation_x:e.lock_rotation_x,lock_rotation_y:e.lock_rotation_y,lock_rotation_z:e.lock_rotation_z,collision_margin:e.collision_margin,collision_group:e.collision_group,collision_mask:e.collision_mask,
use_collision_bounds:e.use_collision_bounds,collision_bounds_type:e.collision_bounds_type,use_collision_compound:e.use_collision_compound};if(e=a.b4w_vehicle_settings)b.vehicle_settings={name:e.name,part:e.part,suspension_rest_length:e.suspension_rest_length,suspension_compression:e.suspension_compression,suspension_stiffness:e.suspension_stiffness,suspension_damping:e.suspension_damping,wheel_friction:e.wheel_friction,roll_influence:e.roll_influence,max_suspension_travel_cm:e.max_suspension_travel_cm,
force_max:e.force_max,brake_max:e.brake_max,steering_max:e.steering_max,max_speed_angle:e.max_speed_angle,delta_tach_angle:e.delta_tach_angle,speed_ratio:e.speed_ratio,steering_ratio:e.steering_ratio,inverse_control:e.inverse_control,floating_factor:e.floating_factor,water_lin_damp:e.water_lin_damp,water_rot_damp:e.water_rot_damp,synchronize_position:e.synchronize_position};if(e=a.b4w_floating_settings)b.floating_settings={name:e.name,part:e.part,floating_factor:e.floating_factor,water_lin_damp:e.water_lin_damp,
water_rot_damp:e.water_rot_damp,synchronize_position:e.synchronize_position};if(e=a.b4w_character_settings)b.character_settings={walk_speed:e.walk_speed,run_speed:e.run_speed,step_height:e.step_height,jump_strength:e.jump_strength,waterline:e.waterline};for(e=0;e<a.constraints.length;e++)c=a.constraints[e],"RIGID_BODY_JOINT"==c.type&&b.physics_constraints.push({target:c.target._object,pivot_type:c.pivot_type,pivot_x:c.pivot_x,pivot_y:c.pivot_y,pivot_z:c.pivot_z,axis_x:c.axis_x,axis_y:c.axis_y,axis_z:c.axis_z,
use_limit_x:c.use_limit_x,use_limit_y:c.use_limit_y,use_limit_z:c.use_limit_z,use_angular_limit_x:c.use_angular_limit_x,use_angular_limit_y:c.use_angular_limit_y,use_angular_limit_z:c.use_angular_limit_z,limit_max_x:c.limit_max_x,limit_max_y:c.limit_max_y,limit_max_z:c.limit_max_z,limit_min_x:c.limit_min_x,limit_min_y:c.limit_min_y,limit_min_z:c.limit_min_z,limit_angle_max_x:c.limit_angle_max_x,limit_angle_max_y:c.limit_angle_max_y,limit_angle_max_z:c.limit_angle_max_z,limit_angle_min_x:c.limit_angle_min_x,
limit_angle_min_y:c.limit_angle_min_y,limit_angle_min_z:c.limit_angle_min_z});e=b.render=M.create_render("MESH"===b.type?b.is_dynamic?"DYNAMIC":"STATIC":b.type);a.parent?(b.parent=a.parent._object,"BONE"==a.parent_type&&"ARMATURE"==a.parent.type&&(b.parent_bone=a.parent_bone)):a.dg_parent&&(b.parent=a.dg_parent._object,b.parent_is_dupli=!0);var c=a.location,f=a.scale[0];z.quat_bpy_b4w(a.rotation_quaternion,pa);Q.set_translation(b,c);Q.set_rotation(b,pa);Q.set_scale(b,f);b.use_default_animation=a.b4w_use_default_animation;
b.anim_behavior_def=D.anim_behavior_bpy_b4w(a.b4w_anim_behavior);a.b4w_object_tags&&(b.metatags={title:a.b4w_object_tags.title,description:a.b4w_object_tags.description,category:a.b4w_object_tags.category});switch(a.type){case "ARMATURE":U.update_object(a,b);c=e.bone_pointers;f=D.calc_pose_data(c);a.b4w_animation_mixing?(e.quats_before=new Float32Array(f.quats),e.quats_after=new Float32Array(f.quats),e.trans_before=new Float32Array(f.trans),e.trans_after=new Float32Array(f.trans)):(e.quats_before=
f.quats,e.quats_after=f.quats,e.trans_before=f.trans,e.trans_after=f.trans);for(var k in c){var g=c[k];1==g.chain.length&&U.update_bone_tsr_r(g,!0,f.trans,f.quats)}e.pose_data=f;e.frame_factor=0;e.anim_mixing=a.b4w_animation_mixing;break;case "MESH":e.do_not_render=a.b4w_do_not_render;e.bb_original=A.bb_bpy_to_b4w(a.data.b4w_bounding_box);e.selectable=da.outlining_overview_mode||a.b4w_selectable;e.origin_selectable=a.b4w_selectable;e.outlining=da.outlining_overview_mode||a.b4w_outlining;e.origin_outlining=
a.b4w_outlining;e.outline_on_select=da.outlining_overview_mode||a.b4w_outline_on_select;e.billboard=a.b4w_billboard;e.billboard_pres_glob_orientation=a.b4w_pres_glob_orientation;e.billboard_type="BASIC";e.billboard_spherical="SPHERICAL"==a.b4w_billboard_geometry;k=e.outline_anim_settings_default;k.outline_duration=a.b4w_outline_settings.outline_duration;k.outline_period=a.b4w_outline_settings.outline_period;k.outline_relapses=a.b4w_outline_settings.outline_relapses;e.selectable&&(e.color_id=z.gen_color_id(aa),
aa++);for(k=0;k<a.data.b4w_vertex_anim.length;k++)c=a.data.b4w_vertex_anim[k],b.vertex_anim.push({name:c.name,frame_start:c.frame_start,frame_end:c.frame_end,averaging:c.averaging,averaging_interval:c.averaging_interval,allow_nla:c.allow_nla});b.render.vertex_anim=b.vertex_anim.length?!0:!1;if("MESH"!=a.type)throw"Wrong object type: "+a.name;k=b.render;if(a.data.b4w_shape_keys.length)for(k.use_shape_keys=!0,c=0;c<a.data.b4w_shape_keys.length;c++)f={},f.value=a.data.b4w_shape_keys[c].value,f.name=
a.data.b4w_shape_keys[c].name,k.shape_keys_values.push(f);else k.use_shape_keys=!1;k=b.render;for(var c=a.data.materials,f=[],g=[],m=[],n=[],r=[],p=[],q=0;q<c.length;q++){var w=c[q],u=w.node_tree;u&&l(u,w.name,u.animation_data,f,g,m,n,r,p)}k.mats_values=f;k.mats_value_inds=g;k.mats_anim_inds=m;k.mats_rgbs=n;k.mats_rgb_inds=r;k.mats_rgb_anim_inds=p;e.shadow_cast=a.b4w_shadow_cast;e.shadow_receive=a.b4w_shadow_receive;e.shadow_cast_only=a.b4w_shadow_cast_only&&e.shadow_cast;e.reflexible=a.b4w_reflexible;
e.reflexible_only=a.b4w_reflexible_only&&e.reflexible;e.reflective=a.b4w_reflective;e.reflection_type=a.b4w_reflection_type;e.caustics=a.b4w_caustics;e.wind_bending=a.b4w_wind_bending;e.wind_bending_angle=a.b4w_wind_bending_angle;k=A.wb_angle_to_amp(a.b4w_wind_bending_angle,e.bb_original,a.scale[0]);e.wind_bending_amp=k;e.wind_bending_freq=a.b4w_wind_bending_freq;e.detail_bending_freq=a.b4w_detail_bending_freq;e.detail_bending_amp=a.b4w_detail_bending_amp;e.branch_bending_amp=a.b4w_branch_bending_amp;
e.hide=!1;e.main_bend_col=a.b4w_main_bend_stiffness_col;k=a.b4w_detail_bend_colors;e.detail_bend_col={};e.detail_bend_col.leaves_stiffness=k.leaves_stiffness_col;e.detail_bend_col.leaves_phase=k.leaves_phase_col;e.detail_bend_col.overall_stiffness=k.overall_stiffness_col;e.do_not_cull=a.b4w_do_not_cull;e.disable_fogging=a.b4w_disable_fogging;e.dynamic_geometry=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";k=a.data.materials[0];e.friction=k.physics.friction;e.elasticity=k.physics.elasticity;
e.lod_dist_min=0;e.lod_dist_max=1E4;e.lod_transition_ratio=a.b4w_lod_transition;e.last_lod=!0;break;case "CAMERA":x.camera_object_to_camera(a,b);x.assign_boundings(b);break;case "LAMP":E.lamp_to_light(a,b);break;case "SPEAKER":b.sfx=I.create_sfx();e=!1;for(k=0;k<b.scenes_data.length;k++)if(b.scenes_data[k].scene.b4w_enable_audio){e=!0;break}e&&I.update_object(a,b);break;case "EMPTY":k=h.zero_bounding_box(),e.bb_local=k,k=h.zero_bounding_sphere(),e.bs_local=k,a.field&&(b.field={type:a.field.type,strength:a.field.strength}),
a.b4w_anchor&&(b.anchor={type:a.b4w_anchor.type,detect_visibility:a.b4w_anchor.detect_visibility,element_id:a.b4w_anchor.element_id,max_width:a.b4w_anchor.max_width})}K(b)};a.update_object_relations=function(a,c){var d=c.render;if(c.parent){!c.parent_is_dupli&&c.physics_settings.use_collision_compound&&c.parent.physics_settings.use_collision_compound&&(c.use_obj_physics=!1);var e=c.physics_settings;c.is_vehicle||c.is_floating||N.is_character(c)||c.use_obj_physics&&!e.use_ghost&&0<e.mass&&("DYNAMIC"==
e.physics_type||"RIGID_BODY"==e.physics_type)?(e=c.parent_is_dupli?G.copy(d.world_tsr,G.create()):d.world_tsr,G.multiply(c.parent.render.world_tsr,e,d.world_tsr),Q.set_translation(c,G.get_trans_view(d.world_tsr)),Q.set_scale(c,G.get_scale(d.world_tsr)),Q.set_rotation(c,G.get_quat_view(d.world_tsr))):c.parent_is_dupli||!c.parent_bone?(e=G.copy(d.world_tsr,G.create()),r.append_child_of(c,c.parent,e)):(e=G.copy(d.world_tsr,G.create()),r.append_child_of_bone(c,c.parent,c.parent_bone,e))}if("ARMATURE"==
c.type)for(var e=a.pose.bones,f=0;f<e.length;f++){var k=e[f],h=k.constraints;if(h)for(var g=0;g<h.length;g++){var m=h[g];"COPY_TRANSFORMS"!=m.type||m.subtarget||m.mute||r.append_stiff_bone_to_obj(c,m.target._object,k.name,z.VEC3_IDENT,z.QUAT4_IDENT,1)}}if("MESH"==c.type)var n=D.get_bpy_armobj(a);if(n){h=n._object;e=h.render.pose_data;f=c.render;k=a.data;c.armobj=h;k=k.vertex_groups;if(k.length){var h=h.render.bone_pointers,g=0,m={},p;for(p in h){var l=z.keysearch("name",p,k);l&&(m[p]={vgroup_index:l.index,
bone_index:h[p].bone_index,deform_bone_index:g++})}f.bone_skinning_info=m;p=g;k=D.get_max_bones();f.max_bones=p;p>2*k?(f.is_skinning=!1,B.error('too many bones for "'+a.name+'" / '+f.max_bones+" bones (max "+k+" with blending, "+2*k+" without blending). Skinning will be disabled.")):f.is_skinning=!0}p=D.extract_skinned_pose_data(e.trans,e.quats,d.bone_skinning_info);n.b4w_animation_mixing?(d.quats_before=new Float32Array(p.quats),d.quats_after=new Float32Array(p.quats),d.trans_before=new Float32Array(p.trans),
d.trans_after=new Float32Array(p.trans)):(d.quats_before=p.quats,d.quats_after=p.quats,d.trans_before=p.trans,d.trans_after=p.trans);d.arm_rel_trans=new Float32Array(4);d.arm_rel_quat=F.create();d.pose_data=p;d.frame_factor=0}if(d.reflective)if(d=c.render,"CUBE"==d.reflection_type)d.cube_reflection_id=W++;else if("PLANE"==d.reflection_type){a:{n=a.constraints;for(p=0;p<n.length;p++)if(e=n[p],"LOCKED_TRACK"==e.type&&"REFLECTION PLANE"==e.name){if(e.target._object){n=e.target._object;break a}B.warn('Reflection plane target "'+
e.target.name+'" for object: "'+c.name+"\" is not present on the scene. Using object's Z-axis.")}n=null}n||(n=z.unique_name("%reflection%"),n=M.create_object(n,"EMPTY"),p=M.create_render("EMPTY"),n.render=p,b(c,n),r.append_stiff_obj(n,c,[0,0,0],null,1),K(n));p=null;for(e=0;e<T.length;e++)if(T[e]==n){p=e;break}null==p&&(p=T.length,T.push(n));n.render.plane_reflection_id=p;d.plane_reflection_id=p;n.reflective_objs.push(c)}};a.update_force=c;a.copy_scene_data=b;a.check_bpy_obj_scene_compatibility=e;
a.update_objects_dynamics=function(a){for(var b=0;b<a.length;b++){var c=a[b];!c.render||"DYNAMIC"!=c.render.type&&"CAMERA"!=c.render.type||Q.update_transform(c);c.use_default_animation&&D.obj_is_animatable(c)&&(D.apply_def(c),c.anim_slots.length&&D.play(c,null,D.SLOT_ALL))}};a.get_meta_tags=function(a){return z.clone_object_r(a.metatags)};a.cleanup=function(){W=aa=0;T=[];Z.length=0;fa={ALL:[]}};a.copy=function(a,c,d){var e=c,f=M.get_dg_parent(a);c=f?M.gen_dupli_name(f.name,c):c;if(p(c,fa.ALL,!1,-1)){for(var f=
1,k;;){k="."+(3>String(f).length?("000"+String(f)).slice(-3):String(f));if(!p(c+k,fa.ALL,!1,-1))break;f++}B.error('Object "'+c+'" already exists. Name was replaced by "'+c+k+'".');e+=k;c+=k}e=M.create_object(c,a.type,e);e.bpy_origin=a.bpy_origin;e.is_dynamic=a.is_dynamic;e.is_hair_dupli=a.is_hair_dupli;e.use_default_animation=a.use_default_animation;e.render=M.copy_object_props_by_value(a.render);e.metatags=M.copy_object_props_by_value(a.metatags);b(a,e);e.action_anim_cache=M.copy_bpy_object_props_by_link(a.action_anim_cache);
e.parent=M.copy_bpy_object_props_by_link(a.parent);e.parent_is_dupli=a.parent_is_dupli;e.parent_bone=a.parent_bone;!a.physics||a.is_vehicle||a.is_character||a.is_floating||(e.use_obj_physics=a.use_obj_physics,e.physics=M.copy_object_props_by_value(a.physics));e.collision_id=a.collision_id;e.correct_bounding_offset=a.correct_bounding_offset;e.physics_settings=M.copy_object_props_by_value(a.physics_settings);c=[];for(f=0;f<a.scenes_data.length;f++){var h=e.scenes_data[f];k=a.scenes_data[f].batches;
if(d){for(var h=h.batches,g=0;g<k.length;g++)k[g].forked_batch||(h.push(M.copy_object_props_by_value(k[g])),c.push(k[g].bufs_data));for(g=0;g<k.length;g++)if(k[g].forked_batch){var n=M.copy_object_props_by_value(k[g]);h.push(n);for(var r=0;r<c.length;r++)c[r]==k[g].bufs_data&&(n.bufs_data=h[r].bufs_data)}for(g=0;g<h.length;g++)h[g].bufs_data&&m.update_gl_buffers(h[g].bufs_data),h[g].odd_id_prop=e.uuid,A.update_batch_id(h[g],A.calculate_render_id(e.render))}else h.batches=M.copy_bpy_object_props_by_link(k)}M.scene_data_set_active(e,
!1);K(e);e.render.is_copied=!0;e.render.color_id=z.gen_color_id(aa);aa++;return e};a.get_value_node_ind_by_id=u;a.get_rgb_node_ind_by_id=k;a.update_boundings=function(a){for(var b=a.render,c=a.scenes_data[0].batches,d,e,f,k,g,n,r=0;r<c.length;r++){var p=c[r];if("MAIN"==p.type){var p=p.bufs_data.vbo_array,l=c[r].bufs_data.pointers,x=l.a_position.offset,l=l.a_position.length+x;d=k=p[x];e=g=p[x+1];f=n=p[x+2];for(var q=x;q<l;q+=3){var x=p[q],w=p[q+1],u=p[q+2];d=Math.max(x,d);e=Math.max(w,e);f=Math.max(u,
f);k=Math.min(x,k);g=Math.min(w,g);n=Math.min(u,n)}}}var oa={max_x:parseFloat(d.toFixed(3)),max_y:parseFloat(e.toFixed(3)),max_z:parseFloat(f.toFixed(3)),min_x:parseFloat(k.toFixed(3)),min_y:parseFloat(g.toFixed(3)),min_z:parseFloat(n.toFixed(3))},E=d-k,U=e-g,B=f-n;k=.5*(d+k);var X=.5*(e+g),y=.5*(f+n),va=k,t=y;g=Math.max(E,Math.max(U,B))/2;n=Math.max(E,B)/2;var ra=[k/(E?E:1),X/(U?U:1),y/(B?B:1)],wa=.5;if(b.billboard)x=Math.max(Math.abs(oa.max_x),Math.abs(oa.min_x)),w=Math.max(Math.abs(oa.max_y),Math.abs(oa.min_y)),
u=Math.max(Math.abs(oa.max_z),Math.abs(oa.min_z)),g=Math.sqrt(x*x+w*w+u*u),n=Math.sqrt(x*x+w*w),oa.max_x=oa.max_y=oa.max_z=g,oa.min_x=oa.min_y=oa.min_z=-g,k=new Float32Array([0,0,0]),B=new Float32Array([g,g,g]),U=new Float32Array([0,0,0]);else{for(r=0;r<c.length;r++)if(p=c[r],"MAIN"==p.type)for(p=p.bufs_data.vbo_array,l=c[r].bufs_data.pointers,x=l.a_position.offset,l=l.a_position.length+x,q=x;q<l;q+=3){var x=p[q],w=p[q+1],u=p[q+2],z=Math.sqrt((k-x)*(k-x)+(X-w)*(X-w)+(y-u)*(y-u));if(z>g){var N=k-g*
(x-k)/z,L=X-g*(w-X)/z,z=y-g*(u-y)/z;k=(N+x)/2;X=(L+w)/2;y=(z+u)/2;g=Math.sqrt((k-x)*(k-x)+(X-w)*(X-w)+(y-u)*(y-u))}L=Math.sqrt((va-x)*(va-x)+(t-u)*(t-u));L>n&&(N=va-n*(x-va)/L,z=t-n*(u-t)/L,va=(N+x)/2,t=(z+u)/2,n=Math.sqrt((va-x)*(va-x)+(t-u)*(t-u)));x/=E?E:1;w/=U?U:1;u/=B?B:1;z=Math.sqrt((ra[0]-x)*(ra[0]-x)+(ra[1]-w)*(ra[1]-w)+(ra[2]-u)*(ra[2]-u));z>wa&&(N=ra[0]-wa*(x-ra[0])/z,L=ra[1]-wa*(w-ra[1])/z,z=ra[2]-wa*(u-ra[2])/z,ra[0]=(N+x)/2,ra[1]=(L+w)/2,ra[2]=(z+u)/2,wa=Math.sqrt((ra[0]-x)*(ra[0]-x)+
(ra[1]-w)*(ra[1]-w)+(ra[2]-u)*(ra[2]-u)))}r=E?E*ra[0]:d;e=U?U*ra[1]:e;f=B?B*ra[2]:f;E*=wa;U*=wa;B*=wa;k=new Float32Array([k,X,y]);B=new Float32Array([E,U,B]);U=new Float32Array([r,e,f]);n=parseFloat(n.toFixed(3))}b.bb_local=oa;A.set_local_cylinder_capsule(b,n,n,oa);oa=h.create_bounding_sphere(g,k);b.bs_local=oa;oa=h.create_bounding_ellipsoid([B[0],0,0],[0,B[1],0],[0,0,B[2]],U);b.be_local=oa;Q.update_transform(a);if(P.wireframe_debug)for(r=0;r<c.length;r++)if("WIREFRAME"===c[r].type&&c[r].debug_sphere){a=
O.generate_uv_sphere(16,8,1,oa.center,!1,!1);m.scale_submesh_xyz(a,[oa.axis_x[0],oa.axis_y[1],oa.axis_z[2]],oa.center);m.submesh_drop_indices(a,1,!0);a.va_common.a_polyindex=m.extract_polyindices(a);A.update_batch_geometry(c[r],a);break}};a.get_scene_objs=f;a.get_scene_objs_derived=function(a,b,c){b=fa[b]||[];for(var d=[],e=0;e<b.length;e++){var f=b[e];if((f.render.data_id==c||-1==c)&&f.bpy_origin)for(var k=f.scenes_data,h=0;h<k.length;h++)k[h].scene==a&&d.push(f)}return d};a.get_all_objects=function(a){var b=
fa.ALL;if(-1==a)return b;for(var c=[],d=0;d<b.length;d++){var e=b[d];e.render.data_id==a&&c.push(e)}return c};a.sort_lamps=function(a){var b=f(a,"LAMP",-1);if(b.length==a._render.num_lamps_added){for(var c=[],d=0;d<b.length;d++){var e=b[d],e=M.get_scene_data(e,a);c[e.light_index]=d}for(d=0;d<c.length-1;d++)for(e=d+1;e<c.length;e++){var k;k=b[c[d]].light;var h=b[c[e]].light;k=!h.use_diffuse||!h.use_specular||k.use_diffuse&&k.use_specular?!k.use_diffuse&&(h.use_diffuse||!k.use_specular&&h.use_specular)?
!0:!1:!0;k&&(k=c[d],c[d]=c[e],c[e]=k)}for(d=0;d<c.length;d++)e=b[c[d]],M.get_scene_data(e,a).light_index=d,C.update_lamp_scene(b[c[d]],a)}};a.update_all_mesh_shaders=function(a){for(var b=f(a,"LAMP",-1),c=f(a,"MESH",-1),d=0;d<c.length;d++)for(var e=M.get_scene_data(c[d],a).batches,k=0;k<e.length;k++){var h=e[k];"MAIN"==h.type&&(A.update_batch_lights(h,b,a),A.update_shader(h))}};a.get_selectable_objects=function(a){a=[];for(var b=fa.MESH,c=0;c<b.length;c++){var d=b[c];d.render.selectable&&a.push(d)}return a};
a.get_object=function(b,c,d,e){var f=null,k=fa.ALL;switch(b){case a.GET_OBJECT_BY_NAME:f=p(c,k,!0,d);break;case a.GET_OBJECT_BY_DUPLI_NAME:a:{for(b=0;b<k.length;b++)if(f=k[b],f.origin_name==d&&(f.render.data_id==e||-1==e)){var h=M.get_dg_parent(f);if(h&&h.origin_name==c)break a}f=null}break;case a.GET_OBJECT_BY_DUPLI_NAME_LIST:a:{for(e=0;e<k.length;e++){b=k[e];for(var f=c.length-1,h=b,g=!0;0<=f&&g;)g=h&&h.origin_name==c[f]&&(h.render.data_id==d||-1==d),h&&(h=M.get_dg_parent(h)),f--;if(g&&!h){f=b;
break a}}f=null}}return f};a.pick_object=function(b,c){var d=C.get_main();if(!d)return B.error("No active scene"),null;var e=C.pick_color(d,b,c);if(!e)return null;for(var d=f(d,"MESH",-1),k=0;k<d.length;k++){var h=d[k].render,g=h.color_id;if(g&&3>Math.abs(255*g[0]-e[0])&&3>Math.abs(255*g[1]-e[1])&&3>Math.abs(255*g[2]-e[2]))return h.outlining&&h.outline_on_select&&(da.outlining_overview_mode?a.apply_outline_anim(d[k],da.outline_duration,da.outline_period,da.outline_relapses):(e=h.outline_anim_settings_default,
a.apply_outline_anim(d[k],e.outline_duration,e.outline_period,e.outline_relapses))),d[k]}return null};a.set_wind_params=function(a,b){for(var d=f(a,"EMPTY",-1),e=0;e<d.length;e++){var k=d[e];if(k.field&&"WIND"===k.field.type)var h=k}if(!h)return B.error("There is no wind on the scene"),0;"number"==typeof b.wind_dir&&(Y.set(-Math.PI/2,b.wind_dir/180*Math.PI,0,ba),z.euler_to_quat(ba,pa),Q.set_rotation(h,pa),c(h));"number"==typeof b.wind_strength&&(h.field.strength=b.wind_strength,c(h));C.update_scene_permanent_uniforms(a)};
a.remove_object=function(a){r.check_constraint(a)&&r.remove(a);var b=fa.ALL,c=fa[a.type],d=b.indexOf(a);a=c.indexOf(a);-1!=d&&b.splice(d,1);-1!=a&&c.splice(a,1)};a.objects_storage_add=K;a.objects_storage_check=function(a){return fa[a.type]&&-1<fa[a.type].indexOf(a)};a.set_nodemat_rgb=function(a,b,c,d,e){b=b.join("%join%");var f=k(a,b);null!=f?(a.render.mats_rgbs[3*f]=c,a.render.mats_rgbs[3*f+1]=d,a.render.mats_rgbs[3*f+2]=e):B.error('The RGB node "'+b+'" was not found in the object "'+a.name+'".')};
a.set_nodemat_value=function(a,b,c){b=b.join("%join%");var d=u(a,b);null!=d?a.render.mats_values[d]=c:B.error('The Value node "'+b+'" was not found in the object "'+a.name+'".')}};b4w.module.__obj_util=function(a,t){function v(a){if(!(a instanceof Object))return a;var b=null,c=null,d=null;a.textures&&(b=a.textures,a.textures=null);a.texture_names&&(c=a.texture_names,a.texture_names=null);a.shape_keys&&(d=a.shape_keys,a.shape_keys=null);var e;e=a.constructor;switch(e){case Float32Array:case Uint32Array:case Uint16Array:e=new e(a);break;case Array:e=new e(a.length);for(var f=0;f<a.length;f++)e[f]=v(a[f]);break;case WebGLUniformLocation:case WebGLProgram:case WebGLShader:e=a;
break;case WebGLFramebuffer:case WebGLTexture:case WebGLBuffer:e=null;break;case Function:e=a;break;default:for(f in e=new e,a)e[f]=v(a[f])}b&&(e.textures=b,a.textures=b);c&&(e.texture_names=c,a.texture_names=c);d&&(e.shape_keys=d,a.shape_keys=d);return e}function c(a,b){for(var c=a.scenes_data,d=0;d<c.length;d++){var e=c[d];if(e.scene==b)return e}return null}function b(a){return a.parent_is_dupli?a.parent:a.parent?b(a.parent):null}t("__mat4");t("__print");t("__quat");var e=t("__tsr"),d=t("__util"),
l=t("__vec4");new Float32Array(4);new Float32Array(4);new Float32Array(4);e.create();e.create();a.create_render=function(a){return{type:a,data_id:0,grid_id:[0,0],world_tsr:e.create_ext(),pivot:new Float32Array(3),hover_pivot:new Float32Array(3),init_dist:0,init_top:0,is_copied:!1,color_id:null,outline_intensity:0,target_cam_upside_down:!1,use_panning:!1,move_style:0,velocity_trans:1,velocity_rot:1,velocity_zoom:1,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,dof_object:null,underwater:!1,horizontal_limits:null,
vertical_limits:null,distance_limits:null,hover_vert_trans_limits:null,hover_horiz_trans_limits:null,enable_hover_hor_rotation:!0,hover_zero_level:0,cameras:null,shadow_cameras:null,outline_anim_settings_default:{outline_duration:1,outline_period:1,outline_relapses:0},cube_reflection_id:null,plane_reflection_id:null,reflection_plane:new Float32Array(4),friction:0,elasticity:0,lod_dist_min:0,lod_transition_ratio:0,do_not_render:!1,shadow_cast:!1,shadow_receive:!1,shadow_cast_only:!1,reflexible:!1,
reflexible_only:!1,reflective:!1,reflection_type:"",caustics:!1,wind_bending:!1,disable_fogging:!1,dynamic_geometry:!1,dynamic_grass:!1,do_not_cull:!1,hide:!1,last_lod:!1,selectable:!1,origin_selectable:!1,outlining:!1,origin_outlining:!1,outline_on_select:!1,is_hair_particles:!1,is_visible:!1,force_zsort:!1,wind_bending_angle:0,wind_bending_amp:0,wind_bending_freq:0,detail_bending_freq:0,detail_bending_amp:0,branch_bending_amp:0,main_bend_col:"",detail_bend_col:null,bend_center_only:!1,billboard:!1,
billboard_pres_glob_orientation:!1,billboard_type:"",billboard_spherical:!1,frame_factor:0,time:0,va_frame:0,va_frame_factor:0,max_bones:0,frames_blending:!1,vertex_anim:!1,use_shape_keys:!1,shape_keys_values:[],is_skinning:!1,anim_mixing:!1,anim_mix_factor:1,anim_mix_factor_change_speed:0,anim_destination_mix_factor:1,two_last_skeletal_slots:new Int8Array([-1,-1]),skinned_renders:[],mesh_to_arm_bone_maps:[],skinning_data_cache:[],quats_before:null,quats_after:null,trans_before:null,trans_after:null,
bone_pointers:null,bone_skinning_info:null,pose_data:null,arm_rel_trans:null,arm_rel_quat:null,mats_values:null,mats_value_inds:null,mats_anim_inds:null,mats_rgbs:null,mats_rgb_inds:null,mats_rgb_anim_inds:null,bb_original:null,bb_local:null,bcyl_local:null,bcap_local:null,bcon_local:null,bb_world:null,bs_local:null,bs_world:null,be_local:null,be_world:null,lod_dist_max:1E4}};a.create_object=function(a,b,c){c||(c=a);return{name:a,uuid:d.gen_uuid(),origin_name:c,type:b,bpy_origin:!1,is_dynamic:!1,
is_hair_dupli:!1,use_default_animation:!1,render:null,constraint:null,sfx:null,light:null,armobj:null,anchor:null,field:null,metatags:null,scenes_data:[],vertex_anim:[],cons_descends:[],cons_armat_bone_descends:[],anim_slots:[],reflective_objs:[],nla_events:[],action_anim_cache:[],sensor_manifolds:null,sensor_manifolds_arr:[],parent:null,parent_is_dupli:!1,parent_bone:"",use_obj_physics:!1,collision_id:"",correct_bounding_offset:"AUTO",is_vehicle:!1,is_character:!1,is_floating:!1,physics:null,vehicle:null,
floater:null,vehicle_settings:null,floating_settings:null,character_settings:null,physics_constraints:[],physics_settings:{physics_type:"NO_COLLISION",use_ghost:!1,use_sleep:!1,mass:0,velocity_min:0,velocity_max:0,damping:0,rotation_damping:0,lock_location_x:!1,lock_location_y:!1,lock_location_z:!1,lock_rotation_x:!1,lock_rotation_y:!1,lock_rotation_z:!1,collision_margin:0,collision_group:0,collision_mask:0,use_collision_bounds:!1,collision_bounds_type:"BOX",use_collision_compound:!1},outline_animation:{time_start:0,
outline_time:0,period:0,relapses:0},anim_behavior_def:0,actions:[],need_update_transform:!1}};a.copy_bpy_object_props_by_link=function(a){return a instanceof Array?a.slice():a};a.copy_object_props_by_value=v;a.is_dynamic=function(a){return a.is_dynamic};a.is_dynamic_mesh=function(a){return"MESH"==a.type&&a.is_dynamic};a.append_scene_data=function(a,b){a.scenes_data.push({scene:b,is_active:!1,batches:[],plane_refl_subs:null,cube_refl_subs:null,shadow_subscenes:[],light_index:0,obj_has_nla_on_scene:!1})};
a.append_batch=function(a,b,d){c(a,b).batches.push(d)};a.remove_scene_data=function(a,b){for(var c=a.scenes_data,d=0;d<c.length;d++)if(c[d].scene==b){c.splice(d,1);break}};a.get_scene_data=c;a.update_refl_objects=function(a,b){for(var c=0;c<a.length;c++)l.copy(b,a[c].render.reflection_plane)};a.scene_data_set_active=function(a,b,c){for(var d=0;d<a.scenes_data.length;d++){var e=a.scenes_data[d];c&&e.scene!=c||(e.is_active=b)}};a.get_first_lamp_with_shadows=function(a){for(var b=0;b<a.length;b++){var c=
a[b];if(c.light.generate_shadows)return c}return null};a.gen_dupli_name=function(a,b){return a+"*"+b};a.get_parent=function(a){return a.parent_is_dupli?null:a.parent};a.get_dg_parent=b;a.get_dg_objects=function(a,c){for(var d=[],e=0;e<c.length;e++){var k=c[e];b(k)==a&&d.push(k)}return d};a.is_mesh=function(a){return"MESH"===a.type};a.is_armature=function(a){return"ARMATURE"===a.type};a.is_speaker=function(a){return"SPEAKER"===a.type};a.is_camera=function(a){return"CAMERA"===a.type};a.is_lamp=function(a){return"LAMP"===
a.type};a.is_empty=function(a){return"EMPTY"===a.type}};b4w.module.__particles=function(a,t){function v(a,b,c,e,n,l,h){var x=a.delay_attrs,w=a.emitter_tsr_snapshots,r=a.time;a=a.prev_time;for(var m=b?4:1,u=0;u<x.length;u+=m){var y=x[u];if(r>a&&r>=y&&y>a||r<a&&(y>a||r>=y))for(y=0;8>y;y++)w[8*u+y]=n[y];for(y=0;8>y;y++)q[y]=w[8*u+y];y=g;y[0]=c[3*u];y[1]=c[3*u+1];y[2]=c[3*u+2];d.transform_vec3(y,q,y);l[3*u]=y[0];l[3*u+1]=y[1];l[3*u+2]=y[2];var t=g;t[0]=e[3*u];t[1]=e[3*u+1];t[2]=e[3*u+2];d.transform_dir_vec3(t,q,t);h[3*u]=t[0];h[3*u+1]=t[1];h[3*u+2]=t[2];if(b)for(y=
1;4>y;y++)l[3*(u+y)]=l[3*u],l[3*(u+y)+1]=l[3*u+1],l[3*(u+y)+2]=l[3*u+2],h[3*(u+y)]=t[0],h[3*(u+y)+1]=t[1],h[3*(u+y)+2]=t[2]}}function c(a){a?(l.srand(a),u=function(){return l.rand()}):u=function(){return Math.random()}}t("__config");var b=t("__geometry");t("__scenes");var e=t("__time"),d=t("__tsr"),l=t("__util"),n=t("__vec3"),q=new Float32Array(8),g=new Float32Array(3),u=function(){throw"_rand() undefined";};a.obj_has_particles=function(a){a=a.scenes_data;for(var b=0;b<a.length;b++)for(var c=a[b].batches,
d=0;d<c.length;d++)if(c[d].particles_data)return!0;return!1};a.obj_has_anim_particles=function(a){a=a.scenes_data;for(var b=0;b<a.length;b++)for(var c=a[b].batches,d=0;d<c.length;d++){var e=c[d].particles_data;if(e&&"EMITTER"==e.p_type)return!0}return!1};a.bpy_obj_has_particles=function(a){return 0<a.particle_systems.length};a.bpy_obj_has_anim_particles=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;return!1};a.has_dynamic_grass_particles=
function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.init_particles_data=function(a,b,c){var d={name:b.name,p_type:b.settings.type,time:0,prev_time:-1,use_world_space:!1,frame_start:0,frame_end:0,time_length:0,lifetime_frames:0,lifetime:0,cyclic:!1,mass:0,nfactor:0,gravity:0,fade_in:0,fade_out:0,wind_factor:0,size:0,alpha_start:0,alpha_end:0,size_ramp_length:0,color_ramp_length:0,size_ramp:new Float32Array(8),
color_ramp:new Float32Array(16),positions:null,positions_cache:null,normals:null,normals_cache:null,delay_attrs:null,delay_attrs_masked:null,emitter_tsr_snapshots:null},d=a.particles_data=d;d.frame_start=b.settings.frame_start;d.frame_end=b.settings.frame_end;d.time_length=(d.frame_end-d.frame_start)/e.get_framerate();d.lifetime_frames=b.settings.lifetime;d.lifetime=d.lifetime_frames/e.get_framerate();d.cyclic=b.settings.b4w_cyclic?1:0;d.mass=b.settings.mass;d.nfactor=b.settings.normal_factor;d.gravity=
9.81*b.settings.effector_weights.gravity;d.fade_in=b.settings.b4w_fade_in/e.get_framerate();d.fade_out=b.settings.b4w_fade_out/e.get_framerate();d.wind_factor=b.settings.effector_weights.wind;d.use_world_space="WORLD"==b.settings.b4w_coordinate_system?!0:!1;var g,n;a.halo_particles?(a=c.halo.size,g=c.halo.hardness,30>g?(g=.5,n=.9):40>g?(g=.1,n=1):50>g?(g=0,n=.8):(g=0,n=.5)):(a=b.settings.particle_size,n=g=1);d.size=a;d.alpha_start=g;d.alpha_end=n;a=b.settings.texture_slots;b=[-1,0,-1,0,-1,0,-1,0];
if(a[0]&&a[0].use_map_size&&a[0].texture&&"BLEND"==a[0].texture.type&&a[0].texture.use_color_ramp){a=a[0].texture.color_ramp.elements;g=Math.min(2*a.length,b.length);for(n=0;n<g;n+=2){var h=a[n/2];b[n]=h.position;b[n+1]=(h.color[0]+h.color[1]+h.color[2])/3}d.size_ramp_length=a.length}d.size_ramp.set(b);b=c.texture_slots;c=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){a=b[0].texture.color_ramp.elements;
g=Math.min(4*a.length,c.length);for(n=0;n<g;n+=4)h=a[n/4],c[n]=h.position,c[n+1]=h.color[0],c[n+2]=h.color[1],c[n+3]=h.color[2];d.color_ramp_length=a.length}d.color_ramp.set(c)};a.generate_emitter_particles_submesh=function(a,d,g,q){var t=a.particles_data,A=g.settings.count,h=g.settings.frame_start/e.get_framerate(),x=g.settings.frame_end/e.get_framerate(),w=g.settings.lifetime/e.get_framerate(),r=g.settings.lifetime_random,m=g.settings.emit_from,E=g.settings.factor_random,y=g.settings.angular_velocity_mode,
M=g.settings.angular_velocity_factor,L=g.settings.b4w_randomize_emission,N=g.settings.b4w_cyclic,B=!a.halo_particles;c(g.seed);d=b.extract_submesh_all_mats(d,["a_position","a_normal"],null);switch(m){case "VERT":g=d.va_frames[0].a_position;d=d.va_frames[0].a_normal;for(var O=g.length/3,m=[],F=0;F<A;F++){var C=Math.round((O-1)*u());m.push(C);B&&(m.push(C),m.push(C),m.push(C))}O=[];for(F=0;F<m.length;F++)O.push(g[3*m[F]]),O.push(g[3*m[F]+1]),O.push(g[3*m[F]+2]);g=new Float32Array(O);O=[];for(F=0;F<
m.length;F++)O.push(d[3*m[F]]),O.push(d[3*m[F]+1]),O.push(d[3*m[F]+2]);m=new Float32Array(O);break;case "FACE":g=[];m=[];F=[];l.init_rand_r_seed(0,F);O=b.geometry_random_points(d,A,!1,F);l.init_rand_r_seed(0,F);d=b.geometry_random_points(d,A,!0,F);for(F=0;F<O.length;F++)g.push(O[F][0],O[F][1],O[F][2]),B&&(g.push(O[F][0],O[F][1],O[F][2]),g.push(O[F][0],O[F][1],O[F][2]),g.push(O[F][0],O[F][1],O[F][2])),m.push(d[F][0],d[F][1],d[F][2]),B&&(m.push(d[F][0],d[F][1],d[F][2]),m.push(d[F][0],d[F][1],d[F][2]),
m.push(d[F][0],d[F][1],d[F][2]));g=new Float32Array(g);m=new Float32Array(m);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}m=[g,m];d=m[0];m=m[1];t.positions=new Float32Array(d);t.normals=new Float32Array(m);t.positions_cache=new Float32Array(d.length);t.normals_cache=new Float32Array(m.length);g=[];x=(x-h)/A;for(O=0;O<A;O++)F=L?x*O+10*x*(.5-u()):x*O,N||(F+=h),g.push(F),B&&(g.push(F),g.push(F),g.push(F));h=new Float32Array(g);t.delay_attrs=
new Float32Array(h);t.delay_attrs_masked=new Float32Array(h);t.emitter_tsr_snapshots=new Float32Array(8*h.length);for(L=0;L<8*h.length;L++)for(N=0;8>N;N++)t.emitter_tsr_snapshots[8*L+N]=q[N];t.use_world_space&&v(t,B,d,m,q,d,m);q=l.create_empty_submesh("EMITTER_PARTICLES");t=l.create_empty_va_frame();t.a_position=d;t.a_normal=m;q.va_frames[0]=t;if(B){a.draw_mode=b.DM_DYNAMIC_TRIANGLES;a=[];for(t=0;t<A;t++)a.push(4*t,4*t+2,4*t+1,4*t,4*t+3,4*t+2);a=new Uint16Array(a);q.indices=a;a=q.va_common;t=[];for(L=
0;L<A;L++)t.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);t=new Float32Array(t);a.a_p_bb_vertex=t}else a.draw_mode=b.DM_DYNAMIC_POINTS,q.indices=new Uint16Array(0);q.base_length=d.length/3;q.va_common.a_p_delay=h;a=q.va_common;t=[];r*=w;for(h=0;h<A;h++)L=r*u(),t.push(w-L),B&&(t.push(w-L),t.push(w-L),t.push(w-L));w=new Float32Array(t);a.a_p_lifetime=w;w=q.va_common;r=[];for(a=0;a<A;a++){t=[u()-.5,u()-.5,u()-.5];n.normalize(t,t);r.push(E*t[0]);r.push(E*t[1]);r.push(E*t[2]);switch(y){case "NONE":r.push(0);break;
case "SPIN":case "VELOCITY":r.push(M);break;case "RAND":r.push(2*M*(u()-.5));break;default:throw"Undefined velocity factor";}if(B)for(t=r.slice(-4),h=0;12>h;h++)r.push(t[h%4])}A=new Float32Array(r);w.a_p_vels=A;return q};a.update_emitter_transform=function(a,c){for(var d=0;d<c.length;d++){var e=c[d],g=c[d].particles_data;if(g){var n=e.bufs_data;if(!g.use_world_space)break;var h=g.positions_cache,l=g.normals_cache;v(g,!e.halo_particles,g.positions,g.normals,a.render.world_tsr,h,l);b.make_dynamic(n);
b.update_bufs_data_array(n,"a_position",3,h);b.update_bufs_data_array(n,"a_normal",3,l)}}};a.set_time=function(a,b,c){a=a.scenes_data;for(var d=0;d<a.length;d++)for(var e=a[d].batches,g=0;g<e.length;g++){var h=e[g].particles_data;h&&h.name==b&&(h.prev_time=h.time,h.time=c)}};a.prepare_lens_flares=function(a){for(var b=a.base_length,c=a.va_frames[0].a_position,d=a.va_common.a_texcoord,e=[],g=[],h=0;h<b;h++)g.push(c[3*h]),g.push(c[3*h+1]),e.push(c[3*h+2]);e=new Float32Array(e);g=new Float32Array(g);
a.va_common.a_lf_dist=e;a.va_common.a_lf_bb_vertex=g;a.va_common.a_texcoord=d;return a};a.set_size=function(a,b,c){a=a.scenes_data;for(var d=0;d<a.length;d++)for(var e=a[d].batches,g=0;g<e.length;g++){var h=e[g].particles_data;h&&h.name==b&&(h.size=c)}};a.set_normal_factor=function(a,b,c){a=a.scenes_data;for(var d=0;d<a.length;d++)for(var e=a[d].batches,g=0;g<e.length;g++){var h=e[g].particles_data;h&&h.name==b&&(h.nfactor=c)}};a.set_factor=function(a,c,d){a=a.scenes_data;for(var e=0;e<a.length;e++)for(var g=
a[e].batches,n=0;n<g.length;n++){var h=g[n],l=h.particles_data;if(l&&l.name==c){var q=l.delay_attrs;if(1==d)l=q;else if(0==d)for(var r=!h.halo_particles,m=r?4:1,l=l.delay_attrs_masked,u=0;u<l.length;u+=m)l[u]=1E4,r&&(l[u+1]=l[u],l[u+2]=l[u],l[u+3]=l[u]);else for(var y=1/d,l=l.delay_attrs_masked,m=(r=!h.halo_particles)?4:1,t=0,u=0;u<l.length;u+=m)u>=t?(l[u]=q[u],t+=y):l[u]=1E4,r&&(l[u+1]=l[u],l[u+2]=l[u],l[u+3]=l[u]);b.update_bufs_data_array(h.bufs_data,"a_p_delay",1,l)}}};a.update_start_pos=function(a,
b,c){a=a.scenes_data;for(var d=0;d<a.length;d++)for(var e=a[d].batches,g=0;g<e.length;g++){var h=e[g].particles_data;if(h)for(var n=0;n<8*h.delay_attrs.length;n++)h.emitter_tsr_snapshots[8*n]=b[0],h.emitter_tsr_snapshots[8*n+1]=b[1],h.emitter_tsr_snapshots[8*n+2]=b[2],h.emitter_tsr_snapshots[8*n+3]=b[3],h.emitter_tsr_snapshots[8*n+4]=c[0],h.emitter_tsr_snapshots[8*n+5]=c[1],h.emitter_tsr_snapshots[8*n+6]=c[2],h.emitter_tsr_snapshots[8*n+7]=c[3]}}};b4w.module.__primitives=function(a,t){function v(a,b,c,d){for(var e=[],l=[],q=[],t=[],h=2*c/(a-1),x=2*d/(b-1),w=0;w<a;w++)for(var r=-c+w*h,m=0;m<b;m++)if(l.push(r,0,-d+m*x),q.push(0,1,0),t.push(w/(a-1),m/(b-1)),w&&m){var E=w*b+m,y=E-1,v=(w-1)*b+m,L=v-1;e.push(E,y,v);e.push(y,L,v)}a=n.create_empty_va_frame();a.a_position=new Float32Array(l);a.a_normal=new Float32Array(q);q=n.create_empty_submesh("GRID_PLANE");q.va_frames[0]=a;q.va_common.a_texcoord=new Float32Array(t);q.indices=new Uint32Array(e);
q.base_length=l.length/3;return q}function c(a){var b=a.length;if(b%4)throw"Wrong array";for(var c=[],d=[],l=0;l<b;l+=4){var q=a[l+1],t=a[l+2],v=a[l+3];e(a[l],d);e(q,d);e(t,d);e(v,d);c.push(l,l+1,l+2);c.push(l,l+2,l+3)}a=n.create_empty_va_frame();a.a_position=new Float32Array(d);b=n.create_empty_submesh("FROM_QUADS");b.va_frames[0]=a;b.indices=new Uint32Array(c);b.base_length=d.length/3;return b}function b(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function e(a,b){b.push(a[0],a[1],a[2])}var d=t("__config"),
l=t("__geometry");t("__print");var n=t("__util"),q=d.defaults;a.generate_lines=function(a){for(var b=n.create_empty_submesh("LINE"),c=[],d=0;d<2*a;d++)c.push(d);d=n.create_empty_va_frame();d.a_point=new Float32Array(c);b.va_frames[0]=d;b.indices=new Uint32Array(c);b.base_length=2*a;return b};a.generate_plane=function(a,b){var c=v(2,2,a,b);c.name="PLANE";return c};a.generate_grid=v;a.generate_multigrid=function(a,b,c){function d(a,b){return 1==a%2&&(0==b||b==A-1)||1==b%2&&(0==a||a==v-1)?!0:!1}var e=
c/=Math.pow(2,a-1),t=c,v=b+1,A=b+1;b=[];c=[];for(var h=0,x=0,w=-1,r=[],m=0;m<a;m++){for(var E=2*e/(v-1),y=2*t/(A-1),M=[],L=[],N=0,B=0;B<v;B++){for(var O=-e+B*E,F=[],C=0;C<A;C++){var I=-t+C*y;if(O>-h&&O<h&&I>-x&&I<x)F.push(-1),N++;else{for(var Q=null,G=0;G<r.length;G+=3)if(O==r[G]&&I==r[G+1]){Q=r[G+2];break}G=null!==Q?Q:w+1;d(B,C)?(F.push(-2),N++):(null==Q&&(0==C||C==A-1||0==B||B==v-1?(Q=m==a-1?E:2*E,M.push(O,I,G)):Q=E,c.push(O,Q,I),w++),F.push(G));if(B&&C)if(1==B)if(d(B-1,C)){if(1<C){var I=G-1,Q=
L[B-1][C+1],z=Q-1;b.push(G,I,z)}else Q=L[B-1][C+1],z=Q-1;b.push(G,z,Q)}else d(B,C)||(I=G-1,Q=L[B-1][C],b.push(G,I,Q));else if(B==v-1){if(!d(B,C))if(C==A-1)I=G-1,Q=L[B-1][C-1],z=L[B-2][C],b.push(G,I,Q),b.push(G,Q,z);else{var I=G-1,Q=L[B-1][C],z=Q-1,Y=Q+1;b.push(G,I,z);b.push(G,z,Q);b.push(G,Q,Y);2==C&&(Y=L[B-2][C-2],b.push(I,Y,z))}}else 1==C?d(B,C-1)?(I=L[B-1][C],Q=L[B-1][C-1],b.push(G,Q,I)):(I=F[C-1],Q=L[B-1][C],z=L[B-2][C-1],b.push(G,I,Q),b.push(I,z,Q)):C==A-1?d(B,C)||(I=F[C-1],Q=L[B-1][C-1],z=L[B-
2][C],b.push(G,I,Q),b.push(G,Q,z)):-1!=L[B-1][C]&&-1!=L[B-1][C-1]&&-1!=F[C-1]?(I=F[C-1],Q=L[B-1][C],z=L[B-1][C-1],b.push(G,I,Q),b.push(I,z,Q),C==A-2&&d(B,C+1)&&(Y=L[B-1][C+1],b.push(G,Q,Y))):C==A-2&&d(B,C+1)&&(Q=L[B-1][C],Y=L[B-1][C+1],b.push(G,Q,Y))}}L.push(F)}r=M;h=e;x=t;e*=2;t*=2}2E4>h&&(a=-(2*h)/(v-1),c.push(-2E4,a,-2E4),c.push(-2E4,a,2E4),c.push(-h,a,-x),c.push(-h,a,x),c.push(2E4,a,-2E4),c.push(2E4,a,2E4),c.push(h,a,-x),c.push(h,a,x),G=w+1,b.push(G+3,G+2,G+1,G+2,G+0,G+1,G+6,G+4,G+2,G+4,G+0,G+
2,G+5,G+7,G+1,G+7,G+3,G+1,G+5,G+4,G+7,G+7,G+4,G+6));a=n.create_empty_va_frame();a.a_position=new Float32Array(c);e=n.create_empty_submesh("multigrid_plane");e.va_frames[0]=a;e.indices=new Uint32Array(b);e.base_length=c.length/3;q.water_wireframe_debug&&(l.submesh_drop_indices(e,1,!0),a.a_polyindex=l.extract_polyindices(e));return e};a.generate_from_triangles=function(a){var b=a.length;if(b%3)throw"Wrong array";for(var c=[],d=[],l=0;l<b;l+=3){var q=a[l+1],t=a[l+2];e(a[l],d);e(q,d);e(t,d);c.push(l,
l+1,l+2)}a=n.create_empty_va_frame();a.a_position=new Float32Array(d);b=n.create_empty_submesh("FROM_TRIANGLES");b.va_frames[0]=a;b.indices=new Uint32Array(c);b.base_length=d.length/3;return b};a.generate_from_quads=c;a.generate_frustum=function(a){a=n.vectorize(a,[]);var b=[];b.push(a[0],a[1],a[2],a[3]);b.push(a[0],a[3],a[5],a[4]);b.push(a[3],a[2],a[6],a[5]);b.push(a[1],a[7],a[6],a[2]);b.push(a[0],a[4],a[7],a[1]);b.push(a[4],a[5],a[6],a[7]);a=c(b);a.name="FRUSTUM";return a};a.generate_fullscreen_tri=
function(){var a=n.create_empty_submesh("FULLSCREEN_TRI"),b=n.create_empty_va_frame();b.a_position=new Float32Array([0,0,1,0,0,1]);a.va_frames[0]=b;a.indices=new Uint32Array([0,1,2]);a.base_length=3;return a};a.generate_fullscreen_quad=function(){var a=n.create_empty_submesh("FULLSCREEN_QUAD"),b=n.create_empty_va_frame();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.va_frames[0]=b;a.indices=new Uint32Array([0,2,1,1,2,3]);a.base_length=4;return a};a.generate_billboard=function(){var a=n.create_empty_submesh("BILLBOARD"),
b=n.create_empty_va_frame();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.va_frames[0]=b;a.indices=new Uint32Array([0,2,1,0,3,2]);a.base_length=4;return a};a.generate_cube=function(){var a=n.create_empty_submesh("CUBEMAP_BOARD"),b=n.create_empty_va_frame();b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.va_frames[0]=b;a.indices=new Uint32Array([0,2,1,0,3,2]);a.base_length=4;return a};a.generate_uv_sphere=function(a,c,d,f,p,q){var t=n.create_empty_submesh("UV_SPHERE"),v,h,
x=[],w=[],r=[];for(h=0;h<=c;h++)for(v=0;v<=a;v++){var m=v/a,E=h/c,y=-d*Math.cos(2*m*Math.PI)*Math.sin(E*Math.PI),M=d*Math.cos(E*Math.PI),m=d*Math.sin(2*m*Math.PI)*Math.sin(E*Math.PI);p&&(y=1E-5>Math.abs(y)?0:y,M=1E-5>Math.abs(M)?0:M,m=1E-5>Math.abs(m)?0:m);w.push(y+f[0],M+f[1],m+f[2])}for(h=p=0;h<c;h++)for(v=0;v<a;v++)y=b(w,(a+1)*h+v+1),M=b(w,(a+1)*h+v),m=b(w,(a+1)*(h+1)+v),E=b(w,(a+1)*(h+1)+v+1),Math.abs(y[1])==d+f[1]?(e(y,x),e(m,x),e(E,x),q?r.push(p,p+1,p+1,p+2,p+2,p):r.push(p,p+1,p+2),p+=3):Math.abs(m[1])==
d+f[1]?(e(y,x),e(M,x),e(m,x),q?r.push(p,p+1,p+1,p+2,p+2,p):r.push(p,p+1,p+2),p+=3):(e(y,x),e(M,x),e(m,x),e(E,x),q?(r.push(p,p+1),r.push(p+1,p+2),r.push(p+2,p+3),r.push(p+3,p)):(r.push(p,p+1,p+2),r.push(p,p+2,p+3)),p+=4);a={};a.a_position=x;q?a.a_normal=[]:(q=l.calc_shared_indices(r,w,x),a.a_normal=l.calc_normals(r,x,q));a.a_tangent=[];t.va_common.a_influence=[];t.va_common.a_color=[];t.va_common.a_texcoord=[];t.va_frames[0]=a;t.indices=r;t.base_length=x.length/3;return t};a.generate_index=function(a){var b=
n.create_empty_submesh("INDEX"),c=n.create_empty_va_frame();c.a_index=new Float32Array(a);for(var d=0;d<a;d++)c.a_index[d]=d;b.va_frames[0]=c;b.indices=new Uint16Array(0);b.base_length=a;return b}};b4w.module.__prerender=function(a,t){function v(a,c){var d=a.obj_render;d.is_visible=!1;var e=c.camera,g="SHADOW_CAST"==c.type?e.lod_eye:l.get_trans_view(e.world_tsr);if(!d||d.hide)return!1;var q=d.bs_world.center,h=d.lod_dist_min,x=d.lod_dist_max,g=Math.sqrt((q[0]-g[0])*(q[0]-g[0])+(q[1]-g[1])*(q[1]-g[1])+(q[2]-g[2])*(q[2]-g[2])),q=d.lod_transition_ratio*d.bs_world.radius;if(!(g>=h&&g<x+q))return!1;d.is_visible=!0;if("OUTLINE_MASK"==c.type&&!Boolean(d.outline_intensity))return!1;e=e.frustum_planes;
d.do_not_cull?d=!1:"STATIC"===d.type?(h=d.bs_world,d=h.center,d=n.sphere_is_out_of_frustum(d,e,h.radius)):(h=d.be_world,d=h.center,d=n.ellipsoid_is_out_of_frustum(d,e,h.axis_x,h.axis_y,h.axis_z));return d?!1:"WIREFRAME"==c.type?a.batch.wireframe_mode==b.WM_DEBUG_SPHERES?a.batch.debug_sphere:!a.batch.debug_sphere:!0}var c=t("__config"),b=t("__debug"),e=t("__geometry"),d=t("__renderer"),l=t("__tsr"),n=t("__util"),q=t("__vec3"),g=c.defaults,u="MAIN_OPAQUE MAIN_BLEND MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT MAIN_GLOW SHADOW_CAST DEPTH OUTLINE_MASK WIREFRAME COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" ");
a.prerender_subs=function(a){if(-1<u.indexOf(a.type)){for(var b=!1,c=a.bundles,n=0;n<c.length;n++){var t=c[n];if("MAIN_CUBE_REFLECT"==a.type)for(var A=0;6>A;A++)a.camera.frustum_planes=a.cube_cam_frustums[A],t.do_render_cube[A]=v(t,a),t.do_render_cube[A]&&(b=!0);else t.do_render=v(t,a),t.do_render&&(b=!0)}switch(a.type){case "WIREFRAME":break;default:"MAIN_OPAQUE"===a.type||"DEPTH"===a.type||"MAIN_GLOW"===a.type||b?a.do_render=!0:(a.do_render&&d.clear(a),a.do_render=!1)}}if("MAIN_BLEND"==a.type&&
g.alpha_sort&&a.bundles){b=l.get_trans_view(a.camera.world_tsr);c=q.dist(b,a.zsort_eye_last)>g.alpha_sort_threshold;for(n=0;n<a.bundles.length;n++)if(A=a.bundles[n],t=A.obj_render,t.force_zsort||c){var h=A.batch;if(h&&h.blend&&h.zsort_type!=e.ZSORT_DISABLED){h=h.bufs_data;if(!h||!A.do_render)continue;(A=h.info_for_z_sort_updates)&&A.type==e.ZSORT_BACK_TO_FRONT&&e.update_buffers_movable(h,t.world_tsr,b)}t.force_zsort=!1}c&&q.copy(b,a.zsort_eye_last)}}};b4w.module.__print=function(a,t){function v(a,b){var c=[];-1<a[0].indexOf("%c")?c.push(a[0].replace("%c","%c"+b+": ")):c.push(b+": "+a[0]);for(var d=1;d<a.length;d++)c.push(a[d]);return c}function c(){l++;var a=v(arguments,"B4W ERROR");console.error.apply(console,a)}function b(a){a in q||(q[a]=a,c([a]))}function e(a,c){b(a+"() is deprecated, use "+c+"() instead.")}var d=!1,l=0,n=0,q={};a.set_verbose=function(a){d=a};a.log_raw=function(){console.log.apply(console,arguments)};a.log=function(){if(d){var a=
v(arguments,"B4W LOG");console.log.apply(console,a)}};a.error=c;a.error_once=b;a.error_deprecated=e;a.error_deprecated_arr=function(a,c){switch(1<c.length){case !0:b(a+"() is deprecated, use "+c.slice(0,-1).join("(), ")+"() or "+c[c.length-1]+"() instead.");break;case !1:e(a,c[0])}};a.warn=function(){n++;var a=v(arguments,"B4W WARN");console.warn.apply(console,a)};a.info=function(){var a=v(arguments,"B4W INFO");console.info.apply(console,a)};a.export_error=function(){l++;var a=v(arguments,"B4W EXPORT ERROR");
console.error.apply(console,a)};a.export_warn=function(){n++;var a=v(arguments,"B4W EXPORT WARNING");console.warn.apply(console,a)};a.time=function(){d&&console.time.apply(console,arguments)};a.timeEnd=function(){d&&console.timeEnd.apply(console,arguments)};a.group=function(){d&&console.group.apply(console,arguments)};a.groupCollapsed=function(){d&&console.groupCollapsed.apply(console,arguments)};a.groupEnd=function(){d&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&
console.clear.apply(console,arguments)};a.get_warning_count=function(){return n};a.get_error_count=function(){return l};a.clear_errors_warnings=function(){l=n=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,t){function v(a){switch(a.type){case "MAPPING":a.vector_type||(a.vector_type="POINT",b("node Mapping",a,"vector_type"));break;case "MATERIAL":case "MATERIAL_EXT":"alpha"in a||(a.alpha=1,b("node material",a,"alpha"));"darkness"in a||(a.darkness=1,b("node material",a,"darkness"));"diffuse_toon_size"in a||(a.diffuse_toon_size=.5,b("node material",a,"diffuse_toon_size"));"diffuse_toon_smooth"in a||(a.diffuse_toon_smooth=.1,b("node material",a,"diffuse_toon_smooth"));"diffuse_intensity"in
a||(a.diffuse_intensity=1,b("node material",a,"diffuse_intensity"));"specular_shader"in a||(a.specular_shader="COOKTORR",b("node material",a,"specular_shader"));"specular_ior"in a||(a.specular_ior=4,b("node material",a,"specular_ior"));"specular_hardness"in a||(a.specular_hardness=50,b("node material",a,"specular_hardness"));"specular_slope"in a||(a.specular_slope=.1,b("node material",a,"specular_slope"));"specular_toon_size"in a||(a.specular_toon_size=.5,b("node material",a,"specular_toon_size"));
"specular_toon_smooth"in a||(a.specular_toon_smooth=.1,b("node material",a,"specular_toon_smooth"));"specular_intensity"in a||(a.specular_intensity=.5,b("node material",a,"specular_intensity"));"diffuse_shader"in a||(a.diffuse_shader="LAMBERT",b("node material",a,"diffuse_shader"));"roughness"in a||(a.roughness=.5,b("node material",a,"roughness"));"diffuse_fresnel"in a||(a.diffuse_fresnel=.1,b("node material",a,"diffuse_fresnel"));"diffuse_fresnel_factor"in a||(a.diffuse_fresnel_factor=.5,b("node material",
a,"diffuse_fresnel_factor"));break;case "MATH":case "MIX_RGB":"use_clamp"in a||(a.use_clamp=!1,b("node "+a.type,a,"use_clamp"));break;case "GROUP":switch(a.node_tree_name=a.node_tree_name.replace(/\.[0-9]{3,}$/g,""),a.node_tree_name){case "CLAMP":case "LEVELS_OF_QUALITY":case "LINEAR_TO_SRGB":case "NORMAL_VIEW":case "PARALLAX":case "REFLECT":case "REFRACTION":case "REPLACE":case "SMOOTHSTEP":case "SRGB_TO_LINEAR":case "TIME":case "TRANSLUCENCY":case "VECTOR_VIEW":a.node_tree_name="B4W_"+a.node_tree_name}}}
function c(a){if(a=a.nla_tracks)for(var c=0;c<a.length;c++)for(var d=a[c],e=0;e<d.strips.length;e++){var f=d.strips[e];"action"in f||(f.action=null,b("strip",f,"action"));"action_frame_start"in f||(f.action_frame_start=0,b("strip",f,"action_frame_start"));"action_frame_end"in f||(f.action_frame_end=f.frame_end-f.frame_start,b("strip",f,"action_frame_end"));"repeat"in f||(f.repeat=1,b("strip",f,"repeat"));"use_reverse"in f||(f.use_reverse=!1,b("strip",f,"use_reverse"));"scale"in f||(f.scale=1,b("strip",
f,"scale"))}}function b(a,b,c){c=c+">>"+a;c in D||(D[c]={storage:[],report_type:"undefined",type:a});D[c].storage.push(b.name)}function e(a,b,c){c=c+">>"+a;c in D||(D[c]={storage:[],report_type:"deprecated",type:a});D[c].storage.push(b.name)}function d(a,b){b||(b=a.name+"_COPY");var c=a.materials,d=a.submeshes;a.materials=null;a.submeshes=null;var e=k.clone_object_json(a);a.materials=c;a.submeshes=d;e.name=b;e.materials=a.materials.slice(0);e.submeshes=[];for(c=0;c<d.length;c++){var f=k.clone_object_nr(d[c]);
e.submeshes.push(f)}return e}var l=t("__boundings"),n=t("__curve"),q=t("__mat4"),g=t("__print"),u=t("__quat"),k=t("__util"),f=t("__vec3"),p=t("__vec4"),K=[5,4],D={};a.check_particles_bin_format=function(a){return-1!=k.version_cmp(a,K)};a.check_bpy_data=function(a){D={};var d=a.worlds;if(0==d.length){g.warn('WARNING Datablock world is missing, reexport "'+a.b4w_filepath_blend+'" scene');var f={name:"DEFAULT",horizon_color:new Float32Array([0,0,0]),zenith_color:new Float32Array([0,0,0]),light_settings:{use_environment_light:!1,
environment_energy:1,environment_color:"PLAIN"},fog_settings:{use_fog:!1,intensity:0,depth:25,start:5,height:0,falloff:"INVERSE_QUADRATIC",use_custom_color:!0,color:[.5,.5,.5]},use_sky_paper:!1,use_sky_blend:!1,use_sky_real:!1,texture_slots:[]};d.push(f)}for(var d=a.worlds,n=0;n<d.length;n++){f=d[n];"use_sky_blend"in f||(b("world",f,"use_sky_blend"),f.use_sky_blend=!1);"use_sky_paper"in f||(b("world",f,"use_sky_paper"),f.use_sky_paper=!1);"use_sky_real"in f||(b("world",f,"use_sky_real"),f.use_sky_real=
!1);"b4w_sky_settings"in f&&"rayleigh_brightness"in f.b4w_sky_settings||(b("world",f,"rayleigh_brightness"),f.b4w_sky_settings={render_sky:!1,procedural_skydome:!1,use_as_enviroment_map:!1,color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"fog_settings"in f||(b("world",f,"fog_settings"),f.fog_settings={use_fog:!1,intensity:0,depth:25,
start:0,height:0,falloff:"QUADRATIC",use_custom_color:!0,color:[.5,.5,.5]},"b4w_fog_color"in f&&(f.fog_settings.use_custom_color=!0,f.fog_settings.color=f.b4w_fog_color),"b4w_fog_density"in f&&0<f.b4w_fog_density&&(f.fog_settings.depth=1/f.b4w_fog_density));"render_sky"in f.b4w_sky_settings||(b("world",f,"render_sky"),f.b4w_sky_settings.render_sky=!1);for(var r=f.texture_slots,f=0;f<r.length;f++){var m=r[f];"blend_type"in m||(m.blend_type="MIX",b("world_texture_slot",m,"blend_type"));"use_map_blend"in
m||(m.use_map_blend=!1,b("world_texture_slot",m,"use_map_blend"));"use_map_horizon"in m||(m.use_map_horizon=!0,b("world_texture_slot",m,"use_map_horizon"));"use_map_zenith_up"in m||(m.use_map_zenith_up=!1,b("world_texture_slot",m,"use_map_zenith_up"));"use_rgb_to_intensity"in m||(m.use_rgb_to_intensity=!1,b("world_texture_slot",m,"use_rgb_to_intensity"));"invert"in m||(m.invert=!1,b("world_texture_slot",m,"invert"));"color"in m||(m.color=[1,0,1],b("world_texture_slot",m,"color"));"blend_factor"in
m||(m.blend_factor=0,b("world_texture_slot",m,"blend_factor"));"horizon_factor"in m||(m.horizon_factor=1,b("world_texture_slot",m,"horizon_factor"));"zenith_up_factor"in m||(m.zenith_up_factor=0,b("world_texture_slot",m,"zenith_up_factor"));"zenith_down_factor"in m||(m.zenith_down_factor=0,b("world_texture_slot",m,"zenith_down_factor"));"default_value"in m||(m.default_value=1,b("world_texture_slot",m,"default_value"))}}f=a.scenes;for(n=0;n<f.length;n++)r=f[n],m=r.world,"timeline_markers"in r||(r.timeline_markers=
null,b("scene",r,"timeline_markers")),"b4w_reflection_quality"in r||(r.b4w_reflection_quality="MEDIUM",b("scene",r,"b4w_reflection_quality")),"b4w_use_nla"in r||(r.b4w_use_nla=!1,b("scene",r,"b4w_use_nla")),"fps"in r||(r.fps=24,b("scene",r,"fps")),"b4w_nla_cyclic"in r||(r.b4w_nla_cyclic=!1,b("scene",r,"b4w_nla_cyclic")),"b4w_logic_nodes"in r||(r.b4w_logic_nodes=[],b("scene",r,"b4w_logic_nodes")),"b4w_detect_collisions"in r&&(e("scene",r,"b4w_detect_collisions"),delete r.b4w_detect_collisions),"audio_doppler_speed"in
r||(r.audio_doppler_speed=343.3),"audio_doppler_factor"in r||(r.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in r||(r.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,release:.25},b("scene",r,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in r||(r.b4w_enable_convolution_engine=!1),"b4w_enable_bloom"in r||(r.b4w_enable_bloom=!1,b("scene",r,"b4w_enable_bloom")),"b4w_enable_motion_blur"in r||(r.b4w_enable_motion_blur=!1,b("scene",r,"b4w_enable_motion_blur")),
"b4w_enable_color_correction"in r||(r.b4w_enable_color_correction=!1,b("scene",r,"b4w_enable_color_correction")),"b4w_antialiasing_quality"in r||(r.b4w_antialiasing_quality="MEDIUM",b("scene",r,"b4w_antialiasing_quality")),"b4w_tags"in r||(r.b4w_tags={title:"",description:""},b("scene",r,"b4w_tags")),"b4w_enable_object_selection"in r||(r.b4w_enable_object_selection="AUTO",b("scene",r,"b4w_enable_object_selection")),"b4w_enable_outlining"in r||(r.b4w_enable_outlining="AUTO",b("scene",r,"b4w_enable_outlining")),
"b4w_enable_glow_materials"in r||(r.b4w_enable_glow_materials="AUTO",b("scene",r,"b4w_enable_glow_materials")),"b4w_enable_anchors_visibility"in r||(r.b4w_enable_anchors_visibility="AUTO",b("scene",r,"b4w_enable_anchors_visibility")),"b4w_outline_color"in r||(r.b4w_outline_color=[1,1,1],b("scene",r,"b4w_outline_color")),"b4w_outline_factor"in r||(r.b4w_outline_factor="b4w_glow_factor"in r?r.b4w_glow_factor:1,b("scene",r,"b4w_outline_factor")),"b4w_shadow_settings"in r||(b("scene",r,"b4w_shadow_settings"),
d=m.b4w_shadow_settings,r.b4w_shadow_settings=d?d:{csm_resolution:2048,self_shadow_polygon_offset:1,b4w_enable_csm:!1,csm_num:1,csm_first_cascade_border:10,first_cascade_blur_radius:3,csm_last_cascade_border:100,last_cascade_blur_radius:1.5,fade_last_cascade:!0,blend_between_cascades:!0}),d=r.b4w_shadow_settings,"csm_resolution"in d||(b("scene",r,"b4w_shadow_settings.csm_resolution"),d.csm_resolution=2048),"self_shadow_polygon_offset"in d||(b("scene",r,"b4w_shadow_settings.self_shadow_polygon_offset"),
d.self_shadow_polygon_offset=1),"self_shadow_normal_offset"in d||(b("scene",r,"b4w_shadow_settings.self_shadow_normal_offset"),d.self_shadow_normal_offset=.01),"b4w_enable_csm"in d||(b("scene",r,"b4w_shadow_settings.b4w_enable_csm"),d.b4w_enable_csm=!1),"csm_num"in d||(b("scene",r,"b4w_shadow_settings.csm_num"),d.csm_num=1),"csm_first_cascade_border"in d||(b("scene",r,"b4w_shadow_settings.csm_first_cascade_border"),d.csm_first_cascade_border=10),"first_cascade_blur_radius"in d||(b("scene",r,"b4w_shadow_settings.first_cascade_blur_radius"),
d.first_cascade_blur_radius=3),"csm_last_cascade_border"in d||(b("scene",r,"b4w_shadow_settings.csm_last_cascade_border"),d.csm_last_cascade_border=100),"last_cascade_blur_radius"in d||(b("scene",r,"b4w_shadow_settings.last_cascade_blur_radius"),d.last_cascade_blur_radius=1.5),"fade_last_cascade"in d||(b("scene",r,"b4w_shadow_settings.fade_last_cascade"),d.fade_last_cascade=!0),"blend_between_cascades"in d||(b("scene",r,"b4w_shadow_settings.blend_between_cascades"),d.blend_between_cascades=!0),"b4w_ssao_settings"in
r||(b("scene",r,"b4w_ssao_settings"),d=m.b4w_ssao_settings,r.b4w_ssao_settings=d?d:{dist_factor:0,samples:16,hemisphere:!1,blur_depth:!1,blur_discard_value:1}),d=r.b4w_ssao_settings,"dist_factor"in d||(b("scene",r,"b4w_ssao_settings.dist_factor"),d.dist_factor=0),"samples"in d||(b("scene",r,"b4w_ssao_settings.samples"),d.samples=16),"hemisphere"in d||(b("scene",r,"b4w_ssao_settings.hemisphere"),d.hemisphere=!1),"blur_depth"in d||(b("scene",r,"b4w_ssao_settings.blur_depth"),d.blur_depth=!1),"blur_discard_value"in
d||(b("scene",r,"b4w_ssao_settings.blur_discard_value"),d.blur_discard_value=1),"b4w_bloom_settings"in r||(b("scene",r,"b4w_bloom_settings"),d=m.b4w_bloom_settings,r.b4w_bloom_settings=d?d:{key:.2,blur:4,edge_lum:1}),"key"in r.b4w_bloom_settings||(b("scene",r,"b4w_bloom_settings.key"),r.b4w_bloom_settings.key=.2),"blur"in r.b4w_bloom_settings||(b("scene",r,"b4w_bloom_settings.blur"),r.b4w_bloom_settings.blur=4),"edge_lum"in r.b4w_bloom_settings||(b("scene",r,"b4w_bloom_settings.edge_lum"),r.b4w_bloom_settings.edge_lum=
1),"b4w_motion_blur_settings"in r||(b("scene",r,"b4w_motion_blur_settings"),d=m.b4w_motion_blur_settings,r.b4w_motion_blur_settings=d?d:{motion_blur_factor:.01,motion_blur_decay_threshold:.01}),"motion_blur_factor"in r.b4w_motion_blur_settings||(b("scene",r,"b4w_motion_blur_settings.motion_blur_factor"),r.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in r.b4w_motion_blur_settings||(b("scene",r,"b4w_motion_blur_settings.motion_blur_decay_threshold"),r.b4w_motion_blur_settings.motion_blur_decay_threshold=
.01),"b4w_color_correction_settings"in r||(b("scene",r,"b4w_color_correction_settings"),d=m.b4w_color_correction_settings,r.b4w_color_correction_settings=d?d:{brightness:0,contrast:0,exposure:1,saturation:1}),"b4w_god_rays_settings"in r||(b("scene",r,"b4w_god_rays_settings"),d=m.b4w_god_rays_settings,r.b4w_god_rays_settings=d?d:{intensity:.7,max_ray_length:1,steps_per_pass:10}),"steps_per_pass"in r.b4w_god_rays_settings||(b("scene",r,"b4w_god_rays_settings.steps_per_pass"),r.b4w_god_rays_settings.steps_per_pass=
10),"b4w_glow_settings"in r||(b("scene",r,"b4w_glow_settings"),r.b4w_glow_settings={render_glow_over_blend:!1,small_glow_mask_coeff:2,large_glow_mask_coeff:2,small_glow_mask_width:2,large_glow_mask_width:6},d=r.b4w_glow_settings,"b4w_render_glow_over_blend"in m&&(d.render_glow_over_blend=m.b4w_render_glow_over_blend),"b4w_small_glow_mask_coeff"in m&&(d.small_glow_mask_coeff=m.b4w_small_glow_mask_coeff),"b4w_large_glow_mask_coeff"in m&&(d.large_glow_mask_coeff=m.b4w_large_glow_mask_coeff),"b4w_small_glow_mask_width"in
m&&(d.small_glow_mask_width=m.b4w_small_glow_mask_width),"b4w_large_glow_mask_width"in m&&(d.large_glow_mask_width=m.b4w_large_glow_mask_width)),m=r.b4w_render_shadows,"AUTO"!=m&&"OFF"!=m&&"ON"!=m&&(r.b4w_render_shadows=m?"ON":"OFF"),m=r.b4w_render_reflections,"OFF"!=m&&"ON"!=m&&(r.b4w_render_reflections=m?"ON":"OFF"),m=r.b4w_render_refractions,"AUTO"!=m&&"OFF"!=m&&"ON"!=m&&(r.b4w_render_refractions=m?"ON":"OFF"),r.b4w_nla_script&&e("scene",r,"b4w_nla_script");r=a.meshes;for(n=0;n<r.length;n++){m=
r[n];m.b4w_bounding_box||(b("mesh",m,"b4w_bounding_box"),m.b4w_bounding_box={max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0});m.b4w_bounding_box_source||(b("mesh",m,"b4w_bounding_box_source"),m.b4w_bounding_box_source=m.b4w_bounding_box);m.uv_textures||(b("mesh",m,"uv_textures"),m.uv_textures=[]);m.b4w_bounding_sphere_center||(m.b4w_bounding_sphere_center=[0,0,0]);m.b4w_bounding_cylinder_center||(m.b4w_bounding_cylinder_center=[0,0,0]);m.b4w_bounding_ellipsoid_center||(m.b4w_bounding_ellipsoid_center=
[0,0,0]);m.b4w_bounding_ellipsoid_axes||(f=m.b4w_bounding_box,m.b4w_bounding_ellipsoid_axes=[(f.max_x-f.min_x)/2,(f.max_y-f.min_y)/2,(f.max_z-f.min_z)/2]);"b4w_shape_keys"in m||(m.b4w_shape_keys=[],b("mesh",m,"b4w_shape_keys"));for(var f=m,d=["b4w_apply_scale","b4w_apply_modifiers","b4w_export_edited_normals","b4w_loc_export_vertex_anim","b4w_shape_keys"],l=null,p=0;p<d.length;p++)f[d[p]]&&(l?(f[d[p]]=!1,g.warn('WARNING property "'+d[p]+'" of object "'+f.name+'" has been set to "false". Foreground property "'+
l+'" already exists.')):l=d[p]);for(f=0;f<m.b4w_vertex_anim.length;f++)d=m.b4w_vertex_anim[f],"allow_nla"in d||(b('mesh["b4w_vertex_anim"]',m,"allow_nla"),d.allow_nla=!0)}f=a.cameras;for(n=0;n<f.length;n++)r=f[n],r.type||(r.type="PERSP",b("camera",r,"type")),"b4w_eye_target_dist"in r&&(delete r.b4w_eye_target_dist,e("camera",r,"b4w_eye_target_dist")),"b4w_hover_zero_level"in r||(r.b4w_hover_zero_level=0,b("camera",r,"b4w_hover_zero_level")),"b4w_trans_velocity"in r||(r.b4w_trans_velocity=1,b("camera",
r,"b4w_trans_velocity")),"b4w_rot_velocity"in r||(r.b4w_rot_velocity=1,b("camera",r,"b4w_rot_velocity")),"b4w_zoom_velocity"in r||(r.b4w_zoom_velocity=.1,b("camera",r,"b4w_zoom_velocity")),"b4w_use_target_distance_limits"in r||(r.b4w_use_target_distance_limits=r.b4w_use_distance_limits||!1,b("camera",r,"b4w_use_target_distance_limits")),"b4w_use_zooming"in r||(r.b4w_use_zooming=r.b4w_use_distance_limits||!1,b("camera",r,"b4w_use_zooming")),"b4w_distance_min"in r||(r.b4w_distance_min=1,b("camera",
r,"b4w_distance_min")),"b4w_distance_max"in r||(r.b4w_distance_max=100,b("camera",r,"b4w_distance_max")),"b4w_horizontal_translation_min"in r||(r.b4w_horizontal_translation_min=-100,b("camera",r,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in r||(r.b4w_horizontal_translation_max=100,b("camera",r,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in r||(r.b4w_vertical_translation_min=-100,b("camera",r,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in
r||(r.b4w_vertical_translation_max=100,b("camera",r,"b4w_vertical_translation_max")),"b4w_use_horizontal_clamping"in r||(r.b4w_use_horizontal_clamping=!1,b("camera",r,"b4w_use_horizontal_clamping")),"b4w_rotation_left_limit"in r||(r.b4w_rotation_left_limit=-Math.PI,b("camera",r,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in r||(r.b4w_rotation_right_limit=Math.PI,b("camera",r,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in r||(r.b4w_horizontal_clamping_type="LOCAL",b("camera",
r,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in r||(r.b4w_use_vertical_clamping=!1,b("camera",r,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in r||(r.b4w_rotation_down_limit=-Math.PI/2,b("camera",r,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in r||(r.b4w_rotation_up_limit=Math.PI/2,b("camera",r,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in r||(r.b4w_vertical_clamping_type="LOCAL",b("camera",r,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in r||(r.b4w_hover_angle_min=
Math.PI/6,b("camera",r,"b4w_hover_angle_min")),"b4w_hover_angle_max"in r||(r.b4w_hover_angle_max=Math.PI/6,b("camera",r,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in r||(r.b4w_enable_hover_hor_rotation=!0,b("camera",r,"b4w_enable_hover_hor_rotation")),"b4w_use_panning"in r||(r.b4w_use_panning=!0,b("camera",r,"b4w_use_panning"));f=a.lamps;for(n=0;n<f.length;n++)r=f[n],"b4w_generate_shadows"in r||(r.b4w_generate_shadows=!1,b("lamp",r,"b4w_generate_shadows")),"b4w_dynamic_intensity"in r||
(r.b4w_dynamic_intensity=!1,b("lamp",r,"b4w_dynamic_intensity")),"use_diffuse"in r||(r.use_diffuse=!0,b("lamp",r,"use_diffuse")),"use_specular"in r||(r.use_specular=!0,b("lamp",r,"use_specular"));f=a.speakers;for(n=0;n<f.length;n++)r=f[n],"b4w_behavior"in r||(r.b4w_behavior=r.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in r||(r.b4w_disable_doppler=!1),"b4w_delay"in r||(r.b4w_delay=0),"b4w_delay_random"in r||(r.b4w_delay_random=0),"b4w_volume_random"in r||(r.b4w_volume_random=
0),"b4w_pitch_random"in r||(r.b4w_pitch_random=0),"b4w_fade_in"in r||(r.b4w_fade_in=0),"b4w_fade_out"in r||(r.b4w_fade_out=0),"b4w_loop"in r||(r.b4w_loop=!1),"b4w_loop_count"in r||(r.b4w_loop_count=0),"b4w_loop_count_random"in r||(r.b4w_loop_count_random=0),"b4w_playlist_id"in r||(r.b4w_playlist_id=""),r.animation_data&&c(r.animation_data);f=a.textures;for(n=0;n<f.length;n++)r=f[n],"b4w_anisotropic_filtering"in r||(r.b4w_anisotropic_filtering="OFF",b("texture",r,"b4w_anisotropic_filtering")),"b4w_water_foam"in
r||(r.b4w_water_foam=!1,b("texture",r,"b4w_water_foam")),"b4w_foam_uv_freq"in r||(r.b4w_foam_uv_freq=[1,1],b("texture",r,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in r||(r.b4w_foam_uv_magnitude=[1,1],b("texture",r,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in r||(r.b4w_parallax_steps=5,b("material",r,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in r||(r.b4w_parallax_lod_dist=10,b("material",r,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in r||(r.b4w_shore_dist_map=!1,b("texture",r,"b4w_shore_dist_map")),
"b4w_shore_boundings"in r||(r.b4w_shore_boundings=new Float32Array(4),r.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],b("texture",r,"b4w_shore_boundings")),"b4w_max_shore_dist"in r||(r.b4w_max_shore_dist=100,b("texture",r,"b4w_max_shore_dist")),"b4w_disable_compression"in r||(r.b4w_disable_compression=!1,b("texture",r,"b4w_disable_compression")),"b4w_source_type"in r||(r.b4w_source_type="",b("texture",r,"b4w_source_type")),"b4w_source_id"in r||(r.b4w_source_id="",b("texture",r,"b4w_source_id")),"b4w_source_size"in
r||(r.b4w_source_size=1024,b("texture",r,"b4w_source_size")),"b4w_enable_canvas_mipmapping"in r||(r.b4w_enable_canvas_mipmapping=!0,b("texture",r,"b4w_enable_canvas_mipmapping")),"b4w_nla_video"in r||(r.b4w_nla_video=!1,b("texture",r,"b4w_nla_video"));d=a.materials;for(n=0;n<d.length;n++){l=d[n];"ALPHA_ANTIALIASING"==l.game_settings.alpha_blend&&(l.game_settings.alpha_blend="CLIP");"b4w_node_mat_type"in l&&e("material",l,"b4w_node_mat_type");"b4w_skydome"in l&&e("material",l,"b4w_skydome");"b4w_procedural_skydome"in
l&&e("material",l,"b4w_procedural_skydome");l.b4w_water&&("b4w_water_shore_smoothing"in l||(l.b4w_water_shore_smoothing=!1,b("material",l,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in l||(l.b4w_water_dynamic=!1,b("material",l,"b4w_water_dynamic")),"b4w_waves_height"in l||(l.b4w_waves_height=1,b("material",l,"b4w_waves_height")),"b4w_waves_length"in l||(l.b4w_waves_length=1,b("material",l,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in l||(l.b4w_water_dst_noise_scale0=.05,b("material",l,
"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in l||(l.b4w_water_dst_noise_scale1=.03,b("material",l,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in l||(l.b4w_water_dst_noise_freq0=1.3,b("material",l,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in l||(l.b4w_water_dst_noise_freq1=1,b("material",l,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in l||(l.b4w_water_dir_min_shore_fac=.4,b("material",l,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in
l||(l.b4w_water_dir_freq=.5,b("material",l,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in l||(l.b4w_water_dir_noise_scale=.05,b("material",l,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in l||(l.b4w_water_dir_noise_freq=.07,b("material",l,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in l||(l.b4w_water_dir_min_noise_fac=.5,b("material",l,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in l||(l.b4w_water_dst_min_fac=.2,b("material",l,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in
l||(l.b4w_water_waves_hor_fac=5,b("material",l,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in l||(l.b4w_water_absorb_factor=6,b("material",l,"b4w_water_absorb_factor")),"b4w_water_fog_color"in l||(l.b4w_water_fog_color=new Float32Array(3),l.b4w_water_fog_color=[.5,.7,.7],b("material",l,"b4w_water_fog_color")),"b4w_foam_factor"in l||(l.b4w_foam_factor=5,b("material",l,"b4w_foam_factor")),"b4w_generated_mesh"in l||(l.b4w_generated_mesh=!1,b("material",l,"b4w_generated_mesh")),"b4w_water_num_cascads"in
l||(l.b4w_water_num_cascads=5,b("material",l,"b4w_water_num_cascads")),"b4w_water_subdivs"in l||(l.b4w_water_subdivs=64,b("material",l,"b4w_water_subdivs")),"b4w_water_detailed_dist"in l||(l.b4w_water_detailed_dist=1E3,b("material",l,"b4w_water_detailed_dist")),"b4w_water_enable_caust"in l||(l.b4w_water_enable_caust=!1,b("material",l,"b4w_water_enable_caust")),"b4w_water_caust_scale"in l||(l.b4w_water_caust_scale=.25,b("material",l,"b4w_water_caust_scale")),"b4w_water_caust_brightness"in l||(l.b4w_water_caust_brightness=
.5,b("material",l,"b4w_water_caust_brightness")));"b4w_dynamic_grass_size"in l||(l.b4w_dynamic_grass_size="");"b4w_dynamic_grass_color"in l||(l.b4w_dynamic_grass_color="");"diffuse_intensity"in l||(l.diffuse_intensity=1,b("material",l,"diffuse_intensity"));"b4w_use_ghost"in l||(l.b4w_use_ghost=!1);"b4w_collision_margin"in l||(l.b4w_collision_margin=.04,b("material",l,"b4w_collision_margin"));"b4w_collision_group"in l||(l.b4w_collision_group=128,b("material",l,"b4w_collision_group"));"b4w_collision_mask"in
l||(l.b4w_collision_mask=127,b("material",l,"b4w_collision_mask"));"b4w_do_not_render"in l||(l.b4w_do_not_render=!1,b("material",l,"b4w_do_not_render"));"HALO"!=l.type||"b4w_halo_sky_stars"in l||(l.b4w_halo_sky_stars=!1,b("material",l,"b4w_halo_sky_stars"));"HALO"!=l.type||"b4w_halo_stars_blend_height"in l||(l.b4w_halo_stars_blend_height=10,b("material",l,"b4w_halo_stars_blend_height"));"HALO"!=l.type||"b4w_halo_stars_min_height"in l||(l.b4w_halo_stars_min_height=0,b("material",l,"b4w_halo_stars_min_height"));
"specular_shader"in l||(l.specular_shader="COOKTORR",b("material",l,"specular_shader"));"diffuse_shader"in l||(l.diffuse_shader="LAMBERT",b("material",l,"diffuse_shader"));"roughness"in l||(l.roughness=.5,b("material",l,"roughness"));"diffuse_fresnel"in l||(l.diffuse_fresnel=.1,b("material",l,"diffuse_fresnel"));"diffuse_fresnel_factor"in l||(l.diffuse_fresnel_factor=.5,b("material",l,"diffuse_fresnel_factor"));"specular_slope"in l||(l.specular_slope=.2,b("material",l,"specular_slope"));"specular_toon_size"in
l||(l.specular_toon_size=.5,b("material",l,"specular_toon_size"));"specular_toon_smooth"in l||(l.specular_toon_smooth=.1,b("material",l,"specular_toon_smooth"));"specular_alpha"in l||(l.specular_alpha=1,b("material",l,"specular_alpha"));"b4w_wettable"in l||(l.b4w_wettable=!1,b("material",l,"b4w_wettable"));"b4w_refractive"in l||(l.b4w_refractive=!1,b("material",l,"b4w_refractive"));"b4w_refr_bump"in l||(l.b4w_refr_bump=0,b("material",l,"b4w_refr_bump"));"b4w_shallow_water_col"in l||(l.b4w_shallow_water_col=
[0,.8,.3],b("material",l,"b4w_shallow_water_col"));"b4w_shore_water_col"in l||(l.b4w_shore_water_col=[0,.9,.2],b("material",l,"b4w_shore_water_col"));"b4w_shallow_water_col_fac"in l||(l.b4w_shallow_water_col_fac=1,b("material",l,"b4w_shallow_water_col_fac"));"b4w_shore_water_col_fac"in l||(l.b4w_shore_water_col_fac=.5,b("material",l,"b4w_shore_water_col_fac"));"b4w_water_sss_strength"in l||(l.b4w_water_sss_strength=5.9,b("material",l,"b4w_water_sss_strength"));"b4w_water_sss_width"in l||(l.b4w_water_sss_width=
.45,b("material",l,"b4w_water_sss_width"));"b4w_render_above_all"in l||(l.b4w_render_above_all=!1,b("material",l,"b4w_render_above_all"));"b4w_water_norm_uv_velocity"in l||(l.b4w_water_norm_uv_velocity=.05,b("material",l,"b4w_water_norm_uv_velocity"));"specular_ior"in l||(l.specular_ior=1,b("material",l,"specular_ior"));"darkness"in l||(l.darkness=0,b("material",l,"darkness"));"diffuse_toon_size"in l||(l.diffuse_toon_size=0,b("material",l,"diffuse_toon_size"));"diffuse_toon_smooth"in l||(l.diffuse_toon_smooth=
0,b("material",l,"diffuse_toon_smooth"));r=l.texture_slots;for(f=0;f<r.length;f++)m=r[f],"blend_type"in m||(m.blend_type="MIX",b("texture_slot",m,"blend_type"));if(l.node_tree){r=l.node_tree.nodes;for(f=0;f<r.length;f++)v(r[f]);l.node_tree.animation_data&&c(l.node_tree.animation_data)}}m=a.node_groups;for(n=0;n<m.length;n++)for(r=m[n].node_tree.nodes,f=0;f<r.length;f++)v(r[f]);r=a.objects;for(n=0;n<r.length;n++){m=r[n];switch(m.type){case "MESH":"b4w_dynamic_geometry"in m||(m.b4w_dynamic_geometry=
!1);"b4w_reflexible"in m||(m.b4w_reflexible=!1);"b4w_reflexible_only"in m||(m.b4w_reflexible_only=!1);"b4w_reflective"in m||(m.b4w_reflective=!1);"b4w_reflection_type"in m||(m.b4w_reflection_type="PLANE",b("object",m,"b4w_reflection_type"));"b4w_wind_bending"in m||(m.b4w_wind_bending=!1,b("object",m,"b4w_wind_bending"));"b4w_wind_bending_angle"in m||(m.b4w_wind_bending_angle=10,m.b4w_wind_bending_freq=.25,b("object",m,"wind bending params"));"b4w_detail_bending_amp"in m||(m.b4w_detail_bending_amp=
.1,m.b4w_branch_bending_amp=.3,b("object",m,"detail bending params"));"b4w_detail_bending_freq"in m||(m.b4w_detail_bending_freq=1,b("object",m,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in m||(m.b4w_main_bend_stiffness_col="",b("object",m,"b4w_main_bend_stiffness_col"));"b4w_detail_bend_colors"in m||(m.b4w_detail_bend_colors={leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},b("object",m,"b4w_detail_bend_colors"));"b4w_caustics"in m||(m.b4w_caustics=!1);"vertex_groups"in
m&&m.vertex_groups.length&&m.data&&0==m.data.vertex_groups.length&&(m.data.vertex_groups=m.vertex_groups,delete m.vertex_groups,b("object",m,"vertex_groups"));"b4w_vertex_anim"in m&&m.b4w_vertex_anim.length&&m.data&&0==m.data.b4w_vertex_anim.length&&(m.data.b4w_vertex_anim=m.b4w_vertex_anim,delete m.b4w_vertex_anim,b("object",m,"b4w_vertex_anim"));"b4w_do_not_render"in m||(m.b4w_do_not_render=!1);"use_ghost"in m.game||(m.game.use_ghost=!1);"use_sleep"in m.game||(m.game.use_sleep=!1);"velocity_min"in
m.game||(m.game.velocity_min=0);"velocity_max"in m.game||(m.game.velocity_max=0);"collision_group"in m.game||(m.game.collision_group=1);"collision_mask"in m.game||(m.game.collision_mask=255);"b4w_vehicle_settings"in m?m.b4w_vehicle_settings&&("steering_ratio"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.steering_ratio=10),"steering_max"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.steering_max=1),"inverse_control"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.inverse_control=!1),"force_max"in
m.b4w_vehicle_settings||(m.b4w_vehicle_settings.force_max=1500),"brake_max"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.brake_max=100),"speed_ratio"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.max_speed_angle=Math.PI),"delta_tach_angle"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.suspension_compression=
4.4),"suspension_stiffness"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.roll_influence=.1),"max_suspension_travel_cm"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in m.b4w_vehicle_settings||
(m.b4w_vehicle_settings.floating_factor=3),"floating_factor"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.water_rot_damp=.9)):(m.b4w_vehicle_settings=null,b("object",m,"b4w_vehicle_settings"));"b4w_floating_settings"in m?m.b4w_floating_settings&&("floating_factor"in m.b4w_floating_settings||(m.b4w_floating_settings.floating_factor=
3),"water_lin_damp"in m.b4w_floating_settings||(m.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in m.b4w_floating_settings||(m.b4w_floating_settings.water_rot_damp=.8)):(m.b4w_floating_settings=null,b("object",m,"b4w_floating_settings"));"b4w_character_settings"in m?m.b4w_character_settings&&("walk_speed"in m.b4w_character_settings||(m.b4w_character_settings.walk_speed=4),"run_speed"in m.b4w_character_settings||(m.b4w_character_settings.run_speed=8),"step_height"in m.b4w_character_settings||
(m.b4w_character_settings.step_height=.25),"jump_strength"in m.b4w_character_settings||(m.b4w_character_settings.jump_strength=5),"waterline"in m.b4w_character_settings||(m.b4w_character_settings.waterline=0)):(m.b4w_character_settings=null,b("object",m,"b4w_character_settings"));"b4w_selectable"in m||(m.b4w_selectable=!1,b("object",m,"b4w_selectable"));"b4w_outlining"in m||(m.b4w_outlining=!1,b("object",m,"b4w_outlining"));"b4w_outline_on_select"in m||(m.b4w_outline_on_select=!1,b("object",m,"b4w_outline_on_select"));
"b4w_billboard"in m||(m.b4w_billboard=!1,b("object",m,"b4w_billboard"));"b4w_billboard_geometry"in m||(m.b4w_billboard_geometry="SPHERICAL",b("object",m,"b4w_billboard_geometry"));"b4w_pres_glob_orientation"in m||(m.b4w_pres_glob_orientation=!1,b("object",m,"b4w_pres_glob_orientation"));"b4w_outline_settings"in m||("b4w_glow_settings"in m?m.b4w_outline_settings=m.b4w_glow_settings:(m.b4w_outline_settings={},m.b4w_outline_settings.outline_duration=1,m.b4w_outline_settings.outline_period=1,m.b4w_outline_settings.outline_relapses=
0),b("object",m,"b4w_outline_settings"));"b4w_lod_transition"in m||(m.b4w_lod_transition=.01,b("object",m,"b4w_lod_transition"));"lod_levels"in m||(m.lod_levels=[],b("object",m,"lod_levels"));"b4w_animation_mixing"in m||(m.b4w_animation_mixing=!1,b("object",m,"b4w_animation_mixing"));break;case "EMPTY":"b4w_anchor"in m||(m.b4w_anchor=null,b("object",m,"b4w_anchor")),!m.b4w_anchor||"max_width"in m.b4w_anchor||(m.b4w_anchor.max_width=250)}"collision_margin"in m.game||(m.game.collision_margin=.04,b("object",
m,"collision_margin"));"b4w_anim_behavior"in m||(m.b4w_anim_behavior=m.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",b("object",m,"b4w_anim_behavior"));if(!("rotation_quaternion"in m)){f=[0,0,0,1];k.euler_to_quat(m.rotation_euler,f);var d=f,l=f[0],p=f[1],q=f[2];d[0]=f[3];d[1]=l;d[2]=p;d[3]=q;m.rotation_quaternion=f;b("object",m,"rotation_quaternion")}"webgl_do_not_batch"in m&&(m.b4w_do_not_batch=m.webgl_do_not_batch)&&e("object",m,"webgl_do_not_batch");"b4w_shadow_cast_only"in m||(m.b4w_shadow_cast_only=
!1,b("object",m,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in m||(m.b4w_correct_bounding_offset="AUTO",b("object",m,"b4w_correct_bounding_offset"));d=m.particle_systems;for(f=0;f<d.length;f++)l=d[f],p=l.settings,"use_rotation_dupli"in p||(p.use_rotation_dupli=!1,b("object",p,"use_rotation_dupli")),"use_whole_group"in p||(p.use_whole_group=!1,b("object",p,"use_whole_group")),l.transforms||(l.transforms=new Float32Array,b("particle_system",l,"transforms")),"b4w_billboard_align"in p||(p.b4w_billboard_align=
"VIEW",b("particle_settings",p,"b4w_billboard_align")),"b4w_dynamic_grass"in p||(p.b4w_dynamic_grass=!1,b("object",p,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in p||(p.b4w_dynamic_grass_scale_threshold=.01,b("object",p,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in p||(p.b4w_initial_rand_rotation=!1,b("particle_settings",p,"b4w_initial_rand_rotation")),"b4w_rotation_type"in p||(p.b4w_rotation_type="Z",b("particle_settings",p,"b4w_rotation_type")),"b4w_rand_rotation_strength"in
p||(p.b4w_rand_rotation_strength=1,b("particle_settings",p,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in p||(p.b4w_hair_billboard=!1,b("particle_settings",p,"b4w_hair_billboard")),"b4w_hair_billboard_type"in p||(p.b4w_hair_billboard_type="BASIC",b("particle_settings",p,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in p||(p.b4w_hair_billboard_jitter_amp=0,b("particle_settings",p,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in p||(p.b4w_hair_billboard_jitter_freq=
0,b("particle_settings",p,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in p||(p.b4w_hair_billboard_geometry="SPHERICAL",b("particle_settings",p,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in p||(p.b4w_wind_bend_inheritance="PARENT",b("particle_settings",p,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in p||(p.b4w_shadow_inheritance="PARENT",b("particle_settings",p,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in p||(p.b4w_reflection_inheritance="PARENT",
b("particle_settings",p,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in p||(p.b4w_vcol_from_name="",b("particle_settings",p,"b4w_vcol_from_name")),"b4w_vcol_to_name"in p||(p.b4w_vcol_to_name="",b("particle_settings",p,"b4w_vcol_to_name")),"b4w_coordinate_system"in p||(p.b4w_coordinate_system="LOCAL",b("particle_settings",p,"b4w_coordinate_system")),"b4w_allow_nla"in p||(p.b4w_allow_nla=!0,b("particle_settings",p,"b4w_allow_nla")),"b4w_enable_soft_particles"in p||(p.b4w_enable_soft_particles=
!1,b("particle_settings",p,"b4w_enable_soft_particles")),"b4w_particles_softness"in p||(p.b4w_particles_softness=1,b("particle_settings",p,"b4w_particles_softness"));"constraints"in m||(m.constraints=[],b("object",m,"constraints"));d=m.modifiers;for(f=0;f<d.length;f++){a:{l=d[f];switch(l.type){case "ARRAY":if(!("fit_type"in l)){g.error("WARNING Incomplete modifier "+String(l.type)+' for "'+m.name+'", reexport "'+a.b4w_filepath_blend+'" scene');l=!1;break a}}l=!0}l||(d.splice(f,1),f--)}"animation_data"in
m||(m.animation_data={action:null,nla_tracks:[]},b("object",m,"animation_data"));m.animation_data&&("action"in m.animation_data||(m.animation_data.action=null,g.warn("no action in animation data "+m.name)),"nla_tracks"in m.animation_data||(m.animation_data.nla_tracks=[],g.warn("no NLA in animation data "+m.name)),c(m.animation_data));"b4w_collision_id"in m||(m.b4w_collision_id="",b("material",m,"b4w_collision_id"));(0>m.scale[0]||0>m.scale[1]||0>m.scale[2])&&g.warn('negative scale for object "'+m.name+
'", can lead to some errors');d=m.scale;0==d[0]&&0==d[1]&&0==d[2]?f=!0:(f=Math.abs((d[0]-d[1])/d[0]),d=Math.abs((d[1]-d[2])/d[1]),f=.005>f&&.005>d);f||g.warn("non-uniform scale for object "+m.name)}for(var u in D)n=D[u],f=u.match(/.*?(?=>>|$)/i)[0],g.warn('Property "'+String(f)+'" is '+n.report_type+' for "'+n.type+'". To fix this, reexport '+a.b4w_filepath_blend)};a.check_anim_fcurve_completeness=function(a,b){"num_channels"in a||(a.num_channels=1,g.warn('B4W Warning: no channels number in animation fcurve for "'+
b.name+'" action, reexport scene'))};a.apply_mesh_modifiers=function(a){var b;a:{b=a.modifiers;for(var c=0;c<b.length;c++){var e=b[c].type;if("ARRAY"==e||"CURVE"==e){b=!0;break a}}b=!1}if(!b)return null;b=d(a.data,a.data.name+"_MOD");a=a.modifiers;for(c=0;c<a.length;c++){var g=a[c];switch(g.type){case "ARRAY":for(var e=b,m=g,t=0,y=0,v=0,L=new Float32Array(16),g=[],N=1;N<m.count;N++){m.use_constant_offset&&(t+=m.constant_offset_displace[0],y+=m.constant_offset_displace[1],v+=m.constant_offset_displace[2]);
if(m.use_relative_offset)var B=e.b4w_bounding_box,t=t+(B.max_x-B.min_x)*m.relative_offset_displace[0],y=y+(B.max_y-B.min_y)*m.relative_offset_displace[1],v=v+(B.max_z-B.min_z)*m.relative_offset_displace[2];k.trans_matrix(t,y,v,L);for(var O=B=d(e),F=L,C=0;C<O.submeshes.length;C++){var K=O.submeshes[C];k.positions_multiply_matrix(K.position,F,K.position,0);k.vectors_multiply_matrix(K.normal,F,K.normal,0);k.tangents_multiply_matrix(K.tangent,F,K.tangent,0)}g.push(B)}for(N=0;N<g.length;N++)for(m=e,t=
g[N],y=0;y<m.submeshes.length;y++){v=m.submeshes[y];L=t.submeshes[y];B=v.base_length;O=v.indices.length;v.base_length+=L.base_length;for(var D in v)if("base_length"!=D)if("indices"==D)for(v[D]=k.uint32_concat(v[D],L[D]),F=O;F<v.indices.length;F++)v.indices[F]+=B;else"vertex_colors"!=D&&(v[D]=k.float32_concat(v[D],L[D]))}break;case "CURVE":for(var e=b,N=n.create_spline(g.object),m=new Float32Array(16),y=N.is_3d?4:3,t=new Float32Array(y),y=new Float32Array(y),v=new Float32Array(3),L=new Float32Array(4),
B=new Float32Array(4),O=new Float32Array(3),F=new Float32Array(3),C=new Float32Array(3),K=new Float32Array(4),G=new Float32Array(4),z=0;z<e.submeshes.length;z++){var Y=e.submeshes[z],U=Y.position,P=Y.normal,Y=Y.tangent,da;a:switch(da=g.deform_axis,da){case "POS_X":case "NEG_X":da=0;break a;case "POS_Y":case "NEG_Y":da=1;break a;case "POS_Z":case "NEG_Z":da=2;break a;default:throw"Wrong deform axis value "+da;}O[0]=0;O[1]=0;O[2]=0;O[da]=1;for(var fa=n.spline_length(N),aa=0;aa<U.length/3;aa++){C[0]=
U[3*aa];C[1]=U[3*aa+1];C[2]=U[3*aa+2];var W=C[da],T=n.spline_len_to_t(N,W);n.spline_point(N,T,t);v[0]=t[0];v[1]=t[1];v[2]=t[2];n.spline_derivative(N,T,y);F[0]=y[0];F[1]=0;F[2]=y[2];f.normalize(F,F);u.rotationTo(O,F,L);0>W?(t[0]=F[0],t[1]=F[1],t[2]=F[2],f.scale(t,W,t),f.add(v,t,v)):W>fa&&(t[0]=F[0],t[1]=F[1],t[2]=F[2],f.scale(t,W-fa,t),f.add(v,t,v));q.fromRotationTranslation(L,v,m);N.is_3d&&(u.setAxisAngle(O,t[3],B),f.transformQuat(C,B,C));C[da]=0;f.transformMat4(C,m,C);U[3*aa]=C[0];U[3*aa+1]=C[1];
U[3*aa+2]=C[2];P.length&&(K[0]=P[3*aa],K[1]=P[3*aa+1],K[2]=P[3*aa+2],K[3]=0,p.transformMat4(K,m,K),P[3*aa]=K[0],P[3*aa+1]=K[1],P[3*aa+2]=K[2]);Y.length&&(G[0]=Y[3*aa],G[1]=Y[3*aa+1],G[2]=Y[3*aa+2],G[3]=0,p.transformMat4(G,m,G),Y[3*aa]=G[0],Y[3*aa+1]=G[1],Y[3*aa+2]=G[2])}}}l.recalculate_mesh_boundings(b)}return b};a.create_material=function(a){return{name:a,uuid:k.gen_uuid(),use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,
fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,
b4w_collision_id:"",b4w_double_sided_lighting:!1,b4w_water_enable_caust:!1,b4w_water_caust_scale:.25,b4w_water_caust_brightness:.5,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}};a.assign_logic_nodes_object_params=
function(a,b){for(var c=b.b4w_logic_nodes,d=0;d<c.length;d++)for(var e=c[d],f=0;f<e.length;f++){var k=e[f],l={register1:"variable1",register2:"variable2",registerd:"variabled"},n;for(n in l)n in k&&(k[l[n]]=k[n]);switch(k.type){case "SELECT":for(l=0;l<a.length;l++){var p=a[l];p.name==k.object&&(p.b4w_selectable=!0)}k.bools||(k.bools={});k.bools.not_wait||(k.bools.not_wait=!1);break;case "SWITCH_SELECT":for(var q in k.objects_paths){var p=k.objects_paths[q],u=p[0];if(1<p.length)for(l=1;l<p.length;l++)u+=
"*"+p[l];for(l=0;l<a.length;l++)p=a[l],p.name==u&&(p.b4w_selectable=!0)}break;case "SELECT_PLAY":g.warn('Logic nodes type "SELECT_PLAY" is deprecated, node will be muted. To fix this, reexport scene "'+b.name+'"');k.mute=!0;break;case "SHOW":case "HIDE":case "PLAY_ANIM":case "SET_SHADER_NODE_PARAM":case "INHERIT_MAT":for(q in k.objects_paths){p=k.objects_paths[q];u=p[0];if(1<p.length)for(l=1;l<p.length;l++)u+="*"+p[l];for(l=0;l<a.length;l++)p=a[l],p.name==u&&(p.b4w_do_not_batch=!0)}break;case "PLAY":b.b4w_use_nla=
!0}}}};b4w.module.__scenegraph=function(a,t){function v(a){a=ha.copy_object_props_by_value(a);a.framebuffer=null;a.color_attachment=null;a.depth_attachment=null;return a}function c(a,c){var d=[];H.traverse_edges(a,function(b,c,e){-1<d.indexOf(e)?H.replace_edge_attr(a,b,c,e,r(e)):d.push(e)});H.traverse(a,function(b,e){for(var f=0;f<e.slinks_internal.length;f++){var k=e.slinks_internal[f];c||"MAIN_PLANE_REFLECT"!=e.type&&"MAIN_CUBE_REFLECT"!=e.type&&"MAIN_XRAY"!=e.type||(k.use_renderbuffer=!0);-1<d.indexOf(k)?
e.slinks_internal[f]=r(k):d.push(k)}"ANTIALIASING"==e.type&&H.traverse_inputs(a,b,function(a,b,c){if("MOTION_BLUR"==b.type)for(a=0;a<b.slinks_internal.length;a++)c=b.slinks_internal[a],c.min_filter=ca.TF_LINEAR,c.mag_filter=ca.TF_LINEAR});c||H.traverse_inputs(a,b,function(a,b,c){"DEPTH"==c.from&&(c.use_renderbuffer=!0)})});H.traverse(a,function(c,d){var e={};b(a,c,e);for(var f in e){for(var k=e[f],h=k[0],g=0;g<k.length;g++)if(k[g].min_filter==ca.TF_LINEAR){h=k[g];break}for(var m=k[0],g=0;g<k.length;g++)if(k[g].mag_filter==
ca.TF_LINEAR){m=k[g];break}for(var l=k[0],g=0;g<k.length;g++)if(!k[g].use_renderbuffer){l=k[g];break}for(g=0;g<k.length;g++)k[g].min_filter=h.min_filter,k[g].mag_filter=m.mag_filter,k[g].use_renderbuffer=l.use_renderbuffer}})}function b(a,c,d){H.traverse_inputs(a,c,function(c,e,f){f.active&&f.from==f.to&&(d[f.from]=d[f.from]||[],-1==d[f.from].indexOf(f)&&d[f.from].push(f),b(a,c,d))});H.traverse_outputs(a,c,function(a,b,c){c.active&&(d[c.from]=d[c.from]||[],-1==d[c.from].indexOf(c)&&d[c.from].push(c))});
c=H.get_node_attr(a,c);if("MOTION_BLUR"==c.type)for(var e=0;e<c.slinks_internal.length;e++){var f=c.slinks_internal[e];d[f.from].push(f)}}function e(a){var b=H.topsort(a),c=[];H.traverse(b,function(a,e){switch(e.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_PLANE_REFLECT":var f=[];break;default:f=c}for(var k=0;k<e.slinks_internal.length;k++){var h=e.slinks_internal[k],g=q(f,h,d(h));h.texture=g;e.textures_internal[k]=g}for(k=0;k<e.textures_internal.length;k++)g=
e.textures_internal[k],n(f,g);switch(e.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_PLANE_REFLECT":f=[]}H.traverse_outputs(b,a,function(c,e,k){if(!k.texture){if((c=l(b,a,k.from))&&k.active&&!k.texture){e=f;for(var h=c,g=0;g<e.length;g++){var m=e[g];m.tex===h&&m.ref++}}else c=q(f,k,d(k));k.texture=c}});H.traverse_inputs(b,a,function(a,b,c){n(f,c.texture)});H.traverse_outputs(b,a,function(a,b,c){c.texture&&"NONE"==c.to&&n(f,c.texture)})})}function d(a){a=
Ea.clone_object_json(a);delete a.to;delete a.active;delete a.texture;return JSON.stringify(a)}function l(a,b,c){var d=null;H.traverse_inputs(a,b,function(a,b,e){if(e.active&&e.from==e.to&&e.from==c&&e.texture)return d=e.texture,!0});H.traverse_outputs(a,b,function(a,b,e){if(e.active&&e.from==c&&e.texture)return d=e.texture,!0});return d}function n(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.tex===b&&d.ref&&d.ref--}}function q(a,b,c){for(var d=null,e=0;e<a.length;e++){var f=a[e];if(f.id==c&&0===
f.ref){d=f;break}}if(d&&!sa.macos_tex_reuse_hack)return d.ref++,d.tex;b=g(b);a.push({id:c,ref:1,tex:b});return b}function g(a){var b=a.size_mult*a.size;switch(a.from){case "COLOR":if(a.use_renderbuffer){var c=ca.create_texture("COLOR_RB",a.multisample?ca.TT_RB_RGBA_MS:ca.TT_RB_RGBA);ca.resize(c,b,b)}else c=ca.create_texture("COLOR",ca.TT_RGBA_INT),ca.resize(c,b,b),ca.set_filters(c,a.min_filter,a.mag_filter);return c;case "DEPTH":return a.use_renderbuffer?(c=ca.create_texture("DEPTH_RB",a.multisample?
ca.TT_RB_DEPTH_MS:ca.TT_RB_DEPTH),ca.resize(c,b,b)):(c=ca.create_texture("DEPTH_TEX",ca.TT_DEPTH),ca.resize(c,b,b),ca.set_filters(c,a.min_filter,a.mag_filter)),c;case "CUBEMAP":return c=ca.create_cubemap_texture("CUBEMAP",b);case "SCREEN":return null;default:throw"Wrong slink param: "+a.from;}}function u(a,b){var c=!1;H.traverse_edges(a,function(d,e,f){if(f&&(d=H.get_node_attr(a,d),e=H.get_node_attr(a,e),b(f,!1,d,e)))return c=!0});c||H.traverse(a,function(a,c){for(var d=0;d<c.slinks_internal.length;d++)if(b(c.slinks_internal[d],
!0,c,null))return!0})}function k(a){H.traverse(a,function(b,c){if("SINK"!=c.type){var d=c.camera;H.traverse_outputs(a,b,function(a,b,c){c.active&&c.texture&&(ea.set_attachment(d,c.from,c.texture),c.from==c.to&&b.camera&&ea.set_attachment(b.camera,c.from,c.texture))});for(var e=0;e<c.slinks_internal.length;e++){var f=c.slinks_internal[e];f.active&&f.from==f.to&&ea.set_attachment(d,f.from,c.textures_internal[e])}!d.color_attachment&&!d.depth_attachment||d.framebuffer||(d.framebuffer=oa.render_target_create(d.color_attachment,
d.depth_attachment))}});H.traverse(a,function(b,c){if("RESOLVE"==c.type||"COPY"==c.type){var d=ia(a,c);c.camera.framebuffer_prev=d[0].camera.framebuffer}})}function f(a){var b=null,c=0;H.traverse(a,function(a,d){if(d.type==X.subs_type){if(c==X.subs_number)return b=d,!0;c++}});return b}function p(a,b){var c=H.node_by_attr(a,b),d=E("NONE"),e=H.append_node_attr(a,d),f=H.get_sink_nodes(a)[0];H.traverse_edges(a,function(b,c,d){c==f&&H.reconnect_edges(a,b,f,b,e)});H.traverse_edges(a,function(e,f,k){if(e==
c)return H.append_edge_attr(a,b,d,w(X.slink_type,"u_color",k.size,k.size_mult,k.update_dim)),!0});H.append_edge(a,e,f,w("SCREEN","NONE",.5,.5,!0))}function K(a,b,c){var d=["SHADOW_CAST","GRASS_MAP","MAIN_PLANE_REFLECT","MAIN_CUBE_REFLECT"],e=c.cameras;b=H.get_sink_nodes(a)[0];var f,k;H.traverse_inputs(a,b,function(b,c,d){if(ua(a,c,"MAIN_OPAQUE"))return f=b,k=c,!0});c=H.subgraph_node_conn(a,f,H.BACKWARD_DIR);var h=[],g=[];c=H.clone(c,function(b){var c;-1<d.indexOf(b.type)?(g.push(b),c=b):(c=x(b),-1<
e.indexOf(b.camera)&&(ea.make_stereo(b.camera,ea.TYPE_STEREO_LEFT),ea.make_stereo(c.camera,ea.TYPE_STEREO_RIGHT),e.push(c.camera)),b=H.node_by_attr(a,b),H.traverse_inputs(a,b,function(a,b,e){-1<d.indexOf(b.type)&&h.push([b,c,e])}));return c},function(a){return r(a,!0)});for(var m=0;m<g.length;m++)H.remove_node(c,H.node_by_attr(c,g[m]));H.cleanup_loose_edges(c);var m=pa(),l=H.append_node_attr(a,m);H.reconnect_edges(a,f,b,l,b);H.append_edge_attr(a,k,m,w("COLOR","u_sampler_left",1,1,!0));H.append_subgraph(c,
a,[H.get_sink_nodes(c)[0],l,w("COLOR","u_sampler_right",1,1,!0)]);for(m=0;m<h.length;m++)H.append_edge_attr(a,h[m][0],h[m][1],h[m][2])}function D(a,b){a.num_lights=b;a.light_directions=new Float32Array(3*b);a.light_positions=new Float32Array(3*b);a.light_color_intensities=new Float32Array(3*b);a.light_factors=new Float32Array(0==b%2?2*b:2*b+2)}function A(a,b,c){var d=h("SHADOW_CAST");d.csm_index=a;d.self_shadow_polygon_offset=b.self_shadow_polygon_offset;switch(b.lamp_type){case "SPOT":case "POINT":d.camera=
ea.create_camera(ea.TYPE_PERSP);ea.set_frustum(d.camera,180*b.spot_size/Math.PI,.1,2*b.distance);break;default:d.camera=ea.create_camera(ea.TYPE_ORTHO_ASYMMETRIC)}D(d,c);return d}function h(a){a={type:a,subtype:"",blend:!1,pack:!1,assign_texture:!1,need_fog_update:!1,debug_render_calls:0,debug_render_time:0,debug_render_time_queries:[],time:0,camera:null,cube_view_matrices:null,cube_cam_frustums:[],bundles:[],slinks_internal:[],textures_internal:[],wind:new Float32Array(3),zsort_eye_last:new Float32Array(3),
grass_map_dim:new Float32Array(3),fog_color_density:new Float32Array(4),fog_params:new Float32Array(4),cube_fog:new Float32Array(16),sky_tex_default_value:0,environment_energy:0,num_lights:0,light_directions:null,light_positions:null,light_color_intensities:null,light_factors:null,horizon_color:new Float32Array(3),zenith_color:new Float32Array(3),sky_tex_fac:new Float32Array(4),sun_intensity:new Float32Array([0,0,0]),sun_direction:new Float32Array(3),sun_quaternion:new Float32Array(4),sky_tex_color:new Float32Array(3),
outline_factor:0,draw_outline_flag:0,is_for_outline:!1,outline_color:new Float32Array(3),water:0,water_params:null,use_shoremap:!1,shoremap_center:new Float32Array(2),shoremap_size:new Float32Array(2),shoremap_tex_size:0,max_shore_dist:0,cam_water_depth:0,water_fog_color_density:null,water_waves_height:0,water_waves_length:0,water_level:0,caustics:!1,caust_scale:0,caust_speed:new Float32Array(2),caust_brightness:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,
spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,sky_color:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,ssao_radius_increase:0,ssao_influence:0,ssao_dist_factor:0,ssao_samples:0,ssao_only:0,ssao_white:0,brightness:0,contrast:0,exposure:0,saturation:0,god_rays_intensity:0,max_ray_length:0,radial_blur_step:0,steps_per_pass:0,csm_index:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,
v_light_tsr:null,p_light_matrix:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,blur_texel_size_mult:0,ext_texel_size_mult:0,mb_decay_threshold:0,mb_factor:0,motion_blur_exp:0,pp_effect:"",jitter_projection_space:new Float32Array(2),small_glow_mask_width:0,large_glow_mask_width:0,small_glow_mask_coeff:0,large_glow_mask_coeff:0,texel_size:new Float32Array(2),texel_mask:new Float32Array(2),do_render:!0,enqueue:!0,clear_color:!0,clear_depth:!0,depth_test:!0,need_perm_uniforms_update:!0,texel_size_multiplier:1};
a.texel_mask[0]=1;a.texel_mask[1]=1;return a}function x(a){var b=Ea.clone_object_r(a);b.camera=v(a.camera);return b}function w(a,b,c,d,e){return{from:a,to:b,size:c,size_mult:d,update_dim:e,active:!0,texture:null,multisample:!1,use_renderbuffer:!1,min_filter:ca.TF_NEAREST,mag_filter:ca.TF_NEAREST}}function r(a,b){if(b){var c=a.texture;a.texture=null}a.texture&&Ea.panic("Failed to clone slink with attached texture");var d=Ea.clone_object_json(a);b&&(a.texture=c,d.texture=c);return d}function m(){var a=
h("GRASS_MAP");a.camera=ea.create_camera(ea.TYPE_ORTHO_ASPECT);return a}function E(a){var b=h("POSTPROCESSING");b.clear_color=!1;b.clear_depth=!1;b.depth_test=!1;b.camera=ea.create_camera(ea.TYPE_NONE);b.pp_effect=a;switch(a){case "NONE":b.texel_mask[0]=1;b.texel_mask[1]=1;break;case "GRAYSCALE":b.texel_mask[0]=1;b.texel_mask[1]=1;break;case "X_BLUR":b.texel_mask[0]=1;b.texel_mask[1]=0;break;case "Y_BLUR":b.texel_mask[0]=0;b.texel_mask[1]=1;break;case "X_GLOW_BLUR":b.texel_mask[0]=1;b.texel_mask[1]=
0;break;case "Y_GLOW_BLUR":b.texel_mask[0]=0;b.texel_mask[1]=1;break;case "X_EXTEND":b.texel_mask[0]=1;b.texel_mask[1]=0;break;case "Y_EXTEND":b.texel_mask[0]=0;b.texel_mask[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}return b}function y(a,b,c){a=h("BLOOM_BLUR");a.clear_color=!1;a.clear_depth=!1;a.depth_test=!1;a.camera=ea.create_camera(ea.TYPE_NONE);a.pp_effect=c;switch(c){case "X_BLUR":a.texel_mask[0]=1;a.texel_mask[1]=0;break;case "Y_BLUR":a.texel_mask[0]=0;a.texel_mask[1]=1;break;
default:throw"Wrong postprocessing effect for bloom blur: "+c;}return a}function M(a,b){var c=h("GLOW_COMBINE");c.clear_color=!1;c.clear_depth=!1;c.depth_test=!1;c.small_glow_mask_coeff=b.glow_params.small_glow_mask_coeff;c.large_glow_mask_coeff=b.glow_params.large_glow_mask_coeff;c.small_glow_mask_width=b.glow_params.small_glow_mask_width;c.large_glow_mask_width=b.glow_params.large_glow_mask_width;c.camera=a;return c}function L(a,b,c,d,e,f,k,g,m){var l=h("MAIN_"+a);if("OPAQUE"===a)l.clear_color=
!0,l.clear_depth=c,l.blend=!1;else if("BLEND"===a)l.clear_color=!1,l.clear_depth=!1,l.blend=!0;else if("XRAY"===a)l.clear_color=!1,l.clear_depth=!0,l.blend=!0;else if("PLANE_REFLECT"===a||"CUBE_REFLECT"===a)l.clear_color=!0,l.clear_depth=!0,l.blend=!1;else if("GLOW"===a)l.clear_color=!0,l.clear_depth=!1,l.blend=!1;else throw"wrong main subscene type";l.blend&&g&&(l.self_shadow_normal_offset=g.self_shadow_normal_offset);l.camera=b;if(a=k.sky_texture_param)l.sky_tex_fac.set([a.blend_factor,a.horizon_factor,
a.zenith_up_factor,a.zenith_down_factor]),l.sky_tex_color.set(a.color),l.sky_tex_default_value=a.default_value;l.horizon_color.set(k.horizon_color);l.zenith_color.set(k.zenith_color);l.environment_energy=k.environment_energy;l.fog_color_density=f.fog_color_density;l.fog_params=f.fog_params;d&&(l.water_params=d,d.fog_color_density&&(l.water_fog_color_density=new Float32Array(d.fog_color_density)),l.water_waves_height=d.waves_height,l.water_waves_length=d.waves_length,l.water_level=d.water_level,d.caustics&&
m&&(l.caustics=!0,l.caust_scale=d.caustic_scale,l.caust_speed.set(d.caustic_speed),l.caust_brightness=d.caustic_brightness),d.shoremap_image&&(l.use_shoremap=!0,f=d.shore_boundings,l.shoremap_center[0]=(f[0]+f[1])/2,l.shoremap_center[1]=(f[2]+f[3])/2,l.shoremap_size[0]=f[0]-f[1],l.shoremap_size[1]=f[2]-f[3],l.shoremap_tex_size=d.shoremap_tex_size,l.max_shore_dist=d.max_shore_dist));D(l,e);return l}function N(){var a=h("RESOLVE");a.camera=ea.create_camera(ea.TYPE_NONE);return a}function B(a,b,c){var d=
h("COLOR_PICKING");b&&(d.type+="_XRAY",d.clear_color=!1,d.clear_depth=!0);d.enqueue=!1;d.camera=a;D(d,c);return d}function O(a){var b=h("WIREFRAME");b.do_render=!1;b.clear_color=!1;b.clear_depth=!1;b.camera=a;return b}function F(a){var b=h("ANCHOR_VISIBILITY");b.clear_color=!0;b.clear_depth=!1;b.camera=a;return b}function C(a,b,c){a=h("DEPTH");a.camera=b;D(a,c);return a}function I(a){var b=h("DEPTH_PACK");b.clear_color=!1;b.clear_depth=!1;b.camera=a;return b}function Q(a,b,c){var d=h("SSAO");d.clear_color=
!1;d.clear_depth=!1;d.depth_test=!1;d.camera=a;d.fog_color_density=b.fog_color_density;d.water_fog_color_density=new Float32Array(b.fog_color_density);d.ssao_radius_increase=c.radius_increase;d.ssao_hemisphere=c.hemisphere;d.ssao_influence=c.influence;d.ssao_dist_factor=c.dist_factor;d.ssao_samples=c.samples;return d}function G(a,b){var c=h("SSAO_BLUR");c.clear_color=!1;c.clear_depth=!1;c.depth_test=!1;c.camera=a;c.ssao_blur_depth=b.blur_depth;c.ssao_blur_discard_value=b.blur_discard_value;return c}
function z(a){var b=h("ANTIALIASING");b.clear_color=!1;b.clear_depth=!1;b.depth_test=!1;b.texel_size_multiplier=1/a.resolution_factor;b.fxaa_quality=a.aa_quality;b.camera=ea.create_camera(ea.TYPE_NONE);return b}function Y(a,b){var c=h(a);c.clear_color="SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==a?!0:!1;c.clear_depth=!1;c.depth_test=!1;c.texel_size_multiplier=1/b.resolution_factor;c.camera=ea.create_camera(ea.TYPE_NONE);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(c.jitter_subsample_ind=
new Float32Array(4));return c}function U(a,b,c,d){var e=h("COMPOSITING");e.clear_color=!1;e.clear_depth=!1;e.depth_test=!1;e.camera=ea.create_camera(ea.TYPE_NONE);e.brightness=a;e.contrast=b;e.exposure=c;e.saturation=d;return e}function P(a,b){var c=h("MOTION_BLUR");c.clear_color=!1;c.clear_depth=!1;c.depth_test=!1;c.camera=ea.create_camera(ea.TYPE_NONE);c.assign_texture=!0;c.mb_decay_threshold=a;c.mb_factor=b;return c}function da(a){var b=h("DOF");b.clear_color=!1;b.clear_depth=!1;b.depth_test=!1;
b.camera=a;b.texel_size_multiplier=b.camera.dof_power;return b}function fa(a,b){var c=h("OUTLINE_MASK");c.depth_test=!1;c.camera=a;D(c,b);return c}function aa(a){var b=h("OUTLINE");va.outlining_overview_mode?b.outline_color.set(va.outline_color):b.outline_color.set(a.outline_color);b.outline_factor=a.outline_factor;b.ext_texel_size_mult=5;b.blur_texel_size_mult=3;b.depth_test=!1;b.camera=ea.create_camera(ea.TYPE_NONE);return b}function W(a,b,c,d,e,f,k){var g=h("GOD_RAYS");g.clear_color=!1;g.clear_depth=
!1;g.depth_test=!1;g.horizon_color=new Float32Array([1,1,1]);g.zenith_color=new Float32Array([1,1,1]);g.environment_energy=1;g.pack=d;g.water=b;g.radial_blur_step=e;g.max_ray_length=c;g.steps_per_pass=k;g.camera=a;D(g,f);return g}function T(a,b){var c=h("GOD_RAYS_COMBINE");c.clear_color=!1;c.clear_depth=!1;c.depth_test=!1;c.camera=ea.create_camera(ea.TYPE_NONE);c.god_rays_intensity=a;D(c,b);return c}function Z(a,b){var c=h("SKY");c.enqueue=!1;c.clear_color=!1;c.clear_depth=!1;c.depth_test=!1;var d=
ea.create_camera(ea.TYPE_NONE);d.width=bb.cubemap_tex_size;d.height=bb.cubemap_tex_size;c.camera=d;c.cube_view_matrices=Ea.generate_cubemap_matrices();D(c,a);c.horizon_color=new Float32Array([1,1,1]);c.zenith_color=new Float32Array([1,1,1]);c.environment_energy=1;c.sky_color.set(b.sky_color);c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=b.mie_brightness;c.spot_brightness=b.spot_brightness;
c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;return c}function ba(){var a=h("COPY");a.clear_color=!1;a.clear_depth=!1;a.camera=ea.create_camera(ea.TYPE_NONE);return a}function pa(){var a=h("ANAGLYPH");a.clear_color=!1;a.clear_depth=!1;a.camera=ea.create_camera(ea.TYPE_NONE);return a}function ga(){var a=
h("LUMINANCE");a.clear_color=!1;a.clear_depth=!1;a.camera=ea.create_camera(ea.TYPE_NONE);return a}function ka(){var a=h("AVERAGE_LUMINANCE");a.clear_color=!1;a.clear_depth=!1;a.camera=ea.create_camera(ea.TYPE_NONE);return a}function J(a,b,c,d){var e=h("LUMINANCE_TRUNCED");e.clear_color=!1;e.clear_depth=!1;e.bloom_key=a;e.bloom_edge_lum=b;e.camera=d;D(e,c);return e}function V(a){var b=h("BLOOM");b.clear_color=!1;b.clear_depth=!1;b.camera=ea.create_camera(ea.TYPE_NONE);b.bloom_blur=a;return b}function S(){var a=
h("SINK");a.enqueue=!1;return a}function R(a,b,c){if(b.type===c)return!0;b=na(a,b);for(var d=0;d<b.length;d++)if(R(a,b[d],c))return!0;return!1}function ua(a,b,c){if(b.type===c)return!0;b=ia(a,b);for(var d=0;d<b.length;d++)if(ua(a,b[d],c))return!0;return!1}function ia(a,b){var c=H.node_by_attr(a,b);if(c==H.NULL_NODE)throw"Subscene not in graph";for(var d=[],e=H.in_edge_count(a,c),f=0;f<e;f++){var k=H.get_in_edge(a,c,f);k!=c&&d.push(H.get_node_attr(a,k))}return d}function na(a,b){var c=H.node_by_attr(a,
b);if(c==H.NULL_NODE)throw"Subscene not in graph";for(var d=[],e=H.out_edge_count(a,c),f=0;f<e;f++){var k=H.get_out_edge(a,c,f);k!=c&&d.push(H.get_node_attr(a,k))}return d}function ja(a){var b=[],c=[];u(a,function(a,d,e,f){a.texture&&-1==b.indexOf(a.texture)&&(b.push(a.texture),c.push(a.texture,b.length-1))});return c}function ta(a,b,c,d){b=""+(a.from+"\\n");b+="NONE"!=a.to?a.to+"\\n":"";b+="(";a.update_dim?(c=a.size_mult,Math.round(c)!=c&&(c=c.toFixed(2)),c=(1==c?"":c)+"S",b+=c+"x"+c):b+=a.size+
"x"+a.size;if("SCREEN"!=a.from){b+=" ";if(a.use_renderbuffer)b+="RR";else{c=a.min_filter;var e=a.mag_filter,f="";c==ca.TF_LINEAR?f+="L":c==ca.TF_NEAREST&&(f+="N");e==ca.TF_LINEAR?f+="L":e==ca.TF_NEAREST&&(f+="N");b+=f}for(c=0;c<d.length;c+=2)d[c]==a.texture&&(b+=" "+d[c+1])}return b+")\\n"}var ea=t("__camera"),qa=t("__config"),Aa=t("__debug"),H=t("__graph"),ha=t("__obj_util"),oa=t("__renderer"),ca=t("__textures"),xa=t("__tsr"),Ea=t("__util"),X=qa.debug_subs,sa=qa.defaults,va=qa.outlining,bb=qa.scenes;
a.check_slink_tex_conn=function(a){switch(a.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "OFFSCREEN":case "RESOLVE":case "COPY":case "NONE":return!1;default:return!0}};a.traverse_slinks=u;a.create_rendering_graph=function(a,b,d){var h=H.create(),g=[],l=[],n=[],q=[],oa=[],x=[],u=[],t=[],va=a.lamps_number,R=a.water_params,ja=a.shore_smoothing,D=a.soft_particles,qa=a.ssao,ua=a.god_rays,Gc=a.materials_params,ta=a.reflection_params,pa=a.bloom_params,ha=a.motion_blur,Zc=a.compositing,
oc=a.antialiasing,qb=a.world_light_set,Qa=a.world_fog_set,cb=a.shadow_params,wc=a.mb_params,$b=a.cc_params,xc=a.god_rays_params,ed=a.outline_params,Pc=a.dof,Hc=a.depth_tex,kd=a.refractions,db=Boolean(d.length),vb=1<sa.msaa_samples,Ib=w("COLOR","COLOR",1,1,!0),ab=w("DEPTH","DEPTH",1,1,!0);if(vb){r(ab);var Mb=r(ab);Ib.multisample=!0;Ib.use_renderbuffer=!0;ab.multisample=!0;ab.use_renderbuffer=!0}var Ka=b.cameras[0];if(cb){ea.update_camera_shadows(Ka,cb);for(var yc=cb.csm_num,Ya=0;Ya<yc;Ya++){var wb=
A(Ya,cb,va);H.append_node_attr(h,wb);n.push(wb);var Ra=cb.csm_resolution,Ba=wb.camera;b.shadow_cameras.push(Ba);Ba.width=Ra;Ba.height=Ra;wb.clear_color=!1;q.push(w("DEPTH","u_shadow_map"+Ya,Ra,1,!1));(Aa.check_depth_only_issue()||sa.firefox_shadows_slink_hack)&&wb.slinks_internal.push(w("COLOR","COLOR",Ra,1,!1))}}if(ta&&ta.num_cube_refl&&!db)for(Ya=0;Ya<ta.num_cube_refl;Ya++){Ba=ea.create_camera(ea.TYPE_PERSP);Ba.width=a.cubemap_refl_size;Ba.height=a.cubemap_refl_size;ea.set_frustum(Ba,90,.1,100);
ea.set_projection(Ba,Ba.aspect);var Ma=L("CUBE_REFLECT",Ba,!1,R,va,Qa,qb,null,a.sun_exist);Ma.cube_view_matrices=Ea.generate_inv_cubemap_matrices();for(var Fa=0;6>Fa;Fa++)Ma.cube_cam_frustums.push(ea.create_frustum_planes());H.append_node_attr(h,Ma);var za=w("CUBEMAP","u_cube_reflection",a.cubemap_refl_size,1,!1);za.min_filter=ca.TF_LINEAR;za.mag_filter=ca.TF_LINEAR;var Nb=w("DEPTH","DEPTH",a.cubemap_refl_size,1,!1);t.push(za);Ma.slinks_internal.push(Nb);u.push(Ma);ta.cube_refl_subs.push(Ma)}if(ta&&
0<ta.refl_plane_objs.length&&!db)for(Fa=0;Fa<ta.refl_plane_objs.length;Fa++){var Ba=v(Ka),zc=ta.refl_plane_objs[Fa];xa.get_trans_view(zc.render.world_tsr);xa.get_quat_view(zc.render.world_tsr);Ba.reflection_plane=new Float32Array(4);b.cameras.push(Ba);Ma=L("PLANE_REFLECT",Ba,!1,R,va,Qa,qb,null,a.sun_exist);H.append_node_attr(h,Ma);za=w("COLOR","u_plane_reflection",1,a.plane_refl_size,!0);za.min_filter=ca.TF_LINEAR;za.mag_filter=ca.TF_LINEAR;Nb=w("DEPTH","DEPTH",1,a.plane_refl_size,!0);x.push(za);
Ma.slinks_internal.push(Nb);oa.push(Ma);ta.plane_refl_subs.push(Ma)}if(a.dynamic_grass){var Xa=m();H.append_node_attr(h,Xa);Ra=bb.grass_tex_size;Xa.camera.width=Ra;Xa.camera.height=Ra;var jb=w("DEPTH","u_grass_map_depth",Ra,1,!1);jb.min_filter=ca.TF_LINEAR;jb.mag_filter=ca.TF_LINEAR;var Ab=w("COLOR","u_grass_map_color",Ra,1,!1);Ab.min_filter=ca.TF_LINEAR;Ab.mag_filter=ca.TF_LINEAR}else Ab=jb=Xa=null;if(Hc&&cb){var sc=v(Ka);b.cameras.push(sc);var eb=C(h,sc,va);H.append_node_attr(h,eb);eb.self_shadow_normal_offset=
cb.self_shadow_normal_offset;for(Ya=0;Ya<n.length;Ya++)wb=n[Ya],H.append_edge_attr(h,wb,eb,q[Ya]);var tc=w("COLOR","u_color",1,1,!0),Ac=w("DEPTH","u_depth",1,1,!0);if(qa){var Eb=v(Ka);b.cameras.push(Eb);var Xb=a.ssao_params,Yb=Q(Eb,Qa,Xb);H.append_node_attr(h,Yb);var Ic=w("COLOR","u_ssao_mask",1,1,!0);H.append_edge_attr(h,eb,Yb,tc);H.append_edge_attr(h,eb,Yb,Ac);var Bb=v(Ka);b.cameras.push(Bb);var Fb=G(Bb,Xb);H.append_node_attr(h,Fb);var Sa=w("COLOR","u_shadow_mask",1,1,!0);H.append_edge_attr(h,Yb,
Fb,Ic);H.append_edge_attr(h,eb,Fb,Ac)}vb&&eb.slinks_internal.push(w("DEPTH","DEPTH",1,1,!0));Xa&&(H.append_edge_attr(h,Xa,eb,jb),H.append_edge_attr(h,Xa,eb,Ab))}else eb=null;var Ha=L("OPAQUE",Ka,vb||!eb||sa.arch_mesa_clear_depth_hack,R,va,Qa,qb,null,a.sun_exist);H.append_node_attr(h,Ha);if(vb){var Za=N();H.append_node_attr(h,Za);l.push(Za);var ac=w("COLOR","RESOLVE",1,1,!0);ac.multisample=!0;ac.use_renderbuffer=!0;var kc=w("DEPTH","RESOLVE",1,1,!0);kc.multisample=!0;kc.use_renderbuffer=!0;H.append_edge_attr(h,
Ha,Za,ac);H.append_edge_attr(h,Ha,Za,kc);eb&&(Ic?H.append_edge_attr(h,Fb,Ha,Sa):cb?H.append_edge_attr(h,eb,Ha,w("COLOR","u_shadow_mask",1,1,!0)):Ea.panic("Internal error"))}else l.push(Ha),eb&&(H.append_edge_attr(h,eb,Ha,ab),Ic?H.append_edge_attr(h,Fb,Ha,Sa):cb?H.append_edge_attr(h,eb,Ha,w("COLOR","u_shadow_mask",1,1,!0)):Ea.panic("Internal error"));Xa&&(H.append_edge_attr(h,Xa,Ha,jb),H.append_edge_attr(h,Xa,Ha,Ab));if(oa.length)for(var Jb=oa.length,Fa=0;Fa<Jb;Fa++)H.append_edge_attr(h,oa[Fa],Ha,
x[Fa]);if(u.length)for(Fa=0;Fa<u.length;Fa++)H.append_edge_attr(h,u[Fa],Ha,t[Fa]);g=l;l=[];if(!db&&a.color_picking){Ba=v(Ka);b.cameras.push(Ba);var Cb=B(Ba,!1,va);H.append_node_attr(h,Cb);if(a.xray){Ba=v(Ka);b.cameras.push(Ba);var rb=B(Ba,!0,va);H.append_node_attr(h,rb);var Bc=w("COLOR","COLOR",1,1,!0);H.append_edge_attr(h,Cb,rb,Bc);var Ob=w("DEPTH","DEPTH",1,1,!0);H.append_edge_attr(h,Cb,rb,Ob)}}else Cb=null;if(Gc.refractions&&!db)if(vb)lc=Za;else{var lc=ba();H.append_node_attr(h,lc);var Jc=w("COLOR",
"COPY",1,1,!0);H.append_edge_attr(h,g[0],lc,Jc)}else lc=null;if(Hc&&(Gc.refractions&&kd||ja||D)){var Db=v(Ka);b.cameras.push(Db);var kb=I(Db);H.append_node_attr(h,kb);var La=w("DEPTH","u_depth",1,1,!0);H.append_edge_attr(h,vb?Za:Ha,kb,La);var Ua=w("COLOR","u_scene_depth",1,1,!0);Ua.min_filter=ca.TF_NEAREST;Ua.mag_filter=ca.TF_NEAREST}else kb=null;var hb=function(c){var d=v(Ka);b.cameras.push(d);d=L(c,d,!1,R,va,Qa,qb,cb,a.sun_exist);H.append_node_attr(h,d);var e=vb&&"RESOLVE"==g[0].type?Ha:g[0];H.append_edge_attr(h,
e,d,Ib);"XRAY"==c?(c=w("DEPTH","DEPTH",1,1,!0),vb&&(c.multisample=!0,c.use_renderbuffer=!0),d.slinks_internal.push(c)):H.append_edge_attr(h,e,d,ab);Xa&&(H.append_edge_attr(h,Xa,d,jb),H.append_edge_attr(h,Xa,d,Ab));for(c=0;c<n.length;c++)H.append_edge_attr(h,n[c],d,q[c]);kb&&H.append_edge_attr(h,kb,d,Ua);if(oa.length)for(e=oa.length,c=0;c<e;c++)H.append_edge_attr(h,oa[c],d,x[c]);if(u.length)for(c=0;c<u.length;c++)H.append_edge_attr(h,u[c],d,t[c]);lc&&(c=w("COLOR","u_refractmap",1,1,!0),H.append_edge_attr(h,
lc,d,c));return d};if(a.glow_over_blend){var Va=hb("BLEND");l.push(Va);g=l;l=[]}if(a.glow_materials){var Pb=v(Ka);b.cameras.push(Pb);var Ca=L("GLOW",Pb,!1,R,va,Qa,qb);H.append_node_attr(h,Ca);H.append_edge_attr(h,vb?Za:Ha,Ca,vb?Mb:ab);var Ta=E("X_GLOW_BLUR");Ta.subtype="GLOW_MASK_SMALL";Ta.texel_size_multiplier=a.glow_params.small_glow_mask_width;var ob=w("COLOR","u_color",1,1,!0);ob.min_filter=ca.TF_LINEAR;ob.mag_filter=ca.TF_LINEAR;H.append_node_attr(h,Ta);H.append_edge_attr(h,Ca,Ta,ob);var lb=
E("Y_GLOW_BLUR");lb.subtype="GLOW_MASK_SMALL";lb.texel_size_multiplier=a.glow_params.small_glow_mask_width;var Ia=w("COLOR","u_color",1,.5,!0);Ia.min_filter=ca.TF_LINEAR;Ia.mag_filter=ca.TF_LINEAR;H.append_node_attr(h,lb);H.append_edge_attr(h,Ta,lb,Ia);var Qb=E("X_GLOW_BLUR");Qb.subtype="GLOW_MASK_LARGE";Qb.texel_size_multiplier=a.glow_params.large_glow_mask_width;var pc=w("COLOR","u_color",1,.5,!0);pc.min_filter=ca.TF_LINEAR;pc.mag_filter=ca.TF_LINEAR;H.append_node_attr(h,Qb);H.append_edge_attr(h,
lb,Qb,pc);var mb=E("Y_GLOW_BLUR");mb.subtype="GLOW_MASK_LARGE";mb.texel_size_multiplier=a.glow_params.large_glow_mask_width;var bc=w("COLOR","u_color",1,.25,!0);bc.min_filter=ca.TF_LINEAR;bc.mag_filter=ca.TF_LINEAR;H.append_node_attr(h,mb);H.append_edge_attr(h,Qb,mb,bc);var qc=v(Ka);b.cameras.push(qc);var nb=M(qc,a);H.append_node_attr(h,nb);var Zb=w("COLOR","u_src_color",1,1,!0);if(a.glow_over_blend)if(vb){var Wa=N();H.append_node_attr(h,Wa);H.append_edge_attr(h,Va,Wa,ac);H.append_edge_attr(h,Va,
Wa,kc);H.append_edge_attr(h,Wa,nb,Zb)}else H.append_edge_attr(h,Va,nb,Zb);else H.append_edge_attr(h,vb?Za:Ha,nb,Zb);H.append_edge_attr(h,a.glow_over_blend?Va:Ha,nb,ab);var ib=w("COLOR","u_glow_mask_small",1,.5,!0);ib.min_filter=ca.TF_LINEAR;ib.mag_filter=ca.TF_LINEAR;H.append_edge_attr(h,lb,nb,ib);var pb=w("COLOR","u_glow_mask_large",1,.25,!0);pb.min_filter=ca.TF_LINEAR;pb.mag_filter=ca.TF_LINEAR;H.append_edge_attr(h,mb,nb,pb);g=[nb];l=[]}a.glow_over_blend||(Va=hb("BLEND"),l.push(Va),g=l,l=[]);if(a.xray){var uc=
hb("XRAY");l.push(uc);g=l;l=[]}if(sa.wireframe_debug){Ba=v(Ka);b.cameras.push(Ba);var Gb=O(Ba);l.push(Gb);H.append_node_attr(h,Gb);H.append_edge_attr(h,g[0],Gb,Ib);H.append_edge_attr(h,g[0],Gb,ab);Xa&&(H.append_edge_attr(h,Xa,Gb,jb),H.append_edge_attr(h,Xa,Gb,Ab));g=l;l=[]}if(vb){var cc=N();H.append_node_attr(h,cc);l.push(cc);H.append_edge_attr(h,g[0],cc,ac);H.append_edge_attr(h,g[0],cc,kc);g=l;l=[]}var Rb=g.slice(0);if(!db&&a.anchor_visibility){Ba=v(Ka);b.cameras.push(Ba);var Kb=F(Ba);H.append_node_attr(h,
Kb);H.append_edge_attr(h,g[0],Kb,vb?Mb:ab)}if(ua&&Hc&&!db){var xb=xc.max_ray_length,dc=xc.intensity,Na=xc.steps_per_pass,Ja=g[0],ec=R?1:0,Lb=w("DEPTH","u_input",1,1,!0);Lb.min_filter=ca.TF_LINEAR;Lb.mag_filter=ca.TF_LINEAR;var yb=w("COLOR","u_input",1,.25,!0);yb.min_filter=ca.TF_LINEAR;yb.mag_filter=ca.TF_LINEAR;var fc=xb/Na,Kc=v(Ka);b.cameras.push(Kc);var Sb=W(Kc,ec,xb,!0,fc,va,Na);H.append_node_attr(h,Sb);H.append_edge_attr(h,Ja,Sb,Lb);var fc=xb/Na*.5,rc=v(Ka);b.cameras.push(rc);var mc=W(rc,ec,
xb,!1,fc,va,Na);H.append_node_attr(h,mc);H.append_edge_attr(h,Sb,mc,yb);var fc=xb/Na*.25,Cc=v(Ka);b.cameras.push(Cc);var Dc=W(Cc,ec,xb,!1,fc,va,Na);H.append_node_attr(h,Dc);H.append_edge_attr(h,mc,Dc,yb);var Tb=T(dc,va);l.push(Tb);H.append_node_attr(h,Tb);H.append_edge_attr(h,Ja,Tb,w("COLOR","u_main",1,1,!0));H.append_edge_attr(h,Dc,Tb,w("COLOR","u_god_rays",1,1,!0));g=l;l=[]}if(pa&&!db){var Ja=g[0],$a=ga();H.append_node_attr(h,$a);H.append_edge_attr(h,Ja,$a,w("COLOR","u_input",1,1,!0));var Oa=ka();
H.append_node_attr(h,Oa);Oa.camera.width=sa.edge_min_tex_size_hack?2:1;Oa.camera.height=sa.edge_min_tex_size_hack?2:1;var Lc=w("COLOR","u_input",1,.25,!0);Lc.min_filter=ca.TF_LINEAR;Lc.mag_filter=ca.TF_LINEAR;var Ub=w("COLOR","u_luminance",1,.25,!0);Ub.min_filter=ca.TF_LINEAR;Ub.mag_filter=ca.TF_LINEAR;H.append_edge_attr(h,$a,Oa,Lc);var Mc=pa.key,$c=pa.edge_lum,Qc=v(Ka);b.cameras.push(Qc);var Rc=J(Mc,$c,va,Qc);H.append_node_attr(h,Rc);H.append_edge_attr(h,Ja,Rc,w("COLOR","u_main",1,1,!0));H.append_edge_attr(h,
$a,Rc,Ub);H.append_edge_attr(h,Oa,Rc,w("COLOR","u_average_lum",1,1,!1));var nc=w("COLOR","u_color",1,.25,!0);nc.min_filter=ca.TF_LINEAR;nc.mag_filter=ca.TF_LINEAR;Ta=y(h,$a,"X_BLUR",!0);H.append_node_attr(h,Ta);H.append_edge_attr(h,Rc,Ta,nc);lb=y(h,Ta,"Y_BLUR",!0);H.append_node_attr(h,lb);H.append_edge_attr(h,Ta,lb,nc);var Vb=V(pa.blur);H.append_node_attr(h,Vb);var fd=w("COLOR","u_bloom",1,.25,!0);fd.min_filter=ca.TF_LINEAR;fd.mag_filter=ca.TF_LINEAR;H.append_edge_attr(h,lb,Vb,fd);H.append_edge_attr(h,
Ja,Vb,w("COLOR","u_main",1,1,!0));l.push(Vb);g=l;l=[]}if(ha&&!db){var ld=g[0],Nc=P(wc.mb_decay_threshold,wc.mb_factor);l.push(Nc);H.append_node_attr(h,Nc);var rd=w("COLOR","u_mb_tex_curr",1,1,!0);H.append_edge_attr(h,ld,Nc,rd);var md=w("COLOR","u_mb_tex_accum",1,1,!0);Nc.slinks_internal.push(md);g=l;l=[]}if(Pc&&Hc&&!db){var Ja=g[0],gc=v(Ka);b.cameras.push(gc);nc=w("COLOR","u_color",1,1,!0);nc.min_filter=ca.TF_LINEAR;nc.mag_filter=ca.TF_LINEAR;var hc=E("X_BLUR");H.append_node_attr(h,hc);H.append_edge_attr(h,
Ja,hc,nc);var vc=E("Y_BLUR");H.append_node_attr(h,vc);H.append_edge_attr(h,hc,vc,nc);var nd=Rb[0],Sc=da(gc);gc.dof_distance=b.dof_distance;gc.dof_object=b.dof_object;gc.dof_front=b.dof_front;gc.dof_rear=b.dof_rear;gc.dof_power=b.dof_power;gc.dof_on=1;l.push(Sc);H.append_node_attr(h,Sc);H.append_edge_attr(h,Ja,Sc,w("COLOR","u_sharp",1,1,!0));H.append_edge_attr(h,vc,Sc,w("COLOR","u_blurred",1,1,!0));H.append_edge_attr(h,nd,Sc,w("DEPTH","u_depth",1,1,!0));g=l;l=[]}if(!db&&a.outline){var Ja=g[0],gd=v(Ka);
b.cameras.push(gd);var sb=fa(gd,va);H.append_node_attr(h,sb);var ad=E("X_EXTEND"),Oc=w("COLOR","u_color",1,1,!0),sd=w("COLOR","u_outline_mask",1,1,!0);ad.is_for_outline=!0;H.append_node_attr(h,ad);H.append_edge_attr(h,sb,ad,Oc);var Tc=w("COLOR","u_color",1,.5,!0);Tc.min_filter=ca.TF_LINEAR;Tc.mag_filter=ca.TF_LINEAR;var Uc=E("Y_EXTEND");Uc.is_for_outline=!0;H.append_node_attr(h,Uc);H.append_edge_attr(h,ad,Uc,Tc);hc=E("X_BLUR");hc.is_for_outline=!0;H.append_node_attr(h,hc);H.append_edge_attr(h,Uc,
hc,Tc);var Ec=w("COLOR","u_color",1,.25,!0);Ec.min_filter=ca.TF_LINEAR;Ec.mag_filter=ca.TF_LINEAR;var hd=w("COLOR","u_outline_mask_blurred",1,.25,!0);hd.min_filter=ca.TF_LINEAR;hd.mag_filter=ca.TF_LINEAR;vc=E("Y_BLUR");vc.is_for_outline=!0;H.append_node_attr(h,vc);H.append_edge_attr(h,hc,vc,Ec);var Vc=aa(ed);H.append_node_attr(h,Vc);H.append_edge_attr(h,Ja,Vc,w("COLOR","u_outline_src",1,1,!0));H.append_edge_attr(h,sb,Vc,sd);H.append_edge_attr(h,vc,Vc,hd);l.push(Vc);g=l;l=[]}if(Zc&&!db){var Ja=g[0],
bd=U($b.brightness,$b.contrast,$b.exposure,$b.saturation);H.append_node_attr(h,bd);H.append_edge_attr(h,Ja,bd,w("COLOR","u_color",1,1,!0));l.push(bd);g=l;l=[]}if(oc){Ja=g[0];if(sa.smaa){var Wc=w("COLOR","u_color",1,1,!0);Wc.min_filter=ca.TF_LINEAR;Wc.mag_filter=ca.TF_LINEAR;var cd=Y("SMAA_EDGE_DETECTION",a);H.append_node_attr(h,cd);H.append_edge_attr(h,Ja,cd,Wc);var od=Y("SMAA_BLENDING_WEIGHT_CALCULATION",a);H.append_node_attr(h,od);H.append_edge_attr(h,cd,od,Wc);var ud=w("COLOR","u_search_tex",1,
1,!1),vd=w("COLOR","u_area_tex",1,1,!1);ud.min_filter=ca.TF_LINEAR;ud.mag_filter=ca.TF_LINEAR;vd.min_filter=ca.TF_LINEAR;vd.mag_filter=ca.TF_LINEAR;od.slinks_internal.push(ud);od.slinks_internal.push(vd);var td=Y("SMAA_NEIGHBORHOOD_BLENDING",a);H.append_node_attr(h,td);H.append_edge_attr(h,Ja,td,Wc);var wd=w("COLOR","u_blend",1,1,!0);wd.min_filter=ca.TF_LINEAR;wd.mag_filter=ca.TF_LINEAR;H.append_edge_attr(h,od,td,wd);l.push(td)}else{var xd=z(a);H.append_node_attr(h,xd);var yd=w("COLOR","u_color",
1,1,!0);yd.min_filter=ca.TF_LINEAR;yd.mag_filter=ca.TF_LINEAR;H.append_edge_attr(h,Ja,xd,yd);l.push(xd)}g=l;l=[]}l.push(g[0]);var Gd=H.node_by_attr(h,g[0]);if("MOTION_BLUR"==g[0].type||"RESOLVE"==g[0].type)var zd=!0;else zd=!1,H.traverse_inputs(h,Gd,function(a,b,c){if(c.from==c.to)return zd=!0});if(zd){var Ad=E("NONE");H.append_node_attr(h,Ad);H.append_edge_attr(h,g[0],Ad,w("COLOR","u_color",1,1,!0));g=l;l=[];l.push(Ad)}Cb&&(rb?l.push(rb):l.push(Cb));Kb&&l.push(Kb);if(!db&&a.sky_params.procedural_skydome){var Cd=
Z(va,a.sky_params);H.append_node_attr(h,Cd);l.push(Cd)}var Xc=S();H.append_node_attr(h,Xc);for(Ya=0;Ya<l.length;Ya++){var pd=l[Ya];switch(pd.type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":H.append_edge_attr(h,pd,Xc,w("COLOR","NONE",1,1,!0));H.append_edge_attr(h,pd,Xc,w("DEPTH","NONE",1,1,!0));break;case "SKY":var Hd=w("CUBEMAP","u_sky",bb.cubemap_tex_size,1,!1);H.append_edge_attr(h,pd,Xc,Hd);break;case "ANCHOR_VISIBILITY":var Id=w("COLOR","NONE",1,1,!0);H.append_edge_attr(h,pd,Xc,Id);break;
default:if(db){var Dd=d[0]._render,qd=w("COLOR","OFFSCREEN",1,1,!0);qd.texture=Dd;H.append_edge_attr(h,l[Ya],Xc,qd);for(Fa=1;Fa<d.length;Fa++){var Ed=d[Fa]._render,Bd=ba();H.append_node_attr(h,Bd);var Jd=w("COLOR","COPY",1,1,!0);H.append_edge_attr(h,l[Ya],Bd,Jd);qd=w("COLOR","OFFSCREEN",1,Ed.source_size/Dd.source_size,!0);qd.texture=Ed;H.append_edge_attr(h,Bd,Xc,qd)}}else H.append_edge_attr(h,l[Ya],Xc,w("SCREEN","NONE",1,1,!0))}}Za&&!na(h,Za).length&&(H.remove_node(h,H.node_by_attr(h,Za)),H.cleanup_loose_edges(h));
a.anaglyph_use&&!db&&K(h,a,b);if(X.enabled){var Fd=f(h);Fd&&p(h,Fd)}c(h,Hc);e(h);k(h);cb&&H.traverse(h,function(a,b){if("DEPTH"==b.type||"MAIN_BLEND"==b.type||"MAIN_XRAY"==b.type)for(var c=0,d=ia(h,b),e=0;e<d.length;e++){var f=d[e];"SHADOW_CAST"==f.type&&(f=f.camera,b.perspective_cast_far_bound=f.far/(f.far-f.near),b.v_light_tsr=f.view_tsr,b.p_light_matrix=b.p_light_matrix||[],b.p_light_matrix[c]=f.proj_matrix,c++)}});return h};a.init_subs=h;a.set_texel_size=function(a,b,c){var d=a.texel_size_multiplier;
a.texel_size[0]=b*a.texel_mask[0]*d;a.texel_size[1]=c*a.texel_mask[1]*d};a.set_texel_size_mult=function(a,b){a.texel_size_multiplier=b};a.find_on_screen=function(a){var b=null;H.traverse(a,function(a,c){return c.camera&&null===c.camera.framebuffer?(b=c,!0):!1});return b};a.find_input=function(a,b,c){a=ia(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.has_lower_subs=R;a.has_upper_subs=ua;a.get_inputs=ia;a.get_outputs=na;a.find_subs=function(a,b){var c=null;H.traverse(a,function(a,
d){return d.type==b?(c=d,!0):!1});return c};a.debug_convert_to_dot=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=ja(a);H.traverse(a,function(a,d){var e=b+="    ",f="",f=d.type.replace(/_/g," ");"POSTPROCESSING"==d.type&&(f+=" ("+d.pp_effect.replace(/_/g," ")+")");if(d.camera){for(var f=f+"\\n",h=0;h<c.length;h+=2){var k=d.camera.color_attachment;c[h]==k&&(f=ca.is_renderbuffer(k)?
f+("CR"+c[h+1]+" "):f+("C"+c[h+1]+" "))}for(h=0;h<c.length;h+=2)k=d.camera.depth_attachment,c[h]==k&&(f=ca.is_renderbuffer(k)?f+("DR"+c[h+1]):f+("D"+c[h+1]))}d.slinks_internal.length&&(f+="\\n-----\\n");for(h=0;h<d.slinks_internal.length;h++)f+=ta(d.slinks_internal[h],a,null,c);h="SINK"==d.type?"dotted":d.enqueue?"solid":"dashed";b=e+(String(a)+' [label="'+f+'" color="black" style="'+(h+",bold")+'"];\n')});H.traverse_edges(a,function(a,d,e){var f=b+="    ",h=ta(e,a,d,c);b=f+(String(a)+" -> "+String(d)+
' [label="'+h+'" style="'+(e.active?"solid":"dotted")+'"];\n')});return b+="}"};a.create_rendering_queue=function(a){a=H.topsort_attr(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.enqueue&&b.push(d)}return b}};b4w.module.__textures=function(a,t){function v(){return{name:"",type:0,source:"",source_id:"",width:0,height:0,compress_ratio:1,allow_node_dds:!0,source_size:1024,enable_canvas_mipmapping:!1,canvas_context:null,w_target:0,w_texture:null,w_renderbuffer:null,is_movie:!1,vtex_data_id:-1,video_file:null,movie_length:0,fps:0,frame_start:0,frame_offset:0,frame_duration:0,need_resize:!1,scale_fac:1,seq_video:null,seq_movie_length:0,seq_fps:0,seq_cur_frame:-1,seq_video_played:!1,seq_last_discrete_mark:-1,
video_was_stopped:!1,use_auto_refresh:!1,use_cyclic:!1,use_nla:!1,repeat:!0}}function c(c,d,e,f){var h=c.type,k=new Uint8Array([204,204,204,255]),g=v();switch(h){case "DATA_TEX2D":case "IMAGE":var l=z.createTexture(),m=z.TEXTURE_2D;z.bindTexture(m,l);z.texImage2D(m,0,z.RGBA,1,1,0,z.RGBA,z.UNSIGNED_BYTE,k);c.image&&"MOVIE"==c.image.source&&(g.is_movie=!0,g.frame_start=c.frame_start,g.frame_offset=c.frame_offset,g.frame_duration=c.frame_duration,g.use_auto_refresh=c.use_auto_refresh,g.use_cyclic=c.use_cyclic,
g.movie_length=c.movie_length,g.use_nla=c.b4w_nla_video,0!=g.frame_offset&&y.warn('Frame offset for texture "'+c.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":l=z.createTexture();m=z.TEXTURE_2D;z.bindTexture(m,l);if("NONE"==c.b4w_source_type)return null;if("SCENE"==c.b4w_source_type)if(c.b4w_source_id&&(e=L.keysearch("name",c.b4w_source_id,e)))g.source_size=c.b4w_source_size,e._render_to_textures=e._render_to_textures||[],e._render_to_textures.push(c),
z.texImage2D(m,0,z.RGBA,1,1,0,z.RGBA,z.UNSIGNED_BYTE,k);else return null;break;case "ENVIRONMENT_MAP":l=z.createTexture();m=z.TEXTURE_CUBE_MAP;z.bindTexture(m,l);e="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var n=0;6>n;n++)z.texImage2D(z["TEXTURE_CUBE_MAP_"+e[n]],0,z.RGBA,1,1,0,z.RGBA,z.UNSIGNED_BYTE,k);break;case "BLEND":return null;default:return y.error('texture "'+c.name+'" has unsupported type "'+h+'"'),null}"NONE"==h&&(!c.b4w_enable_canvas_mipmapping||
"CANVAS"!=c.b4w_source_type)||"DATA_TEX2D"==h||"IMAGE"==h&&"MOVIE"==c.image.source?z.texParameteri(m,z.TEXTURE_MIN_FILTER,z.LINEAR):z.texParameteri(m,z.TEXTURE_MIN_FILTER,Y[B.texture_min_filter]);z.texParameteri(m,z.TEXTURE_MAG_FILTER,z.LINEAR);k=m;e=c.b4w_anisotropic_filtering;"DEFAULT"===e&&(e=d);"OFF"!==e&&B.anisotropic_filtering&&(d=E.get_aniso())&&(e=parseFloat(e.split("x")[0]),z.texParameterf(k,d.TEXTURE_MAX_ANISOTROPY_EXT,e));"REPEAT"!=c.extension||c.b4w_shore_dist_map?(g.repeat=!1,z.texParameteri(m,
z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE),z.texParameteri(m,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE)):(z.texParameteri(m,z.TEXTURE_WRAP_S,z.REPEAT),z.texParameteri(m,z.TEXTURE_WRAP_T,z.REPEAT));g.type=a.TT_RGBA_INT;g.width=1;g.height=1;g.w_texture=l;g.w_target=m;"CANVAS"==c.b4w_source_type&&"NONE"==h?(h=c.b4w_source_id,l=c.b4w_source_size,g.enable_canvas_mipmapping=c.b4w_enable_canvas_mipmapping,g.source_id=h,g.source="CANVAS",m=document.createElement("canvas"),m.width=l,m.height=l,g.canvas_context=m.getContext("2d"),
f in Q||(Q[f]={}),Q[f][h]=g,b(g)):"SCENE"==c.b4w_source_type&&"NONE"==h?(g.source_id=c.b4w_source_id,g.source="SCENE"):(g.source=h,z.generateMipmap(m),z.bindTexture(m,null));g.name=c.name;return c._render=g}function b(a){if("CANVAS"!=a.source)throw"Wrong texture";var b=a.w_target;z.bindTexture(b,a.w_texture);var c=k(a),d=f(a),e=p(a),h=a.canvas_context.canvas;z.pixelStorei(z.UNPACK_FLIP_Y_WEBGL,!0);z.texImage2D(b,0,d,c,e,h);z.pixelStorei(z.UNPACK_FLIP_Y_WEBGL,!1);a.enable_canvas_mipmapping&&z.generateMipmap(b);
z.bindTexture(b,null);a.width=h.width;a.height=h.height}function e(a){var b=a.w_target;z.bindTexture(b,a.w_texture);z.pixelStorei(z.UNPACK_FLIP_Y_WEBGL,!0);4!=a.video_file.length?a.need_resize?n(a,a.video_file,a.width*a.scale_fac,a.height*a.scale_fac,!1):z.texImage2D(b,0,z.RGBA,z.RGBA,z.UNSIGNED_BYTE,a.video_file):z.texImage2D(b,0,z.RGBA,1,1,0,z.RGBA,z.UNSIGNED_BYTE,a.video_file);z.bindTexture(b,null)}function d(a){var b=a.w_target;z.bindTexture(b,a.w_texture);z.pixelStorei(z.UNPACK_FLIP_Y_WEBGL,
!0);a.need_resize?n(a,a.seq_video[a.seq_cur_frame],a.width*a.scale_fac,a.height*a.scale_fac,!1):z.texImage2D(b,0,z.RGBA,z.RGBA,z.UNSIGNED_BYTE,a.seq_video[a.seq_cur_frame]);z.bindTexture(b,null)}function l(){F||(F=document.createElement("canvas"));return F}function n(a,b,c,d,e){e||(q(z.TEXTURE_2D),z.texImage2D(z.TEXTURE_2D,0,z.RGBA,z.RGBA,z.UNSIGNED_BYTE,b));z.bindTexture(z.TEXTURE_2D,null);N.draw_resized_texture(a,c,d,I,C,"NONE")}function q(a){I||(I=z.createFramebuffer());z.bindTexture(a,null);C||
(C=z.createTexture());z.bindTexture(a,C);z.texParameteri(a,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE);z.texParameteri(a,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE);z.texParameteri(a,z.TEXTURE_MAG_FILTER,z.LINEAR);z.texParameteri(a,z.TEXTURE_MIN_FILTER,z.LINEAR)}function g(a){a.video_file.oncanplay=function(){e(a)}}function u(a){return L.check_npot(a)?(a=Math.pow(2,parseInt(a).toString(2).length),L.clamp(a,2,B.max_texture_size)):a}function k(b){switch(b.type){case a.TT_RGBA_INT:b=z.RGBA;break;case a.TT_RGB_INT:b=z.RGB;
break;case a.TT_RGBA_FLOAT:b=z.RGBA;break;case a.TT_RGB_FLOAT:b=z.RGB;break;case a.TT_DEPTH:b=z.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}function f(b){switch(b.type){case a.TT_RGBA_INT:b=B.webgl2?z.RGBA8:z.RGBA;break;case a.TT_RGB_INT:b=B.webgl2?z.RGB8:z.RGB;break;case a.TT_RGBA_FLOAT:b=B.webgl2?z.RGBA8:z.RGBA;break;case a.TT_RGB_FLOAT:b=B.webgl2?z.RGB8:z.RGB;break;case a.TT_DEPTH:b=B.webgl2?z.DEPTH_COMPONENT24:z.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}
function p(b){switch(b.type){case a.TT_RGBA_INT:b=z.UNSIGNED_BYTE;break;case a.TT_RGB_INT:b=z.UNSIGNED_BYTE;break;case a.TT_RGBA_FLOAT:b=z.FLOAT;break;case a.TT_RGB_FLOAT:b=z.FLOAT;break;case a.TT_DEPTH:b=z.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}function K(a){return a&&a.name&&a.w_renderbuffer?!0:!1}function D(a,b){if(b in G&&a in G[b]){var c=G[b][a];c.video_file?c.video_file.play():c.seq_video&&(c.seq_video_played=!0);return!0}return!1}function A(a,b){if(b in G&&a in G[b]){var c=
G[b][a];c.video_file?c.video_file.pause():c.seq_video&&(c.seq_video_played=!1);return!0}return!1}function h(a,b){if(b in G&&a in G[b]){var c=G[b][a];c.video_file?c.video_file.currentTime=c.frame_offset/c.fps:c.seq_video&&(c.seq_cur_frame=w(c,c.frame_offset),d(c));return!0}return!1}function x(a){return a.video_file?!a.video_file.paused:a.seq_video?a.seq_video_played:!1}function w(a,b){return Math.round(b*a.seq_movie_length/a.movie_length)}var r=t("__config"),m=t("__dds"),E=t("__extensions"),y=t("__print"),
M=t("__time"),L=t("__util"),N=t("__renderer"),B=r.defaults,O=r.sfx,F=null,C=null,I=null;a.TF_NEAREST=0;a.TF_LINEAR=0;a.TF_NEAREST_MIPMAP_NEAREST=0;a.TF_LINEAR_MIPMAP_NEAREST=0;a.TF_NEAREST_MIPMAP_LINEAR=0;a.TF_LINEAR_MIPMAP_LINEAR=0;a.TT_RGBA_INT=10;a.TT_RGB_INT=20;a.TT_RGBA_FLOAT=30;a.TT_RGB_FLOAT=40;a.TT_DEPTH=50;a.TT_RB_RGBA=60;a.TT_RB_DEPTH=70;a.TT_RB_RGBA_MS=80;a.TT_RB_DEPTH_MS=90;var Q={},G={},z=null,Y;a.setup_context=function(b){Y=[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,
b.LINEAR_MIPMAP_LINEAR];a.TF_NEAREST=b.NEAREST;a.TF_LINEAR=b.LINEAR;a.TF_NEAREST_MIPMAP_NEAREST=b.NEAREST_MIPMAP_NEAREST;a.TF_LINEAR_MIPMAP_NEAREST=b.LINEAR_MIPMAP_NEAREST;a.TF_NEAREST_MIPMAP_LINEAR=b.NEAREST_MIPMAP_LINEAR;a.TF_LINEAR_MIPMAP_LINEAR=b.LINEAR_MIPMAP_LINEAR;z=b};a.get_canvas_context=function(a,b){return b in Q&&a in Q[b]?Q[b][a].canvas_context:null};a.update_canvas_context=function(a,c){return c in Q&&a in Q[c]?(b(Q[c][a]),!0):!1};a.create_texture=function(b,c){var d=v();d.name=b;d.type=
c;d.source="NONE";if(c==a.TT_RB_RGBA||c==a.TT_RB_DEPTH||c==a.TT_RB_RGBA_MS||c==a.TT_RB_DEPTH_MS)d.w_renderbuffer=z.createRenderbuffer();else{var e=z.TEXTURE_2D,f=z.createTexture();z.bindTexture(e,f);z.texParameteri(e,z.TEXTURE_MAG_FILTER,z.LINEAR);z.texParameteri(e,z.TEXTURE_MIN_FILTER,z.LINEAR);z.texParameteri(e,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE);z.texParameteri(e,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE);z.bindTexture(e,null);d.w_target=e;d.w_texture=f}return d};a.create_cubemap_texture=function(b,c){var d=
z.createTexture(),e=z.TEXTURE_CUBE_MAP;z.bindTexture(e,d);z.texParameteri(e,z.TEXTURE_MAG_FILTER,z.LINEAR);z.texParameteri(e,z.TEXTURE_MIN_FILTER,z.LINEAR);z.texParameteri(e,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE);z.texParameteri(e,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE);for(var f="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),h=0;6>h;h++)z.texImage2D(z[f[h]],0,z.RGBA,c,c,0,z.RGBA,
z.UNSIGNED_BYTE,null);z.bindTexture(e,null);e=v();e.name=b;e.type=a.TT_RGBA_INT;e.source="NONE";e.width=3*c;e.height=2*c;e.compress_ratio=1;e.w_texture=d;e.w_target=z.TEXTURE_CUBE_MAP;return e};a.set_filters=function(a,b,c){if(!K(a)){var d=a.w_target;z.bindTexture(d,a.w_texture);b&&z.texParameteri(d,z.TEXTURE_MIN_FILTER,b);c&&z.texParameteri(d,z.TEXTURE_MAG_FILTER,c);z.bindTexture(d,null)}};a.get_filters=function(b){if(K(b))return{min:a.TF_NEAREST,mag:a.TF_NEAREST};var c=b.w_target;z.bindTexture(c,
b.w_texture);b=z.getTexParameter(c,z.TEXTURE_MIN_FILTER);var d=z.getTexParameter(c,z.TEXTURE_MAG_FILTER);z.bindTexture(c,null);return{min:b,mag:d}};a.resize=function(b,c,d){c=Math.max(c,B.edge_min_tex_size_hack?2:1);d=Math.max(d,B.edge_min_tex_size_hack?2:1);if(b.width!=c||b.height!=d){switch(b.type){case a.TT_RB_RGBA:z.bindRenderbuffer(z.RENDERBUFFER,b.w_renderbuffer);z.renderbufferStorage(z.RENDERBUFFER,z.RGB565,c,d);z.bindRenderbuffer(z.RENDERBUFFER,null);break;case a.TT_RB_DEPTH:z.bindRenderbuffer(z.RENDERBUFFER,
b.w_renderbuffer);z.renderbufferStorage(z.RENDERBUFFER,z.DEPTH_COMPONENT16,c,d);z.bindRenderbuffer(z.RENDERBUFFER,null);break;case a.TT_RB_RGBA_MS:z.bindRenderbuffer(z.RENDERBUFFER,b.w_renderbuffer);z.renderbufferStorageMultisample(z.RENDERBUFFER,B.msaa_samples,z.RGBA8,c,d);z.bindRenderbuffer(z.RENDERBUFFER,null);break;case a.TT_RB_DEPTH_MS:z.bindRenderbuffer(z.RENDERBUFFER,b.w_renderbuffer);z.renderbufferStorageMultisample(z.RENDERBUFFER,B.msaa_samples,z.DEPTH_COMPONENT24,c,d);z.bindRenderbuffer(z.RENDERBUFFER,
null);break;default:var e=b.w_target;z.bindTexture(e,b.w_texture);var h=k(b),g=f(b),l=p(b);z.texImage2D(e,0,g,c,d,0,h,l,null);z.bindTexture(e,null)}c>B.max_texture_size||d>B.max_texture_size?y.error('Slink texture "'+b.name+'" has unsupported size: '+c+"x"+d+". Max available: "+B.max_texture_size+"x"+B.max_texture_size+"."):(b.width=c,b.height=d)}};a.create_texture_bpy=c;a.update_video_texture=e;a.update_seq_video_texture=d;a.update_texture=function(a,b,c,d,e){var f=a.source,h=a.w_texture,k=a.w_target,
r=1,p=1;z.bindTexture(k,h);if(4==b.length){var x=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==f)if(x)z.texImage2D(k,0,z.RGBA,1,1,0,z.RGBA,z.UNSIGNED_BYTE,b),a.width=1,a.height=1;else if(c){p=m.get_width_height(b);x=L.check_npot(p.width)||L.check_npot(p.height);if(p.width>B.max_texture_size||p.height>B.max_texture_size){y.error('Texture "'+d+'" has unsupported size: '+p.width+"x"+p.height+". Max available: "+B.max_texture_size+"x"+B.max_texture_size+".");return}r=p.width;
p=p.height;x&&(a.need_resize=!0,q(k),r=u(r*a.scale_fac),p=u(p*a.scale_fac));m.upload_dds_levels(z,E.get_s3tc(),b,!0);a.need_resize&&(n(a,null,r,p,!0),z.bindTexture(k,h),z.generateMipmap(k));a.width=r;a.height=p;a.compress_ratio=m.get_compress_ratio(b)}else{z.pixelStorei(z.UNPACK_FLIP_Y_WEBGL,!0);a.is_movie?B.seq_video_fallback?(r=b[0].width,p=b[0].height):(r=b.videoWidth,p=b.videoHeight):(r=b.width,p=b.height);a.width=r;a.height=p;if(r>B.max_texture_size||r>B.max_texture_size)y.warn('Texture "'+d+
'" has unsupported size: '+r+"x"+p+". Max available: "+B.max_texture_size+"x"+B.max_texture_size+". Reduced image size will be used."),a.scale_fac=Math.min(B.max_texture_size/r,B.max_texture_size/p),a.need_resize=!0;a.is_movie&&(B.seq_video_fallback?(e in G||(G[e]={}),G[e][a.name]=a,a.seq_video=b,a.seq_movie_length=b.length,a.fps=a.seq_fps*a.movie_length/b.length,b=b[0]):(e in G||(G[e]={}),G[e][a.name]=a,a.video_file=b,a.video_file.loop=a.use_cyclic,a.fps=b.duration?a.movie_length/b.duration:M.get_framerate(),
O.disable_playback_rate_hack||(b.playbackRate=M.get_framerate()/a.fps,O.clamp_playback_rate_hack&&2<b.playbackRate&&(b.playbackRate=2)),g(a)));r=u(a.width*a.scale_fac);p=u(a.height*a.scale_fac);a.need_resize?(d=l(),h=d.getContext("2d"),d.width=r,d.height=p,h.drawImage(b,0,0,a.width,a.height,0,0,r,p),z.texImage2D(k,0,z.RGBA,z.RGBA,z.UNSIGNED_BYTE,d)):L.check_npot(a.width)||L.check_npot(a.height)?(n(a,b,r,p,!1),a.need_resize=!0):z.texImage2D(k,0,z.RGBA,z.RGBA,z.UNSIGNED_BYTE,b);h=a.w_texture;z.bindTexture(k,
h);a.is_movie||z.generateMipmap(k);z.bindTexture(k,null);a.width=r;a.height=p}else if("ENVIRONMENT_MAP"==f)if(p=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],x){for(r=0;6>r;r++)z.texImage2D(z["TEXTURE_CUBE_MAP_"+p[r][0]],0,z.RGBA,1,1,0,z.RGBA,z.UNSIGNED_BYTE,b);a.width=3;a.height=2}else{z.pixelStorei(z.UNPACK_FLIP_Y_WEBGL,!1);if(b.width%3||b.height%2){y.error('Cubemap texture "'+d+'" has unsupported size: '+b.width+"x"+b.height+
". The width must be multiple of three and the height - multiple of two.");return}r=b.width/3;if(r>B.max_cube_map_size)y.warn('Cubemap texture "'+d+'" has unsupported size: '+b.width+"x"+b.height+". Max available: "+3*B.max_cube_map_size+"x"+2*B.max_cube_map_size+". Reduced image size will be used."),d=u(B.max_cube_map_size/r*r),a.need_resize=!0;else if(d=u(r),3*d>B.max_texture_size||2*d>B.max_texture_size)a.need_resize=!0;if(a.need_resize||B.resize_cubemap_canvas_hack)for(h=d,x=0;6>x;x++)c=p[x],
e=l(),e.width=h,e.height=h,f=e.getContext("2d"),"POSITIVE_Y"==c[0]||"NEGATIVE_Y"==c[0]?(f.translate(0,h),f.scale(1,-1)):(f.translate(h,0),f.scale(-1,1)),f.drawImage(b,c[1]*r,c[2]*r,r,r,0,0,h,h),z.texImage2D(z["TEXTURE_CUBE_MAP_"+c[0]],0,z.RGBA,z.RGBA,z.UNSIGNED_BYTE,e);else{p=b;b=d;q(z.TEXTURE_2D);z.texImage2D(z.TEXTURE_2D,0,z.RGBA,z.RGBA,z.UNSIGNED_BYTE,p);z.bindTexture(z.TEXTURE_2D,null);for(p=0;6>p;p++)z.texImage2D(z.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,z.RGBA,b,b,0,z.RGBA,z.UNSIGNED_BYTE,null);z.bindTexture(a.w_target,
null);z.bindFramebuffer(z.FRAMEBUFFER,I);for(p=0;6>p;p++)N.draw_resized_cubemap_texture(a,z.TEXTURE_CUBE_MAP_POSITIVE_X+p,b,r,C,p);z.bindFramebuffer(z.FRAMEBUFFER,null);z.bindTexture(a.w_target,a.w_texture);z.texParameteri(a.w_target,z.TEXTURE_MIN_FILTER,Y[B.texture_min_filter]);z.texParameteri(a.w_target,z.TEXTURE_MAG_FILTER,z.LINEAR)}a.width=3*d;a.height=2*d;z.generateMipmap(k)}else"DATA_TEX2D"==f&&(z.texImage2D(k,0,z.RGBA,b.width,b.height,0,z.RGBA,z.UNSIGNED_BYTE,b.data),a.width=b.width,a.height=
b.height);z.bindTexture(k,null)};a.delete_texture=function(a){z.deleteTexture(a)};a.is_texture=function(a){return a&&a.name&&(a.w_texture||a.w_renderbuffer)?!0:!1};a.is_renderbuffer=K;a.is_float=function(b){return b.type==a.TT_RGBA_FLOAT||b.type==a.TT_RGB_FLOAT?!0:!1};a.get_texture_texel_size=function(b){var c=0;switch(b.type){case a.TT_RGBA_INT:case a.TT_RGB_INT:c=4;break;case a.TT_RGBA_FLOAT:case a.TT_RGB_FLOAT:c=16;break;case a.TT_DEPTH:c=3;break;case a.TT_RB_RGBA:case a.TT_RB_DEPTH:c=2;break;
case a.TT_RB_RGBA_MS:c=4*B.msaa_samples;break;case a.TT_RB_DEPTH_MS:c=3*B.msaa_samples}return c};a.generate_texture=function(a,b){var d=null;switch(a){case "SSAO_TEXTURE":d={name:"special_ssao_texture",type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"},c(d,null,b,0),d.image={filepath:null}}return d};a.cleanup=function(){if(!B.seq_video_fallback)for(var a in G)for(var b in G[a])G[a][b].video_file.pause(),G[a][b].video_file.src="",G[a][b].video_file.load();Q={};G={}};a.pause=function(){for(var a in G)for(var b in G[a]){var c=
G[a][b];x(c)&&(A(b,a),c.video_was_stopped=!0)}};a.reset=function(){for(var a in G)for(var b in G[a])h(b,a),G[a][b].video_was_stopped=!1};a.play=function(a){for(var b in G)for(var c in G[b]){var d=G[b][c];if(!a||d.video_was_stopped)D(c,b),d.video_was_stopped=!1}};a.video_allow_nla=function(a,b){return b in G&&a in G[b]?G[b][a].use_nla:!1};a.play_video=D;a.pause_video=A;a.reset_video=h;a.set_frame_video=function(a,b,c){return c in G&&a in G[c]?(a=G[c][a],a.video_file?a.video_file.currentTime=b/a.fps:
a.seq_video&&(a.seq_cur_frame=b,d(a)),!0):!1};a.video_is_played=x;a.video_update_is_available=function(a){return a.video_file||a.seq_video?a.video_file?2<=a.video_file.readyState:!0:0};a.video_get_current_frame=function(a){return a.video_file||a.seq_video?a.video_file?Math.round(a.video_file.currentTime*a.fps):a.seq_cur_frame:0};a.video_get_start_frame=function(a){return a.video_file||a.seq_video?a.video_file?a.frame_offset:w(a,a.frame_offset):0};a.video_get_end_frame=function(a){if(!a.video_file&&
!a.seq_video)return 0;var b=Math.min(a.frame_duration,a.movie_length-a.frame_offset);return a.video_file?a.frame_offset+b:w(a,a.frame_offset+b)};a.seq_video_get_discrete_timemark=function(a,b){return Math.round(b*a.seq_fps*(M.get_framerate()/a.fps))};a.video_get_duration=function(a){return Math.min(a.frame_duration,a.movie_length-a.frame_offset)};a.video_frame_to_seq_frame=w};b4w.module.__assets=function(a,t){function v(){return K.is_built_in_data()?t(K.paths.built_in_data_module).data:null}function c(){var a={_source_url:null,_parse_response:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},
open:function(b,c,d){a._source_url=c;a.readyState=1},send:function(){a.status=404;a.readyState=4;var b=v();b&&a._source_url in b&&(a.status=200,b[a._source_url]&&(a.response=a._parse_response(b[a._source_url])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function b(b){for(var c=0,f=0;f<b.length;f++){var h=b[f];20===h.state&&c++;if(c>=m.max_requests)break;if(10===h.state)switch(h.state=20,c++,h.type){case a.AT_ARRAYBUFFER:e(h,"arraybuffer");break;
case a.AT_JSON:e(h,"json");break;case a.AT_TEXT:e(h,"text");break;case a.AT_AUDIOBUFFER:d(h);break;case a.AT_IMAGE_ELEMENT:l(h);break;case a.AT_AUDIO_ELEMENT:n(h);break;case a.AT_VIDEO_ELEMENT:q(h);break;case a.AT_SEQ_VIDEO_ELEMENT:g(h);break;default:x.panic("Wrong asset type: "+h.type)}}}function e(b,d){var e=v(),f=e&&b.url in e?new c:new XMLHttpRequest;if("GET"==b.request)f.open("GET",b.url,!0);else if("POST"==b.request)switch(f.open("POST",b.url,!0),b.post_type){case a.APT_TEXT:f.setRequestHeader("Content-type",
"text/plain");break;case a.APT_JSON:f.setRequestHeader("Content-type","application/json")}"text"==d?(f.overrideMimeType("text/plain"),f.responseType="text"):"json"==d?(f.overrideMimeType("application/json"),f.responseType="text"):f.responseType=d;f.onreadystatechange=function(){if(40!=b.state&&4==f.readyState){if(200==f.status||0==f.status){var a=f.response;if(a){if("json"==d&&"string"==typeof a)try{a=JSON.parse(a)}catch(c){A.error(c+" (parsing JSON "+b.url+")");b.asset_cb(null,b.id,b.type,b.url,
b.param);return}b.asset_cb(a,b.id,b.type,b.url,b.param)}else A.error("empty responce when trying to get "+b.url),b.asset_cb(null,b.id,b.type,b.url,b.param)}else A.error(f.status+" when trying to get "+b.url),b.asset_cb(null,b.id,b.type,b.url,b.param);b.state=30}};f.addEventListener("progress",function(a){a.lengthComputable&&b.progress_cb(a.loaded/a.total)},!1);f.send(b.post_data)}function d(a){"GET"!=a.request&&x.panic("Unsupported request type for audio buffer");var b=v(),d=b&&a.url in b?new c:new XMLHttpRequest;
d.open("GET",a.url,!0);d.responseType="arraybuffer";d.onreadystatechange=function(){if(40!=a.state&&4==d.readyState)if(200==d.status||0==d.status){var b=d.response;b?h.decode_audio_data(b,function(b){a.asset_cb(b,a.id,a.type,a.url,a.param);a.state=30},function(){a.asset_cb(null,a.id,a.type,a.url,a.param);A.error("failed to decode "+a.url);a.state=30}):(a.asset_cb(null,a.id,a.type,a.url,a.param),A.error("empty responce when trying to get "+a.url),a.state=30)}else a.asset_cb(null,a.id,a.type,a.url,
a.param),A.error(d.status+" when trying to get "+a.url),a.state=30};d.send(a.post_data)}function l(a){"GET"!=a.request&&x.panic("Unsupported request type for image element");var b=document.createElement("img");r.allow_cors&&(b.crossOrigin="Anonymous");b.onload=function(){40!=a.state&&(a.asset_cb(b,a.id,a.type,a.url,a.param),a.state=30)};b.addEventListener("error",function(){40!=a.state&&(a.asset_cb(null,a.id,a.type,a.url,a.param),A.error("could not load image: "+a.url),a.state=30)},!1);var c=v();
if(c&&a.url in c)if(c[a.url]){var d=k(a.url);b.src="data:"+d+";base64,"+c[a.url]}else D.is_ie11()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.url}function n(a){"GET"!=a.request&&x.panic("Unsupported request type for audio element");var b=document.createElement("audio");if(r.allow_cors||r.cors_chrome_hack)b.crossOrigin="Anonymous";b.addEventListener("loadeddata",function(){40!=a.state&&(a.asset_cb(b,a.id,a.type,
a.url,a.param),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.asset_cb(null,a.id,a.type,a.url,a.param),A.error("could not load sound: "+a.url),a.state=30)},!1);var c=v();if(c&&a.url in c)if(c[a.url]){var d=f(a.url);b.src="data:"+d+";base64,"+c[a.url];40!=a.state&&(a.asset_cb(b,a.id,a.type,a.url,a.param),a.state=30)}else D.is_ie11()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.url,r.is_mobile_device&&
b.load();r.mobile_firefox_media_hack&&(b.autoplay=!0,b.pause());setTimeout(function(){b.some_prop_to_prevent_gc=1},5E3)}function q(a){function b(c){40!=a.state&&(a.asset_cb(null,a.id,a.type,a.url),A.error("could not load video: "+a.url,a.param),a.state=30)}"GET"!=a.request&&x.panic("Unsupported request type for video element");var c=document.createElement("video");c.muted=!0;if(r.allow_cors||r.is_mobile_device)c.crossOrigin="Anonymous";c.addEventListener("loadeddata",function(){c.removeEventListener("error",
b,!1);40!=a.state&&(a.asset_cb(c,a.id,a.type,a.url,a.param),a.state=30)},!1);c.addEventListener("error",b,!1);var d=v();if(d&&a.url in d)if(d[a.url]){var e=p(a.url);c.src="data:"+e+";base64,"+d[a.url];40!=a.state&&c.addEventListener("loadeddata",function(){a.asset_cb(c,a.id,a.type,a.url,a.param);a.state=30},!1)}else D.is_ie11()?(d=document.createEvent("CustomEvent"),d.initCustomEvent("error",!1,!1,null)):d=new CustomEvent("error"),c.dispatchEvent(d);else c.src=a.url,r.is_mobile_device&&c.load();r.mobile_firefox_media_hack&&
(c.autoplay=!0,c.pause());setTimeout(function(){c.some_prop_to_prevent_gc=1},1E4)}function g(b){function d(a){b.asset_cb(a,b.id,b.type,b.url,b.param);b.state=30}"GET"!=b.request&&x.panic("Unsupported request type for seq video element");var e=v(),f=e&&b.url in e?new c:new XMLHttpRequest;if(null==b.post_type&&null==b.post_data)f.open("GET",b.url,!0);else switch(f.open("POST",b.url,!0),b.post_type){case a.APT_TEXT:f.setRequestHeader("Content-type","text/plain");break;case a.APT_JSON:f.setRequestHeader("Content-type",
"application/json")}f.responseType="arraybuffer";f.onreadystatechange=function(){if(40!=b.state&&4==f.readyState)if(200==f.status||0==f.status){var a=f.response;a?u(a,d):(b.asset_cb(null,b.id,b.type,b.url,b.param),A.error("empty responce when trying to get "+b.url),b.state=30)}else b.asset_cb(null,b.id,b.type,b.url,b.param),A.error(f.status+" when trying to get "+b.url),b.state=30};f.addEventListener("progress",function(a){a.lengthComputable&&b.progress_cb(a.loaded/a.total)},!1);f.send(b.post_data)}
function u(a,b){for(var c=new Int32Array(a),d=new Int8Array(a),e=c[3],f={images:[],blobs:[],fps:c[4]},h=20,k=0;k<e;k++){var g=c[h/4],l=d.subarray(h+4,h+4+g),l=new Blob([l],{type:"image/jpg"}),m=document.createElement("img");m.src=window.URL.createObjectURL(l);f.images.push(m);f.blobs.push(l);h+=g+8-g%4}m.onload=function(){for(var a=0;a<f.images.length;a++)window.URL.revokeObjectURL(f.images[a].src);delete f.blobs;b(f)}}function k(a){var b="image";switch(x.get_file_extension(a).toLowerCase()){case "jpeg":case "jpg":b+=
"/jpeg";break;case "png":b+="/png"}return b}function f(a){var b="audio";switch(x.get_file_extension(a).toLowerCase()){case "ogv":case "ogg":b+="/ogg";break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}function p(a){var b="video";switch(x.get_file_extension(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+="/webm";break;case "m4v":b+="/mp4"}return b}var K=t("__config"),D=t("__compat"),A=t("__print"),h=t("__sfx"),x=t("__util"),w=t("__version"),
r=K.defaults,m=K.assets;a.AT_ARRAYBUFFER=10;a.AT_JSON=20;a.AT_TEXT=30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;a.AT_VIDEO_ELEMENT=70;a.AT_SEQ_VIDEO_ELEMENT=80;a.APT_JSON=a.AT_JSON;a.APT_TEXT=a.AT_TEXT;var E=[],y=0,M={};a.split_extension=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.get_text_sync=function(a){if(M[a])return M[a];var b=m.prevent_caching?a+w.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");
c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=c.responseText;if(b.length)return M[a]=b;x.panic("Error XHR: responce is empty, GET "+a)}else x.panic("Error XHR: "+c.status+", GET "+a)};a.cleanup=function(){for(var a=0;a<E.length;a++)E[a].state=40;E=[];y=0;M={}};a.enqueue=function(a,c,d,e){for(var f=0;f<a.length;f++){var h=a[f],h={id:h.id,type:h.type,url:h.url,request:h.request?h.request:"GET",post_type:h.post_type?h.post_type:null,post_data:h.post_data?h.post_data:null,param:h.param?
h.param:null,state:10,asset_cb:c||function(){},pack_cb:d||function(){},progress_cb:e||function(){},pack_index:y};if(m.prevent_caching){var k=v();k&&h.url in k||(h.url+=w.timestamp())}E.push(h)}b(E);y++};a.update=function(){b(E);for(var a=E,c=0,d=!0,e=0;e<a.length;e++){var f=a[e];f.pack_index===a[c].pack_index?30!==f.state&&(d=!1):(d&&(a[e-1].pack_cb(),d=e-c,a.splice(c,d),e-=d),c=e,d=30===a[e].state?!0:!1);e===a.length-1&&d&&(a[e].pack_cb(),a.splice(c))}}};b4w.module.__loader=function(a,t){function v(b,d,e,k){var g=h,l=K.create(),n;for(n in d){var q=c(d[n]);(k&&q.is_resource||!b&&q.primary_only)&&f(q);K.append_node_attr(l,q)}for(n in d)for(q=d[n],q.name=n,b=0;b<q.inputs.length;b++)K.append_edge_attr(l,d[q.inputs[b]],q,null);d=c({name:"out",priority:a.FINISH_PRIORITY,cb_before:function(a,b,c,d,e,f){b.is_primary&&(g.start_secondary_threads=!0);p(b)||(b.status=2);b.loaded_cb(b.id,!0);e(b,c);D.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")},relative_size:5});
if(e)e=K.get_sink_nodes(l);else{n=K.clone(l);do{e=K.get_sink_nodes(n);q=[];for(b=0;b<e.length;b++){k=e[b];var u=K.get_node_attr(n,k);u.background_loading&&q.push(k)}for(b=0;b<q.length;b++)K.remove_node(n,q[b]);q.length&&K.cleanup_loose_edges(n)}while(q.length)}K.append_node_attr(l,d);for(b=0;b<e.length;b++)k=e[b],u=K.get_node_attr(l,k),d.inputs.push(u.name),K.append_edge_attr(l,u,d,null);return l}function c(a){a.background_loading=a.background_loading||!1;a.priority||0===a.priority||(a.priority=a.SYNC_PRIORITY);
a.inputs=a.inputs||[];a.is_finished=a.is_finished||!1;a.skip=a.skip||!1;a.relative_size=a.relative_size||0;a.is_resource=a.is_resource||!1;a.primary_only=a.primary_only||!1;a.status=0;a.loop_index=0;a.load_rate=0;a.cb_param=a.cb_param||null;return a}function b(a,b,c){b.complete_load_cb(c,b);b.status=3;a.active_threads--;b.stageload_cb=null;b.complete_load_cb=null;b.stage_graph=null;b.stages_queue=null}function e(a,b){for(var c=[],d=[],e=0;e<b.length;e++){var f=b[e];K.get_node_attr(a.stage_graph,f).is_finished&&
(K.traverse_outputs(a.stage_graph,f,function(d,e,f){var h=!0;K.traverse_inputs(a.stage_graph,d,function(a,b,c){if(!b.is_finished)return h=!1,1});h&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(e))}for(e=d.length-1;0<=e;e--)b.splice(d[e],1);return c}function d(a){var b=[],c=a.stages_queue,d=!1;do{var f=e(a,c);b.push.apply(b,c);0<f.length&&(d=!0);c=f}while(0<f.length);c=function(b,c){var d=K.get_node_attr(a.stage_graph,b),e=K.get_node_attr(a.stage_graph,c),f=e.priority-d.priority;0==f&&(f=
d.background_loading-e.background_loading);return f};d&&b.sort(c);a.stages_queue=b;return a.stages_queue.length}function l(a,b,c){if(b.skip)return b.is_finished=!0,q(a,b),!1;if(!b.cb_before&&!b.cb_loop&&!b.cb_after)return q(a,b),!1;if(0==b.status&&(b.status++,b.cb_before))return b.cb_before(c,a,b,b.cb_param,q,g),!0;if(1==b.status){if(b.cb_loop)return b.cb_loop(c,a,b,b.cb_param,q,g),!0;b.status++}return 2==b.status&&(b.status++,b.cb_after)?(b.cb_after(c,a,b,b.cb_param,q,g),!0):!1}function n(a){if(0==
a.stages_size_total)return 100;var b=0;K.traverse(a.stage_graph,function(c,d){a.do_not_load_resources&&d.is_resource||(b+=d.load_rate*d.relative_size)});return A.trunc(100*b/a.stages_size_total)}function q(a,b){b.is_finished=!0;b.status=3;u(a,b,1)}function g(a,b,c){1>c?u(a,b,c):b.status++}function u(a,b,c){var d=h;if(b.cb_before||b.cb_loop||b.cb_after)if(b.load_rate=c,b=n(a),a.curr_percents!=b||1==c)a.stageload_cb(b,performance.now()-a.time_load_start),a.curr_percents=b,d.make_idle_iteration=!0}function k(a,
b){var c=null;K.traverse(a.stage_graph,function(a,d){if(d.name==b)return c=d,1});return c}function f(a){a.skip=!0;a.load_rate=1}function p(a){return a&&(3==a.status||4==a.status)}var K=t("__graph"),D=t("__print"),A=t("__util");a.SYNC_PRIORITY=0;a.ASYNC_PRIORITY=1;a.FINISH_PRIORITY=2;var h=null;a.get_scheduler=function(){return h};a.create_scheduler=function(){var a={threads:[],current_thread_index:0,active_threads:0,start_secondary_threads:!1,make_idle_iteration:!1};return h=a};a.create_thread=function(a,
b,c,d,e,f,k,g){var l=h,n=l.threads.length,p={id:n,is_primary:0==n,status:0,filepath:b,binary_name:"",loaded_cb:c||function(){},load_hidden:g||!1,wait_complete_loading:f,time_load_start:0,curr_percents:0,stages_size_total:0,reset_time_cycle:!1,stageload_cb:d||function(){},complete_load_cb:e||function(){},stage_graph:null,stages_queue:null,has_video_textures:!1,has_background_music:!1,init_wa_context:!1};a=v(p.is_primary,a,f,k);p.stage_graph=a;b=[];c=K.get_source_nodes(a);for(d=0;d<c.length;d++)b.push(c[d]);
p.stages_queue=b;K.traverse(a,function(a,b){if(b.cb_before||b.cb_loop||b.cb_after)p.do_not_load_resources&&b.is_resource||(p.stages_size_total+=b.relative_size)});l.threads.push(p);l.active_threads++;return p.id};a.update_scheduler=function(c){var e=h,f;(f=!e)||(f=0==h.active_threads);if(!f)if(e.make_idle_iteration)e.make_idle_iteration=!1;else{f=performance.now();do{var k=e.threads[e.current_thread_index],g=c[k.id];if(!p(k))if(0==k.status&&(k.status=1,k.time_load_start=performance.now(),k.stageload_cb(0,
0)),d(k)){var n=k,q=n.stages_queue.length;do{var u=K.get_node_attr(n.stage_graph,n.stages_queue[0]),t=l(n,u,g);u.priority==a.ASYNC_PRIORITY&&(n.reset_time_cycle=!0);u=n.stages_queue.shift();n.stages_queue.push(u);q--}while(!t&&0!=q)}else b(e,k,g);e.start_secondary_threads&&(e.current_thread_index=(e.current_thread_index+1)%e.threads.length);if(k.reset_time_cycle){k.reset_time_cycle=!1;break}}while(16>performance.now()-f)}};a.abort_thread=function(a){var c=h;b(c,a,null);a.status=4;a.is_primary&&(c.start_secondary_threads=
!0);a.loaded_cb(a.id,!1)};a.stage_part_finish_cb=g;a.skip_stage_by_name=function(a,b){var c=k(a,b);null!==c&&f(c)};a.thread_is_finished=p;a.is_primary_loaded=function(a){var b=h;if(!b)return!1;a|=0;return b.threads[a]&&(3==b.threads[a].status||2==b.threads[a].status)};a.graph_to_dot=function(a){D.error("Debug mode isn't enabled. Can not retrieve the graph.")};a.cleanup=function(){h=null}};b4w.module.__logic_nodes=function(a,t){function v(a,b,c,d,e,f){switch(b.state){case 1:n.error("Unknown node type: "+a.type);break;case 2:c.curr_node=a.slot_idx_order}}function c(a){var b=g.get("url_params");if(b&&a in b)return Number(b[a]);b=location.href.toString();if(-1==b.indexOf("?"))return 0;for(var b=b.split("?")[1].split("&"),c=0;c<b.length;c++){var d=b[c].split("=");if(1<d.length&&d[0]==a)return Number(d[1])}return 0}function b(a){return d.get_object(d.GET_OBJECT_BY_DUPLI_NAME_LIST,a.dupli_name_list,
0)}function e(a,b){var c=a.b4w_logic_nodes,d=b.logic_threads;b.state=1;for(var e=0;e<c.length;e++){var f={nodes:[],thread_state:{scene:a,curr_node:0,in_progress:!1,thread_index:e,variables:{R1:0,R2:0,R3:0,R4:0,R5:0,R6:0,R7:0,R8:0}}};d.push(f);for(var h=d[d.length-1],k=c[e],g=0;g<k.length;g++){var l=k[g],l={type:l.type,label:l.label,slot_idx_order:l.slot_idx_order,slot_idx_jump:l.slot_idx_jump,frame_start:l.frame_range[0],frame_end:l.frame_range[1],frame_start_mask:l.frame_range_mask?l.frame_range_mask[0]:
!0,frame_end_mask:l.frame_range_mask?l.frame_range_mask[1]:!0,state:-1,sel_objs_len:-1,sel_obj_idx:-1,cond:l.condition,var1:l.variable1,var2:l.variable2,num1:l.number1,num2:l.number2,vard:l.variabled,url:l.url,param_name:l.param_name,op:l.operation,mute:l.mute,dupli_name_list:l.object,obj:null,objects:{},anim_name:l.anim_name,parse_resp_list:l.parse_resp_list,objects_paths:l.objects_paths,nodes_paths:l.nodes_paths,floats:l.floats,bools:l.bools,vars:l.variables,materials_names:l.materials_names,shader_nd_type:l.shader_nd_type,
common_usage_names:l.common_usage_names,send_req_vars_list:l.send_req_vars_list,thread:h,process_node:G[l.type]?G[l.type]:v,processed:!1,timer:0,tmp1:0,camera_state:null,sel_obj_idxs:null,links_idxs:l.links};h.nodes.push(l)}for(k=0;k<h.nodes.length;k++)l=h.nodes[k],l.process_node(l,b,f.thread_state,0,0)}var c=a.timeline_markers,m;for(m in c)b.sorted_markers_values.push(c[m]);b.sorted_markers_values.sort(function(a,b){return a-b});b.state=2;N.push(b)}var d=t("__objects"),l=t("__scenes"),n=t("__print"),
q=t("__nla"),g=t("__config"),u=t("__controls"),k=t("__util"),f=t("__animation"),p=t("__assets"),K=t("__batch"),D=t("__geometry"),A=t("__time"),h=t("__camera"),x=t("__vec3");t("__vec4");var w=t("__physics"),r=t("__transform"),m=t("__sfx");t("__constraints");var E=t("__mat3"),y=t("__mat4"),M=t("__tsr"),L=t("__quat"),N=[],B=new Float32Array(4),O=new Float32Array(3),F=new Float32Array(3),C=new Float32Array(2),I=new Float32Array(9),Q=new Float32Array(16),G={ENTRYPOINT:function(a,b,c,d,e,f){switch(b.state){case 2:c.curr_node=
a.slot_idx_order}},HIDE:function(a,c,d,e,f,h){switch(c.state){case 1:a.obj=b(a);break;case 2:l.change_visibility(a.obj,!0),d.curr_node=a.slot_idx_order}},SHOW:function(a,c,d,e,f,h){switch(c.state){case 1:a.obj=b(a);break;case 2:l.change_visibility(a.obj,!1),d.curr_node=a.slot_idx_order}},PAGEPARAM:function(a,b,d,e,f,h){switch(b.state){case 2:d.variables[a.vard]=c(a.param_name),d.curr_node=a.slot_idx_order}},SWITCH_SELECT:function(a,b,c,e,f,h){switch(b.state){case 1:a:{c=b.logic_threads[c.thread_index];
e=d.get_selectable_objects(b.scene);a.sel_obj_idxs=[];for(var k in a.objects_paths){var g=d.get_object(d.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths[k],0);f=e.indexOf(g);if(-1==f){n.error("logic script error: non-selectable object:",a.objects_paths[k][a.objects_paths[k].length-1]);break a}a.sel_obj_idxs.push(f)}a.state=-1;a.sel_objs_len=e.length;k=[];for(f=0;f<e.length;f++)k.push(u.create_selection_sensor(e[f],!0));e=Y();u.create_sensor_manifold(g,"LOGIC_NODES_SWITCH_SELECT_"+a.label,u.CT_SHOT,
k,u.default_OR_logic_fun,e,[a,b,c])}break;case 2:if(-1==a.state){b=b.logic_threads[c.thread_index].nodes;for(g=0;g<b.length;g++)k=b[g],"SWITCH_SELECT"==k.type&&(k.state=-1);a.state=-2}-1<a.state&&(c.curr_node=a.state?a.slot_idx_jump:a.slot_idx_order,a.state=-1)}},SELECT:function(a,c,e,f,h,k){switch(c.state){case 1:e=c.logic_threads[e.thread_index];f=b(a);h=d.get_selectable_objects(c.scene);k=h.indexOf(f);if(-1==k)n.error("logic script error: non-selectable object:",a.dupli_name_list[a.dupli_name_list.length-
1]);else{a.state=-1;a.sel_objs_len=h.length;a.sel_obj_idx=k;k=[];for(var g=0;g<h.length;g++)k.push(u.create_selection_sensor(h[g],!0));h=z();u.create_sensor_manifold(f,"LOGIC_NODES_SELECT_"+a.label,u.CT_SHOT,k,u.default_OR_logic_fun,h,[a,c,e])}break;case 2:if(-1<a.state){e.curr_node=a.state?a.slot_idx_jump:a.slot_idx_order;a.state=-1;break}a.bools.not_wait&&(e.curr_node=a.slot_idx_order)}},PLAY:function(a,b,c,d,e,f){switch(b.state){case 1:q.stop_nla();a.state=-1;a.bools.not_wait||(a.bools.not_wait=
!1);break;case 2:switch(a.state){case -1:if(q.is_play(b._nla))if(b.curr_thread==b.nla_thread&&c.in_progress)break;else if(e=b.nla_thread)for(e.thread_state.curr_node=e.nodes[e.thread_state.curr_node].slot_idx_order,e.nodes[e.thread_state.curr_node].state=-1,e=b.nla_thread.nodes,f=0;f<e.length;f++){var h=e[f];"PLAY"==h.type&&(h.state=-1)}c.in_progress=!a.bools.not_wait;b.nla_thread=b.curr_thread;a.state=0;a.frame_start_mask&&(q.set_range_start(a.frame_start),q.set_offset_from_range_start(d));if(a.frame_end_mask)q.set_range_end(a.frame_end);
else{d=q.get_frame(d);for(var g in b.sorted_markers_values)if(d<b.sorted_markers_values[g])break;q.set_range_end(b.sorted_markers_values[g])}q.play_nla(null);a.bools.not_wait&&(c.curr_node=a.slot_idx_order,a.state=-1,c.in_progress=!1);break;case 0:q.is_play()||(c.curr_node=a.slot_idx_order,a.state=-1,c.in_progress=!1);break;case 1:c.curr_node=a.slot_idx_order;a.state=-1;b.nla_thread=null;c.in_progress=!1;break;default:k.panic("Unknown state of "+a.name),a.state=-1}}},REDIRECT:function(a,b,c,d,e,f){switch(b.state){case 2:window.location.href=
a.url,b.state=3}},MATH:function(a,b,c,d,e,f){switch(b.state){case 2:b=-1==a.var1?a.num1:c.variables[a.var1];d=-1==a.var2?a.num2:c.variables[a.var2];switch(a.op){case "ADD":c.variables[a.vard]=b+d;break;case "MUL":c.variables[a.vard]=b*d;break;case "SUB":c.variables[a.vard]=b-d;break;case "DIV":0==d&&k.panic("Division by zero in Logic script");c.variables[a.vard]=b/d;break;case "RAND":c.variables[a.vard]=Math.random()*(d-b)+b}c.curr_node=a.slot_idx_order}},CONDJUMP:function(a,b,c,d,e,f){switch(b.state){case 2:b=
-1==a.var1?a.num1:c.variables[a.var1];d=-1==a.var2?a.num2:c.variables[a.var2];e=!1;switch(a.cond){case "EQUAL":b==d&&(e=!0);break;case "NOTEQUAL":b!=d&&(e=!0);break;case "LESS":b<d&&(e=!0);break;case "GREATER":b>d&&(e=!0);break;case "LEQUAL":b<=d&&(e=!0);break;case "GEQUAL":b>=d&&(e=!0)}c.curr_node=e?a.slot_idx_jump:a.slot_idx_order}},REGSTORE:function(a,b,c,d,e,f){switch(b.state){case 2:c.variables[a.vard]=a.num1,c.curr_node=a.slot_idx_order}},PLAY_ANIM:function(a,c,d,e,h,g){e=f.SLOT_ALL;""==!a.anim_name&&
(e=f.SLOT_0);switch(c.state){case 1:a.obj=b(a);(d=a.common_usage_names.param_anim_behavior)||(d="FINISH_STOP");a.tmp1=f.anim_behavior_bpy_b4w(d);break;case 2:switch(f.is_play(a.obj,e)||0!=a.state||(a.state=1),a.state){case -1:for(var l in c.logic_threads)h=c.logic_threads[l].thread_state.curr_node,-1!=h&&(h=c.logic_threads[l].nodes[h],"PLAY_ANIM"==h.type&&h!=a&&0==h.state&&h.obj==a.obj&&(h.state=1));if(""==a.anim_name)f.apply_def(a.obj),f.set_behavior(a.obj,a.tmp1,e);else{a:{for(l=c=0;8>l;l++)if((h=
a.obj.anim_slots[l])&&h.animation_name&&h.animation_name==a.anim_name)if(0==c)c=1;else{c=!1;break a}c=1==c?!0:!1}c||(f.apply(a.obj,a.anim_name,e),f.set_behavior(a.obj,a.tmp1,e))}a.bools.not_wait||(d.in_progress=!0);f.play(a.obj,null,e);a.state=0;a.bools.not_wait&&(d.curr_node=a.slot_idx_order,a.state=-1);break;case 0:break;case 1:a.bools.not_wait||(d.in_progress=!1);d.curr_node=a.slot_idx_order;a.state=-1;break;default:k.panic("Unknown state of "+a.name),a.state=-1}}},SELECT_PLAY:function(a,b,c,d,
e,f){switch(b.state){case 2:c.curr_node=a.slot_idx_order}},SEND_REQ:function(a,b,c,d,e,f){function h(a,b,c,d,e){for(var f in a)for(var k in e[0].parse_resp_list)f==e[0].parse_resp_list[k]&&(e[1][f]=a[f]);e[0].state=1}switch(b.state){case 2:switch(a.state){case -1:a.state=0;if("GET"==a.common_usage_names.request_type)p.enqueue([{id:a.url,type:p.AT_JSON,url:a.url,param:[a,c.variables]}],h,null,null);else if("POST"==a.common_usage_names.request_type){b={};for(d=0;d<a.send_req_vars_list.length;d++)e=
a.send_req_vars_list[d],b[e]=c.variables[e];p.enqueue([{id:a.url,type:p.AT_JSON,url:a.url,request:"POST",post_type:p.APT_JSON,post_data:JSON.stringify(b),param:[a,c.variables]}],h,null,null)}break;case 1:a.state=-1,c.curr_node=a.slot_idx_order}}},INHERIT_MAT:function(a,b,c,e,f,h){switch(b.state){case 1:for(b=0;2>b;b++)a.objects["id"+b]=d.get_object(d.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths["id"+b],0);break;case 2:K.inherit_material(a.objects.id0,a.materials_names.id0,a.objects.id1,a.materials_names.id1),
c.curr_node=a.slot_idx_order}},SET_SHADER_NODE_PARAM:function(a,b,c,e,f,h){switch(b.state){case 1:a.objects_paths.id0&&(a.objects.id0=d.get_object(d.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0),a.nodes_paths.id0.unshift(a.materials_names.id0));break;case 2:"ShaderNodeRGB"==a.shader_nd_type&&d.set_nodemat_rgb(a.objects.id0,a.nodes_paths.id0,a.bools.id0?c.variables[a.vars.id0]:a.floats.id0,a.bools.id1?c.variables[a.vars.id1]:a.floats.id1,a.bools.id2?c.variables[a.vars.id2]:a.floats.id2),"ShaderNodeValue"==
a.shader_nd_type&&d.set_nodemat_value(a.objects.id0,a.nodes_paths.id0,a.bools.id0?c.variables[a.vars.id0]:a.floats.id0),c.curr_node=a.slot_idx_order}},DELAY:function(a,b,c,d,e,f){switch(b.state){case 2:-1==a.state?(a.state=0,a.timer=0,c.in_progress=!0):0==a.state&&(a.timer+=e,(a.bools.dl?c.variables[a.vars.dl]:a.floats.dl)<a.timer&&(a.state=-1,c.curr_node=a.slot_idx_order,c.in_progress=!1))}},APPLY_SHAPE_KEY:function(a,b,c,e,f,h){switch(b.state){case 1:b=a.objects.id0=d.get_object(d.GET_OBJECT_BY_DUPLI_NAME_LIST,
a.objects_paths.id0,0);c=a.common_usage_names.sk;D.check_shape_keys(b)?D.has_shape_key(b,c)||(n.error("Wrong key name:",c),a.mute=!0):(n.error("No shape keys in object:",b.name),a.mute=!0);break;case 2:D.apply_shape_key(a.objects.id0,a.common_usage_names.sk,a.bools.skv?c.variables[a.vars.skv]:a.floats.skv),c.curr_node=a.slot_idx_order}},OUTLINE:function(a,b,c,e,f,h){switch(b.state){case 1:b=a.objects.id0=d.get_object(d.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);b&&b.render&&b.render.outlining||
(n.error("Can't evaluate 'Outline' logic node: wrong object"),a.mute=!0);break;case 2:b=a.objects.id0;switch(a.common_usage_names.outline_operation){case "PLAY":e=b.render.outline_anim_settings_default;d.apply_outline_anim(b,e.outline_duration,e.outline_period,e.outline_relapses);break;case "STOP":d.clear_outline_anim(b);break;case "INTENSITY":b.render.outline_intensity=a.bools["in"]?c.variables[a.vars["in"]]:a.floats["in"]}c.curr_node=a.slot_idx_order}},MOVE_CAMERA:function(a,b,c,e,f,g){function l(a,
b,c,d){switch(h.get_move_style(a)){case h.MS_TARGET_CONTROLS:h.set_trans_pivot(a,b,c);break;case h.MS_EYE_CONTROLS:case h.MS_STATIC:r.set_tsr(a,d);break;case h.MS_HOVER_CONTROLS:x.sub(c,b,O),x.normalize(O,O),h.set_hover_pivot(a,c),c=b=0,F[0]=O[0],F[1]=0,F[2]=O[2],b=x.dot(F,O),c=Math.acos(b/(x.length(F)*x.length(O))),b=O[2]?Math.atan(O[0]/O[2]):0<O[0]?0:Math.PI,0<O[2]&&0<O[0]?C[1]=-(Math.PI+C[1]):0<O[2]&&0>O[0]?C[1]=-(Math.PI+C[1]):0>O[2]&&0>O[0]?(C[0]+=Math.PI,b=-(Math.PI-b)):0>O[2]&&0<O[0]&&(C[0]+=
Math.PI,b-=Math.PI),h.rotate_hover_camera(a,b+Math.PI,-c,!0,!0)}r.update_transform(a);w.sync_transform(a)}function m(a,b,c,d){y.lookAt(b,c,k.AXIS_Y,Q);y.invert(Q,Q);y.rotateX(Q,Math.PI/2,Q);E.fromMat4(Q,I);L.fromMat3(I,B);L.normalize(B,B);a=M.get_scale(a.render.world_tsr);M.set_sep(b,a,B,d)}switch(b.state){case 1:a.objects.ca=d.get_object(d.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);a.objects.tr=d.get_object(d.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id1,0);a.objects.ta=d.get_object(d.GET_OBJECT_BY_DUPLI_NAME_LIST,
a.objects_paths.id2,0);a.state=-1;a.camera_state={trans_start:new Float32Array(3),trans_end:new Float32Array(3),interp_trans:new Float32Array(3),target_start:new Float32Array(3),target_end:new Float32Array(3),interp_target:new Float32Array(3),tsr_start:new Float32Array(8),tsr_end:new Float32Array(8),interp_tsr:new Float32Array(8)};break;case 2:var n=a.objects.ca;b=M.get_trans_view(a.objects.tr.render.world_tsr);e=M.get_trans_view(a.objects.ta.render.world_tsr);switch(a.state){case -1:var p=a.bools.dur?
c.variables[a.vars.dur]:a.floats.dur;if(0==p){m(n,b,e,a.camera_state.tsr_end);l(n,b,e,a.camera_state.tsr_end);c.curr_node=a.slot_idx_order;break}c=M.get_trans_view(n.render.world_tsr);x.copy(c,a.camera_state.trans_start);var q=h.get_move_style(n);q==h.MS_HOVER_CONTROLS?x.copy(n.render.hover_pivot,a.camera_state.target_start):q==h.MS_STATIC||q==h.MS_EYE_CONTROLS?(M.copy(n.render.world_tsr,a.camera_state.tsr_start),m(n,b,e,a.camera_state.tsr_end)):x.copy(n.render.pivot,a.camera_state.target_start);
x.copy(b,a.camera_state.trans_end);x.copy(e,a.camera_state.target_end);a.state=0;p=A.animate(0,1,1E3*p,function(b){q==h.MS_STATIC||q==h.MS_EYE_CONTROLS?M.interpolate(a.camera_state.tsr_start,a.camera_state.tsr_end,k.smooth_step(b),a.camera_state.interp_tsr):(a.camera_state.interp_target=x.lerp(a.camera_state.target_start,a.camera_state.target_end,k.smooth_step(b),a.camera_state.interp_target),a.camera_state.interp_trans=x.lerp(a.camera_state.trans_start,a.camera_state.trans_end,k.smooth_step(b),a.camera_state.interp_trans));
l(n,a.camera_state.interp_trans,a.camera_state.interp_target,a.camera_state.interp_tsr);1==b&&(a.state=1)});break;case 1:A.clear_animation(p),a.state=-1,c.curr_node=a.slot_idx_order}}},SET_CAMERA_MOVE_STYLE:function(a,b,c,d,e,f){switch(b.state){case 1:a.tmp1=h.move_style_bpy_to_b4w(a.common_usage_names.camera_move_style);break;case 2:b=l.get_camera(c.scene),h.set_move_style(b,a.tmp1),r.update_transform(b),w.sync_transform(b),c.curr_node=a.slot_idx_order}},SPEAKER_PLAY:function(a,b,c,e,f,h){switch(b.state){case 1:a.obj=
d.get_object(d.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);void 0==a.bools.not_wait&&(a.bools.not_wait=!0);break;case 2:switch(m.is_playing(a.obj)||0!=a.state||(a.state=1),a.state){case -1:for(var g in b.logic_threads)e=b.logic_threads[g].thread_state.curr_node,-1!=e&&(e=b.logic_threads[g].nodes[e],"SPEAKER_PLAY"==e.type&&e!=a&&0==e.state&&e.obj==a.obj&&(e.state=1));a.bools.not_wait||(c.in_progress=!0);m.play_def(a.obj);a.state=0;break;case 0:a.bools.not_wait&&(c.curr_node=a.slot_idx_order,
a.state=-1);break;case 1:a.bools.not_wait||(c.in_progress=!1);c.curr_node=a.slot_idx_order;a.state=-1;break;default:k.panic("Unknown state of "+a.name),a.state=-1}}},SPEAKER_STOP:function(a,b,c,e,f,h){switch(b.state){case 1:a.obj=d.get_object(d.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);break;case 2:m.stop(a.obj),c.curr_node=a.slot_idx_order}},STOP_ANIM:function(a,c,d,e,h,k){switch(c.state){case 1:a.obj=b(a);break;case 2:f.stop(a.obj,f.SLOT_ALL),a.bools.rst&&f.set_first_frame(a.obj,f.SLOT_ALL),
d.curr_node=a.slot_idx_order}},STOP_TIMELINE:function(a,b,c,d,e,f){switch(b.state){case 2:a.bools.rst&&q.set_offset_from_range_start(d),q.stop_nla(),c.curr_node=a.slot_idx_order}}};a.init_logic=function(a,b){var c={data_id:b,scene_name:a.name,state:0,nla_thread:null,scene:a,curr_thread:null,logic_threads:[],sorted_markers_values:[]};a._logic=c;e(a,c)};a.update=function(a,b){var c=q.get_start_time();if(!(0>=c))for(var d=0;d<N.length;d++)for(var e=d,f=a,h=b,k=c,g=N[e],l=0;l<N[e].logic_threads.length;l++){g.curr_thread=
N[e].logic_threads[l];var m=N[e].logic_threads[l],n=g,p=f,r=h,u=k,x=m.nodes;if(x.length){for(var w=0;w<x.length;w++)x[w].processed=!1;for(w=0;w<x.length;w++){if(0<=m.thread_state.curr_node)var t=x[m.thread_state.curr_node];else break;if(t.processed)break;if(t.mute)if("ENTRYPOINT"==t.type)break;else m.thread_state.curr_node=t.slot_idx_order,t.processed=!0;else t.process_node(t,n,m.thread_state,p,r,u),t.processed=!0}}}};var z=function(){return function(a,b,c,d){c=d[0];var e=d[1];d=d[2];for(var f=0;f<
c.sel_objs_len;f++)if(u.get_sensor_value(a,b,f)&&f==c.sel_obj_idx){if(q.is_play(e._nla)&&e.nla_thread==c.thread)c.state=-1;else if(!d.thread_state.in_progress||c.bools.no_wait)c.state=1;return}c.state=0}},Y=function(){return function(a,b,c,d){c=d[0];var e=d[1];d=d[2];if(-2==c.state){for(var f=0;f<c.sel_objs_len;f++)if(u.get_sensor_value(a,b,f))for(var h=0;h<c.sel_obj_idxs.length;h++)if(c.sel_obj_idxs[h]==f){e.nla_thread==c.thread?(q.is_play(e._nla)&&(c.state=-1),d.thread_state.in_progress||(c.state=
1,c.slot_idx_jump=c.links_idxs[h])):(c.state=1,c.slot_idx_jump=c.links_idxs[h]);return}c.state=0}}};a.cleanup=function(){N=[]}};b4w.module.__nla=function(a,t){function v(){return{type:"CLIP",frame_start:0,frame_end:0,scheduled:!1,paused:!1,anim_name:"",anim_uuid:"",anim_slot:0,action_frame_start:0,action_frame_end:0,ext_frame_start:0,ext_frame_end:0,use_reverse:!1,scale:1,repeat:1}}function c(a,b){if(a.animation_data){var d=a.animation_data.nla_tracks;if(d)for(var e=0;e<d.length;e++)b.push(d[e])}d=a.nodes;for(e=0;e<d.length;e++){var f=d[e];f.node_group&&(f=f.node_group.node_tree)&&c(f,b)}}function b(a,b){var c=Math.round(a)-
b.frame_start;b.use_cyclic&&(c%=b.frame_duration,0>c&&(c+=b.frame_duration));return b.frame_offset+c}function e(a,b,c,d){b=(b-d)*x.get_framerate()+a.frame_offset;b>a.frame_start&&(b-=a.frame_start,a.cyclic&&c&&(b%=a.frame_end-a.frame_start+1),b+=a.frame_start);return b}function d(a,b){a=w.clamp(a,b.frame_start,b.frame_end);var c=a-b.frame_start,d=(b.frame_end-b.frame_start)/b.repeat,c=c/d&&0==c%d?b.action_frame_end:b.action_frame_start+c%d/b.scale;b.use_reverse&&(c=b.action_frame_end-c+b.action_frame_start);
return c}function l(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d].strips;if(e)for(var f=0;f<e.length;f++){var h=e[f],k=v();k.type=h.type;k.frame_start=h.frame_start;k.frame_end=h.frame_end;k.anim_slot=b;k.action_frame_start=h.action_frame_start;k.action_frame_end=h.action_frame_end;k.use_reverse=h.use_reverse;k.scale=h.scale;k.repeat=h.repeat;h.action&&(k.anim_name=h.action.name,k.anim_uuid=h.action.uuid);c.push(k)}}return c}function n(a){return("SPEAKER"==a.type||"LAMP"==a.type)&&a.data.animation_data&&
a.data.animation_data.nla_tracks.length?!0:!1}function q(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c.use_nodes&&d&&g(d))return!0}return!1}function g(a,b){if(a.animation_data){var c=a.animation_data.nla_tracks;if(c&&c.length)return!0}for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];e.node_group&&(e=e.node_group.node_tree)&&g(e,b)}return!1}function u(a,b){var c=D.get_active();if(c._nla){var d=e(c._nla,b,!0,m);c._nla.frame_offset-=
d-a;c._nla.force_update=!0}}var k=t("__animation");t("__camera");t("__controls");t("__config");t("__lights");t("__loader");var f=t("__objects"),p=t("__obj_util"),K=t("__print"),D=t("__scenes"),A=t("__sfx"),h=t("__textures"),x=t("__time"),w=t("__util"),r=[],m=-1;a.update_object=function(a,b){var d;d=null;for(var e=b.scenes_data.length-1;0<=e;e--){var f=b.scenes_data[e];if(f.scene.b4w_use_nla&&(d=f,f.scene._is_main))break}if(d){d.obj_has_nla_on_scene=!0;var h=0;if((e=a.animation_data)&&e.nla_tracks.length){var g=
e.nla_tracks;if(p.is_armature(b)||p.is_camera(b)||p.is_mesh(b)||p.is_empty(b)||p.is_lamp(b)||p.is_speaker(b))g=l(g,h),g.length&&(b.nla_events=b.nla_events.concat(g),h++)}n(a)&&(g=a.data.animation_data.nla_tracks,g=l(g,h),g.length&&(b.nla_events=b.nla_events.concat(g),h++));if(p.is_mesh(b))for(f=a.data.materials,e=0;e<f.length;e++){var m=f[e];if(m.use_nodes&&m.node_tree&&(g=[],c(m.node_tree,g),g=l(g,h),g.length)){for(var m=h,r=g,q=k.get_all_actions(),u=[],x=0,t=0;t<r.length;t++){var A=r[t];""!=A.anim_uuid?
A=w.keysearch("uuid",A.anim_uuid,q):(A=A.anim_name,A=w.keysearch("name",A,q)||w.keysearch("name",A+"_B4W_BAKED",q));if(A){var A=A.fcurves,K=[],D;for(D in A)K.push(D);u.push(K)}}for(t=0;t<u.length;t++){q=!1;for(A=0;A<t;A++)if(w.arrays_have_common(u[t],u[A])){r[t].anim_slot=r[A].anim_slot;q=!0;break}q||(r[t].anim_slot=h+x++)}h=m+x;b.nla_events=b.nla_events.concat(g)}}for(e=0;e<a.particle_systems.length;e++)f=a.particle_systems[e],D=f.settings,"EMITTER"==D.type&&D.b4w_allow_nla&&(D=v(),D.type="CLIP",
D.frame_start=d.scene.frame_start,D.frame_end=d.scene.frame_end+1,D.anim_name=f.name,D.anim_slot=h,D.action_frame_start=D.frame_start,D.action_frame_end=D.frame_end,b.nla_events.push(D),h++);f=h+1;for(e=0;e<b.vertex_anim.length;e++)g=b.vertex_anim[e],g.allow_nla&&(h=f,D=v(),D.type="CLIP",D.frame_start=d.scene.frame_start,D.frame_end=d.scene.frame_end+1,D.anim_name=g.name,D.anim_slot=h,D.action_frame_start=D.frame_start,D.action_frame_end=D.frame_end,b.nla_events.push(D))}};a.update_scene=function(a,
b,c){a._nla||(a._nla={frame_start:a.frame_start,frame_end:a.frame_end,frame_offset:0,last_frame:-1,range_end:a.frame_end,range_start:a.frame_start,user_callback:null,cyclic:b,objects:[],textures:[],scene_name:a.name,is_stopped:!1,force_update:!1,rewinded_to_start:!0});b=a._nla;for(var d=f.get_scene_objs_derived(a,"ALL",c),e=0;e<d.length;e++){var h=d[e];if(h.nla_events.length){for(var k=0;k<h.scenes_data.length;k++){var g=h.scenes_data[k];g.scene==a&&g.obj_has_nla_on_scene&&b.objects.push(h)}for(var k=
h.nla_events,g=b,l=h.name,m=0;m<k.length;m++){var n=k[m],p=l+" ["+n.frame_start+":"+n.frame_end+"]",q=Math.max(g.frame_start,n.frame_start);n.action_frame_start+=q-n.frame_start;n.frame_start=q;n.frame_end=Math.min(g.frame_end+1,n.frame_end);n.frame_start>n.frame_end?(K.warn("NLA: out of scene range: "+p),k.splice(m,1),m--):n.anim_name||"CLIP"!=n.type||(K.warn('NLA: no action in strip for object "'+l+'".'),k.splice(m,1),m--)}h=h.nla_events;k=b;for(g=0;g<h.length;g++){l=h[g];m=k.frame_start;n=k.frame_end+
1;for(p=0;p<h.length;p++)q=h[p],l.anim_slot==q.anim_slot&&(q.frame_end<=l.frame_start&&(m=l.frame_start),q.frame_start>=l.frame_end&&(n=Math.min(n,q.frame_start)));l.ext_frame_start=m;l.ext_frame_end=n}}}a=a._render.video_textures;for(e=0;e<a.length;e++)d=a[e]._render,d.use_nla&&(d.video_file||d.seq_video)&&d.vtex_data_id==c&&(h=v(),h.type="VIDEO",d.use_cyclic?(h.frame_start=0,h.frame_end=b.frame_end):(h.frame_start=w.clamp(d.frame_start,0,b.frame_end),h.frame_end=w.clamp(d.frame_start+d.frame_duration,
0,b.frame_end)),h.anim_name=a[e].name,b.textures.push(d));r.push(b)};a.start=function(){m=0};a.get_start_time=function(){return m};a.get_frame_offset=function(a){return a._nla?a._nla.frame_offset:null};a.set_frame_offset=function(a,b){return a._nla?(a._nla.frame_offset=b,!0):!1};a.update=function(a,c){if(!(0>m)){0==m&&(m=a);for(var f=0;f<r.length;f++){var g=r[f];g.is_stopped&&(g.frame_offset-=x.get_framerate()*c);var l=e(g,a,!0,m);if((!g.is_stopped||g.force_update)&&l>=g.range_end)if(g.cyclic){var l=
g,n=a;l.user_callback&&l.user_callback();u(l.range_start,n);l.rewinded_to_start=!0;l=e(l,n,!0,m)}else{var n=g,p=l;n.is_stopped=!0;n.frame_offset-=p-n.range_end;n.user_callback&&n.user_callback()}if(!g.is_stopped||g.force_update){for(var n=g,p=l,q=0;q<n.objects.length;q++){for(var t=n.objects[q],v=t.nla_events,K=0;K<v.length;K++){var G=v[K];"SOUND"==G.type&&p<n.last_frame-1E-6&&(G.scheduled=!1)}for(K=0;K<v.length;K++)switch(G=v[K],G.type){case "CLIP":if(G.ext_frame_start<=p&&p<G.ext_frame_end&&!G.scheduled){var z=
t,D=G;""!=D.anim_uuid?k.apply_by_uuid(z,D.anim_uuid,D.anim_slot):k.apply(z,D.anim_name,D.anim_slot);k.set_behavior(z,k.AB_FINISH_STOP,D.anim_slot);var U=d(D.frame_start,D);k.set_frame(z,U,D.anim_slot);for(z=0;z<v.length;z++)v[z]!=G&&v[z].anim_slot==G.anim_slot&&(v[z].scheduled=!1);G.scheduled=!0}G.scheduled&&(z=t,D=d(p,G),U=k.get_current_frame_float(z,G.anim_slot),1E-6<Math.abs(D-U)&&k.set_frame(z,D,G.anim_slot));break;case "SOUND":(p<n.last_frame-1E-6||n.last_frame<G.frame_start)&&G.frame_start<=
p&&p<G.frame_end&&!G.scheduled&&(z=t,U=G,D=(U.frame_start-p)/x.get_framerate(),U=(U.frame_end-U.frame_start)/x.get_framerate(),A.play(z,D,U),G.scheduled=!0),n.last_frame<G.frame_end&&G.frame_end<=p&&G.scheduled&&(G.scheduled=!1)}}n=a;p=g;q=l;for(t=0;t<p.textures.length;t++)if(v=p.textures[t],v.video_file||v.seq_video){K=h.video_get_current_frame(v);G=v;z=b(q,G);z=w.clamp(z,G.frame_offset,G.frame_offset+h.video_get_duration(G)-1);G.seq_video&&(z=h.video_frame_to_seq_frame(G,z),z==G.seq_movie_length&&
z--);G=z;z=h.video_get_start_frame(v);U=D=!1;if(p.force_update||p.rewinded_to_start)U=!0;if(!p.is_stopped){var P;P=v;var da=b(q,P);P=P.frame_offset<=da&&da<=P.frame_offset+h.video_get_duration(P);da=h.video_is_played(v);v.use_cyclic&&G==z&&(U=!0);da||K==G||(U=!0);P&&!da?h.play_video(v.name,v.vtex_data_id):P&&da?D=!0:!P&&da&&(v.video_file&&K<G?D=!0:h.pause_video(v.name,v.vtex_data_id))}U?(h.set_frame_video(v.name,G,v.vtex_data_id),v.seq_video&&(v.seq_last_discrete_mark=h.seq_video_get_discrete_timemark(v,
n))):D&&h.video_update_is_available(v)&&(v.video_file?h.update_video_texture(v):(K=h.seq_video_get_discrete_timemark(v,n),K!=v.seq_last_discrete_mark&&(v.seq_cur_frame=G,h.update_seq_video_texture(v)),v.seq_last_discrete_mark=K))}g.last_frame=l}g.force_update=!1;g.rewinded_to_start=!1}}};a.calc_curr_frame_scene=e;a.cleanup=function(){r.length=0;m=-1};a.bpy_obj_has_nla=function(a){var b=a.animation_data;return b&&b.nla_tracks.length||n(a)||q(a)?!0:!1};a.set_frame=u;a.get_frame=function(a){var b=D.get_active();
return b._nla?e(b._nla,a,!0,m):-1};a.stop_nla=function(){var a=D.get_active();a._nla&&(a._nla.is_stopped=!0);for(var a=a._nla.textures,b=0;b<a.length;b++){var c=a[b];h.pause_video(c.name,c.vtex_data_id)}};a.play_nla=function(a){var b=D.get_active();b._nla&&(b._nla.is_stopped=!1,b._nla.user_callback=a?a:null)};a.get_frame_start=function(){var a=D.get_active();return a._nla?a._nla.frame_start:-1};a.get_frame_end=function(){var a=D.get_active();return a._nla?a._nla.frame_end:-1};a.is_play=function(){var a=
D.get_active();return a._nla?!a._nla.is_stopped:!1};a.check_nla=function(){var a=D.get_active();return a._nla?a.b4w_use_nla:!1};a.check_logic_nodes=function(){var a=D.get_active();return a._nla?0<a.b4w_logic_nodes.length:!1};a.set_range=function(a,b){var c=D.get_active();if(c._nla)c._nla.range_start=a,c._nla.range_end=b;else return!1};a.set_range_end=function(a){var b=D.get_active();if(b._nla)b._nla.range_end=a;else return!1};a.set_range_start=function(a){var b=D.get_active();if(b._nla)b._nla.range_start=
a;else return!1};a.reset_range=function(){var a=D.get_active();if(a._nla)a=a._nla,a.range_start=a.frame_start,a.range_end=a.frame_end;else return!1};a.set_cyclic=function(a){var b=D.get_active();if(b._nla)b._nla.cyclic=a;else return!1};a.clear_callback=function(){var a=D.get_active();a._nla&&(a._nla.user_callback=null)};a.set_offset_from_range_start=function(a){var b=D.get_active()._nla;b&&(b.frame_offset=-(a-m)*x.get_framerate()+b.range_start,b.force_update=!0)}};b4w.module.__camera=function(a,t){function v(a){var b=a.render,c=a.render,d=W.get_trans_view(c.world_tsr),e=W.get_quat_view(c.world_tsr),e=T.quat_to_dir(e,T.AXIS_MY,J),h=ia;h.set(T.AXIS_Y);h[3]=0;e=T.line_plane_intersect(h,-c.hover_zero_level,d,e,c.hover_pivot);h=n(a,ga)[1];if(!e||Math.abs(h)<pa)P.warn("Active hover camera view vector and the supporting plane are parallel to each other. Hover pivot will be set based on the camera position."),c.hover_pivot[0]=d[0],c.hover_pivot[1]=0,c.hover_pivot[2]=
d[2],f(a,d,c.hover_pivot),G.correct_up(a,T.AXIS_Y,!0);c=n(a,ga);d=aa.obj_point_distance(a,a.render.hover_pivot);b.distance_limits||(b.distance_limits={min:d,max:d});b.vertical_limits||(b.vertical_limits={down:c[1],up:c[1]});b=T.calc_returning_angle(c[1],b.vertical_limits.up,b.vertical_limits.down);0<c[1]&&P.warn("Active hover camera has wrong orientation");b?r(a,0,b):E(a)}function c(b){b=b.render;switch(b.move_style){case a.MS_TARGET_CONTROLS:var c=W.get_trans_view(b.world_tsr);b.init_dist=Z.dist(c,
b.pivot);b.init_top=b.cameras[0].top;break;case a.MS_HOVER_CONTROLS:c=W.get_trans_view(b.world_tsr),b.init_dist=Z.dist(c,b.hover_pivot),b.init_top=b.cameras[0].top}}function b(){return{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),near:new Float32Array([0,0,0,0]),far:new Float32Array([0,0,0,0])}}function e(b){switch(b){case "STATIC":return a.MS_STATIC;case "TARGET":return a.MS_TARGET_CONTROLS;case "EYE":return a.MS_EYE_CONTROLS;
case "HOVER":return a.MS_HOVER_CONTROLS;default:throw"Unknown move style";}}function d(c){var d;d={type:c,name:"",size_mult:1,width:0,height:0,framebuffer:null,framebuffer_prev:null,color_attachment:null,depth_attachment:null,aspect:0,fov:0,near:0,far:0,left:0,right:0,top:0,bottom:0,world_tsr:new Float32Array(9),view_matrix:new Float32Array(16),billboard_view_matrix:new Float32Array(16),proj_matrix:new Float32Array(16),view_proj_matrix:new Float32Array(16),view_proj_inv_matrix:new Float32Array(16),
prev_view_proj_matrix:new Float32Array(16),sky_vp_inv_matrix:new Float32Array(16),view_tsr:W.create_ext(),shadow_cast_billboard_view_tsr:W.create_ext(),dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,dof_object:null,dof_on:0,lod_eye:new Float32Array(3),frustum_planes:b(),stereo_conv_dist:0,stereo_eye_dist:0,reflection_plane:null,csm_centers:null,csm_radii:null,csm_center_dists:new Float32Array(4),pcf_blur_radii:new Float32Array(4)};if(c==a.TYPE_NONE)return d;switch(c){case a.TYPE_PERSP:g(d,40,.1,
1E3);break;case a.TYPE_ORTHO:g(d,2.5,.1,1E3);break;case a.TYPE_PERSP_ASPECT:break;case a.TYPE_ORTHO_ASPECT:break;case a.TYPE_ORTHO_ASYMMETRIC:break;case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return d}function l(b,c,d){if(b.type!=a.TYPE_STEREO_LEFT&&b.type!=a.TYPE_STEREO_RIGHT)throw"set_stereo_params(): wrong camera type";b.stereo_conv_dist=c;b.stereo_eye_dist=d;y(b,b.aspect);if(fa.check_active()&&
(c=fa.get_active(),b=c._render.shadow_params))for(c=fa.get_camera(c).render.cameras,d=0;d<c.length;d++)O(c[d],b)}function n(a,b){var c=W.get_quat_view(a.render.world_tsr);return q(c,b)}function q(a,b){var c=T.quat_to_dir(a,T.AXIS_Y,J),d=T.quat_to_dir(a,T.AXIS_Z,V),e=-Math.asin(c[1]/Z.length(c)),c=Math.abs(e)>Math.PI/4?Z.scale(d,-T.sign(e),S):Z.scale(c,-T.sign(d[1]),S),f=Math.atan(Math.abs(c[0]/c[2]));0<d[1]&&(e=T.sign(e)*Math.PI-e);d=f;0>c[2]&&(d=Math.PI-d);0>c[0]&&(d=2*Math.PI-d);b[0]=d;b[1]=e;return b}
function g(b,c,d,e,f){switch(b.type){case a.TYPE_PERSP:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:b.fov=c;b.aspect=1;break;case a.TYPE_ORTHO:b.top=c;b.aspect=1;break;case a.TYPE_PERSP_ASPECT:delete b.fov;b.fov=c;b.aspect=f/c;break;case a.TYPE_ORTHO_ASPECT:b.top=c;b.aspect=f/c;break;default:P.error("set_frustum(): Unsupported camera type: "+b.type)}b.near=d;b.far=e}function u(b,c){var d=W.to_mat4(c.render.world_tsr,ja);Y.rotateX(d,-Math.PI/2,d);Y.invert(d,b.view_matrix);if(b.reflection_plane){var d=
b.reflection_plane[0],e=b.reflection_plane[1],f=b.reflection_plane[2],h=b.reflection_plane[3],k=ja;k[0]=1-2*d*d;k[1]=-2*d*e;k[2]=-2*d*f;k[3]=0;k[4]=-2*d*e;k[5]=1-2*e*e;k[6]=-2*e*f;k[7]=0;k[8]=-2*d*f;k[9]=-2*e*f;k[10]=1-2*f*f;k[11]=0;k[12]=-2*d*h;k[13]=-2*e*h;k[14]=-2*f*h;k[15]=1;Y.multiply(b.view_matrix,k,b.view_matrix);W.from_mat4(b.view_matrix,b.view_tsr);y(b,b.aspect,!0);d=ia;e=ja;Y.invert(b.view_matrix,e);Y.transpose(e,e);ba.transformMat4(b.reflection_plane,e,d);e=na;e[0]=(T.sign(d[0])+b.proj_matrix[8])/
b.proj_matrix[0];e[1]=(T.sign(d[1])+b.proj_matrix[9])/b.proj_matrix[5];e[2]=-1;e[3]=(1+b.proj_matrix[10])/b.proj_matrix[14];ba.scale(d,2/(d[0]*e[0]+d[1]*e[1]+d[2]*e[2]+d[3]*e[3]),d);b.proj_matrix[2]=d[0];b.proj_matrix[6]=d[1];b.proj_matrix[10]=d[2]+1;b.proj_matrix[14]=d[3]}b.type==a.TYPE_STEREO_LEFT?b.view_matrix[12]+=b.stereo_eye_dist/2:b.type==a.TYPE_STEREO_RIGHT&&(b.view_matrix[12]-=b.stereo_eye_dist/2);W.from_mat4(b.view_matrix,b.view_tsr);L(b);M(b);W.copy(c.render.world_tsr,b.world_tsr)}function k(b,
c,d,e){Y.lookAt(c,d,e,b.view_matrix);b.type==a.TYPE_STEREO_LEFT?b.view_matrix[12]+=b.stereo_eye_dist/2:b.type==a.TYPE_STEREO_RIGHT&&(b.view_matrix[12]-=b.stereo_eye_dist/2);W.from_mat4(b.view_matrix,b.view_tsr);L(b);M(b);W.set_trans(c,b.world_tsr)}function f(a,b,c){c=Z.subtract(c,b,J);Z.normalize(c,c);c=T.rotation_to_stable(T.AXIS_MY,c,R);aa.set_rotation(a,c);aa.set_translation(a,b)}function p(a){var b=a.render.cameras,c=a.render.shadow_cameras;if(!b)throw"Wrong object";for(var d=a.render,e=0;e<c.length;e++){var f=
c[e];Z.copy(W.get_trans_view(a.render.world_tsr),f.lod_eye)}for(e=0;e<b.length;e++)if(f=b[e],u(f,a),T.extract_frustum_planes(f.view_proj_matrix,f.frustum_planes),f.dof_object)if(f.dof_on){var c=W.get_trans_view(d.world_tsr),h=aa.get_translation(f.dof_object,J),c=Z.dist(c,h);f.dof_distance=c}else f.dof_distance=0}function K(b){b=b.render;if(b.move_style==a.MS_TARGET_CONTROLS){var c=W.get_quat_view(b.world_tsr),c=T.quat_to_dir(c,T.AXIS_Z,J);b.target_cam_upside_down=0<c[1]}}function D(b){var c=b.render,
d=c.horizontal_limits;!d||c.move_style!=a.MS_EYE_CONTROLS&&c.move_style!=a.MS_TARGET_CONTROLS||(d.camera_space&&(b=n(b,ga),d.left+=b[0],d.right+=b[0]),d.left=T.angle_wrap_0_2pi(d.left),d.right=T.angle_wrap_0_2pi(d.right),d.left_local=T.angle_wrap_0_2pi(d.left_local),d.right_local=T.angle_wrap_0_2pi(d.right_local))}function A(b){var c=b.render,d=c.vertical_limits;if(d)switch(c.move_style){case a.MS_EYE_CONTROLS:case a.MS_TARGET_CONTROLS:d.camera_space&&(b=n(b,ga),d.up+=b[1],d.down+=b[1]);d.up=T.angle_wrap_periodic(d.up,
-Math.PI,Math.PI);d.down=T.angle_wrap_periodic(d.down,-Math.PI,Math.PI);d.up_local=T.angle_wrap_periodic(d.up_local,-Math.PI,Math.PI);d.down_local=T.angle_wrap_periodic(d.down_local,-Math.PI,Math.PI);break;case a.MS_HOVER_CONTROLS:d.up=T.angle_wrap_periodic(d.up,-Math.PI,Math.PI),d.down=T.angle_wrap_periodic(d.down,-Math.PI,Math.PI),d.up=T.clamp(d.up,-Math.PI/2,0),d.down=T.clamp(d.down,-Math.PI/2,0)}}function h(b){var c=b.render;if(U.is_camera(b)){var d=c.cameras;if(d[0].type===a.TYPE_ORTHO){switch(c.move_style){case a.MS_TARGET_CONTROLS:var e=
W.get_trans_view(c.world_tsr),e=Z.dist(e,c.pivot),c=e/c.init_dist*c.init_top;break;case a.MS_HOVER_CONTROLS:e=W.get_trans_view(c.world_tsr);e=Z.distance(e,c.hover_pivot);c=e/c.init_dist*c.init_top;break;default:c=d[0].top}for(e=0;e<d.length;e++){var f=d[e];f.top=c;y(f,f.aspect)}p(b)}}}function x(a,b,c,d,e){var f=a.render,h=b,k=c;if(d||e)a=n(a,ka),d&&(h=b-a[0]),e&&(k=c-a[1]);if(h||k)b=da.identity(R),h&&(h=da.setAxisAngle(T.AXIS_Y,h,ua),da.multiply(b,h,b)),f=W.get_quat_view(f.world_tsr),k&&(h=T.quat_to_dir(f,
T.AXIS_X,J),k=da.setAxisAngle(h,k,ua),da.normalize(k,k),da.multiply(b,k,b)),da.multiply(b,f,f)}function w(a,b,c,d,e){var f=a.render,h=b,k=c;if(d||e){var g=n(a,ka);d&&(h=b-g[0]);e&&(k=c-g[1])}m(a,a.render.pivot,h,k);a=n(a,ka);a=T.angle_wrap_periodic(a[1],-Math.PI,Math.PI);f.target_cam_upside_down=Math.abs(a)>Math.PI/2}function r(a,b,c,d,e){var f=a.render,h=b,k=c;if(d||e){var g=n(a,ka);d&&(h=b-g[0]);e&&(k=c-g[1])}f.enable_hover_hor_rotation||(h=0);m(a,f.hover_pivot,h,k);k&&E(a)}function m(a,b,c,d){var e=
a.render;if(c||d){var f=da.identity(R);c&&(c=da.setAxisAngle(T.AXIS_Y,c,ua),da.multiply(f,c,f));B(a);a=W.get_quat_view(e.world_tsr);d&&(c=T.quat_to_dir(a,T.AXIS_X,J),d=da.setAxisAngle(c,d,ua),da.normalize(d,d),da.multiply(f,d,f));e=W.get_trans_view(e.world_tsr);T.rotate_point_pivot(e,b,f,e);da.multiply(f,a,a)}}function E(a){var b=a.render,c=n(a,ga)[1],d=a.render;a=d.vertical_limits;d=d.distance_limits;a.down-a.up?(c=(a.down-c)/(a.down-a.up),c=Math.max(c,0)):c=0;c=c*(d.max-d.min)+d.min;a=W.get_trans_view(b.world_tsr);
d=W.get_quat_view(b.world_tsr);d=T.quat_to_dir(d,T.AXIS_MY,J);Z.normalize(d,d);Z.scale(d,c,d);Z.subtract(b.hover_pivot,d,a)}function y(b,c,d){switch(b.type){case a.TYPE_PERSP:if(!c)throw"No aspect ratio";b.aspect=c;case a.TYPE_PERSP_ASPECT:Y.perspective(T.rad(b.fov),b.aspect,b.near,b.far,b.proj_matrix);break;case a.TYPE_ORTHO:if(!c)throw"No aspect ratio";b.aspect=c;case a.TYPE_ORTHO_ASPECT:c=b.top*b.aspect;Y.ortho(-c,c,-b.top,b.top,b.near,b.far,b.proj_matrix);break;case a.TYPE_ORTHO_ASYMMETRIC:Y.ortho(b.left,
b.right,b.bottom,b.top,b.near,b.far,b.proj_matrix);break;case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:if(!c)throw"No aspect ratio";b.aspect=c;var e=Math.tan(b.fov*Math.PI/360);c=b.near*e;var f=b.aspect*b.stereo_conv_dist*e;b.type==a.TYPE_STEREO_LEFT?(e=f-b.stereo_eye_dist/2,f+=b.stereo_eye_dist/2):(e=f+b.stereo_eye_dist/2,f-=b.stereo_eye_dist/2);e=-(b.near/b.stereo_conv_dist*e);f*=b.near/b.stereo_conv_dist;Y.frustum(e,f,-c,c,b.near,b.far,b.proj_matrix);b.left=e;b.right=f;break;case a.TYPE_NONE:return;
default:throw"Wrong camera type: "+b.type;}d||(L(b),M(b))}function M(a){Y.copy(a.view_matrix,a.sky_vp_inv_matrix);a.sky_vp_inv_matrix[12]=0;a.sky_vp_inv_matrix[13]=0;a.sky_vp_inv_matrix[14]=0;a.sky_vp_inv_matrix[15]=1;Y.multiply(a.proj_matrix,a.sky_vp_inv_matrix,a.sky_vp_inv_matrix);Y.invert(a.sky_vp_inv_matrix,a.sky_vp_inv_matrix)}function L(a){Y.copy(a.view_matrix,a.view_proj_matrix);Y.multiply(a.proj_matrix,a.view_proj_matrix,a.view_proj_matrix);Y.invert(a.view_proj_matrix,a.view_proj_inv_matrix)}
function N(b,c,d,e,f){e||(e=new Float32Array(24));c||(c=b.near);d||(d=b.far);var h,k,g,l,m,n,p,r;switch(b.type){case a.TYPE_NONE:throw"Extraction from NONE camera is not possible";case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:h=c*Math.tan(b.fov*Math.PI/360);l=-h;k=h*b.aspect;g=-k;m=d/c*h;r=-m;n=m*b.aspect;p=-n;break;case a.TYPE_ORTHO:case a.TYPE_ORTHO_ASPECT:g=b.top*b.aspect;h=m=b.top;k=n=g;l=r=-b.top;g=p=-g;break;case a.TYPE_ORTHO_ASYMMETRIC:h=m=b.top;k=n=b.right;l=r=b.bottom;g=p=b.left;break;case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:m=
c/b.near;h=c*Math.tan(b.fov*Math.PI/360);l=-h;k=b.right*m;g=b.left*m;p=d/c;m=h*p;r=-m;n=k*p;p*=g;break;default:throw"Wrong camera type: "+b.type;}e[0]=g;e[1]=l;e[2]=-c;e[3]=k;e[4]=l;e[5]=-c;e[6]=k;e[7]=h;e[8]=-c;e[9]=g;e[10]=h;e[11]=-c;e[12]=p;e[13]=r;e[14]=-d;e[15]=p;e[16]=m;e[17]=-d;e[18]=n;e[19]=m;e[20]=-d;e[21]=n;e[22]=r;e[23]=-d;f&&(c=ja,Y.invert(b.view_matrix,c),T.positions_multiply_matrix(e,c,e,0));return e}function B(b){return U.is_camera(b)&&b.render&&b.render.move_style==a.MS_HOVER_CONTROLS}
function O(a,b){if(b.enable_csm){var c=b.csm_num;if(!a.csm_centers){var d=b.csm_num;a.csm_centers=Array(d);for(var e=0;e<d;e++)a.csm_centers[e]=new Float32Array(3);a.csm_radii=new Float32Array(d)}for(d=0;d<c;d++){var e=0==d?a.near:F(b,a,d-1),f=F(b,a,d),e=N(a,e,f,ta),e=Q.get_frustum_mec(e);a.csm_centers[d].set(e.center);a.csm_radii[d]=e.radius;a.csm_center_dists[d]=Z.length(e.center);a.pcf_blur_radii[d]=C(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}else a.pcf_blur_radii[0]=b.first_cascade_blur_radius}
function F(a,b,c){var d=a.csm_num,e=T.clamp(a.csm_first_cascade_border,b.near,b.far);a=T.clamp(a.csm_last_cascade_border,b.near,b.far);c=C(e,a,d,c);return T.clamp(c,b.near,b.far)}function C(a,b,c,d){switch(d){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,d/(c-1))}return a}function I(a,b){b||(b=new Float32Array(3));var c=W.get_trans_view(a.render.world_tsr);Z.copy(c,b);return b}var Q=t("__boundings");t("__config");var G=t("__constraints"),z=t("__container");t("__mat3");var Y=t("__mat4"),
U=t("__obj_util"),P=t("__print"),da=t("__quat"),fa=t("__scenes"),aa=t("__transform"),W=t("__tsr"),T=t("__util"),Z=t("__vec3"),ba=t("__vec4");t("__physics");a.TYPE_NONE=10;a.TYPE_PERSP=20;a.TYPE_ORTHO=30;a.TYPE_PERSP_ASPECT=40;a.TYPE_ORTHO_ASPECT=50;a.TYPE_ORTHO_ASYMMETRIC=60;a.TYPE_STEREO_LEFT=70;a.TYPE_STEREO_RIGHT=80;a.MS_STATIC=0;a.MS_TARGET_CONTROLS=2;a.MS_EYE_CONTROLS=3;a.MS_HOVER_CONTROLS=4;var pa=Math.PI/180/2,ga=new Float32Array(2),ka=new Float32Array(2),J=new Float32Array(3),V=new Float32Array(3),
S=new Float32Array(3),R=new Float32Array(4),ua=new Float32Array(4),ia=new Float32Array(4),na=new Float32Array(4);new Float32Array(16);var ja=new Float32Array(16),ta=new Float32Array(24);a.camera_object_to_camera=function(b,f){var h=f.render,k=b.data;switch(k.type){case "PERSP":var l=d(a.TYPE_PERSP);if(k.angle_y)var m=k.angle_y/Math.PI*180;g(l,m,k.clip_start,k.clip_end);break;case "ORTHO":l=d(a.TYPE_ORTHO),g(l,k.ortho_scale/2,k.clip_start,k.clip_end)}l.name=f.name;h.underwater=!1;h.move_style=e(k.b4w_move_style);
h.dof_distance=k.dof_distance;m=k.dof_object;h.dof_object=m?m._object:null;h.dof_front=k.b4w_dof_front;h.dof_rear=k.b4w_dof_rear;h.dof_power=k.b4w_dof_power;h.enable_hover_hor_rotation=k.b4w_enable_hover_hor_rotation;h.hover_zero_level=k.b4w_hover_zero_level;h.cameras=[l];h.shadow_cameras=[];h.velocity_trans=k.b4w_trans_velocity;h.velocity_rot=k.b4w_rot_velocity;h.velocity_zoom=k.b4w_zoom_velocity;h.move_style==a.MS_TARGET_CONTROLS&&(h.pivot.set(k.b4w_target),K(f));k=f.render;m=k.move_style;if(m===
a.MS_TARGET_CONTROLS||m===a.MS_EYE_CONTROLS||m===a.MS_HOVER_CONTROLS){var n=b.data,p=null,r=null,q=null,u=null,x=null;m===a.MS_TARGET_CONTROLS||m===a.MS_EYE_CONTROLS?(n.b4w_use_panning&&(k.use_panning=n.b4w_use_panning),n.b4w_use_horizontal_clamping&&(p={left:n.b4w_rotation_left_limit,left_local:n.b4w_rotation_left_limit,right:n.b4w_rotation_right_limit,right_local:n.b4w_rotation_right_limit,camera_space:"LOCAL"==n.b4w_horizontal_clamping_type}),n.b4w_use_vertical_clamping&&(r={down:n.b4w_rotation_down_limit,
down_local:n.b4w_rotation_down_limit,up:n.b4w_rotation_up_limit,up_local:n.b4w_rotation_up_limit,camera_space:"LOCAL"==n.b4w_vertical_clamping_type}),m===a.MS_TARGET_CONTROLS&&n.b4w_use_target_distance_limits&&n.b4w_distance_min<=n.b4w_distance_max&&(q={min:n.b4w_distance_min,max:n.b4w_distance_max})):m===a.MS_HOVER_CONTROLS&&(n.b4w_use_horizontal_clamping&&n.b4w_horizontal_translation_min<=n.b4w_horizontal_translation_max&&(u={min:n.b4w_horizontal_translation_min,max:n.b4w_horizontal_translation_max}),
n.b4w_use_vertical_clamping&&n.b4w_vertical_translation_min<=n.b4w_vertical_translation_max&&(x={min:n.b4w_vertical_translation_min,max:n.b4w_vertical_translation_max}),n.b4w_use_zooming&&(n.b4w_hover_angle_min<=n.b4w_hover_angle_max?r={down:n.b4w_hover_angle_min,up:n.b4w_hover_angle_max}:P.error("Wrong angle limits for the HOVER camera. Disabling angle limits."),n.b4w_distance_min<=n.b4w_distance_max?q={min:n.b4w_distance_min,max:n.b4w_distance_max}:P.error("Wrong distance limits for the HOVER camera. Disabling distance limits.")));
k.horizontal_limits=p;k.vertical_limits=r;k.distance_limits=q;k.hover_horiz_trans_limits=u;k.hover_vert_trans_limits=x;k=f.render;switch(k.move_style){case a.MS_EYE_CONTROLS:k.horizontal_limits&&(k.horizontal_limits.left*=-1,k.horizontal_limits.right*=-1);break;case a.MS_TARGET_CONTROLS:k.vertical_limits&&(k.vertical_limits.down*=-1,k.vertical_limits.up*=-1);break;case a.MS_HOVER_CONTROLS:k.hover_vert_trans_limits&&(m=-k.hover_vert_trans_limits.min,k.hover_vert_trans_limits.min=-k.hover_vert_trans_limits.max,
k.hover_vert_trans_limits.max=m),k.vertical_limits&&(k.vertical_limits.down*=-1,k.vertical_limits.up*=-1)}D(f);A(f)}h.move_style===a.MS_HOVER_CONTROLS&&v(f);l.type==a.TYPE_ORTHO&&c(f)};a.init_hover_behavior=v;a.init_ortho_props=c;a.create_frustum_planes=b;a.move_style_bpy_to_b4w=e;a.create_camera=d;a.check_attachment=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.color_attachment);case "DEPTH":return Boolean(a.depth_attachment);case "SCREEN":return!Boolean(a.color_attachment)&&
!Boolean(a.depth_attachment);default:throw"Wrong attachment type: "+b;}};a.set_attachment=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.color_attachment=c;break;case "DEPTH":a.depth_attachment=c;break;case "SCREEN":a.color_attachment=null;a.depth_attachment=null;break;default:throw"Wrong attachment type: "+b;}};a.get_attachment=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.color_attachment;case "DEPTH":return a.depth_attachment;case "SCREEN":return null;default:throw"Wrong attachment type: "+
b;}};a.make_stereo=function(b,c){if(b.type!=a.TYPE_PERSP||c!=a.TYPE_STEREO_LEFT&&c!=a.TYPE_STEREO_RIGHT)throw"make_stereo(): wrong camera type";b.type=c;l(b,6,.065)};a.set_stereo_params=l;a.get_camera_angles=n;a.get_camera_angles_from_quat=q;a.get_camera_angles_char=function(a,b){n(a,b);b[0]=T.angle_wrap_0_2pi(b[0]+Math.PI);b[1]*=-1;return b};a.get_angles=function(a,b){var c=W.get_quat_view(a.render.world_tsr),d=T.quat_to_dir(c,T.AXIS_MY,J),e=Math.asin(d[1]/Z.length(d));0==d[0]&&0==d[2]?c=0:(Math.abs(e)>
Math.PI/4&&(d=0>=e?T.quat_to_dir(c,T.AXIS_MZ,V):T.quat_to_dir(c,T.AXIS_Z,V)),c=Math.atan(Math.abs(d[0]/d[2])),0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=e;return b};a.set_frustum=g;a.set_frustum_asymmetric=function(b,c,d,e,f,h,k){switch(b.type){case a.TYPE_ORTHO_ASYMMETRIC:b.left=c;b.right=d;b.bottom=e;b.top=f;b.near=h;b.far=k;break;default:P.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.get_move_style=function(a){return a.render.move_style};a.set_view=u;
a.set_view_eye_target_up=k;a.set_view_trans_quat=function(a,b,c){var d=J;d[0]=0;d[1]=-1;d[2]=0;Z.transformQuat(d,c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=V;e[0]=0;e[1]=0;e[2]=-1;Z.transformQuat(e,c,e);k(a,b,d,e)};a.set_look_at=f;a.update_camera_transform=p;a.update_camera=function(b){var c=b.render,d=b.render;if(d.move_style===a.MS_TARGET_CONTROLS||d.move_style===a.MS_EYE_CONTROLS){if(d.horizontal_limits){var e=d.horizontal_limits.left,f=d.horizontal_limits.right,k=n(b,ga);(k=d.move_style==a.MS_TARGET_CONTROLS?
T.calc_returning_angle(k[0],e,f):T.calc_returning_angle(k[0],f,e))&&(d.move_style==a.MS_TARGET_CONTROLS?w(b,k,0):x(b,k,0))}d.vertical_limits&&(e=d.vertical_limits.down,f=d.vertical_limits.up,k=n(b,ga),(k=d.move_style==a.MS_TARGET_CONTROLS?T.calc_returning_angle(k[1],f,e):T.calc_returning_angle(k[1],e,f))&&(d.move_style==a.MS_TARGET_CONTROLS?w(b,0,k):x(b,0,k)));if(d.move_style===a.MS_TARGET_CONTROLS&&d.distance_limits){var k=b.render,e=W.get_trans_view(k.world_tsr),f=Z.subtract(e,k.pivot,J),g=Z.length(f);
g>k.distance_limits.max?(Z.scale(f,k.distance_limits.max/g,f),Z.add(k.pivot,f,e)):g<k.distance_limits.min&&(g=W.get_quat_view(k.world_tsr),g=T.quat_to_dir(g,T.AXIS_MY,V),Z.scale(g,100*k.distance_limits.min,g),Z.add(f,g,f),Z.scale(f,-k.distance_limits.min/Z.length(f),f),Z.add(k.pivot,f,e))}}d.move_style===a.MS_HOVER_CONTROLS&&(d=b.render,d.hover_horiz_trans_limits&&(e=T.clamp(d.hover_pivot[0],d.hover_horiz_trans_limits.min,d.hover_horiz_trans_limits.max)-d.hover_pivot[0],d.hover_pivot[0]+=e,k=W.get_trans_view(d.world_tsr),
k[0]+=e),d.hover_vert_trans_limits&&(e=T.clamp(d.hover_pivot[2],d.hover_vert_trans_limits.min,d.hover_vert_trans_limits.max)-d.hover_pivot[2],d.hover_pivot[2]+=e,k=W.get_trans_view(d.world_tsr),k[2]+=e),d=b.render,k=n(b,ga)[1],(d=T.calc_returning_angle(k,d.vertical_limits.up,d.vertical_limits.down))&&r(b,0,d));h(b);switch(c.move_style){case a.MS_TARGET_CONTROLS:d=W.get_trans_view(c.world_tsr);k=W.get_quat_view(c.world_tsr);G.rotate_to(d,k,c.pivot);G.correct_up(b,T.AXIS_Y);break;case a.MS_EYE_CONTROLS:b.constraint||
G.correct_up(b,T.AXIS_Y)}K(b)};a.update_camera_upside_down=K;a.prepare_horizontal_limits=D;a.prepare_vertical_limits=A;a.update_ortho_scale=h;a.rotate_eye_camera=x;a.rotate_target_camera=w;a.rotate_hover_camera=r;a.is_float_aspect=function(b){switch(b.type){case a.TYPE_PERSP:case a.TYPE_ORTHO:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:return!0;default:return!1}};a.get_angular_diameter=function(b){b=b.render.cameras[0];switch(b.type){case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:return Math.PI*
b.fov/180;default:return P.error("get_min_fov(): Unsupported camera type: "+b.type),0}};a.set_projection=y;a.calc_sky_vp_inverse=M;a.calc_view_proj_inverse=L;a.extract_frustum_corners=N;a.assign_boundings=function(a){a=a.render;var b=Q.zero_bounding_box();b.min_x=-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.bb_local=b;var c=Q.create_bounding_sphere(1,[0,0,0]);a.bs_local=c;a.bcap_local=Q.create_bounding_capsule(1,b);a.bcyl_local=Q.create_bounding_cylinder(1,b);a.bcon_local=Q.create_bounding_cone(1,
b)};a.is_static_camera=function(b){return U.is_camera(b)&&b.render&&b.render.move_style==a.MS_STATIC};a.is_target_camera=function(b){return U.is_camera(b)&&b.render&&b.render.move_style==a.MS_TARGET_CONTROLS};a.is_eye_camera=function(b){return U.is_camera(b)&&b.render&&b.render.move_style==a.MS_EYE_CONTROLS};a.is_hover_camera=B;a.is_ortho_camera=function(b){return U.is_camera(b)&&b.render&&b.render.cameras[0].type==a.TYPE_ORTHO};a.update_camera_shadows=O;a.csm_far_plane=F;a.project_point=function(b,
c,d){b=b.render.cameras[0];switch(b.type){case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:case a.TYPE_ORTHO:case a.TYPE_ORTHO_ASPECT:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:var e=ia;e.set(c);e[3]=1;ba.transformMat4(e,b.view_proj_matrix,e);c=-e[1]/e[3];d[0]=(e[0]/e[3]+1)/2*b.width;d[1]=(c+1)/2*b.height;z.viewport_to_canvas_coords(d[0],d[1],d,b);2<d.length&&(d[2]=(e[2]/Math.abs(e[3])+1)/2);return d;default:return P.error("Non-compatible camera"),d}};a.get_first_cam=function(a){return a.render.cameras[0]};
a.get_edge=function(b,c){switch(b.type){case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:var d=Math.tan(T.rad(b.fov)/2);switch(c){case "LEFT":return-d*b.aspect;case "RIGHT":return d*b.aspect;case "TOP":return d;case "BOTTOM":return-d}break;case a.TYPE_ORTHO:case a.TYPE_ORTHO_ASPECT:switch(c){case "LEFT":return-b.top*b.aspect;case "RIGHT":return b.top*b.aspect;case "TOP":return b.top;case "BOTTOM":return-b.top}break;case a.TYPE_ORTHO_ASYMMETRIC:switch(c){case "LEFT":return b.left;
case "RIGHT":return b.right;case "TOP":return b.top;case "BOTTOM":return b.bottom}break;default:T.panic("Unknown camera type")}};a.is_ortho=function(b){switch(b.type){case a.TYPE_ORTHO:case a.TYPE_ORTHO_ASPECT:case a.TYPE_ORTHO_ASYMMETRIC:return!0;default:return!1}};a.get_fov=function(b,c){switch(b.type){case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:var d=T.rad(b.fov);return c?d*b.aspect:d;default:return 0}};a.set_trans_pivot=function(a,b,c){a=a.render;
W.set_trans(b,a.world_tsr);Z.copy(c,a.pivot)};a.hover_set_vertical_limits=function(a,b){var c=a.render;c.vertical_limits=c.vertical_limits||{};c.vertical_limits.down=b.down;c.vertical_limits.up=b.up;A(a);E(a)};a.apply_distance_limits=function(b,c){var d=b.render;c?(d.distance_limits=d.distance_limits||{},d.distance_limits.min=c.min,d.distance_limits.max=c.max,b.render.move_style==a.MS_HOVER_CONTROLS&&E(b)):d.distance_limits=null};a.set_hover_pivot=function(a,b){var c=a.render,d=Z.subtract(b,c.hover_pivot,
J),e=W.get_trans_view(c.world_tsr),d=Z.add(d,e,d);aa.set_translation(a,d);Z.copy(b,c.hover_pivot)};a.get_eye=I;a.set_move_style=function(b,d){b.render.move_style=d;b.render.horizontal_limits=null;b.render.vertical_limits=null;b.render.distance_limits=null;b.render.hover_horiz_trans_limits=null;b.render.hover_vert_trans_limits=null;c(b);switch(d){case a.MS_HOVER_CONTROLS:v(b);break;case a.MS_TARGET_CONTROLS:var e=I(b,J),f=W.get_quat_view(b.render.world_tsr),f=T.quat_to_dir(f,T.AXIS_MY,V),e=Z.scaleAndAdd(e,
f,10,f);Z.copy(e,b.render.pivot)}}};b4w.module.__lights=function(a,t){function v(a){e.scale(a.color,a.energy,a.color_intensity)}t("__print");var c=t("__tsr"),b=t("__util"),e=t("__vec3"),d=new Float32Array(3);new Float32Array(3);a.lamp_to_light=function(a,n){var q=a.data,g={name:"",type:q.type,prev_direction:new Float32Array(3),direction:new Float32Array(3),color:new Float32Array(3),color_intensity:new Float32Array(3),default_energy:0,spot_size:0,spot_blend:0,generate_shadows:!1,need_sun_fog_update:!1,dynamic_intensity:!1,use_diffuse:!0,
use_specular:!0,energy:1,distance:25,falloff_type:"INVERSE_SQUARE"},g=n.light=g;g.name=n.name;g.use_diffuse=q.use_diffuse;g.use_specular=q.use_specular;var u=c.get_quat_view(n.render.world_tsr),u=b.quat_to_dir(u,b.AXIS_Y,d);e.normalize(u,u);g.direction.set(u);g.color[0]=q.color[0];g.color[1]=q.color[1];g.color[2]=q.color[2];g.energy=g.default_energy=q.energy;v(g);g.distance=q.distance;if("POINT"===g.type||"SPOT"===g.type)g.distance=q.distance;"SPOT"===g.type?(g.spot_blend=q.spot_blend,g.spot_size=
q.spot_size):"POINT"===g.type&&(g.spot_size=Math.PI/2);g.generate_shadows=q.b4w_generate_shadows;g.dynamic_intensity=q.b4w_dynamic_intensity};a.set_light_color=function(a,b){a.color[0]=b[0];a.color[1]=b[1];a.color[2]=b[2];v(a)};a.set_light_spot_blend=function(a,b){a.spot_blend=b};a.set_light_distance=function(a,b){a.distance=b};a.set_light_spot_size=function(a,b){a.spot_size=b};a.set_light_energy=function(a,b){a.energy=b;v(a)};a.update_light_transform=function(a){if("LAMP"!=a.type)throw"Wrong light object";
var d=a.light;if(d){a=c.get_quat_view(a.render.world_tsr);b.quat_to_dir(a,b.AXIS_Y,d.direction);e.normalize(d.direction,d.direction);if("SUN"==d.type){a=Math.acos(e.dot(d.prev_direction,b.VEC3_UNIT));var q=Math.acos(e.dot(d.direction,b.VEC3_UNIT));d.need_sun_fog_update=Math.floor(a/.025)!=Math.floor(q/.025)?!0:!1}e.copy(d.direction,d.prev_direction)}}};b4w.module.__scenes=function(a,t){function v(a){for(var b=0;b<a.length;b++){var c=a[b];if(!c._render_to_textures||!c._render_to_textures.length)return c}return null}function c(){if(!qb)throw"No active scene available";return qb}function b(a,b,c){if(!Da.depth_tex_available||!e(a,b,c))return null;a=a.b4w_shadow_settings;c={};a.csm_resolution>Da.max_texture_size?(c.csm_resolution=Da.max_texture_size,fb.error("Shadow map texture has unsupported size. Changed to "+Da.max_texture_size+".")):c.csm_resolution=
a.csm_resolution;c.self_shadow_polygon_offset=a.self_shadow_polygon_offset;c.self_shadow_normal_offset=a.self_shadow_normal_offset;c.enable_csm=a.b4w_enable_csm;if(b=ya.get_first_lamp_with_shadows(b)||b[0])c.lamp_type=b.light.type,c.spot_size=b.light.spot_size,c.distance=b.light.distance,"SPOT"!=c.lamp_type&&"POINT"!=c.lamp_type||!c.enable_csm||(fb.warn("Generating shadows for SPOT or POINT light. Disabling Cascaded Shadow Maps"),c.enable_csm=!1);c.enable_csm?(c.csm_num=a.csm_num,c.csm_first_cascade_border=
a.csm_first_cascade_border,c.first_cascade_blur_radius=a.first_cascade_blur_radius,c.csm_last_cascade_border=a.csm_last_cascade_border,c.last_cascade_blur_radius=a.last_cascade_blur_radius,c.fade_last_cascade=a.fade_last_cascade,c.blend_between_cascades=a.blend_between_cascades):(c.csm_num=1,c.csm_first_cascade_border=a.csm_first_cascade_border,c.first_cascade_blur_radius=a.first_cascade_blur_radius,c.csm_last_cascade_border=a.csm_last_cascade_border,c.last_cascade_blur_radius=a.last_cascade_blur_radius,
c.fade_last_cascade=!1,c.blend_between_cascades=!1);return c}function e(a,b,c){if(Da.shadows)switch(a.b4w_render_shadows){case "OFF":return!1;case "ON":return!0}else return!1;var d=!1,e=!1;a=Da.ssao&&a.b4w_enable_ssao;if(0==b.length&&!a)return!1;for(b=0;b<c.length;b++){var f=c[b];f.b4w_shadow_cast&&(d=!0);f.b4w_shadow_receive&&(e=!0);if((a||d)&&e)return!0}return!1}function d(a){for(var b=0;b<a.length;b++)if("SUN"==a[b].light.type)return!0;return!1}function l(a){if(!Da.shore_smoothing)return!1;a=ga(a);
for(var b=0;b<a.length;b++){var c=a[b];if(c.b4w_water&&c.b4w_water_shore_smoothing)return!0}return!1}function n(a){for(var b=0;b<a.length;b++)for(var c=a[b].particle_systems,d=0;d<c.length;d++){var e=c[d].settings;if(e.b4w_enable_soft_particles&&0<e.b4w_particles_softness)return!0}return!1}function q(a){for(var b=ga(a),c=[],d=0;d<b.length;d++){var e=b[d];if(e.b4w_water){for(var f={},h=0;h<a.length;h++)for(var k=a[h],g=k.data.materials,l=0;l<g.length;l++)g[l]==e&&(f.water_level=k.location[1]);f.fog_color_density=
e.b4w_water_fog_color.slice(0);f.fog_color_density.push(e.b4w_water_fog_density);e.b4w_water_dynamic?(f.dynamic=!0,f.waves_height=e.b4w_waves_height,f.waves_length=e.b4w_waves_length,f.dst_noise_scale0=e.b4w_water_dst_noise_scale0,f.dst_noise_scale1=e.b4w_water_dst_noise_scale1,f.dst_noise_freq0=e.b4w_water_dst_noise_freq0,f.dst_noise_freq1=e.b4w_water_dst_noise_freq1,f.dir_min_shore_fac=e.b4w_water_dir_min_shore_fac,f.dir_freq=e.b4w_water_dir_freq,f.dir_noise_scale=e.b4w_water_dir_noise_scale,f.dir_noise_freq=
e.b4w_water_dir_noise_freq,f.dir_min_noise_fac=e.b4w_water_dir_min_noise_fac,f.dst_min_fac=e.b4w_water_dst_min_fac,f.waves_hor_fac=e.b4w_water_waves_hor_fac):(f.dynamic=!1,f.waves_height=0,f.waves_length=0);f.caustics=e.b4w_water_enable_caust;f.caustic_scale=e.b4w_water_caust_scale;f.caustic_brightness=e.b4w_water_caust_brightness;f.caustic_speed=new Float32Array([.3,.7]);f.shoremap_image=null;e=e.texture_slots;for(h=0;h<e.length;h++)k=e[h].texture,!0===k.b4w_shore_dist_map&&(f.shoremap_image=k.image,
f.shoremap_tex_size=k.image.size[0],f.shore_boundings=k.b4w_shore_boundings,f.max_shore_dist=k.b4w_max_shore_dist);c.push(f)}}if(0<c.length){f=c[0];if(!f.dynamic)for(d=0;d<c.length;d++)c[d].dynamic&&(f=c[d]);return f}return null}function g(a){var b={refractions:!1};a=ga(a);for(var c=function(a){if(a){a=a.nodes;for(var d=0;d<a.length;d++){var e=a[d];"GROUP"==e.type&&e.node_group&&c(e.node_group.node_tree);"GROUP"==e.type&&"B4W_REFRACTION"==e.node_tree_name&&(b.refractions=!0)}}},d=0;d<a.length;d++){var e=
a[d];e.b4w_refractive&&(b.refractions=!0);e.node_tree&&c(e.node_tree)}return b}function u(a,b){if(Da.reflections)switch(a.b4w_render_reflections){case "OFF":return!1}else return!1;for(var c=[],d=0,e=0;e<b.length;e++){var f=b[e];f.render.reflective&&"CUBE"==f.render.reflection_type&&d++;if(f.reflective_objs.length){for(var h=null,k=0;k<c.length;k++)if(c[k]==f){h=k;break}null==h&&c.push(f)}}return{refl_plane_objs:c,num_cube_refl:d,cube_refl_subs:[],plane_refl_subs:[]}}function k(a,b){var c=a.b4w_sky_settings,
d={};d.render_sky=c.render_sky;d.procedural_skydome=c.procedural_skydome&&b;d.use_as_environment_lighting=c.use_as_environment_lighting;d.sky_color=c.color;d.rayleigh_brightness=c.rayleigh_brightness;d.mie_brightness=c.mie_brightness;d.spot_brightness=c.spot_brightness;d.scatter_strength=c.scatter_strength;d.rayleigh_strength=c.rayleigh_strength;d.mie_strength=c.mie_strength;d.rayleigh_collection_power=c.rayleigh_collection_power;d.mie_collection_power=c.mie_collection_power;d.mie_distribution=c.mie_distribution;
d.reflexible=c.reflexible;d.reflexible_only=c.reflexible_only;!b&&c.procedural_skydome&&fb.warn("There is no sun on the scene. Procedural sky won't be rendered");return d}function f(a){var b={};a=a.b4w_ssao_settings;b.radius_increase=a.radius_increase;b.hemisphere=a.hemisphere;b.blur_depth=a.blur_depth;b.blur_discard_value=a.blur_discard_value;b.influence=a.influence;b.dist_factor=a.dist_factor;b.samples=a.samples;return b}function p(a){if(!(Da.bloom&&a.b4w_enable_bloom&&a._render.sun_exist))return null;
var b={};a=a.b4w_bloom_settings;b.blur=a.blur;b.edge_lum=a.edge_lum;b.key=a.key;return b}function K(a){var b={};a=a.b4w_motion_blur_settings;b.mb_decay_threshold=a.motion_blur_decay_threshold;b.mb_factor=a.motion_blur_factor;return b}function D(a){var b={};a=a.b4w_color_correction_settings;b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b}function A(a){var b={};a=a.b4w_god_rays_settings;b.intensity=a.intensity;b.max_ray_length=a.max_ray_length;
b.steps_per_pass=a.steps_per_pass;return b}function h(a){var b={};b.outline_color=a.b4w_outline_color;b.outline_factor=a.b4w_outline_factor;return b}function x(a){var b={};a=a.b4w_glow_settings;b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=a.large_glow_mask_width;return b}function w(a,b){var c=a.light_settings,d={};d.environment_energy=c.environment_energy;d.use_environment_light=
c.use_environment_light;d.environment_color=c.environment_color;d.horizon_color=a.horizon_color.slice(0);d.zenith_color=a.zenith_color.slice(0);d.use_sky_paper=a.use_sky_paper;d.use_sky_blend=a.use_sky_blend;d.use_sky_real=a.use_sky_real;d.sky_texture_slot=null;d.sky_texture_param=null;d.environment_texture_slot=null;if(d.use_environment_light&&"SKY_TEXTURE"==d.environment_color&&(!b.procedural_skydome||!b.use_as_environment_lighting)){for(var c=null,e=0;e<a.texture_slots.length;e++)if(a.texture_slots[e].texture.b4w_use_as_environment_lighting){c=
a.texture_slots[e];break}c?d.environment_texture_slot=c:(fb.warn("environment lighting is set to 'Sky Texture', but there is no world texture with 'Sky Texture Usage' property set to 'ENVIRONMENT_LIGHTING'"),d.use_environment_light=!1)}for(e=0;e<a.texture_slots.length;e++)if(a.texture_slots[e].texture.b4w_use_as_skydome){c=a.texture_slots[e];d.sky_texture_slot=c;d.sky_texture_param={blend_factor:c.blend_factor,horizon_factor:c.horizon_factor,zenith_up_factor:c.zenith_up_factor,zenith_down_factor:c.zenith_down_factor,
color:c.color,default_value:c.default_value,invert:c.invert,use_rgb_to_intensity:c.use_rgb_to_intensity,blend_type:c.blend_type,use_map_blend:c.use_map_blend,use_map_horizon:c.use_map_horizon,use_map_zenith_up:c.use_map_zenith_up,use_map_zenith_down:c.use_map_zenith_down};break}return d}function r(a){var b=a.fog_settings,c={};c.use_fog=b.use_fog;c.intensity=b.intensity;c.depth=b.depth;c.start=b.start;c.height=b.height;c.falloff=b.falloff;c.color=b.use_custom_color?b.color.slice(0):a.horizon_color.slice(0);
a=c.color;c.fog_color_density=new Float32Array([a[0],a[1],a[2],1/c.depth]);c.fog_params=new Float32Array([c.intensity,c.depth,c.start,c.height]);return c}function m(a){if(!Da.dynamic_grass)return!1;for(var b=!1,c=!1,d=0;d<a.length;d++){for(var e=a[d],f=e.data.materials,h=0;h<f.length;h++)f[h].b4w_terrain&&(b=!0);e=e.particle_systems;for(h=0;h<e.length;h++)f=e[h].settings,"HAIR"==f.type&&f.b4w_dynamic_grass&&(c=!0);if(b&&c)return!0}return!1}function E(a,b){if(Fc.outlining_overview_mode)return!0;if(Da.enable_selectable)switch(a.b4w_enable_object_selection){case "OFF":return!1;
case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)if(b[c]._object.render.selectable)return!0;return!1}else return!1}function y(a,b){if(Fc.outlining_overview_mode)return!0;if(Da.enable_outlining)switch(a.b4w_enable_outlining){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)if(b[c]._object.render.outlining)return!0;return!1}else return!1}function M(a,b){if(Da.glow_materials)switch(a.b4w_enable_glow_materials){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=
0;c<b.length;c++)for(var d=b[c].data.materials,e=0;e<d.length;e++)if(ra.check_material_glow_output(d[e]))return!0;return!1}else return!1}function L(a,b){if(Da.refractions)switch(a.b4w_render_refractions){case "OFF":return!1;case "ON":return!0;case "AUTO":return b.refractions}else return!1}function N(a){for(var b=0;b<a.length;b++)for(var c=a[b].data.materials,d=0;d<c.length;d++){var e=c[d],f=e.game_settings.alpha_blend;if(e.b4w_render_above_all&&"OPAQUE"!=f&&"CLIP"!=f)return!0}return!1}function B(a,
b){switch(a.b4w_enable_anchors_visibility){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++){var d=b[c]._object;if(d.anchor&&d.anchor.detect_visibility)return!0}return!1}}function O(a,b,c){var d=sa.node_by_attr(a,b);sa.traverse_inputs(a,d,function(a,b,d){if(d.active){switch(d.from){case "COLOR":case "CUBEMAP":a=b.camera.color_attachment;break;case "DEPTH":a=b.camera.depth_attachment;break;case "SCREEN":a=null;break;case "MAIN_CUBE_REFLECT":return;default:throw"Wrong slink";
}switch(d.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":case "RESOLVE":case "COPY":case "u_cube_reflection":case "u_plane_reflection":break;default:if(!a)throw"Connection of SCREEN is forbidden";if(a.w_renderbuffer)throw"Batch texture can't use renderbuffer";la.check_uniform(c.shader,d.to)&&H.append_texture(c,a,d.to)}}});for(a=0;a<b.slinks_internal.length;a++){var d=b.slinks_internal[a],e=b.textures_internal[a];switch(d.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":case "RESOLVE":case "COPY":break;
default:if(e.w_renderbuffer)throw"Batch texture can't use renderbuffer";la.check_uniform(c.shader,d.to)&&H.append_texture(c,e,d.to)}}}function F(a,b){return{do_render:!0,do_render_cube:[!0,!0,!0,!0,!0,!0],obj_render:a,batch:b}}function C(a,b,c,d,e,f){for(var h=b.render,k=ya.get_scene_data(b,e).batches,g=0;g<k.length;g++){var l=k[g];if(!(l.shadow_cast_only||l.reflexible_only||"MAIN"!=l.type&&"NODES_GLOW"!=l.type&&"PARTICLES"!=l.type)&&("OPAQUE"==l.subtype&&"OPAQUE"==d||"BLEND"==l.subtype&&"BLEND"==
d||"XRAY"==l.subtype&&"XRAY"==d||"NODES_GLOW"==l.type&&"GLOW"==d)){f||(I(l,a,b,c,d,e),H.update_shader(l),Q(l));var m=F(h,l);a.bundles.push(m);O(c,a,l);G(l)}}var n=function(a,b){return a==b?0:a>b?1:-1};a.bundles.sort(function(a,b){return a.batch&&b.batch?-n(a.batch.blend,b.batch.blend)||-n(a.batch.alpha_clip,b.batch.alpha_clip)||n(a.batch.offset_z,b.batch.offset_z):0})}function I(a,b,c,d,e,f){var h=c.render,k=ya.get_scene_data(c,f),g="NO_SHADOWS";if((c=ma.find_subs(d,"SHADOW_CAST"))&&a.shadow_receive){switch(e){case "OPAQUE":g=
"SHADOW_MAPPING_OPAQUE";break;case "BLEND":case "XRAY":g="SHADOW_MAPPING_BLEND";break;case "COLOR_ID":case "REFLECT":case "GLOW":g="NO_SHADOWS";break;case "DEPTH":g="SHADOW_MASK_GENERATION";break;default:throw"Wrong subscene type";}H.assign_shadow_receive_dirs(a,f._render.shadow_params,c)}c=a.shaders_info;la.set_directive(c,"SHADOW_USAGE",g);a.dynamic_grass&&(g=ma.find_subs(d,"GRASS_MAP"))&&z(a,g,h);if("DEPTH"!=a.type&&"COLOR_ID"!=e||a.has_nodes)if(e=b.num_lights,la.set_directive(c,"NUM_LIGHTS",e),
la.set_directive(c,"NUM_LFACTORS",0==e%2?e/2:Math.floor(e/2)+1),la.set_directive(c,"REFLECTION_PASS",0),la.set_directive(c,"SSAO_ONLY",0),la.set_directive(c,"INVERT_FRONTFACING",0),b.water_params&&b.water_fog_color_density?la.set_directive(c,"WATER_EFFECTS",1):la.set_directive(c,"WATER_EFFECTS",0),b.water_params&&b.caustics&&h.caustics?(la.set_directive(c,"CAUSTICS",1),la.set_directive(c,"CAUST_SCALE",la.glsl_value(b.caust_scale)),la.set_directive(c,"CAUST_SPEED",la.glsl_value(b.caust_speed,2)),la.set_directive(c,
"CAUST_BRIGHT",la.glsl_value(b.caust_brightness))):la.set_directive(c,"CAUSTICS",0),b.water_params&&(la.set_directive(c,"WAVES_HEIGHT",la.glsl_value(b.water_waves_height)),la.set_directive(c,"WAVES_LENGTH",la.glsl_value(b.water_waves_length)),la.set_directive(c,"WATER_LEVEL",la.glsl_value(b.water_level))),h=k.cube_refl_subs,k=k.plane_refl_subs,-1!==a.texture_names.indexOf("u_mirrormap")?la.set_directive(c,"REFLECTION_TYPE","REFL_MIRRORMAP"):a.reflective&&h?(h=h.camera.color_attachment,H.append_texture(a,
h,"u_cube_reflection"),la.set_directive(c,"REFLECTION_TYPE","REFL_CUBE")):a.reflective&&k?(h=k.camera.color_attachment,H.append_texture(a,h,"u_plane_reflection"),la.set_directive(c,"REFLECTION_TYPE","REFL_PLANE")):la.set_directive(c,"REFLECTION_TYPE","REFL_NONE"),(k=ma.find_subs(d,"SKY"))?a.procedural_sky?(h=k.camera.color_attachment,H.append_texture(a,h,"u_sky")):Da.procedural_fog?(a.cube_fog=k.cube_fog,la.set_directive(c,"PROCEDURAL_FOG",1)):la.set_directive(c,"PROCEDURAL_FOG",0):la.set_directive(c,
"PROCEDURAL_FOG",0),h=f._render.world_light_set,h.use_environment_light&&(la.set_directive(c,"USE_ENVIRONMENT_LIGHT",1),"SKY_TEXTURE"==h.environment_color?(h=h.environment_texture_slot?H.get_batch_texture(h.environment_texture_slot,!1):k.camera.color_attachment,la.set_directive(c,"SKY_TEXTURE",1),H.append_texture(a,h,"u_sky_texture")):"SKY_COLOR"==h.environment_color&&la.set_directive(c,"SKY_COLOR",1)),h=f._render.world_fog_set,h.use_fog&&(la.set_directive(c,"USE_FOG",1),la.set_directive(c,"FOG_TYPE",
h.falloff)),a.refractive?(Da.depth_tex_available&&la.set_directive(c,"USE_REFRACTION_CORRECTION",1),"MAIN"==a.type&&a.has_nodes||"NODES_GLOW"==a.type?(la.set_directive(c,"REFRACTIVE",1),f._render.refractions?la.set_directive(c,"USE_REFRACTION",1):la.set_directive(c,"USE_REFRACTION",0)):f._render.refractions?la.set_directive(c,"REFRACTIVE",1):la.set_directive(c,"REFRACTIVE",0)):(la.set_directive(c,"REFRACTIVE",0),la.set_directive(c,"USE_REFRACTION",0),la.set_directive(c,"USE_REFRACTION_CORRECTION",
0)),a.water&&(Da.shore_smoothing&&a.water_shore_smoothing&&ma.find_subs(d,"DEPTH")?la.set_directive(c,"SHORE_SMOOTHING",1):la.set_directive(c,"SHORE_SMOOTHING",0),a.water_dynamic&&b.water_params&&b.water_waves_height?la.set_directive(c,"DYNAMIC",1):la.set_directive(c,"DYNAMIC",0)),"PARTICLES"==a.type&&(la.set_directive(c,"SIZE_RAMP_LENGTH",a.particles_data.size_ramp_length),la.set_directive(c,"COLOR_RAMP_LENGTH",a.particles_data.color_ramp_length)),!a.forked_batch)for(a=a.textures,b=0;b<a.length;b++)if(h=
a[b],"SCENE"==h.source)for(d=0;d<Qa.length;d++)for(c=Qa[d],k=Qa[d]._render_to_textures,e=0;e<k.length;e++)k[e]._render==h&&sa.append_edge_attr(cb,c,f,null)}function Q(a){var b=a.shader.attributes,c=a.bufs_data.pointers,d;for(d in b)c[d]||Ga.panic('missing data for "'+d+'" attribute');if("MAIN"==a.type||"NODES_GLOW"==a.type)if(b=la.get_varyings_count(a.shader.vshader),10<b&&("MAIN"==a.type&&fb.warn("Varying limit exceeded for main shader - "+b+', materials: "'+a.material_names.join(", ")+'"'),"MAIN"==
a.type&&a.has_nodes||"NODES_GLOW"==a.type))d=c=0,a.uv_maps_usage&&(c=Ga.get_dict_length(a.uv_maps_usage)),a.vertex_colors_usage&&(d=Ga.get_dict_length(a.vertex_colors_usage)),fb.warn("Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials: "'+a.material_names.join(", ")+'"')}function G(a){8<a.textures.length&&fb.warn(a.type,"too many textures used - "+a.textures.length+' (max 8), materials "'+a.material_names.join(", ")+'"')}function z(a,b,c){a.grass_map_dim=b.grass_map_dim;
var d=b.grass_map_dim[0],e=b.grass_map_dim[1],f=b.grass_map_dim[2];c=c.bb_local;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);f=0==f?c:Math.max(f,c);b.grass_map_dim[2]=f;b=b.camera;oa.set_frustum(b,f/2,-e,-d,f/2);oa.set_projection(b);d=a.grass_size||0;d=0==d?c:Math.max(d,c);a.grass_size=d}function Y(a){ba(a);var b=V(a,"MAIN_OPAQUE"),c=!0,d=a._render.shadow_params;sa.traverse(a._render.graph,function(a,e){"SHADOW_CAST"===e.type&&(P(e,b.camera,e.bundles,d,c),c=!1)})}function U(a){sa.traverse(a._render.graph,
function(a,b){"OUTLINE"===b.type&&(b.draw_outline_flag=1)})}function P(a,b,c,d,e){if(0!=c.length){var f=a.camera,h=Pa.get_trans_view(b.world_tsr);Pa.set_trans(h,f.world_tsr);tb.copy(b.view_tsr,f.shadow_cast_billboard_view_tsr);if("SUN"===d.lamp_type||"HEMI"===d.lamp_type){h=db;ha.zero_bounding_box(h);for(var k=0;k<c.length;k++){var g=c[k].obj_render;0==k?ha.copy_bb(g.bb_world,h):ha.expand_bounding_box(h,g.bb_world)}c=ha.extract_bb_corners(h,Hc);Ga.positions_multiply_matrix(c,f.view_matrix,c);if(d.enable_csm){d=
tb.copy(b.csm_centers[a.csm_index],xc);h=bb.invert(b.view_matrix,Pc);Ga.positions_multiply_matrix(d,h,d);Ga.positions_multiply_matrix(d,f.view_matrix,d);a=b.csm_radii[a.csm_index];if(e)for(Ib=0,ab=-Infinity,e=2;e<c.length;e+=3)Ib=Math.min(Ib,c[e]),ab=Math.max(ab,c[e]);e=db;e.max_x=d[0]+a;e.max_y=d[1]+a;e.max_z=ab;e.min_x=d[0]-a;e.min_y=d[1]-a;e.min_z=Ib}else{a=e=db;b=kd;b.set(c);c=wc/9;d=bb.identity(Pc);bb.rotate(d,c,Ga.AXIS_MZ,d);k=h=-1;for(g=0;10>g;g++){var l=ha.bb_from_coords(b,vb),m=(l.max_x-
l.min_x)*(l.max_y-l.min_y);if(-1==h||m<h)h=m,k=g,ha.copy_bb(l,a);Ga.positions_multiply_matrix(b,d,b)}a=k*c;0<a&&(b=bb.identity(Pc),bb.rotate(b,a,Ga.AXIS_MZ,b),bb.multiply(b,f.view_matrix,f.view_matrix),Pa.from_mat4(f.view_matrix,f.view_tsr));a=e.max_x-e.min_x;b=e.max_y-e.min_y;a&&b&&(c=Math.abs(a-b)/2,2<a/b?(e.max_y+=c,e.min_y-=c):2<b/a&&(e.max_x+=c,e.min_x-=c));e.max_x+=.005;e.max_y+=.005;e.max_z+=.005;e.min_x-=.005;e.min_y-=.005;e.min_z-=.005}oa.set_frustum_asymmetric(f,e.min_x,e.max_x,e.min_y,
e.max_y,-e.max_z,-e.min_z);oa.set_projection(f);Ga.extract_frustum_planes(f.view_proj_matrix,f.frustum_planes)}else"SPOT"!==d.lamp_type&&"POINT"!==d.lamp_type||oa.set_projection(f,f.aspect)}}function da(a,b,c,d,e){for(var f=b.render,h=ya.get_scene_data(b,d).batches,k=0;k<h.length;k++){var g=h[k];"COLOR_ID"==g.type&&(e||(I(g,a,b,c,"COLOR_ID",d),H.update_shader(g),Q(g)),"COLOR_PICKING"==a.type&&"COLOR_ID"==g.subtype||"COLOR_PICKING_XRAY"==a.type&&"COLOR_ID_XRAY"==g.subtype)&&(e||(H.set_batch_directive(g,
"USE_OUTLINE",0),H.update_shader(g),Q(g)),g=F(f,g),a.bundles.push(g))}}function fa(a,b,c,d,e){d||(e.dynamic_grass&&(d=ma.find_subs(c,"GRASS_MAP"))&&z(e,d,b),H.update_shader(e),Q(e));b=F(b,e);a.bundles.push(b);O(c,a,e);G(e)}function aa(a,b){W(a,b);for(var c=0;c<a.scenes_data.length;c++)for(var d=wa.get_scene_objs(a.scenes_data[c].scene,"ALL",-1),e=0;e<d.length;e++)d[e].parent==a&&aa(d[e],b)}function W(a,b){a.render.hide=b;if(ya.is_lamp(a))for(var c=0;c<a.scenes_data.length;c++)for(var d=a.scenes_data[c],
e=J(d.scene,Yc),f=0;f<e.length;f++)Z(a,d,e[f])}function T(a,b){for(var c=J(b,Yc),d=a.light,e=a.render,f=ya.get_scene_data(a,b),h=f.light_index,k=Pa.get_trans_view(e.world_tsr),e=Pa.get_quat_view(e.world_tsr),g=0;g<c.length;g++){var l=c[g];l.light_positions.set(k,3*h);l.light_directions.set(d.direction,3*h);l.light_color_intensities.set(d.color_intensity,3*h);switch(d.type){case "SUN":l.sun_quaternion.set(e);l.sun_intensity=d.color_intensity;"SKY"===l.type?(l.need_fog_update=d.need_sun_fog_update,
tb.copy(d.direction,l.sun_direction),pa(b,l)):tb.copy(d.direction,l.sun_direction);break;case "HEMI":case "POINT":case "SPOT":break;default:fb.error("Unknown light type: "+d.type+'".')}Z(a,f,l);for(var m=0;m<l.bundles.length;m++){var n=l.bundles[m].batch;n.lamp_uuid_indexes&&H.set_lamp_data(n,a)}}c=V(b,"MAIN_OPAQUE").camera;f=f.shadow_subscenes;d=b._render.shadow_params;for(g=0;g<f.length;g++)l=f[g],oa.set_view_trans_quat(l.camera,k,e),P(l,c,l.bundles,d,!0)}function Z(a,b,c){var d=a.render;a=a.light;
b=b.light_index;var e=$b;e[0]=a.use_diffuse&&!d.hide?1:0;e[1]=a.use_specular&&!d.hide?1:0;c.light_factors.set(e,2*b);c.need_perm_uniforms_update=!0}function ba(a){a=wa.get_scene_objs(a,"LAMP",wa.DATA_ID_ALL);if(a=ya.get_first_lamp_with_shadows(a)||a[0])for(var b=a.render,c=Pa.get_trans_view(b.world_tsr),b=Pa.get_quat_view(b.world_tsr),d=0;d<a.scenes_data.length;d++)for(var e=a.scenes_data[d].shadow_subscenes,f=0;f<e.length;f++)oa.set_view_trans_quat(e[f].camera,c,b)}function pa(a,b){Hb.draw(b);if(b.need_fog_update)for(var c=
J(a,["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY","MAIN_GLOW"]),d=0;d<c.length;d++)for(var e=c[d].bundles,f=0;f<e.length;f++){var h=e[f];h.do_render&&(h=h.batch,H.check_batch_perm_uniform(h,"u_cube_fog")&&Hb.update_batch_permanent_uniform(h,"u_cube_fog"))}}function ga(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c].data,e=0;e<d.materials.length;e++){var f=d.materials[e];-1==b.indexOf(f)&&b.push(f)}return b}function ka(a,b,c){for(var d=a._render,e=a._camera.render.cameras,f=0;f<e.length;f++){var h=e[f];
oa.set_projection(h,b/c);d.shadow_params&&oa.update_camera_shadows(h,d.shadow_params)}d.shadow_params&&(d.need_shadow_update=!0,V(a,"DEPTH").need_perm_uniforms_update=!0,V(a,"MAIN_BLEND").need_perm_uniforms_update=!0);var k=d.graph;ma.traverse_slinks(k,function(d,e,f,h){if(d.update_dim){h=d.size_mult*b;var g=d.size_mult*c;if(e)for(e=0;e<f.slinks_internal.length;e++)f.slinks_internal[e]==d&&gb.resize(d.texture,h,g);else switch(gb.is_texture(d.texture)&&gb.resize(d.texture,h,g),d=f.camera,d.width=h,
d.height=g,f.type){case "DOF":S(a,{dof_power:f.camera.dof_power,dof_on:f.camera.dof_on});break;case "GLOW_COMBINE":ua(a,{small_glow_mask_width:f.small_glow_mask_width,large_glow_mask_width:f.large_glow_mask_width});break;case "BLOOM":R(a,{bloom_blur:f.bloom_blur});break;case "OUTLINE":f=ma.find_input(k,f,"POSTPROCESSING");d=ma.find_input(k,f,"POSTPROCESSING");h=ma.find_input(k,d,"POSTPROCESSING");g=ma.find_input(k,h,"POSTPROCESSING");ma.set_texel_size(f,1/b,1/c);ma.set_texel_size(d,1/b,1/c);ma.set_texel_size(h,
1/b,1/c);ma.set_texel_size(g,1/b,1/c);break;default:ma.set_texel_size(f,1/b,1/c)}}})}function J(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];sa.traverse(a._render.graph,function(a,b){b.type==e&&c.push(b)})}return c}function V(a,b){return ma.find_subs(a._render.graph,b)}function S(a,b){var c=V(a,"DOF");if(!c)return fb.error("DOF is not enabled on the scene. Check camera settings"),0;var d=a._render.graph;"boolean"==typeof b.dof_on&&(c.camera.dof_on=parseFloat(b.dof_on));"number"==typeof b.dof_distance&&
(c.camera.dof_distance=b.dof_distance);"number"==typeof b.dof_front&&(c.camera.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(c.camera.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){c.camera.dof_power=b.dof_power;var e=ma.find_input(d,c,"POSTPROCESSING"),d=ma.find_input(d,e,"POSTPROCESSING");ma.set_texel_size_mult(e,c.camera.dof_power);ma.set_texel_size(e,1/c.camera.width,1/c.camera.height);ma.set_texel_size_mult(d,c.camera.dof_power);ma.set_texel_size(d,1/c.camera.width,1/c.camera.height)}c.need_perm_uniforms_update=
!0}function R(a,b){var c=V(a,"LUMINANCE_TRUNCED"),d=V(a,"BLOOM");if(!c||!d)return fb.error("Bloom is not enabled on the scene"),0;"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.need_perm_uniforms_update=!0);"number"==typeof b.bloom_edge_lum&&(c.bloom_edge_lum=b.bloom_edge_lum,c.need_perm_uniforms_update=!0);if("number"==typeof b.bloom_blur){var e=a._render.graph,c=ma.find_input(e,d,"BLOOM_BLUR"),e=ma.find_input(e,c,"BLOOM_BLUR");d.bloom_blur=b.bloom_blur;ma.set_texel_size_mult(c,b.bloom_blur);
ma.set_texel_size(c,1/d.camera.width,1/d.camera.height);ma.set_texel_size_mult(e,b.bloom_blur);ma.set_texel_size(e,1/d.camera.width,1/d.camera.height)}}function ua(a,b){var c=V(a,"GLOW_COMBINE");if(!c)return fb.error("Glow is not enabled on the scene"),null;for(var d=a._render.graph,e=ma.get_inputs(d,c),f=0;f<e.length;++f){var h=e[f];if("POSTPROCESSING"===h.type&&"GLOW_MASK_LARGE"===h.subtype)var k=h;if("POSTPROCESSING"===h.type&&"GLOW_MASK_SMALL"===h.subtype)var g=h}e=ma.find_input(d,k,"POSTPROCESSING");
d=ma.find_input(d,g,"POSTPROCESSING");"number"==typeof b.small_glow_mask_coeff&&(c.small_glow_mask_coeff=b.small_glow_mask_coeff,c.need_perm_uniforms_update=!0);"number"==typeof b.large_glow_mask_coeff&&(c.large_glow_mask_coeff=b.large_glow_mask_coeff,c.need_perm_uniforms_update=!0);"number"==typeof b.small_glow_mask_width&&(c.small_glow_mask_width=b.small_glow_mask_width,ma.set_texel_size_mult(g,b.small_glow_mask_width),ma.set_texel_size(g,1/c.camera.width,1/c.camera.height),g.need_perm_uniforms_update=
!0,ma.set_texel_size_mult(d,b.small_glow_mask_width),ma.set_texel_size(d,1/c.camera.width,1/c.camera.height),d.need_perm_uniforms_update=!0);"number"==typeof b.large_glow_mask_width&&(c.large_glow_mask_width=b.large_glow_mask_width,ma.set_texel_size_mult(k,b.large_glow_mask_width),ma.set_texel_size(k,1/c.camera.width,1/c.camera.height),k.need_perm_uniforms_update=!0,ma.set_texel_size_mult(e,b.large_glow_mask_width),ma.set_texel_size(e,1/c.camera.width,1/c.camera.height),e.need_perm_uniforms_update=
!0)}function ia(a,b){var c=V(qb,"MAIN_OPAQUE");if(!c||!c.water_params)return fb.error("get_water_surface_level() - no water parameters on the scene"),0;var d=c.water_waves_height,e=c.water_waves_length,f=c.water_level,h=c.water_params;if(!d||!h.dynamic)return h.water_level;var k=tb.length(c.wind),g=c.time;k&&(g*=k);var l=$b;l[0]=20/e*(a-.25*g);l[1]=20/e*(b-.25*g);k=Ga.cellular2x2(l);l[0]=17/e*(b+.1*g);l[1]=17/e*(a+.1*g);var l=Ga.cellular2x2(l),k=k+l-1,m=h.dst_noise_scale0,l=h.dst_noise_scale1,n=h.dst_noise_freq0,
p=h.dst_noise_freq1,r=$b;r[0]=m*(a+n*g);r[1]=m*(b+n*g);m=Ga.snoise(r);r[0]=l*(b-p*g);r[1]=l*(a-p*g);l=Ga.snoise(r);l*=d*m;if(c.use_shoremap)if(p=(a-c.shoremap_center[0])/c.shoremap_size[0],r=(c.shoremap_center[1]+b)/c.shoremap_size[1],p+=.5,r+=.5,1<p||0>p||1<r||0>r)d=l;else var p=Ga.get_array_smooth_value(qb._render.shore_distances,c.shoremap_tex_size,p,r),r=h.dir_min_shore_fac,m=h.dir_freq,q=h.dir_noise_scale,u=h.dir_noise_freq,n=h.dir_min_noise_fac,h=h.dst_min_fac,c=e/c.max_shore_dist/Math.PI,q=
[q/e*(a+u*g),q/e*(b+u*g)],e=Math.sqrt(p),d=d*Math.max(p,r)*Math.sin(e/c+m*g)*Math.max(Ga.snoise(q),n),g=Math.max(e,h),d=d*(1-g)+l*g,k=k*p;else d=l;return f+(d+.05*k)}function na(a,b,c){b.is_for_outline&&"POSTPROCESSING"==b.type&&c.do_render!=b.do_render&&(b.do_render=c.do_render);c.do_render||"OUTLINE"!=b.type||(b.draw_outline_flag=0)}function ja(a,b,c,d){var e=sa.get_node_attr(a,b);oa.set_attachment(e.camera,c,d);e.assign_texture=!0;sa.traverse_outputs(a,b,function(b,e,f){f.active&&f.from==c&&ma.check_slink_tex_conn(f)&&
ta(a,b,f.to,d)});sa.traverse_inputs(a,b,function(b,e,f){f.active&&f.from==c&&f.from==f.to&&ja(a,b,c,d)})}function ta(a,b,c,d){a=sa.get_node_attr(a,b).bundles;for(b=0;b<a.length;b++)H.replace_texture(a[b].batch,d,c)}function ea(a){var b=V(a,"GRASS_MAP");if(b){var c=b.camera,d=a._camera.render;a=Pa.get_trans_view(d.world_tsr);var e=xc;e[0]=0;e[1]=-b.grass_map_dim[2]/2;e[2]=0;b=Pa.get_quat_view(d.world_tsr);tb.transformQuat(e,b,e);e[0]+=a[0];e[1]=0;e[2]+=a[2];b=ed;b[0]=0;b[1]=0;b[2]=0;b[3]=1;oa.set_view_trans_quat(c,
e,b)}}function qa(a,b){sa.traverse(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.slinks_internal[0]||!d.textures_internal[0])throw"Wrong MOTION_BLUR subscene";var e=d.slinks_internal[0],f=d.textures_internal[0];d.textures_internal[0]=d.camera.color_attachment;sa.traverse_outputs(a,c,function(b,c,d){d.active&&ta(a,b,d.to,f)});ja(a,c,e.from,f);ta(a,c,e.to,d.textures_internal[0]);d.motion_blur_exp=Math.exp(-b/d.mb_factor)}})}function Aa(a){return a._render.wind}var H=t("__batch"),ha=t("__boundings"),
oa=t("__camera");t("__compat");var ca=t("__config"),xa=t("__container");t("__constraints");var Ea=t("__debug"),X=t("__geometry"),sa=t("__graph"),va=t("__hud");t("__lights");var bb=t("__mat4"),ra=t("__nodemat"),wa=t("__objects"),ya=t("__obj_util"),Wb=t("__physics"),ic=t("__prerender"),zb=t("__primitives"),fb=t("__print"),Hb=t("__renderer"),ma=t("__scenegraph"),jc=t("__sfx"),la=t("__shaders"),gb=t("__textures"),Pa=t("__tsr"),Ga=t("__util"),tb=t("__vec3"),Da=ca.defaults,Fc=ca.outlining,ub=ca.scenes,
Gc="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH OUTLINE_MASK WIREFRAME".split(" ");a.OBJECT_SUBSCENE_TYPES=Gc;var Yc="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY LUMINANCE_TRUNCED DEPTH SHADOW_CAST COLOR_PICKING COLOR_PICKING_XRAY OUTLINE_MASK".split(" "),dd="MAIN_OPAQUE SSAO MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT".split(" "),
jd="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GOD_RAYS OUTLINE_MASK WIREFRAME".split(" "),Zc="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT".split(" "),oc=null,qb=null,Qa=[],cb=null,wc=Math.PI/2,$b=new Float32Array(2),xc=new Float32Array(3),ed=new Float32Array(4),Pc=new Float32Array(16),Hc=new Float32Array(24),kd=new Float32Array(24),db=ha.zero_bounding_box(),vb=ha.zero_bounding_box(),
Ib=0,ab=-Infinity;a.create_scene_render=function(){return{}};a.set_active=function(a){qb=a;jc.set_active_scene(a)};a.prepare_rendering=function(a,b){var c=a._render,d=ma.create_rendering_queue(c.graph);if(a==b){ka(a,xa.get_viewport_width(),xa.get_viewport_height());for(var e=0;e<d.length;e++)a._render.queue.push(d[e])}else for(e=a._render_to_textures[0],ka(a,e._render.source_size,e._render.source_size),e=0;e<d.length;e++)b._render.queue.push(d[e]);d=J(a,jd);for(e=0;e<d.length;e++)d[e].wind.set(c.wind);
for(e=0;e<c.queue.length;e++)"SHADOW_CAST"==c.queue[e].type&&Hb.draw(c.queue[e])};a.get_main=function(){oc||(oc=v(Qa));return oc};a.find_main_scene=v;a.get_active=c;a.check_active=function(){return qb?!0:!1};a.get_camera=function(a){return a._camera};a.get_all_scenes=function(){return Qa};a.get_rendered_scenes=function(){if(1==Qa.length)return Qa;for(var a=0;a<Qa.length;a++){var b=Qa[a]._render.graph;sa.traverse(b,function(b,c){for(var d=0;d<c.bundles.length;d++){for(var e=c.bundles[d].batch.textures,
f=null,h=0;h<e.length;h++)if("SCENE"==e[h].source&&e[h].source_id==Qa[a].name&&"COPY"!=c.type){fb.error('Texture-scene loop detected. A scene is rendered to texture "'+e[h].name+'" yet this texture belongs to the same scene.');sa.node_by_attr(cb,Qa[a]);f=c.bundles[d].batch;break}f&&(f.textures=[],f.texture_names=[],H.update_batch_material_debug(f,null),H.update_shader(f))}})}for(var c=[],a=0;a<Qa.length;a++)if(b=Qa[a],!b._render_to_textures.length){b=sa.node_by_attr(cb,b);sa.enforce_acyclic(cb,b);
b=sa.subgraph_node_conn(cb,b,sa.BACKWARD_DIR);b=sa.topsort(b);sa.traverse(b,function(a,b){c.push(b)});break}return c};a.append_scene=function(a,c,e,t,J){a._render_to_textures=a._render_to_textures||[];a._nla=null;var X=a._render,va=a._camera.render;X.video_textures=[];var v=a.world;X.lamps_number=e.length;X.sun_exist=d(e);X.sky_params=k(v,X.sun_exist);X.world_light_set=w(v,X.sky_params);X.world_fog_set=r(v);X.anchor_visibility=B(a,J);va.cameras[0].type!=oa.TYPE_PERSP&&Da.anaglyph_use?(fb.warn("Anaglyph stereo is disabled for the non-perspective camera"),
J=!1):J=Da.anaglyph_use;X.anaglyph_use=J;X.reflection_params=u(a,c);X.bloom_params=p(a);X.mb_params=K(a);X.cc_params=D(a);X.god_rays_params=A(a);X.outline_params=h(a);X.glow_params=x(a);X.dof=Da.dof&&(0<va.dof_distance||va.dof_object);X.motion_blur=Da.motion_blur&&a.b4w_enable_motion_blur;X.compositing=Da.compositing&&a.b4w_enable_color_correction;X.antialiasing=Da.antialiasing&&1==Da.msaa_samples&&"NONE"!=a.b4w_antialiasing_quality;X.ssao=Da.ssao&&a.b4w_enable_ssao;X.god_rays=Da.god_rays&&a.b4w_enable_god_rays&&
X.sun_exist;X.depth_tex=Da.depth_tex_available;X.glow_over_blend=a.b4w_glow_settings.render_glow_over_blend;X.ssao_params=f(a);J=g(t);X.materials_params=J;X.refractions=L(a,J);X.shadow_params=b(a,e,t);X.water_params=q(t);X.xray=N(t);X.soft_particles=n(t);X.shore_smoothing=l(t);X.dynamic_grass=m(t);X.color_picking=E(a,t);X.outline=y(a,t);X.glow_materials=M(a,t);switch(a.b4w_reflection_quality){case "LOW":X.cubemap_refl_size=ub.cube_reflect_low;X.plane_refl_size=ub.plane_reflect_low;break;case "MEDIUM":X.cubemap_refl_size=
ub.cube_reflect_medium;X.plane_refl_size=ub.plane_reflect_medium;break;case "HIGH":X.cubemap_refl_size=ub.cube_reflect_high;X.plane_refl_size=ub.plane_reflect_high;break;default:X.cubemap_refl_size=ub.cube_reflect_low,X.plane_refl_size=ub.plane_reflect_low}if(xa.is_hidpi())fb.log("%cENABLE HIDPI MODE","color: #00a"),X.aa_quality="AA_QUALITY_LOW",X.resolution_factor=1,Da.msaa_samples=1;else if(1<Da.msaa_samples)fb.log("%cENABLE MSAA RENDERING: "+Da.msaa_samples+"x","color: #00a"),X.resolution_factor=
1;else{X.aa_quality="AA_QUALITY_"+a.b4w_antialiasing_quality;switch(a.b4w_antialiasing_quality){case "LOW":X.antialiasing&&(X.resolution_factor=1);break;case "MEDIUM":Da.quality==ca.P_LOW||Da.quality==ca.P_HIGH?X.resolution_factor=1:Da.quality==ca.P_ULTRA&&(X.resolution_factor=1.33);break;case "HIGH":Da.quality==ca.P_LOW?X.resolution_factor=1:Da.quality==ca.P_HIGH?X.resolution_factor=1.33:Da.quality==ca.P_ULTRA&&(X.resolution_factor=2);break;case "NONE":Da.quality==ca.P_LOW||Da.quality==ca.P_HIGH?
X.resolution_factor=1:Da.quality==ca.P_ULTRA&&(X.resolution_factor=2)}Da.quality==ca.P_CUSTOM&&(X.resolution_factor=1)}e=a._render_to_textures.sort(function(a,b){return b._render.source_size-a._render.source_size});X.graph=ma.create_rendering_graph(X,va,e);X.queue=[];X.need_shadow_update=!1;X.need_grass_map_update=!1;X.need_outline=!1;X.wind=new Float32Array(3);Qa.push(a);cb||(cb=sa.create());sa.append_node_attr(cb,a);for(X=0;X<c.length;X++)ya.scene_data_set_active(c[X],!0,a);a=xa.get_container();
xa.resize(a.clientWidth,a.clientHeight,!0)};a.append_scene_vtex=function(a,b,c){for(var d=0;d<b.length;d++)b[d]._render&&b[d]._render.is_movie&&(b[d]._render.vtex_data_id=c,a._render.video_textures.push(b[d]))};a.get_graph=function(a){return a._render.graph};a.generate_auxiliary_batches=function(a){sa.traverse(a,function(b,c){var d=null;switch(c.type){case "POSTPROCESSING":d=H.create_postprocessing_batch(c.pp_effect);break;case "SSAO":d=H.create_ssao_batch(c);break;case "SSAO_BLUR":d=H.create_ssao_blur_batch(c);
break;case "DEPTH_PACK":d=H.create_depth_pack_batch();break;case "GOD_RAYS":d=ma.find_input(a,c,"RESOLVE")||ma.find_input(a,c,"WIREFRAME")||ma.find_input(a,c,"MAIN_BLEND")||ma.find_input(a,c,"GOD_RAYS");d=H.create_god_rays_batch(d.camera.color_attachment,c.pack,c.water,c.steps_per_pass);break;case "GOD_RAYS_COMBINE":var d=ma.find_input(a,c,"RESOLVE")||ma.find_input(a,c,"WIREFRAME")||ma.find_input(a,c,"MAIN_BLEND"),e=ma.find_input(a,c,"GOD_RAYS"),d=H.create_god_rays_combine_batch(d.camera.color_attachment,
e.camera.color_attachment);break;case "MOTION_BLUR":d=H.create_motion_blur_batch(c.mb_decay_threshold);break;case "DOF":var d=H.create_dof_batch(),e=ma.find_input(a,c,"POSTPROCESSING"),f=ma.find_input(a,e,"POSTPROCESSING");ma.set_texel_size_mult(e,c.camera.dof_power);ma.set_texel_size_mult(f,c.camera.dof_power);break;case "OUTLINE":var d=H.create_outline_batch(),e=ma.find_input(a,c,"POSTPROCESSING"),f=ma.find_input(a,e,"POSTPROCESSING"),h=ma.find_input(a,f,"POSTPROCESSING"),k=ma.find_input(a,h,"POSTPROCESSING");
ma.set_texel_size_mult(f,c.blur_texel_size_mult);ma.set_texel_size_mult(e,c.blur_texel_size_mult);ma.set_texel_size_mult(k,c.ext_texel_size_mult*c.outline_factor);ma.set_texel_size_mult(h,c.ext_texel_size_mult*c.outline_factor);break;case "GLOW_COMBINE":d=H.create_glow_combine_batch();break;case "COMPOSITING":d=H.create_compositing_batch();break;case "ANTIALIASING":d=H.create_antialiasing_batch(c);break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=
H.create_smaa_batch(c.type);break;case "ANAGLYPH":d=H.create_anaglyph_batch();break;case "SKY":d=H.create_procedural_sky_batch();break;case "LUMINANCE":d=H.create_luminance_batch();break;case "AVERAGE_LUMINANCE":d=H.create_average_luminance_batch();break;case "LUMINANCE_TRUNCED":d=H.create_luminance_trunced_batch();break;case "BLOOM_BLUR":d=H.create_bloom_blur_batch();break;case "BLOOM":d=ma.find_input(a,c,"BLOOM_BLUR");e=ma.find_input(a,d,"BLOOM_BLUR");ma.set_texel_size_mult(d,c.bloom_blur);ma.set_texel_size_mult(e,
c.bloom_blur);d=H.create_bloom_combine_batch();break;case "VELOCITY":d=H.create_velocity_batch();break;case "ANCHOR_VISIBILITY":d=H.create_anchor_visibility_batch()}d&&(e=F(ya.create_render("NONE"),d),Q(d),c.bundles.push(e),O(a,c,d),G(d))})};a.append_object=function(a,b,c){switch(b.type){case "MESH":var d=a._render.graph,e=b.render;!ma.find_subs(d,"SHADOW_CAST")&&e.shadow_receive&&(e.shadow_receive=!1);var f=J(a,Gc);c&&Wb.obj_has_physics(b)&&Wb.append_object(b,a);for(e=0;e<f.length;e++){var h=f[e],
k=b,g=d,l=a,m=c;switch(h.type){case "MAIN_OPAQUE":C(h,k,g,"OPAQUE",l,m);break;case "MAIN_BLEND":C(h,k,g,"BLEND",l,m);break;case "MAIN_XRAY":C(h,k,g,"XRAY",l,m);break;case "MAIN_GLOW":C(h,k,g,"GLOW",l,m);break;case "MAIN_PLANE_REFLECT":case "MAIN_CUBE_REFLECT":for(var n=k.render,p=ya.get_scene_data(k,l).batches,r=0;r<p.length;r++){var q=p[r];if(("MAIN"==q.type||"PARTICLES"==q.type)&&"REFLECT"==q.subtype){if("MAIN_PLANE_REFLECT"==h.type){var u;a:{u=l._render.reflection_params.plane_refl_subs;for(var x=
0;x<u.length;x++)if(u[x]==h){u=x;break a}u=null}if(u==n.plane_reflection_id)continue}else{a:{if(l._render.reflection_params)for(u=l._render.reflection_params.cube_refl_subs,x=0;x<u.length;x++)if(u[x]==h){u=x;break a}u=null}if(u==n.cube_reflection_id)continue}m||(I(q,h,k,g,"REFLECT",l),u=q.shaders_info,la.set_directive(u,"WATER_EFFECTS",0),la.set_directive(u,"INVERT_FRONTFACING",1),la.set_directive(u,"REFLECTION_PASS",1),la.set_directive(u,"TEXTURE_NORM",0),H.update_shader(q),Q(q));q=F(n,q);h.bundles.push(q)}}break;
case "DEPTH":n=ya.get_scene_data(k,l).batches;for(p=0;p<n.length;p++)r=n[p],"DEPTH"!=r.type||r.shadow_cast_only||!r.shadow_receive||"DEPTH"!=r.subtype&&"NODES"!=r.subtype||(m||(I(r,h,k,g,"DEPTH",l),H.update_shader(r),Q(r)),q=F(k.render,r),h.bundles.push(q),O(g,h,r),G(r));break;case "SHADOW_CAST":n=!1;p=k.render;k=ya.get_scene_data(k,l).batches;r=ma.find_subs(g,"GRASS_MAP");for(q=0;q<k.length;q++)u=k[q],"DEPTH"==u.type&&"SHADOW_CAST"==u.subtype&&(n=!0,m||(x=h.num_lights,H.set_batch_directive(u,"NUM_LIGHTS",
x),H.set_batch_directive(u,"NUM_LFACTORS",0==x%2?x/2:Math.floor(x/2)+1),la.set_directive(u.shaders_info,"SHADOW_USAGE","SHADOW_CASTING"),u.dynamic_grass&&r&&z(u,r,p),H.set_batch_directive(u,"SHADOW_TEX_RES",la.glsl_value(l._render.shadow_params.csm_resolution)),H.update_shader(u),Q(u)),u=F(p,u),h.bundles.push(u));n&&(k=l._render.shadow_params,l=ma.find_subs(g,"MAIN_OPAQUE"),P(h,l.camera,h.bundles,k,!0));break;case "COLOR_PICKING":da(h,k,g,l,m);break;case "COLOR_PICKING_XRAY":da(h,k,g,l,m);break;case "OUTLINE_MASK":g=
k.render;k=ya.get_scene_data(k,l).batches;for(l=0;l<k.length;l++)n=k[l],"COLOR_ID"==n.type&&"OUTLINE"==n.subtype&&(m||(H.set_batch_directive(n,"USE_OUTLINE",1),H.update_shader(n),Q(n)),n=F(g,n),h.bundles.push(n));break;case "GRASS_MAP":g=k.render;k=ya.get_scene_data(k,l).batches;for(l=0;l<k.length;l++)n=k[l],"GRASS_MAP"==n.type&&(m||(H.update_shader(n),Q(n)),n=F(g,n),h.bundles.push(n),n=h.camera,u=g.bb_world,p=h.grass_map_dim[0],r=h.grass_map_dim[1],q=h.grass_map_dim[2],0==p&&0==r?(p=u.min_y,r=u.max_y):
(p=Math.min(p,u.min_y),r=Math.max(r,u.max_y)),u=1E-4*(r-p),h.grass_map_dim[0]=p-u,h.grass_map_dim[1]=r+u,oa.set_frustum(n,q/2,-r,-p,q/2),oa.set_projection(n));break;case "WIREFRAME":for(n=k.render,k=ya.get_scene_data(k,l).batches,l=0;l<k.length;l++)p=k[l],"WIREFRAME"==p.type&&fa(h,n,g,m,p)}}for(e=0;e<b.scenes_data.length;e++)for(c=b.scenes_data[e].batches,d=0;d<c.length;d++)null==c[d].shader&&c.splice(d--,1);break;case "LAMP":T(b,a)}ya.scene_data_set_active(b,!0,a)};a.schedule_shadow_update=function(a){a._render.need_shadow_update=
!0};a.get_csm_borders=function(a,b){for(var c=a._render.shadow_params,d=new Float32Array(c.csm_num),e=0;e<c.csm_num;e++)d[e]=oa.csm_far_plane(c,b,e);return d};a.append_wireframe_batch=fa;a.change_visibility_rec=aa;a.change_visibility=W;a.is_hidden=function(a){return a.render.hide};a.remove_object_bundles=function(a,b,c){b=b.render;a=J(a,Gc);for(var d=0;d<a.length;d++)for(var e=a[d].bundles,f=e.length-1;0<=f;f--){var h=e[f];h.obj_render==b&&(h.batch&&c&&X.cleanup_bufs_data(h.batch.bufs_data),e.splice(f,
1))}};a.update_lamp_scene_color_intensity=function(a,b){for(var c=a.light,d=ya.get_scene_data(a,b).light_index,e=J(b,Yc),f=0;f<e.length;f++){var h=e[f];h.light_color_intensities.set(c.color_intensity,3*d);h.need_perm_uniforms_update=!0}};a.update_lamp_scene=T;a.cleanup=function(){for(var a=0;a<Qa.length;a++){var b=Qa[a];sa.traverse(b._render.graph,function(a,b){if("SINK"!=b.type){var c=b.camera;Hb.render_target_cleanup(c.framebuffer,c.color_attachment,c.depth_attachment,c.width,c.height);for(var c=
b.bundles,d=0;d<c.length;d++){var e=c[d].batch;e&&H.clear_batch(e)}}});b._render.graph=[];b._render.queue=[]}qb=oc=null;Qa.length=0;cb=null};a.make_frustum_shot=function(a,b,c){a=oa.extract_frustum_corners(a,a.near,a.far,null,!0);var d=zb.generate_frustum(a);a=ya.create_render("DYNAMIC");a.bb_world=a.bb_local=ha.big_bounding_box();a.bs_world=a.bs_local=ha.big_bounding_sphere();var e=a.bs_world.radius;a.be_world=a.be_local=ha.create_bounding_ellipsoid([e,0,0],[0,e,0],[0,0,e],a.bs_world.center);c=H.create_shadeless_batch(d,
c,.5);c=F(a,c);b.bundles.push(c)};a.get_scene_timeline=function(a){return[a.frame_start,a.frame_end]};a.setup_dim=function(a,b,c){xa.setup_viewport_dim(a,b,c);qb&&ka(qb,a,b)};a.setup_scene_dim=ka;a.subs_array=J;a.get_subs=V;a.get_environment_colors=function(a){a=J(a,Yc)[0];var b=a.horizon_color,c=a.zenith_color,d=[],e=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];e[0]=c[0];e[1]=c[1];e[2]=c[2];return[a.environment_energy,d,e]};a.set_environment_colors=function(a,b,c,d){a=J(a,Yc);for(var e=0;e<a.length;e++){var f=
a[e];isNaN(b)||(f.environment_energy=b);c&&f.horizon_color.set(c);d&&f.zenith_color.set(d);f.need_perm_uniforms_update=!0}};a.get_sky_params=function(a){if(a=V(a,"SKY")){var b={};b.color=Array(3);tb.copy(a.sky_color,b.color);b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;
b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=a.mie_collection_power;b.mie_distribution=a.mie_distribution;return b}return null};a.set_sky_params=function(a,b){var c=V(a,"SKY");c&&("number"==typeof b.procedural_skydome&&(c.procedural_skydome=b.procedural_skydome),"number"==typeof b.use_as_environment_lighting&&(c.use_as_environment_lighting=b.use_as_environment_lighting),"object"==typeof b.color&&c.sky_color.set(b.color),"number"==typeof b.rayleigh_brightness&&
(c.rayleigh_brightness=b.rayleigh_brightness),"number"==typeof b.mie_brightness&&(c.mie_brightness=b.mie_brightness),"number"==typeof b.spot_brightness&&(c.spot_brightness=b.spot_brightness),"number"==typeof b.scatter_strength&&(c.scatter_strength=b.scatter_strength),"number"==typeof b.rayleigh_strength&&(c.rayleigh_strength=b.rayleigh_strength),"number"==typeof b.mie_strength&&(c.mie_strength=b.mie_strength),"number"==typeof b.rayleigh_collection_power&&(c.rayleigh_collection_power=b.rayleigh_collection_power),
"number"==typeof b.mie_collection_power&&(c.mie_collection_power=b.mie_collection_power),"number"==typeof b.mie_distribution&&(c.mie_distribution=b.mie_distribution),c.need_perm_uniforms_update=!0,c.need_fog_update=!0,pa(a,c))};a.get_fog_color_density=function(a,b){var c=b||[],d=J(a,dd)[0].fog_color_density;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=function(a,b){for(var c=J(a,dd),d=0;d<c.length;d++){var e=c[d];e.fog_color_density.set(b);e.need_perm_uniforms_update=
!0}};a.get_ssao_params=function(a){var b=V(a,"SSAO");a=V(a,"SSAO_BLUR");if(!b)return null;var c=b.bundles[0].batch,d={};d.ssao_quality=H.get_batch_directive(c,"SSAO_QUALITY")[1];d.ssao_hemisphere=b.ssao_hemisphere;d.ssao_blur_depth=a.ssao_blur_depth;d.blur_discard_value=a.ssao_blur_discard_value;d.radius_increase=b.ssao_radius_increase;d.influence=b.ssao_influence;d.dist_factor=b.ssao_dist_factor;d.ssao_only=b.ssao_only;d.ssao_white=H.get_batch_directive(c,"SSAO_WHITE")[1];return d};a.set_ssao_params=
function(a,b){var c=V(a,"SSAO"),d=V(a,"SSAO_BLUR");if(!c)return fb.error("SSAO is not enabled on the scene"),0;if("string"==typeof b.ssao_quality){var e=c.bundles[0].batch;H.set_batch_directive(e,"SSAO_QUALITY",b.ssao_quality);H.update_shader(e,!0)}"number"==typeof b.ssao_hemisphere&&(e=c.bundles[0].batch,H.set_batch_directive(e,"SSAO_HEMISPHERE",b.ssao_hemisphere),H.update_shader(e,!0));"number"==typeof b.ssao_blur_depth&&(e=d.bundles[0].batch,H.set_batch_directive(e,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),
H.update_shader(e,!0));"number"==typeof b.ssao_blur_discard_value&&(d.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==typeof b.ssao_radius_increase&&(c.ssao_radius_increase=b.ssao_radius_increase);"number"==typeof b.ssao_influence&&(c.ssao_influence=b.ssao_influence);"number"==typeof b.ssao_dist_factor&&(c.ssao_dist_factor=b.ssao_dist_factor);if("number"==typeof b.ssao_only){c=V(a,"MAIN_OPAQUE");c.ssao_only=b.ssao_only;for(var f=0;f<c.bundles.length;f++)e=c.bundles[f].batch,H.set_batch_directive(e,
"SSAO_ONLY",b.ssao_only),H.update_shader(e,!0)}"number"==typeof b.ssao_white&&(e=c.bundles[0].batch,H.set_batch_directive(e,"SSAO_WHITE",b.ssao_white),H.update_shader(e,!0));c.need_perm_uniforms_update=!0;d.need_perm_uniforms_update=!0};a.get_dof_params=function(a){a=V(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.camera.dof_distance;b.dof_front=a.camera.dof_front;b.dof_rear=a.camera.dof_rear;b.dof_power=a.camera.dof_power;b.dof_object=a.camera.dof_object;return b};a.set_dof_params=S;a.get_god_rays_params=
function(a){var b=J(a,["GOD_RAYS"]);a=V(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].max_ray_length;c.god_rays_intensity=a.god_rays_intensity;c.god_rays_steps=H.get_batch_directive(b[0].bundles[0].batch,"STEPS_PER_PASS")[1];return c};a.set_god_rays_params=function(a,b){var c=J(a,["GOD_RAYS"]),d=V(a,"GOD_RAYS_COMBINE");if(!c||!d)return fb.error("God Rays are not enabled on the scene"),0;"number"==typeof b.god_rays_intensity&&(d.god_rays_intensity=b.god_rays_intensity);
if("number"==typeof b.god_rays_max_ray_length)for(var e=b.god_rays_max_ray_length,f=0;f<c.length;f++)c[f].max_ray_length=e,c[f].radial_blur_step=e/c[f].steps_per_pass/(f+1),c[f].need_perm_uniforms_update=!0;if("number"==typeof b.god_rays_steps)for(var h=la.glsl_value(b.god_rays_steps,1),e=c[0].max_ray_length,f=0;f<c.length;f++){c[f].steps_per_pass=h;c[f].radial_blur_step=e/h/(f+1);c[f].need_perm_uniforms_update=!0;var k=c[f].bundles[0].batch;H.set_batch_directive(k,"STEPS_PER_PASS",h);H.update_shader(k,
!0)}d.need_perm_uniforms_update=!0};a.get_bloom_params=function(a){var b=V(a,"LUMINANCE_TRUNCED");a=V(a,"BLOOM");if(!b||!a)return null;var c={};c.bloom_key=b.bloom_key;c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.set_bloom_params=R;a.get_glow_material_params=function(a){a=V(a,"GLOW_COMBINE");if(!a)return null;var b={};b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=
a.large_glow_mask_width;return b};a.set_glow_material_params=ua;a.get_wind_params=function(a){var b=Aa(a);a=tb.length(b);if(0==a)return null;var b=180*Math.atan(b[0]/b[2])/Math.PI,c={};c.wind_dir=b;c.wind_strength=a;return c};a.schedule_grass_map_update=function(a){a._render.need_grass_map_update=!0};a.get_water_surface_level=ia;a.get_water_mat_params=function(a,b){var c=V(a,"MAIN_OPAQUE");if(c&&(b.waves_height=c.water_waves_height,b.waves_length=c.water_waves_length,c.water_fog_color_density)){b.water_fog_density=
c.water_fog_color_density[3];var d=b.water_fog_color=[];d[0]=c.water_fog_color_density[0];d[1]=c.water_fog_color_density[1];d[2]=c.water_fog_color_density[2]}};a.set_water_params=function(a,b){var c=V(a,"MAIN_OPAQUE");if(!c||!c.water_params)return fb.error("set_water_params() - no water parameters on the scene"),null;c=c.water_params;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&
(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(c.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);"number"==typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=b.dir_noise_scale);"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&
(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&(c.dynamic=b.water_dynamic);for(var d=J(a,Zc),e=0;e<d.length;e++){var f=d[e];"number"==typeof b.water_fog_density&&c.fog_color_density&&(f.water_fog_color_density[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&c.fog_color_density&&f.water_fog_color_density.set(b.water_fog_color);"number"==typeof b.waves_height&&(f.water_waves_height=b.waves_height);"number"==
typeof b.waves_length&&(f.water_waves_length=b.waves_length);f.need_perm_uniforms_update=!0}};a.get_shore_dist=function(a,b){var c=V(qb,"MAIN_OPAQUE");if(!c.use_shoremap)return 100;var d=c.max_shore_dist,e=c.water_level,f=(a[0]-c.shoremap_center[0])/c.shoremap_size[0],h=(c.shoremap_center[1]+a[2])/c.shoremap_size[1],f=f+.5,h=h+.5;if(1<f||0>f||1<h||0>h)e=1;else return c=d*Ga.get_array_smooth_value(qb._render.shore_distances,c.shoremap_tex_size,f,h),e=(e-a[1])*b,e=Math.sqrt(c*c+e*e)};a.update=function(a,
b){for(var d=c()._camera.render,e=0;e<Qa.length;e++){var f=Qa[e],h=f._render.graph,k=f._render;if(k.water_params)var g=Pa.get_trans_view(d.world_tsr),l=g[1]-ia(g[0],g[2]);for(g=0;g<k.video_textures.length;g++){var m=k.video_textures[g]._render,n=m.video_file,p=m.seq_video;if(!(f.b4w_use_nla&&m.use_nla||!n&&!p)&&gb.video_is_played(m)){var r=gb.video_get_current_frame(m),q=gb.video_get_start_frame(m);n&&Da.is_mobile_device&&(q-=5);var u=gb.video_get_end_frame(m);r>=u&&m.use_cyclic||r<q?(gb.reset_video(m.name,
m.vtex_data_id),p&&(m.seq_last_discrete_mark=gb.seq_video_get_discrete_timemark(m,a))):r>=u&&!m.use_cyclic?gb.pause_video(m.name,m.vtex_data_id):gb.video_update_is_available(m)&&(n?gb.update_video_texture(m):(n=gb.seq_video_get_discrete_timemark(m,a),n!=m.seq_last_discrete_mark&&(gb.update_seq_video_texture(m),m.seq_cur_frame++),m.seq_last_discrete_mark=n))}}sa.traverse(h,function(b,c){-1<jd.indexOf(c.type)&&(c.time=a);k.water_params&&(c.cam_water_depth=l)})}for(e=0;e<Qa.length;e++)if(f=Qa[e],k=f._render,
h=k.graph,d=k.queue,d.length)for(k.need_shadow_update&&(Y(f),k.need_shadow_update=!1),k.need_grass_map_update&&(ea(f),k.need_grass_map_update=!1),k.need_outline&&(U(f),k.need_outline=!1),k.motion_blur&&qa(h,b),f=ma.find_subs(h,"OUTLINE_MASK"),g=0;g<d.length;g++)m=d[g],ic.prerender_subs(m),f&&na(h,m,f),Hb.draw(m);Da.show_hud_debug_info&&va.show_debug_info(Qa,b)};a.request_outline=function(a){a._render.need_outline=!0};a.get_all_subscenes=function(a){var b=[];sa.traverse(a._render.graph,function(a,
c){b.push(c)});return b};a.get_cam_water_depth=function(){var a=V(qb,"MAIN_BLEND"),b=qb;return a||b._render.water_params?a.cam_water_depth:null};a.get_object_data_id=function(a){return a.render.data_id};a.update_scene_permanent_uniforms=function(a){sa.traverse(a._render.graph,function(a,b){b.need_perm_uniforms_update=!0})};a.set_wireframe_mode=function(a,b){a.do_render=b!=Ea.WM_NONE;for(var c=0;c<a.bundles.length;c++)a.bundles[c].batch.wireframe_mode=b;a.blend=b==Ea.WM_TRANSPARENT_WIREFRAME;a.need_perm_uniforms_update=
!0};a.set_wireframe_edge_color=function(a,b){for(var c=0;c<a.bundles.length;c++)a.bundles[c].batch.wireframe_edge_color=b,a.need_perm_uniforms_update=!0};a.update_force_scene=function(a,b){var c=b.field,d=a._render.wind;if(c&&"WIND"==c.type&&d){var e=Pa.get_quat_view(b.render.world_tsr);Ga.quat_to_dir(e,Ga.AXIS_Y,d);tb.normalize(d,d);tb.scale(d,c.strength,d);c=J(a,jd);for(e=0;e<c.length;e++)c[e].wind.set(d)}};a.pick_color=function(a,b,c){var d=V(a,"COLOR_PICKING");if(d)return b=xa.canvas_to_viewport_coords(b,
c,$b,d.camera),ic.prerender_subs(d,d.camera),Hb.draw(d,d.bundles),(a=V(a,"COLOR_PICKING_XRAY"))?(ic.prerender_subs(a,a.camera),Hb.draw(a,a.bundles),d=a.camera):d=d.camera,b[1]=d.height-b[1],Hb.read_pixels(d.framebuffer,b[0],b[1]);fb.error("Object Selection is not available on the scene");return null};a.set_outline_color=function(a){var b=c();if(b=V(b,"OUTLINE"))b.outline_color.set(a),b.need_perm_uniforms_update=!0};a.get_wind=Aa;a.get_meta_tags=function(a){var b={title:"",description:""};a.b4w_tags&&
(b.title=a.b4w_tags.title,b.description=a.b4w_tags.description);return b};a.update_cube_reflect_subs=function(a,b){var c=xc;tb.negate(b,c);for(var d=0;6>d;d++){var e=a.cube_view_matrices[d],f=a.cube_cam_frustums[d],h=a.camera;bb.translate(Ga.INV_CUBE_VIEW_MATRS[d],c,e);bb.multiply(h.proj_matrix,e,h.view_proj_matrix);Ga.extract_frustum_planes(h.view_proj_matrix,f)}};a.update_plane_reflect_subs=function(a,b,c){Ga.trans_quat_to_plane(b,c,Ga.AXIS_Y,a.camera.reflection_plane)};a.assign_scene_data_subs=
function(a,b,c){var d=a._render.shadow_params,e=a._render.reflection_params;c=ya.get_first_lamp_with_shadows(c)||c[0];for(var f=0;f<b.length;f++){var h=b[f],k=ya.get_scene_data(h,a);if(e)if(null!=h.render.plane_reflection_id){var g=e.plane_refl_subs;if(g.length){var l=h.render.plane_reflection_id;k.plane_refl_subs=g[l]}}else null!=h.render.cube_reflection_id&&(g=e.cube_refl_subs,g.length&&(l=h.render.cube_reflection_id,k.cube_refl_subs=g[l]));d&&h==c&&(k.shadow_subscenes=J(a,["SHADOW_CAST"]))}};a.marker_frame=
function(a,b){return a.timeline_markers[b]}};b4w.module.__physics=function(a,t){function v(a,b){for(var c=a.cons_descends,d=0;d<c.length;d++)c[d].physics_settings.use_collision_compound&&b.push(c[d]),v(c[d],b);return null}function c(a,b,c){for(var d=a._physics.bundles,e=0;e<d.length;e++)for(var f=d[e].physics,h=0;h<f.collision_tests.length;h++){var k=f.collision_tests[h];"ANY"!=k.collision_id&&c!=k.collision_id||w(k,a,b)}}function b(a,b,c){if(I.is_active(a))switch(b){case I.IN_LOADED:var f=e(a);f._physics.worker_loaded=!0;c=Date.now()-performance.now();
I.post_msg(a,I.OUT_INIT,c,W.max_fps,W.calc_fps?T.fps_measurement_interval:0);break;case I.IN_LOG:G.log_raw("URANIUM:",c.slice(1));break;case I.IN_ERROR:G.error(c);break;case I.IN_FBMSG:C.fbmsg.apply(this,c.slice(1));break;case I.IN_TRANSFORM:var h=d(c.body_id);if(h){a=c.trans;f=c.quat;b=c.linvel;var k=c.angvel,h=h.physics;h.curr_time=c.time;P.set_sep(a,1,f,h.curr_tsr);fa.copy(b,h.linvel);fa.copy(k,h.angvel)}break;case I.IN_PROP_OFFSET:(a=d(c.chassis_hull_body_id))&&P.set_sep(c.trans,1,c.quat,a.vehicle.prop_offsets[c.prop_ind]);
break;case I.IN_FLOATER_BOB_TRANSFORM:if(f=d(c[1]))a=c[4],f=f.floater.bobs[c[2]],U.set_translation(f,c[3]),U.set_rotation(f,a),U.update_transform(f);break;case I.IN_VEHICLE_SPEED:if(h=d(c[1]))h.vehicle.speed=c[2];break;case I.IN_COLLISION:f=e(a);l(f,c.body_id_a,c.body_id_b,c.result,null,null,0);break;case I.IN_COLLISION_POS_NORM:f=e(a);l(f,c.body_id_a,c.body_id_b,c.result,c.coll_point,c.coll_norm,c.coll_dist);break;case I.IN_COLLISION_IMPULSE:if(h=d(c[1]))a=h.physics,a.col_imp_test_cb&&a.col_imp_test_cb(c[2]);
break;case I.IN_RAY_HIT:case I.IN_RAY_HIT_POS_NORM:f=e(a);if(a=f._physics.ray_tests[c.id])if(f=d(c.body_id_hit),b==I.IN_RAY_HIT)b=a.callback,b(a.id,c.hit_fract,f,c.hit_time);else{b=c.hit_fract;var k=c.hit_time,h=c.hit_pos,g=a.callback;h?g(a.id,b,f,k,h,c.hit_norm):g(a.id,b,f,k)}break;case I.IN_REMOVE_RAY_TEST:E(id);break;case I.IN_PING:a=pa.indexOf(a);f=(c[2]-c[1]).toFixed(3);b=(performance.now()-c[2]).toFixed(3);c=(performance.now()-c[1]).toFixed(3);console.log("Physics #"+a+" Ping: OUT "+f+" ms, IN "+
b+" ms, ALL "+c+" ms");break;case I.IN_FPS:ba=c[1];break;case I.IN_DEBUG_STATS:a=pa.indexOf(a);console.log("Worker: #"+String(a));console.log(c[1]);break;default:G.error("Wrong message: "+b)}}function e(a){for(var b=0;b<pa.length;b++)if(pa[b]==a)return ga[b]}function d(a){return ka[a]||null}function l(a,b,c,e,f,h,k){a=a._physics.bundles;for(var g=0;g<a.length;g++)for(var l=a[g].physics,m=0;m<l.collision_tests.length;m++){for(var p=l.collision_tests[m],r=p.pairs,q=!1,u=0;u<r.length;u++){var x=r[u];
if(x[0]===b&&x[1]===c){p.pair_results[u]=e;q=!0;break}}q&&(r=n(p),f&&p.body_id_src!=b&&(q=f,u=h,x=k,q[0]+=u[0]*x,q[1]+=u[1]*x,q[2]+=u[2]*x,u[0]*=-1,u[1]*=-1,u[2]*=-1),q=r?p.body_id_src==b?d(c):d(b):null,p.callback(r,q,f,h,k))}}function n(a){a=a.pair_results;for(var b=!1,c=0;c<a.length;c++)b=b||a[c];return b}function q(){S.body++;return S.body}function g(a){if("ANY"==a)return 0;var b=V.indexOf(a);return-1==b?(V.push(a),V.length-1):b}function u(a){return{body_id:a,mass:0,is_ghost:!1,simulated:!0,is_vehicle:!1,
is_character:!1,is_floater:!1,cons_id:null,collision_id:"",collision_id_num:0,collision_callbacks:{},collision_tests:[],col_imp_test_cb:null,curr_time:0,curr_tsr:new Float32Array([0,0,0,1,0,0,0,1]),linvel:new Float32Array(3),angvel:new Float32Array(3),cached_trans:new Float32Array(3),cached_quat:new Float32Array(4)}}function k(a,b){switch(a){case "BOX":var c=b.bb_local;break;case "CYLINDER":c=b.bcyl_local;break;case "CONE":c=b.bcon_local;break;case "SPHERE":c=b.bs_local;break;case "CAPSULE":c=b.bcap_local}return c}
function f(a){if(!a)return null;var b={};"number"===typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.center&&(b.center=a.center);"number"===typeof a.radius&&(b.radius=a.radius);"number"===typeof a.height&&(b.height=a.height);return b}function p(a,b,c,d,e){var f=P.get_trans_view(a.render.world_tsr),
h=P.invert(b.render.world_tsr,ia),k=new Float32Array(3);P.transform_vec3(f,h,k);switch(b.vehicle.type){case 10:b=b.vehicle_settings;a=a.render.bb_local;I.post_msg(e,I.OUT_ADD_CAR_WHEEL,c,k,b.suspension_rest_length,b.roll_influence,(a.max_y-a.min_y)/2,d);break;case 20:I.post_msg(e,I.OUT_ADD_BOAT_BOB,c,k,a.synchronize_pos)}}function K(a){return a.physics&&a.physics.cons_id}function D(a,b,c,d,e,f,h,k,g,l){var m;S.constraint++;m=S.constraint.toString(16);var n=b.physics.body_id;e=e.physics.body_id;var p=
A(n);I.post_msg(p,I.OUT_APPEND_CONSTRAINT,m,a,k,n,c,d,e,f,h,g,l);b.physics.cons_id=m}function A(a){for(var b=0;b<ga.length;b++)for(var c=ga[b]._physics.bundles,d=0;d<c.length;d++)if(c[d].physics.body_id==a)return pa[b];return null}function h(a){var b;if(b=(b=a.physics)?0===b.mass?!0:!0===b.is_ghost?!0:!1===b.simulated?!0:"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type?!0:!1:!1){b=P.get_trans_view(a.render.world_tsr);var c=P.get_quat_view(a.render.world_tsr);b=b[0]!=a.physics.cached_trans[0]||b[1]!=a.physics.cached_trans[1]||
b[2]!=a.physics.cached_trans[2]||c[0]!=a.physics.cached_quat[0]||c[1]!=a.physics.cached_quat[1]||c[2]!=a.physics.cached_quat[2]||c[3]!=a.physics.cached_quat[3]}if(b){b=a.physics;var d=a.render,c=P.get_trans_view(d.world_tsr),d=P.get_quat_view(d.world_tsr);fa.copy(c,b.cached_trans);z.copy(d,b.cached_quat);var e=I.get_msg_cache(I.OUT_SET_TRANSFORM);e.body_id=b.body_id;e.trans=c;"DYNAMIC"==b.type?z.identity(e.quat):e.quat=d;b=A(b.body_id);I.post_msg(b,I.OUT_SET_TRANSFORM)}a=a.cons_descends;for(b=0;b<
a.length;b++)h(a[b])}function x(a,b,c,d,e){e=e||new Float32Array(3);a=P.get_quat_view(a.render.world_tsr);e[0]=b;e[1]=c;e[2]=d;return fa.transformQuat(e,a,e)}function w(a,b,c){var d=a.pairs,e=a.pair_results,f=a.body_id_src,h=[],k=a.collision_id;if(!h)throw"At least one destination required";for(var g=0;g<b._physics.bundles.length;g++){var l=b._physics.bundles[g];if("ANY"==k||l.physics.collision_id==k)l=l.physics.body_id,h&&-1==h.indexOf(l)&&h.push(l)}for(b=0;b<h.length;b++)k=h[b],f<k&&!r(d,f,k)?(d.push([f,
k]),e.push(!1)):f>k&&!r(d,k,f)&&(d.push([k,f]),e.push(!1));I.post_msg(c,I.OUT_ACTIVATE,f);I.post_msg(c,I.OUT_APPEND_COLLISION_TEST,d,a.calc_pos_norm)}function r(a,b,c){for(var d=0;d<a.length;d++)if(a[d][0]==b&&a[d][1]==c)return!0;return!1}function m(a){if(a.physics&&a.physics.col_imp_test_cb){a=a.physics;var b=A(a.body_id);I.post_msg(b,I.OUT_CLEAR_COLLISION_IMPULSE_TEST,a.body_id);a.col_imp_test_cb=null}}function E(a){var b=y(a),c=M(a),b=b._physics;b.ray_tests[a]&&(delete b.ray_tests[a],b.ray_tests_arr.splice(b.ray_tests_arr.indexOf,
1),I.post_msg(c,I.OUT_REMOVE_RAY_TEST,a))}function y(a){for(var b=0;b<ga.length;b++){var c=ga[b];if(c._physics.ray_tests[a])return c}return null}function M(a){for(var b=0;b<ga.length;b++)if(ga[b]._physics.ray_tests[a])return pa[b];return null}function L(a,b,c){if(b.steering_wheel){a=a.physics.body_id;var d=b.engine_force*b.force_max,e=b.brake_force*b.brake_max,f=-b.steering*b.steering_max*2*Math.PI/b.steering_ratio;b.inverse_control&&(f*=-1);switch(b.type){case 10:I.post_msg(c,I.OUT_UPDATE_CAR_CONTROLS,
a,d,e,f);break;case 20:I.post_msg(c,I.OUT_UPDATE_BOAT_CONTROLS,a,d,e,f)}}}function N(a){return a.is_vehicle&&"CHASSIS"==a.vehicle_settings.part}function B(a){return a.is_vehicle&&"HULL"==a.vehicle_settings.part}function O(a){return a.is_floating&&"MAIN_BODY"==a.floating_settings.part}var F=t("__config");t("__constraints");var C=t("__debug"),I=t("__ipc");t("__mat4");var Q=t("__obj_util"),G=t("__print"),z=t("__quat");t("__renderer");var Y=t("__scenes"),U=t("__transform"),P=t("__tsr"),da=t("__util"),
fa=t("__vec3"),aa=t("__version"),W=F.physics,T=F.defaults,Z=F.assets,ba=0,pa=[],ga=[],ka={},J=[],V=[],S={body:0,constraint:0,ray_test:0},R=new Float32Array(3);new Float32Array(4);var ua=new Float32Array(4);new Float32Array(16);var ia=P.create(),na=P.create();a.init_scene_physics=function(a){a._physics={worker_loaded:!1,bundles:[],ray_tests:{},ray_tests_arr:[]};var c=W.uranium_path;Z.prevent_caching&&(c+=aa.timestamp());G.log("%cLOAD PHYSICS","color: #0a0",W.use_workers?"Using Separate Worker Thread,":
"Using Same Thread,","Max FPS: "+W.max_fps);G.log("%cPHYSICS PATH","color: #0a0",c);var d=I.create_worker(c,!W.use_workers);I.attach_handler(d,b);pa.push(d);ga.push(a);W.ping&&setInterval(function(){I.post_msg(d,I.OUT_PING,performance.now())},1E3)};a.check_worker_loaded=function(a){return a._physics?a._physics.worker_loaded:!0};a.cleanup=function(){for(var a=0;a<pa.length;a++)I.terminate(pa[a]);pa.length=0;ga.length=0;ka={};J.length=0;V.length=0;for(var b in S)S[b]=0};a.append_object=function(a,b){if(!a.render)throw"No object render: "+
a.name;var d=a.physics_settings,e;a:{for(var h=0;h<ga.length;h++)if(ga[h]==b){e=pa[h];break a}e=void 0}var l=[];d.use_collision_compound&&v(a,l);var m=b._physics.bundles;if(N(a)||B(a)||a.is_character||O(a)||a.use_obj_physics){var n,r=a,x=e,w=r.render,X=r.physics_settings,t=X.physics_type,va=q();if("CAMERA"==r.type)var y=X.use_collision_bounds?X.collision_bounds_type:"BOX",V=k(y,w),R=w.friction,S=w.elasticity,R=.5,S=0;else"EMPTY"==r.type?(y="EMPTY",V=null,S=R=0):(y=X.use_collision_bounds?X.collision_bounds_type:
"BOX",V=k(y,w),R=w.friction,S=w.elasticity);var A=P.get_trans_view(w.world_tsr),F=P.get_quat_view(w.world_tsr),E=X.use_ghost,C=X.use_sleep,M=X.mass,U=X.velocity_min,jc=X.velocity_max,la=X.damping,W=X.rotation_damping,T=r.collision_id,aa=g(T),tb=X.collision_margin,Z=X.collision_group,fa=X.collision_mask,ba=w.bs_local.radius,Gc=f(V),Yc=r.correct_bounding_offset,dd;var jd=y;if(l.length){var Zc=[],oc={};oc.quat=new Float32Array([0,0,0,1]);oc.trans=new Float32Array(3);oc.worker_bounding=Gc;oc.bounding_type=
jd;Zc.push(oc);var qb=P.invert(w.world_tsr,ia),Qa=P.get_quat_view(w.world_tsr);z.invert(Qa,ua);for(var cb=0;cb<l.length;cb++){var wc={},$b=l[cb],xc=$b.physics_settings.collision_bounds_type,ed=new Float32Array(4),Pc=new Float32Array(3),Hc=P.get_trans_view($b.render.world_tsr),kd=P.get_quat_view($b.render.world_tsr);P.transform_vec3(Hc,qb,Pc);z.multiply(ua,kd,ed);wc.trans=Pc;wc.quat=ed;wc.bounding_type=xc;wc.worker_bounding=f(k(xc,$b.render));Zc.push(wc)}dd=Zc}else dd=[];I.post_msg(x,I.OUT_APPEND_BOUNDING_BODY,
va,A,F,t,E,C,M,U,jc,la,W,aa,tb,Z,fa,y,Gc,ba,R,S,dd,Yc);ka[va]=r;J.push(r);var db=u(va);db.type=t;db.mass=M;db.is_ghost=E;db.collision_id=T;db.collision_id_num=aa;n=db;a.physics=n;var vb={batch:null,physics:n};m.push(vb);c(b,e,n.collision_id)}else for(var Ib=Q.get_scene_data(a,b).batches,ab=0;ab<Ib.length;ab++){var Mb=Ib[ab],Ka;if(!(Ka="PHYSICS"!=Mb.type))a:{for(var yc=b._physics.bundles,Ya=0;Ya<yc.length;Ya++){var wb=yc[Ya].batch;if(wb&&wb.id==Mb.id){Ka=!0;break a}}Ka=!1}if(!Ka)if(Mb.submesh.base_length)if(Mb.water&&
b._render.water_params){var Ra=Mb,Ba=b,Ma=e,Fa=Y.get_subs(Ba,"MAIN_OPAQUE");I.post_msg(Ma,I.OUT_APPEND_WATER,Fa.water_level);if(Fa.water_params&&Ra.water_dynamics){var za={};za.dst_noise_scale0=Ra.dst_noise_scale0;za.dst_noise_scale1=Ra.dst_noise_scale1;za.dst_noise_freq0=Ra.dst_noise_freq0;za.dst_noise_freq1=Ra.dst_noise_freq1;za.dir_min_shore_fac=Ra.dir_min_shore_fac;za.dir_freq=Ra.dir_freq;za.dir_noise_scale=Ra.dir_noise_scale;za.dir_noise_freq=Ra.dir_noise_freq;za.dir_min_noise_fac=Ra.dir_min_noise_fac;
za.dst_min_fac=Ra.dst_min_fac;za.waves_hor_fac=Ra.waves_hor_fac;var Nb=Fa.water_waves_height,zc=Fa.water_waves_length;Fa.use_shoremap?I.post_msg(Ma,I.OUT_ADD_WATER_WRAPPER,za,Fa.shoremap_size[0],Fa.shoremap_size[1],Fa.shoremap_center[0],Fa.shoremap_center[1],Fa.max_shore_dist,Nb,zc,Fa.shoremap_tex_size,Ba._render.shore_distances):I.post_msg(Ma,I.OUT_ADD_WATER_WRAPPER,za,0,0,0,0,0,Nb,zc,0,null)}}else{if(Mb.use_ghost){var Xa=a,jb=Mb,Ab=e,sc=q(),eb=jb.submesh,tc=eb.va_frames[0].a_position,Ac=eb.indices||
null,Eb=jb.collision_id,Xb=g(Eb),Yb=jb.collision_margin,Ic=jb.collision_group,Bb=jb.collision_mask,Fb=P.get_trans_view(Xa.render.world_tsr);I.post_msg(Ab,I.OUT_APPEND_GHOST_MESH_BODY,sc,tc,Ac,Fb,Xb,Yb,Ic,Bb);var Sa=u(sc);Sa.is_ghost=!0;Sa.collision_id=Eb;Sa.collision_id_num=Xb;n=Sa}else{var Ha=a,Za=Mb,ac=e,kc=q(),Jb=Za.submesh,Cb=Jb.va_frames[0].a_position,rb=Jb.indices||null,Bc=P.get_trans_view(Ha.render.world_tsr),Ob=Za.friction,lc=Za.elasticity,Jc=Za.collision_id,Db=g(Jc);I.post_msg(ac,I.OUT_APPEND_STATIC_MESH_BODY,
kc,Cb,rb,Bc,Ob,lc,Db,Za.collision_margin,Za.collision_group,Za.collision_mask);var kb=u(kc);kb.collision_id=Jc;kb.collision_id_num=Db;n=kb}vb={batch:Mb,physics:n};m.push(vb);c(b,e,n.collision_id)}else G.error("Object "+a.name+" has collision material with no assigned vertices")}if(N(a)||B(a)){var La=a,Ua=e,hb=La.physics.body_id;N(La)?(La.vehicle.type=10,I.post_msg(Ua,I.OUT_APPEND_CAR,hb,La.vehicle.suspension_compression,La.vehicle.suspension_stiffness,La.vehicle.suspension_damping,La.vehicle.wheel_friction,
La.vehicle.max_suspension_travel_cm)):B(La)&&(La.vehicle.type=20,I.post_msg(Ua,I.OUT_APPEND_BOAT,hb,La.vehicle.floating_factor,La.vehicle.water_lin_damp,La.vehicle.water_rot_damp));if(La.vehicle.props){var Va=La.vehicle.props;switch(La.vehicle.type){case 10:p(Va[1],La,hb,!0,Ua);p(Va[0],La,hb,!0,Ua);p(Va[3],La,hb,!1,Ua);p(Va[2],La,hb,!1,Ua);break;case 20:for(var Pb=0;Pb<Va.length;Pb++)p(Va[Pb],La,hb,!1,Ua)}}L(a,a.vehicle,e)}else if(a.is_character){var Ca=e,Ta=a.render,ob=a.physics,lb=Ta.bb_local.max_y-
Ta.bb_local.min_y,Ia=ob.body_id,Qb=a.character_settings,pc=Qb.walk_speed,mb=Qb.run_speed,bc=Qb.step_height,qc=Qb.jump_strength,nb=Qb.waterline,Zb=da.dir_ground_proj_angle(a);I.post_msg(Ca,I.OUT_APPEND_CHARACTER,Ia,Zb,lb,pc,mb,bc,qc,nb);ob.is_character=!0}else if(O(a)){var Wa=a,ib=e,pb=Wa.physics.body_id;I.post_msg(ib,I.OUT_APPEND_FLOATER,pb,Wa.floater.floating_factor,Wa.floater.water_lin_damp,Wa.floater.water_rot_damp);if(Wa.floater.bobs)for(var uc=Wa.floater.bobs,Gb=0;Gb<uc.length;Gb++){var cc=uc[Gb],
Rb=P.get_trans_view(cc.render.world_tsr),Kb=P.invert(Wa.render.world_tsr,ia),xb=new Float32Array(3);P.transform_vec3(Rb,Kb,xb);I.post_msg(ib,I.OUT_ADD_FLOATER_BOB,pb,xb,cc.bob_synchronize_pos)}Wa.physics.is_floater=!0}for(ab=0;ab<J.length;ab++)if(a=J[ab],a.physics){var dc=a;if(!K(dc))for(var Na=0;Na<dc.physics_constraints.length;Na++){var Ja=dc.physics_constraints[Na],ec=Ja.target,Lb=Ja.pivot_type;if(ec.physics){var yb=new Float32Array([Ja.pivot_x,Ja.pivot_y,Ja.pivot_z]),fc,Kc=new Float32Array([Ja.axis_x,
Ja.axis_y,Ja.axis_z]);fc=da.euler_to_quat(Kc,new Float32Array(4));var Sb=P.identity(ia),Sb=P.set_trans(yb,Sb),Sb=P.set_quat(fc,Sb),rc=P.multiply(dc.render.world_tsr,Sb,ia),mc=P.invert(ec.render.world_tsr,na),Cc=P.multiply(mc,rc,mc),Dc=P.get_trans_view(Cc),Tb=P.get_quat_view(Cc),$a=Ja,Oa={};Oa.use_limit_x=$a.use_limit_x;Oa.use_limit_y=$a.use_limit_y;Oa.use_limit_z=$a.use_limit_z;Oa.use_angular_limit_x=$a.use_angular_limit_x;Oa.use_angular_limit_y=$a.use_angular_limit_y;Oa.use_angular_limit_z=$a.use_angular_limit_z;
Oa.limit_max_x=$a.limit_max_x;Oa.limit_min_x=$a.limit_min_x;Oa.limit_max_y=$a.limit_max_y;Oa.limit_min_y=$a.limit_min_y;Oa.limit_max_z=$a.limit_max_z;Oa.limit_min_z=$a.limit_min_z;Oa.limit_angle_max_x=$a.limit_angle_max_x;Oa.limit_angle_min_x=$a.limit_angle_min_x;Oa.limit_angle_max_y=$a.limit_angle_max_y;Oa.limit_angle_min_y=$a.limit_angle_min_y;Oa.limit_angle_max_z=$a.limit_angle_max_z;Oa.limit_angle_min_z=$a.limit_angle_min_z;D(Lb,dc,yb,fc,ec,Dc,Tb,Oa,null,null)}}}};a.find_obj_by_body_id=d;a.update=
function(a,b){for(var c=0;c<pa.length;c++){var d=pa[c],e=a,f=b;d&&I.is_fallback(d)&&I.post_msg(d,I.OUT_UPDATE_WORLD,e,f);for(f=0;f<J.length;f++){var k=J[f],g=k.physics;if(g.simulated&&g.curr_time){var l=I.is_fallback(d)?e-g.curr_time:performance.now()/1E3-g.curr_time,l=Math.min(l,10/W.max_fps),l=l-1/W.max_fps;T.no_phy_interp_hack&&(l=0);var m=ia;P.integrate(g.curr_tsr,l,g.linvel,g.angvel,ia);U.set_tsr(k,m);U.update_transform(k);h(k);if(k.vehicle)for(var g=k,l=g.vehicle.props,m=g.render.world_tsr,
n=ia,p=0;p<l.length;p++){var r=l[p];P.multiply(m,g.vehicle.prop_offsets[p],n);U.set_tsr(r,n);U.update_transform(r)}k.vehicle&&k.vehicle.steering_wheel&&(n=k,l=n.vehicle,g=l.steering_wheel)&&(p=n.vehicle.steering_wheel_axis,P.multiply(n.render.world_tsr,n.vehicle.steering_wheel_tsr,g.render.world_tsr),m=R,P.transform_dir_vec3(p,n.render.world_tsr,m),n=ua,z.setAxisAngle(m,-l.steering*l.steering_max*2*Math.PI,n),l=P.get_quat_view(g.render.world_tsr),z.multiply(n,l,l),U.update_transform(g));k.vehicle&&
k.vehicle.speedometer&&(n=k,l=n.vehicle,g=l.speedometer)&&(p=n.vehicle.speedometer_axis,P.multiply(n.render.world_tsr,n.vehicle.speedometer_tsr,g.render.world_tsr),m=R,P.transform_dir_vec3(p,n.render.world_tsr,m),n=ua,p=Math.abs(l.speed)*l.speed_ratio,p>l.max_speed_angle&&(p=l.max_speed_angle),z.setAxisAngle(m,-p,n),l=P.get_quat_view(g.render.world_tsr),z.multiply(n,l,l),z.normalize(l,l),U.update_transform(g));k.vehicle&&k.vehicle.tachometer&&(m=k,g=m.vehicle,k=g.tachometer)&&(n=m.vehicle.tachometer_axis,
P.multiply(m.render.world_tsr,m.vehicle.tachometer_tsr,k.render.world_tsr),l=R,P.transform_dir_vec3(n,m.render.world_tsr,l),m=ua,z.setAxisAngle(l,-Math.abs(g.engine_force)*g.delta_tach_angle,m),g=P.get_quat_view(k.render.world_tsr),z.multiply(m,g,g),z.normalize(g,g),U.update_transform(k))}}I.post_msg_arr(d);d=Y.get_subs(ga[c],"MAIN_OPAQUE");d.water_params&&0<d.water_params.waves_height&&(e=fa.length(d.wind),I.post_msg(pa[c],I.OUT_SET_WATER_TIME,d.time*e))}};a.get_active_scene=function(){return ga[0]};
a.pause=function(){for(var a=0;a<pa.length;a++)I.post_msg(pa[a],I.OUT_PAUSE)};a.resume=function(){for(var a=0;a<pa.length;a++)I.post_msg(pa[a],I.OUT_RESUME)};a.enable_simulation=function(a){a=a.physics;if(!a)throw"No object physics";if(!a.simulated){var b=a.body_id,c=A(b);a.simulated=!0;I.post_msg(c,I.OUT_ENABLE_SIMULATION,b)}};a.disable_simulation=function(a){a=a.physics;if(!a)throw"No object physics";if(a.simulated){var b=a.body_id,c=A(b);a.simulated=!1;I.post_msg(c,I.OUT_DISABLE_SIMULATION,b)}};
a.scene_has_physics=function(a){return Boolean(a._physics)};a.obj_has_physics=function(a){return Boolean(a.physics)};a.has_dynamic_physics=function(a){return(a=a.physics)&&a.simulated&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.mass&&0==a.is_ghost?!0:!1};a.has_simulated_physics=function(a){return(a=a.physics)&&a.simulated?!0:!1};a.set_gravity=function(a,b){var c=a.physics.body_id,d=A(c);I.post_msg(d,I.OUT_SET_GRAVITY,c,b)};a.has_constraint=K;a.apply_constraint=D;a.clear_constraint=function(a){a=
a.physics;var b=a.cons_id,c=A(body_a);I.post_msg(c,I.OUT_REMOVE_CONSTRAINT,b);a.cons_id=null};a.pull_to_constraint_pivot=function(b,c,d,e,f,h){c=P.set_sep(c,1,d,ia);f=P.set_sep(f,1,h,na);P.invert(c,c);P.multiply(f,c,c);U.get_tsr(e,f);P.multiply(f,c,c);U.set_tsr(b,c);U.update_transform(b);e=P.get_trans_view(b.render.world_tsr);f=P.get_quat_view(b.render.world_tsr);a.set_transform(b,e,f)};a.set_transform=function(a,b,c){var d=a.physics,e=P.get_trans_view(a.render.world_tsr);a=P.get_quat_view(a.render.world_tsr);
P.set_sep(e,1,a,d.curr_tsr);e=I.get_msg_cache(I.OUT_SET_TRANSFORM);e.body_id=d.body_id;e.trans=b;e.quat=c;b=A(d.body_id);I.post_msg(b,I.OUT_SET_TRANSFORM)};a.sync_transform=h;a.apply_velocity=function(a,b,c,d){x(a,b,c,d,R);a=a.physics.body_id;b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var e=Math.abs(R[0]),f=Math.abs(R[1]),h=Math.abs(R[2]);R[0]=e?R[0]/e*Math.max(e,b):0;R[1]=f?R[1]/f*Math.max(f,c):0;R[2]=h?R[2]/h*Math.max(h,d):0;b=A(a);I.post_msg(b,I.OUT_SET_LINEAR_VELOCITY,a,R[0],R[1],R[2])};a.apply_velocity_world=
function(a,b,c,d){a=a.physics.body_id;var e=A(a);I.post_msg(e,I.OUT_SET_LINEAR_VELOCITY,a,b,c,d)};a.apply_force=function(a,b,c,d){x(a,b,c,d,R);a=a.physics.body_id;b=A(a);I.post_msg(b,I.OUT_APPLY_CENTRAL_FORCE,a,R[0],R[1],R[2])};a.apply_torque=function(a,b,c,d){x(a,b,c,d,R);a=a.physics.body_id;b=A(a);I.post_msg(b,I.OUT_APPLY_TORQUE,a,R[0],R[1],R[2])};a.set_character_move_dir=function(a,b,c){a=a.physics.body_id;var d=A(a);I.post_msg(d,I.OUT_SET_CHARACTER_MOVE_DIR,a,b,c)};a.set_character_move_type=function(a,
b){var c=a.physics.body_id,d=A(c);I.post_msg(d,I.OUT_SET_CHARACTER_MOVE_TYPE,c,b)};a.set_character_walk_velocity=function(a,b){var c=a.physics.body_id,d=A(c);I.post_msg(d,I.OUT_SET_CHARACTER_WALK_VELOCITY,c,b)};a.set_character_run_velocity=function(a,b){var c=a.physics.body_id,d=A(c);I.post_msg(d,I.OUT_SET_CHARACTER_RUN_VELOCITY,c,b)};a.set_character_fly_velocity=function(a,b){var c=a.physics.body_id,d=A(c);I.post_msg(d,I.OUT_SET_CHARACTER_FLY_VELOCITY,c,b)};a.character_jump=function(a){a=a.physics.body_id;
var b=A(a);I.post_msg(b,I.OUT_CHARACTER_JUMP,a)};a.character_rotation_inc=function(a,b,c){a=a.physics.body_id;var d=A(a);I.post_msg(d,I.OUT_CHARACTER_ROTATION_INCREMENT,a,b,c)};a.set_character_rotation=function(a,b,c){a=a.physics.body_id;var d=A(a);I.post_msg(d,I.OUT_SET_CHARACTER_ROTATION,a,b,c)};a.set_character_rotation_h=function(a,b){var c=a.physics.body_id,d=A(c);I.post_msg(d,I.OUT_SET_CHARACTER_HOR_ROTATION,c,b)};a.set_character_rotation_v=function(a,b){var c=a.physics.body_id,d=A(c);I.post_msg(d,
I.OUT_SET_CHARACTER_VERT_ROTATION,c,b)};a.append_collision_test=function(a,b,c,d){var f=a.physics,h=f.body_id;b=b||"ANY";for(var k=0;k<f.collision_tests.length;k++)if(a=f.collision_tests[k],a.collision_id==b&&a.callback==c)return;a={body_id_src:h,calc_pos_norm:d||!1,collision_id:b,callback:c,pairs:[],pair_results:[]};f.collision_tests.push(a);b=A(h);c=e(b);w(a,c,b)};a.remove_collision_test=function(a,b,c){a=a.physics;for(var d=A(a.body_id),f=e(d),h=0;h<a.collision_tests.length;h++){var k=a.collision_tests[h];
if(k.collision_id==b&&k.callback==c){if(n(k)){var g=fa.set(0,0,0,R);k.callback(!1,null,g,g,0)}a.collision_tests.splice(h,1);h--;for(var g=d,l=f._physics.bundles,k=k.pairs,m=0;m<l.length;m++)for(var p=l[m].physics,r=0;r<p.collision_tests.length;r++)for(var q=p.collision_tests[r],u=0;u<q.pairs.length;u++)for(var x=q.pairs[u],w=0;w<k.length;w++){var t=k[w];x[0]==t[0]&&x[1]==t[1]&&(k.splice(w,1),w--)}k.length&&I.post_msg(g,I.OUT_REMOVE_COLLISION_TEST,k)}}};a.apply_collision_impulse_test=function(a,b){a.physics&&
a.physics.col_imp_test_cb&&m(a);var c=a.physics,d=A(c.body_id);I.post_msg(d,I.OUT_APPLY_COLLISION_IMPULSE_TEST,c.body_id);c.col_imp_test_cb=b};a.clear_collision_impulse_test=m;a.append_ray_test=function(a,b,c,d,f,h,k,l,m){var n;S.ray_test++;n=S.ray_test;d=d||"ANY";a={id:n,body_id:a?a.physics.body_id:0,from:new Float32Array(b),to:new Float32Array(c),collision_id:d,collision_id_num:g(d),autoremove:h,calc_all_hits:k,calc_pos_norm:l,ign_src_rot:m,callback:f};b=A(a.body_id)||pa[0];c=e(b)._physics;n=a.id;
c.ray_tests[n]=a;c.ray_tests_arr.push(a);I.post_msg(b,I.OUT_APPEND_RAY_TEST,a.id,a.body_id,a.from,a.to,a.collision_id_num,a.autoremove,a.calc_all_hits,a.calc_pos_norm,a.ign_src_rot);return n};a.remove_ray_test=E;a.change_ray_test_from_to=function(a,b,c){var d=y(a),e=M(a);(d=d._physics.ray_tests[a])&&!d.autoremove&&(d.from.set(b),d.to.set(c),I.post_msg(e,I.OUT_CHANGE_RAY_TEST_FROM_TO,a,b,c))};a.is_ray_test=function(a){return y(a)._physics.ray_tests[a]?!0:!1};a.vehicle_throttle=function(a,b){var c=
a.vehicle;c.engine_force=b;var d=A(a.physics.body_id);L(a,c,d)};a.vehicle_steer=function(a,b){var c=a.vehicle;c.steering=b;var d=A(a.physics.body_id);L(a,c,d)};a.vehicle_brake=function(a,b){var c=a.vehicle;c.brake_force=b;var d=A(a.physics.body_id);L(a,c,d)};a.is_vehicle_chassis=N;a.is_vehicle_hull=B;a.is_car_wheel=function(a){if(!a.is_vehicle)return!1;a=a.vehicle_settings.part;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.is_boat_bob=function(a){return a.is_vehicle?
"BOB"==a.vehicle_settings.part?!0:!1:!1};a.is_floater_bob=function(a){return a.is_floating?"BOB"==a.floating_settings.part?!0:!1:!1};a.is_vehicle_steering_wheel=function(a){return a.is_vehicle&&"STEERING_WHEEL"==a.vehicle_settings.part?!0:!1};a.is_vehicle_speedometer=function(a){return a.is_vehicle&&"SPEEDOMETER"==a.vehicle_settings.part?!0:!1};a.is_vehicle_tachometer=function(a){return a.is_vehicle&&"TACHOMETER"==a.vehicle_settings.part?!0:!1};a.get_vehicle_speed=function(a){return a.vehicle.speed};
a.wheel_index=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.is_character=function(a){return a.is_character};a.is_floater_main=O;a.get_fps=function(){return ba};a.debug_workers=function(){for(var a=0;a<pa.length;a++)I.post_msg(pa[a],I.OUT_DEBUG)};a.remove_bounding_object=function(a){var b=J.indexOf(a);-1==b&&G.error("Object "+a.name+" doesn't have bounding physics");for(var c=a.physics.body_id,
d=A(c),f=e(d),h=f._physics.bundles,k=[],g=0;g<h.length;g++)for(var l=h[g].physics,p=0;p<l.collision_tests.length;p++)for(var r=l.collision_tests[p],q=0;q<r.pairs.length;q++){var u=r.pairs[q],x=r.pair_results[q];if(u[0]==c||u[1]==c)r.pairs.splice(q,1),r.pair_results.splice(q,1),q--,x&&!n(r)&&(x=fa.set(0,0,0,R),r.callback(!1,null,x,x,0)),k.push(u)}k.length&&I.post_msg(d,I.OUT_REMOVE_COLLISION_TEST,k);a.physics&&a.physics.col_imp_test_cb&&m(a);delete ka[c];J.splice(b,1);a=f._physics.bundles;for(b=0;b<
a.length;b++)a[b].physics.body_id==c&&(a.splice(b,1),b--);I.post_msg(d,I.OUT_REMOVE_BODY,c)}};b4w.module.__data=function(a,t){function v(a,b){Hb[b.id]=null;ma[b.id]=null}function c(a,b,c){var d;a instanceof ArrayBuffer&&(a=R.get_width_height(a));d=a.width;a=a.height;ha.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(jc)&&c&&ha.warn("image",b,"is not from app root.")}function b(a,b,c,d,e,f){d=b.filepath;if(!d)throw"Nothing requested";ka.enqueue([{id:d,type:ka.AT_JSON,url:d}],function(d,f,h,k){if(d){ha.log("%cLOAD METADATA","color: #616",
k);f=wa.str_to_version(d.b4w_format_version);switch(wa.version_cmp(f,ya.min_format_version)){case -1:f[0]<ya.min_format_version[0]?wa.panic("JSON version is too old relative to B4W engine: "+wa.version_to_str(f)+", required: "+wa.version_to_str(ya.min_format_version)+". Reexport scene with the latest B4W addon to fix it."):ha.warn("JSON version is a bit old relative to B4W engine: "+ +wa.version_to_str(f)+", required: "+wa.version_to_str(ya.min_format_version)+". Some compatibility issues can occur. Reexport scene with the latest B4W addon to fix it.");
break;case 1:f[0]>ya.min_format_version[0]?wa.panic("B4W engine version is too old relative to JSON. Can't load the scene. Update your engine version to fix it."):ha.warn("B4W engine version is a bit old relative to JSON. Some compatibility issues can occur. Update your engine version to fix it.")}ya.loaded_data_version=f;for(var g in d)a[g]=d[g];b.is_primary&&(la=xa.find_main_scene(a.scenes));(d=a.binaries[0].binfile)?b.binary_name=d:(ia.skip_stage_by_name(b,"load_binaries"),ia.skip_stage_by_name(b,
"prepare_bindata"));ya.is_mobile_device||ia.skip_stage_by_name(b,"mobile_media_start");ya.antialiasing&&ya.smaa||ia.skip_stage_by_name(b,"load_smaa_textures");if(a.b4w_export_errors)for(d=0;d<a.b4w_export_errors.length;d++)g=a.b4w_export_errors[d],(b.is_primary&&"PRIMARY"==g.type||"ALL"==g.type)&&ha.export_error(g.text);if(a.b4w_export_warnings)for(d=0;d<a.b4w_export_warnings.length;d++)g=a.b4w_export_warnings[d],(b.is_primary&&"PRIMARY"==g.type||"ALL"==g.type)&&ha.export_warn(g.text);e(b,c)}else ia.abort_thread(b)},
null,function(a){f(b,c,a)})}function e(a,b,c,d,e,f){d=T(b.filepath)+b.binary_name;if(!d)throw"Binary data is missing";ka.enqueue([{id:d,type:ka.AT_ARRAYBUFFER,url:d}],function(d,f,h,k){d?(ha.log("%cLOAD BINARY","color: #616",k),a.bin_data=d,d=n(d),f=wa.str_to_version(a.b4w_format_version),d[0]!=f[0]&&wa.panic("BIN version does not match to JSON version: "+wa.version_to_str(d)+", required: "+wa.version_to_str(ya.min_format_version)+". Couldn't load the scene. Reexport scene to fix it."),d[1]!=f[1]&&
ha.warn("BIN version does not match to JSON version: "+ +wa.version_to_str(d)+", required: "+wa.version_to_str(ya.min_format_version)+". Some compatibility issues can occur. Reexport scene to fix it."),e(b,c)):ia.abort_thread(b)},null,function(a){f(b,c,a)})}function d(a,b,c,d,e,f){X.check_shaders_loaded()&&e(b,c)}function l(a,b,c,d,e,f){d=a.bin_data;f=a.binaries[0];var h=a.objects,k=a.meshes;a=a.actions;for(var g=wa.check_endians(),l=n(d),l=5<=l[0]&&4<l[1]?12:0,m=["indices"],p=["normal","tangent"],
r=["color","group"],u=["position","texcoord","texcoord2"],x=0;x<k.length;x++)for(var w=k[x].submeshes,t=0;t<w.length;t++)for(var X in w[t]){var oa=w[t][X][1];if(-1!=m.indexOf(X)){var J=4*w[t][X][0]+f["int"]+l,va=w[t],v=X,B=d;if(g)var z=new Uint32Array(B,J,oa);else for(var z=new Uint32Array(oa),B=new DataView(B),sa=0;sa<oa;sa++)z[sa]=B.getUint32(J+4*sa,!0);va[v]=z}else if(-1!=u.indexOf(X))J=4*w[t][X][0]+f["float"]+l,w[t][X]=q(d,J,oa,g);else if(-1!=p.indexOf(X)){J=2*w[t][X][0]+f["short"]+l;va=w[t];
v=X;B=d;z=new Float32Array(oa);B=new DataView(B);for(sa=0;sa<oa;sa++)z[sa]=B.getInt16(J+2*sa,!0)/32767;va[v]=z}else if(-1!=r.indexOf(X)){J=2*w[t][X][0]+f.ushort+l;va=w[t];v=X;B=d;z=new Float32Array(oa);B=new DataView(B);for(sa=0;sa<oa;sa++)z[sa]=B.getUint16(J+2*sa,!0)/65535;va[v]=z}}for(X=0;X<h.length;X++)for(k=h[X].particle_systems,m=0;m<k.length;m++)p=k[m],p.transforms=q(d,4*p.transforms[0]+f["float"]+l,p.transforms[1],g);for(h=0;h<a.length;h++){X=a[h];k=X.fcurves;m=X.frame_range;r=m[0];u=m[1];
x=ga.get_approx_curve_length(r,u);m=null;0>x&&(x=0);var t=w=!1,y;for(y in k)w|=-1<y.indexOf("rotation_euler"),t|=-1<y.indexOf("rotation_quaternion");p=[];for(y in k)if(w&&t&&-1<y.indexOf("rotation_euler"))delete k[y];else{var oa=k[y],V;for(V in oa)J=oa[V],va=q(d,f["float"]+4*J.bin_data_pos[0]+l,J.bin_data_pos[1],g),v=new Float32Array(x),null===m&&(m=new Int8Array(x)),ga.approximate_curve(J,va,v,m,r,u),J._pierced_points=v;-1<y.indexOf("rotation_euler")&&(ga.fcurve_replace_euler_by_quat(k[y]),p.push(y))}for(r=
0;r<p.length;r++)u=p[r],x=u.replace("euler","quaternion"),k[x]=k[u],delete k[u];X._bflags=m}e(b,c)}function n(a){var b=new Uint8Array(a,0,4),c=(new Uint32Array(a,4,1))[0];a=(new Uint32Array(a,8,1))[0];for(var d=0;d<b.length;d++)if("B4WB"[d]!=String.fromCharCode(b[d])){c=5;a=4;break}return[c,a]}function q(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+4*e,!0)}return d}function g(a,b,c,d,e,f){var h=a.cameras,g=a.groups,l=
a.materials,m=a.meshes,n=a.node_groups,p=a.objects,r=a.particles,q=a.scenes,t=a.speakers,X=a.lamps,J=a.textures,B=a.worlds;n||(ha.warn('"node_groups" datablock undefined. reexport main scene.'),n=a.node_groups=[]);for(var v="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),z={},y=0;y<v.length;y++)for(var V=a[v[y]],ca=0;ca<V.length;ca++){var bb=V[ca];z[bb.uuid]=bb}for(var G=0;G<q.length;G++){for(var ra=
q[G],R=ra.objects,S=0;S<R.length;S++)w(R,S,z);ra.camera&&w(ra,"camera",z);ra.world&&w(ra,"world",z)}for(G=0;G<g.length;G++)for(var N=g[G].objects,S=0;S<N.length;S++)w(N,S,z);for(G=0;G<p.length;G++){var A=p[G];A.dupli_group&&w(A,"dupli_group",z);A.parent&&w(A,"parent",z);A.dg_parent&&w(A,"dg_parent",z);if(A.animation_data){var D=A.animation_data;D.action&&w(D,"action",z);if(D.nla_tracks)for(S=0;S<D.nla_tracks.length;S++)for(var K=D.nla_tracks[S],F=0;F<K.strips.length;F++)K.strips[F].action&&w(K.strips[F],
"action",z)}switch(A.type){case "MESH":if(!A.data)throw"mesh not found for object "+A.name;w(A,"data",z);for(var O=!1,E=A.modifiers,S=0;S<E.length;S++){var ya=E[S];"ARMATURE"==ya.type?(O&&ha.warn('Object "'+A.name+'" has more than one armature modifiers. Only the first one will be used.'),O=!0,w(ya,"object",z)):"CURVE"==ya.type&&w(ya,"object",z)}var I=A.particle_systems;if(I)for(S=0;S<I.length;S++)w(I[S],"settings",z);break;case "ARMATURE":w(A,"data",z);for(var Y=A.pose.bones,fb=A.data.bones,S=0;S<
Y.length;S++){var M=Y[S];M.bone=fb[M.bone];var L=M.constraints;if(L)for(F=0;F<L.length;F++){var ua=L[F];ua.target&&w(ua,"target",z)}for(var ia=M.parent_recursive,F=0;F<ia.length;F++)ia[F]=Y[ia[F]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":w(A,"data",z)}if(L=A.constraints)for(S=0;S<L.length;S++)ua=L[S],ua.target&&w(ua,"target",z);var P=A.lod_levels;if(P)for(S=0;S<P.length;S++){var Wb=P[S];Wb.object&&w(Wb,"object",z)}}for(G=0;G<m.length;G++)for(var U=m[G].materials,S=0;S<U.length;S++)w(U,
S,z);for(G=0;G<l.length;G++){for(var Q=l[G],zb=Q.texture_slots,S=0;S<zb.length;S++)w(zb[S],"texture",z);var pa=Q.node_tree;pa&&x(pa,z)}for(G=0;G<n.length;G++)(pa=n[G].node_tree)&&x(pa,z);for(G=0;G<J.length;G++){var na=J[G],Hb=na.type;"IMAGE"!=Hb&&"ENVIRONMENT_MAP"!=Hb||w(na,"image",z)}for(G=0;G<h.length;G++){var ja=h[G];ja.dof_object&&w(ja,"dof_object",z)}for(G=0;G<t.length;G++){var jc=t[G];jc.sound&&w(jc,"sound",z);if(jc.animation_data&&(D=jc.animation_data,D.action&&w(D,"action",z),D.nla_tracks))for(S=
0;S<D.nla_tracks.length;S++)for(K=D.nla_tracks[S],F=0;F<K.strips.length;F++)K.strips[F].action&&w(K.strips[F],"action",z)}for(G=0;G<r.length;G++){for(var ka=r[G],zb=ka.texture_slots,S=0;S<zb.length;S++)w(zb[S],"texture",z);ka.dupli_group&&w(ka,"dupli_group",z);ka.dupli_object&&w(ka,"dupli_object",z)}for(G=0;G<X.length;G++){var tb=X[G];if(tb.animation_data&&(D=tb.animation_data,D.action&&w(D,"action",z),D.nla_tracks))for(S=0;S<D.nla_tracks.length;S++)for(K=D.nla_tracks[S],F=0;F<K.strips.length;F++)K.strips[F].action&&
w(K.strips[F],"action",z)}for(G=0;G<B.length;G++)if(zb=B[G].texture_slots)for(S=0;S<zb.length;S++)w(zb[S],"texture",z);oa.check_bpy_data(a);for(var W=a.textures,T=b.is_primary?a.scenes[0].b4w_anisotropic_filtering:la.b4w_anisotropic_filtering,ea=0;ea<W.length;ea++)b.is_primary||"SCENE"!=W[ea].b4w_source_type||(W[ea].b4w_source_id=""),sa.create_texture_bpy(W[ea],T,a.scenes,b.id);for(var aa={},Z=a.objects,da=0;da<Z.length;da++){var fa=Z[da];if("MESH"===fa.type&&!fa.particle_systems.length)for(var gb=
fa.data,ta=gb.name,Pa=gb.submeshes,Ga=gb.materials,ba=0;ba<Pa.length;ba++)0!==Pa[ba].base_length||aa[ta]||(Ga[ba]&&ha.warn('material "'+Ga[ba].name+'" is not assigned to any face (object "'+fa.name+'").'),aa[ta]=!0)}for(var Aa=a.meshes,ub=0;ub<Aa.length;ub++){var Fc=Aa[ub];Fc.materials.length||Fc.uv_textures.length&&ha.warn('mesh "'+Fc.name+'" has a UV map but has no exported material.')}var pc=a.materials,mb=oa.create_material("DEFAULT");pc.push(mb);for(var bc=a.meshes,qc=wa.keysearch("name","DEFAULT",
a.materials),nb=0;nb<bc.length;nb++){var Zb=bc[nb];0==Zb.materials.length&&Zb.materials.push(qc)}for(var Wa=a.actions,ib=b.id,pb=0;pb<Wa.length;pb++){var uc=Wa[pb];uc._data_id=ib;ga.append_action(uc)}for(var Gb=a.scenes,cc=0;cc<Gb.length;cc++){for(var Rb=Gb[cc],Kb=[],xb=[],dc=Gb[cc].objects,Na=0;Na<dc.length;Na++){var Ja=dc[Na];C(dc,Ja,Kb,xb);var ec=Ja.dupli_group;if(ec)for(var Lb=ec.objects,yb=0;yb<Lb.length;yb++)C(Lb,Lb[yb],Kb,xb)}for(Na=0;Na<xb.length;Na++)for(var fc=xb[Na],Kc=[Rb],Sb=0;Sb<Kc.length;Sb++){for(var rc=
Kc[Sb].objects,mc=0;mc<rc.length;mc++){var Cc=rc[mc].dupli_group;if(Cc){var Dc=Cc.objects,Tb=Dc.indexOf(fc);-1<Tb&&Dc.splice(Tb,1)}}var Tb=rc.indexOf(fc);-1<Tb&&rc.splice(Tb,1)}for(Na=0;Na<Kb.length;Na++)wa.append_unique(Kb[Na][0],Kb[Na][1])}!b.is_primary&&1<a.scenes.length&&(a.scenes=[xa.find_main_scene(a.scenes)],ha.warn("loading data contains multiple scenes.","Only the first one will be loaded."));var $a=b.is_primary?la:xa.find_main_scene(a.scenes);va.set_framerate(la.fps);if(1<a.scenes.length){var Oa=
a.scenes.indexOf(la);a.scenes.splice(Oa,1);a.scenes.unshift(la)}for(var Lc=0;Lc<a.scenes.length;Lc++){var Ub=a.scenes[Lc];Ub._render=xa.create_scene_render();Ub._is_main=Ub==$a;Ub._is_primary_thread=b.is_primary;ic.enabled&&Ub.b4w_enable_physics&&(b.is_primary||!H.scene_has_physics(la)&&Ub==xa.find_main_scene(a))&&H.init_scene_physics(Ub);b.is_primary?Ub.b4w_enable_audio&&Ea.attach_scene_sfx(Ub):Ub.b4w_enable_audio&&!la._sfx&&Ea.attach_scene_sfx(la)}for(var Mc=0;Mc<a.scenes.length;Mc++){var $c=a.scenes[Mc],
Qc,Rc=[];u($c.objects,"ALL",Rc);Qc=Rc;$c.b4w_use_logic_editor&&oa.assign_logic_nodes_object_params(Qc,$c);for(var nc=0;nc<Qc.length;nc++){var Vb=Qc[nc];qa.check_bpy_obj_scene_compatibility(Vb,$c,a)&&(Vb._scenes||(Vb._scenes=[]),Vb._scenes.push(b.is_primary?$c:la))}for(var fd=Qc,ld=0;ld<fd.length;ld++){var Nc=fd[ld];if(Nc._scenes)for(var rd=Nc.particle_systems,md=0;md<rd.length;md++){var gc=rd[md].settings;if("HAIR"==gc.type)if("OBJECT"==gc.render_type){var hc=gc.dupli_object;hc._scenes||(hc._scenes=
Nc._scenes.slice())}else if("GROUP"==gc.render_type)for(var vc=gc.dupli_group,nd=0;nd<vc.objects.length;nd++)hc=vc.objects[nd],hc._scenes||(hc._scenes=Nc._scenes.slice())}}}for(var Sc=a.scenes,gd=[],sb=0;sb<Sc.length;sb++)k(Sc[sb].objects,0,b.is_primary,gd);ma[b.id]=[];for(sb=0;sb<gd.length;sb++)for(var ad=gd[sb],Oc=0;Oc<ad.length;Oc++)for(var sd=ad[Oc],Tc=0;Tc<sd.length;Tc++)ma[b.id].push(sd[Tc]);for(var Uc=a.particles,sb=0;sb<Uc.length;sb++){var Ec=Uc[sb].dupli_object;Ec&&(Ec._is_hair_dupli=!0,
ma[b.id].push(Ec));var hd=Uc[sb].dupli_group;if(hd)for(var Vc=hd.objects,Oc=0;Oc<Vc.length;Oc++)Ec=Vc[Oc],Ec._is_hair_dupli=!0,ma[b.id].push(Ec)}for(var bd=ma[b.id],sb=bd.length-1;0<=sb;sb--)bd[sb]._scenes||bd.splice(sb,1);for(var Wc=ma[b.id],Mc=0;Mc<Wc.length;Mc++)if(Vb=Wc[Mc],!b.is_primary&&Vb.parent&&-1<Da.indexOf(Vb.parent.type)&&(Vb.parent=""),"MESH"==Vb.type){var cd=oa.apply_mesh_modifiers(Vb);cd&&(a.meshes.push(cd),Vb.data=cd)}e(b,c)}function u(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];
"ALL"!=b&&b!=e.type||c.push(e);(e=e.dupli_group)&&u(e.objects,b,c)}}function k(a,b,c,d){d[b]=d[b]||[];for(var e=d[b],f=0;f<a.length;f++){var h=a[f],g=ba(h);e[g]=e[g]||[];(c||-1==Da.indexOf(h.type))&&-1==e[g].indexOf(h)&&e[g].push(h);(h=h.dupli_group)&&k(h.objects,b+1,c,d)}}function f(a,b,c){var d=[];a=ma[a];for(var e=0;e<a.length;e++){var f=a[e];if(f.type==c||"ALL"==c)for(var h=0;h<f._scenes.length;h++)b==f._scenes[h]&&d.push(f)}return d}function p(a,b,c,d,e,f){f=ma[b.id];d=b.id;for(var h=0;h<f.length;h++){for(var k=
f[h],g=Aa.create_object(k.name,k.type,k.origin_name),l=0;l<k._scenes.length;l++)Aa.append_scene_data(g,k._scenes[l]);k._object=g;qa.update_object(k,g);g.render.data_id=d;g.is_hair_dupli=k._is_hair_dupli||!1}d=qa.get_all_objects(b.id);for(h=0;h<f.length;h++)k=f[h],g=k._object,ja.update_object(k,g);if(b.is_primary)for(h=b.id,k=0;k<a.scenes.length;k++)for(var g=a.scenes[k],l=0,m=qa.get_scene_objs(g,"LAMP",h),n=0;n<m.length;n++)Aa.get_scene_data(m[n],g).light_index=l++;for(h=0;h<f.length;h++)k=f[h],g=
k._object,g.is_hair_dupli||(qa.update_object_relations(k,g),bb.update_transform(g));for(a=0;a<f.length;a++)if(h=f[a],k=h._object,Aa.is_mesh(k)&&(g=h.lod_levels.length))for(l=k,m=0;m<g;m++)if(n=h.lod_levels[m].object){n=n._object;n.render.lod_transition_ratio=k.render.lod_transition_ratio;l.render.lod_dist_max=h.lod_levels[m].distance;n.render.lod_dist_min=h.lod_levels[m].distance;if(h.lod_levels[m+1])n.render.lod_dist_max=h.lod_levels[m+1].distance;else{n.render.last_lod=!0;n.render.lod_dist_max=
1E4;break}l.render.last_lod=!1;l=n}else{l.render.last_lod=!0;l.render.lod_dist_max=h.lod_levels[m].distance;break}for(f=0;f<d.length;f++)if(a=d[f],"MESH"==a.type&&(h=a.armobj)){var h=h.render,k=a.render.bone_skinning_info,g=[],p;for(p in k)l=k[p],g.push(4*l.deform_bone_index,4*l.bone_index);h.mesh_to_arm_bone_maps.push(g);h.skinned_renders.push(a.render)}f=p=-1;a=ga.get_max_bones();for(h=0;h<d.length;h++)k=d[h],g=k.render,Aa.is_mesh(k)&&g.is_skinning&&(k=g.max_bones,k>p&&(p=k),a>=k&&k>f&&(f=k));for(h=
0;h<d.length;h++)k=d[h],g=k.render,Aa.is_mesh(k)&&g.is_skinning&&(g.frames_blending=!0,p<a?g.max_bones=p:g.max_bones<=a?g.max_bones=f:(ha.warn('too many bones for "'+k.name+'" / '+g.max_bones+" bones (max "+a+" with blending, "+2*a+" without blending). Blending between frames will be disabled."),g.max_bones=p,g.frames_blending=!1),g.frames_blending=g.frames_blending&&!zb.frames_blending_hack);for(p=0;p<d.length;p++)if(f=d[p],f.is_vehicle)if(a=f.vehicle_settings,"CHASSIS"==a.part){f.vehicle={};f.vehicle.force_max=
a.force_max;f.vehicle.brake_max=a.brake_max;f.vehicle.suspension_compression=a.suspension_compression;f.vehicle.suspension_stiffness=a.suspension_stiffness;f.vehicle.suspension_damping=a.suspension_damping;f.vehicle.wheel_friction=a.wheel_friction;f.vehicle.roll_influence=a.roll_influence;f.vehicle.max_suspension_travel_cm=a.max_suspension_travel_cm;f.vehicle.engine_force=0;f.vehicle.brake_force=1;f.vehicle.steering=0;f.vehicle.speed=0;f.vehicle.props=[];f.vehicle.prop_offsets=[];f.vehicle.steering_wheel=
null;k=(h=Aa.get_dg_parent(f))?Aa.get_dg_objects(h,d):d;for(h=0;h<k.length;h++)g=k[h],g.is_vehicle&&(l=g.vehicle_settings,H.is_car_wheel(g)&&a.name==l.name?(l=H.wheel_index(g.vehicle_settings.part),f.vehicle.props[l]=g,f.vehicle.prop_offsets[l]=new Float32Array(8)):H.is_vehicle_steering_wheel(g)&&a.name==l.name?(f.vehicle.steering_wheel=g,f.vehicle.steering_max=l.steering_max,f.vehicle.steering_ratio=l.steering_ratio,f.vehicle.inverse_control=l.inverse_control,l=ra.invert(f.render.world_tsr,ra.create()),
g=ra.multiply(l,g.render.world_tsr,l),f.vehicle.steering_wheel_tsr=g,l=new Float32Array([1,0,0]),ra.transform_dir_vec3(l,g,l),f.vehicle.steering_wheel_axis=l):H.is_vehicle_speedometer(g)&&a.name==l.name?(f.vehicle.speedometer=g,f.vehicle.speed_ratio=l.speed_ratio,f.vehicle.max_speed_angle=l.max_speed_angle,l=ra.invert(f.render.world_tsr,ra.create()),g=ra.multiply(l,g.render.world_tsr,l),f.vehicle.speedometer_tsr=g,l=new Float32Array([1,0,0]),ra.transform_dir_vec3(l,g,l),f.vehicle.speedometer_axis=
l):H.is_vehicle_tachometer(g)&&a.name==l.name&&(f.vehicle.tachometer=g,f.vehicle.delta_tach_angle=l.delta_tach_angle,l=ra.invert(f.render.world_tsr,ra.create()),g=ra.multiply(l,g.render.world_tsr,l),f.vehicle.tachometer_tsr=g,l=new Float32Array([1,0,0]),ra.transform_dir_vec3(l,g,l),f.vehicle.tachometer_axis=l));if(4!=f.vehicle.props.length)throw"Not enough wheels for chassis "+f.name;}else if("HULL"==a.part)for(f.vehicle={},f.vehicle.props=[],f.vehicle.prop_offsets=[],f.vehicle.force_max=a.force_max,
f.vehicle.brake_max=a.brake_max,f.vehicle.floating_factor=a.floating_factor,f.vehicle.water_lin_damp=a.water_lin_damp,f.vehicle.water_rot_damp=a.water_rot_damp,f.vehicle.engine_force=0,f.vehicle.brake_force=1,f.vehicle.steering=0,f.vehicle.speed=0,f.vehicle.steering_wheel=null,k=(h=Aa.get_dg_parent(f))?Aa.get_dg_objects(h,d):d,h=0;h<k.length;h++)g=k[h],g.is_vehicle&&(l=g.vehicle_settings,H.is_boat_bob(g)&&a.name==l.name?(f.vehicle.props.push(g),f.vehicle.prop_offsets.push(new Float32Array(8))):H.is_vehicle_steering_wheel(g)&&
a.name==l.name?(f.vehicle.steering_wheel=g,f.vehicle.steering_max=l.steering_max,f.vehicle.steering_ratio=l.steering_ratio,f.vehicle.inverse_control=l.inverse_control,l=ra.invert(f.render.world_tsr,ra.create()),g=ra.multiply(l,g.render.world_tsr,l),f.vehicle.steering_wheel_tsr=g,l=new Float32Array([1,0,0]),ra.transform_dir_vec3(l,g,l),f.vehicle.steering_wheel_axis=l):H.is_vehicle_speedometer(g)&&a.name==l.name?(f.vehicle.speedometer=g,f.vehicle.speed_ratio=l.speed_ratio,f.vehicle.max_speed_angle=
l.max_speed_angle,l=ra.invert(f.render.world_tsr,ra.create()),g=ra.multiply(l,g.render.world_tsr,l),f.vehicle.speedometer_tsr=g,l=new Float32Array([1,0,0]),ra.transform_dir_vec3(l,g,l),f.vehicle.speedometer_axis=l):H.is_vehicle_tachometer(g)&&a.name==l.name&&(f.vehicle.tachometer=g,f.vehicle.delta_tach_angle=l.delta_tach_angle,l=ra.invert(f.render.world_tsr,ra.create()),g=ra.multiply(l,g.render.world_tsr,l),f.vehicle.tachometer_tsr=g,l=new Float32Array([1,0,0]),ra.transform_dir_vec3(l,g,l),f.vehicle.tachometer_axis=
l));for(p=0;p<d.length;p++)if(f=d[p],f.is_floating&&(a=f.floating_settings,"MAIN_BODY"==a.part))for(f.floater={},f.floater.floating_factor=a.floating_factor,f.floater.water_lin_damp=a.water_lin_damp,f.floater.water_rot_damp=a.water_rot_damp,f.floater.bobs=[],h=(h=Aa.get_dg_parent(f))?Aa.get_dg_objects(h,d):d,k=0;k<h.length;k++)g=h[k],g.is_floating&&(l=g.floating_settings,H.is_floater_bob(g)&&a.name==l.name&&(f.floater.bobs.push(g),g.bob_synchronize_pos=g.floating_settings.synchronize_position));e(b,
c)}function K(a,b,c,d,e,h){for(d=0;d<a.scenes.length;d++)h=a.scenes[d],h._camera=h.camera._object;for(d=0;d<a.scenes.length;d++){h=b.is_primary?a.scenes[d]:la;var k=b.is_primary?qa.get_scene_objs(h,"LAMP",b.id):qa.get_scene_objs(h,"LAMP",0),g=qa.get_scene_objs(h,"ALL",b.id),l=f(b.id,h,"MESH"),m=f(b.id,h,"EMPTY");b.is_primary&&xa.append_scene(h,g,k,l,m);for(var n=0;n<m.length;n++)qa.update_force(m[n]._object);g=[];xa.set_active(h);J.generate_main_batches(h,l,k,g);m=xa.get_graph(h);if(b.is_primary){n=
h._render.sky_params;if(n.render_sky||n.procedural_skydome)n=J.generate_sky_meta_obj(h,n),g.push(n);xa.generate_auxiliary_batches(m)}for(n=0;n<l.length;n++)J.create_forked_batches(l[n]._object,m,h);for(n=0;n<g.length;n++)J.create_forked_batches(g[n],m,h),qa.objects_storage_add(g[n]);g=qa.get_scene_objs(h,"ALL",b.id);xa.assign_scene_data_subs(h,g,k);for(n=0;n<g.length;n++)h=g[n],h.render.use_shape_keys&&qa.update_boundings(h)}xa.append_scene_vtex(la,a.textures,b.id);b.is_primary&&la._render.video_textures.length&&
(b.has_video_textures=!0);d=a.materials;if(Wb.dds_available&&ya.use_dds)for(a=0;a<d.length;a++){l=d[a];n=l.texture_slots;for(h=0;h<n.length;h++)if(g=n[h],m=g.texture,"IMAGE"==m.type||"ENVIRONMENT_MAP"==m.type)k=m.image,k._is_dds||(-1<k.filepath.indexOf(".dds")?k._is_dds=!0:(k._is_dds=!m.b4w_disable_compression&&!g.use_map_normal&&"ENVIRONMENT_MAP"!=m.type&&!m.b4w_shore_dist_map&&"MOVIE"!=k.source,k._is_dds&&(k.filepath+=".dds")));if(h=l.node_tree)for(l=h.nodes,h=0;h<l.length;h++)k=l[h],"TEXTURE"==
k.type&&(n=k.texture)&&(k=n.image)&&!k._is_dds&&(k._is_dds=n._render.allow_node_dds&&!n.b4w_disable_compression&&"MOVIE"!=k.source&&"ENVIRONMENT_MAP"!=n.type,k._is_dds&&(k.filepath+=".dds"))}else for(a=a.images,d=0;d<a.length;d++)h=a[d],k=Boolean("FILE"==h.source&&-1<h.filepath.indexOf(".dds")),h._is_dds=k;e(b,c)}function D(a,b,c,d,e,f){d=a.groups;f=a.objects;for(var h={},k={},g={},l={},m=0;m<d.length;m++){var n=d[m];h[n.uuid]=n;g[n.uuid]=n}for(m=0;m<f.length;m++)n=f[m],k[n.uuid]=n,l[n.uuid]=n;a=
a.scenes;for(m=0;m<a.length;m++)A(a[m].objects,null,l,g);for(var p in g)p in h||d.push(g[p]);for(p in l)p in k||f.push(l[p]);e(b,c)}function A(a,b,c,d){for(var e=[],f=0;f<a.length;f++){var k=a[f],g=c[k.uuid];if(k=g.proxy){b&&-1==e.indexOf(k.uuid)&&e.push(k.uuid);for(var l=c[k.uuid],m=l.constraints,k=0;k<m.length;k++){var n=wa.clone_object_json(m[k]);n.name+="_CLONE";g.constraints.push(n)}"b4w_proxy_inherit_anim"in g&&!g.b4w_proxy_inherit_anim||(g.animation_data&&(l.animation_data=wa.clone_object_json(g.animation_data)),
l.b4w_use_default_animation=g.b4w_use_default_animation,l.b4w_auto_skel_anim=g.b4w_auto_skel_anim,l.b4w_anim_behavior=g.b4w_anim_behavior,l.b4w_cyclic_animation=g.b4w_cyclic_animation)}}for(f=0;f<e.length;f++)g=wa.get_index_for_key_value(a,"uuid",e[f]),-1<g&&a.splice(g,1);e={};if(b)for(f=0;f<a.length;f++)k=a[f],g=c[k.uuid],m=wa.clone_object_json(g),g="origin_name"in g?g.origin_name:g.name,m.name=Aa.gen_dupli_name(b.name,g),m.origin_name=g,m.dg_parent={uuid:b.uuid},h(m),c[m.uuid]=m,e[k.uuid]=m.uuid,
k.uuid=m.uuid;for(f=0;f<a.length;f++)k=a[f],g=c[k.uuid],g.dupli_group&&(k=g.dupli_group,m=d[k.uuid],l=wa.clone_object_json(m),l.name=wa.unique_name(m.name+"_CLONE"),l.uuid=na.hexdigest("Group"+l.name),d[l.uuid]=l,k.uuid=l.uuid,A(l.objects,g,c,d));if(b)for(f=0;f<a.length;f++){k=a[f];g=c[k.uuid];g.parent&&g.parent.uuid in e?g.parent.uuid=e[g.parent.uuid]:g.parent&&(ha.warn("Object's \""+g.name+'" parent is not in dupli group. Disabling parenting.'),g.parent=null);m=g.constraints;for(k=0;k<m.length;k++)b=
m[k],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);if(b=g.pose)for(d=b.bones,k=0;k<d.length;k++)if(m=d[k].constraints)for(l=0;l<m.length;l++)b=m[l],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);b=g.modifiers;for(k=0;k<b.length;k++)d=b[k],d.object&&d.object.uuid in e&&(d.object.uuid=e[d.object.uuid]);if((g=g.lod_levels)&&g.length)for(k=0;k<g.length;k++)b=g[k],b.object&&b.object.uuid in e&&(b.object.uuid=e[b.object.uuid])}for(var p in e)gb[p]=e[p]}function h(a){a.uuid=
na.hexdigest("Object"+a.name)}function x(a,b){for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];"TEXTURE"==e.type&&e.texture&&w(e,"texture",b);"LAMP"==e.type&&e.lamp&&(e.lamp.uuid in gb&&(e.lamp.uuid=gb[e.lamp.uuid]),b[e.lamp.uuid]||(e.lamp=null));"GROUP"==e.type&&e.node_group&&w(e,"node_group",b)}e=a.links;for(d=0;d<e.length;d++){var f=e[d];r(f,"from_node",c);r(f,"to_node",c);m(f,"from_socket",f.from_node.outputs);m(f,"to_socket",f.to_node.inputs)}if(c=a.animation_data)if(c.action&&w(c,"action",b),
c.nla_tracks)for(d=0;d<c.nla_tracks.length;d++)for(e=c.nla_tracks[d],f=0;f<e.strips.length;f++)e.strips[f].action&&w(e.strips[f],"action",b)}function w(a,b,c){(c=c[a[b].uuid])||ha.error("Dangling link found:",b,a);a[b]=c}function r(a,b,c){c=wa.keysearch("name",a[b].name,c);a[b]=c}function m(a,b,c){c=wa.keysearch("identifier",a[b].identifier,c);a[b]=c}function E(a,b,d,e,f,h){e=T(b.filepath);for(var k=a.images,g={},l=[],m=0;m<k.length;m++){var n=k[m],p=n.uuid;if("FILE"===n.source||"MOVIE"===n.source){var r=
M(n,a.textures);if(!r.length)ha.warn("image ",n.name," has no users.");else if(!r[0].b4w_shore_dist_map){r=wa.normpath_preserve_protocol(e+n.filepath);if("FILE"===n.source){var q=n._is_dds?ka.AT_ARRAYBUFFER:ka.AT_IMAGE_ELEMENT;Wb.min50_available&&ya.use_min50&&(r=ka.split_extension(r),"dds"==r[1]?(r=ka.split_extension(r[0]),r=r[0]+".min50."+r[1]+".dds"):r=r[0]+".min50."+r[1])}else"MOVIE"===n.source&&(ya.seq_video_fallback?(r=ka.split_extension(r),r=r[0]+".altconv.seq",q=ka.AT_SEQ_VIDEO_ELEMENT):(r=
ka.split_extension(r),q=Ea.detect_video_container(r[1]),r=q!=r[1]?r[0]+".altconv."+q:r[0]+"."+q,q=ka.AT_VIDEO_ELEMENT));l.push({id:p,type:q,url:r});g[p]=n}}}if(l.length){var u=0;ka.enqueue(l,function(e,f,k,m){if(e){if(k==ka.AT_VIDEO_ELEMENT||k==ka.AT_SEQ_VIDEO_ELEMENT){if(k==ka.AT_VIDEO_ELEMENT)var n=e.videoWidth,p=e.videoHeight;else n=e.images[0].width,p=e.images[0].height;ha.log("%cLOAD VIDEO "+n+"x"+p,"color: #"+(2048<n||2048<p?"a00":1024<n||1024<p?"aa0":"0a0"),m);-1==m.indexOf(jc)&&ha.warn("video",
m,"is not from app root.")}else c(e,m,!0);f=g[f];m=M(f,a.textures);for(n=0;n<m.length;n++){var p=m[n],r=p.image.filepath;k==ka.AT_SEQ_VIDEO_ELEMENT?(p._render.seq_fps=e.fps,sa.update_texture(p._render,e.images,f._is_dds,r,b.id)):sa.update_texture(p._render,e,f._is_dds,r,b.id)}}e=++u/l.length;h(b,d,e)},function(){ha.log("%cLOADED ALL IMAGES","color: #0a0");f(b,d)})}else f(b,d)}function y(a,b,c,d,e,f){a=xa.get_rendered_scenes();for(d=0;d<a.length;d++)if(f=a[d],f.b4w_use_nla){var h=f.b4w_nla_cyclic;
f.b4w_use_logic_editor&&(h=!1);ja.update_scene(f,h,b.id)}e(b,c)}function M(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function L(a,b,c,d,e,f){a=T(b.filepath);var h=[],k={};d=qa.get_all_objects(b.id);for(var g=0;g<d.length;g++){var l=d[g];if(N(l)){var m=l.sfx.uuid;"BACKGROUND_MUSIC"==Ea.get_spk_behavior(l)?(m=wa.gen_uuid(),b.has_background_music=!0):"NONE"!=Ea.get_spk_behavior(l)&&ya.init_wa_context_hack&&(b.init_wa_context=!0);if(!(m in k)){k[m]=[];var n=wa.normpath_preserve_protocol(a+
l.sfx.filepath);switch(Ea.source_type(l)){case Ea.AST_ARRAY_BUFFER:var p=ka.AT_AUDIOBUFFER;break;case Ea.AST_HTML_ELEMENT:p=ka.AT_AUDIO_ELEMENT}var n=ka.split_extension(n),r=Ea.detect_audio_container(n[1]),n=r!=n[1]?n[0]+".altconv."+r:n[0]+"."+r;h.push({id:m,type:p,url:n})}k[m].push(l)}}if(h.length){var q=0;ka.enqueue(h,function(a,d,e,g){if(a)for(ha.log("%cLOAD SOUND","color: #0aa",g),-1==g.indexOf(jc)&&ha.warn("sound",g,"is not from app root."),d=k[d],e=0;e<d.length;e++)Ea.update_spkobj(d[e],a);
a=++q/h.length;f(b,c,a)},function(){ha.log("%cLOADED ALL SOUNDS","color: #0aa");e(b,c)})}else e(b,c)}function N(a){return Aa.is_speaker(a)&&Ea.source_type(a)!=Ea.AST_NONE}function B(a,b,c){a=qa.get_scene_objs(a,"SPEAKER",b);for(b=0;b<a.length;b++){var d=a[b];Aa.is_speaker(d)&&(Ea.is_cyclic(d)||c)&&Ea.play_def(d)}}function O(a,b){for(var c=a._render.video_textures,d=0;d<c.length;d++){var e=c[d]._render;a.b4w_use_nla&&c[d].b4w_nla_video||!c[d].use_auto_refresh||b!=e.vtex_data_id||(sa.reset_video(e.name,
b),sa.play_video(e.name,b))}}function F(a,b,c,d,e,f){ja.start();ha.log("%cSTART NLA","color: #0a0");e(b,c)}function C(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var e=b.lod_levels.length,f=0;f<e;f++){var k=b.lod_levels[f],g=k.object;if(g){var l=wa.clone_object_nr(g);l.name=b.name+"_LOD_"+String(f+1);h(l);l.lod_levels=[];c.push([a,l]);d.push(g);k.object=l}}}function I(a,b,c,d,e,f){d=!0;for(f=0;f<a.scenes.length;f++)if(!H.check_worker_loaded(a.scenes[f])){d=!1;break}d&&(e(b,c),ha.log("%cPHYSICS READY",
"color: #0a0"))}function Q(a,b,c,d,e,f){for(d=0;d<a.scenes.length;d++){f=a.scenes[d];if(b.is_primary)var h=H.scene_has_physics(f);else h=H.scene_has_physics(la)||H.scene_has_physics(f),f=la;if(ic.enabled&&h)for(h=0;h<Fc.length;h++)for(var k=qa.get_scene_objs(f,Fc[h],b.id),g=0;g<k.length;g++){var l=k[g];l.render.data_id==b.id&&(H.append_object(l,f),b.load_hidden&&H.obj_has_physics(l)&&H.disable_simulation(l))}}e(b,c)}function G(a,b,d,e,f,h){var k={};e=[];var g=a.scenes;for(h=0;h<a.scenes.length;h++){var l=
g[h];if(l._render.water_params&&(l=l._render.water_params.shoremap_image)&&"FILE"===l.source){var m=l.uuid,n=T(b.filepath),n=wa.normpath_preserve_protocol(n+l.filepath);e.push({id:m,type:l._is_dds?ka.AT_ARRAYBUFFER:ka.AT_IMAGE_ELEMENT,url:n});k[m]=l}}e.length?ka.enqueue(e,function(d,e,f,h){if(d){c(d,h,!0);e=k[e];h=M(e,a.textures);for(f=0;f<h.length;f++){var l=h[f];sa.update_texture(l._render,d,e._is_dds,l.image.filepath,b.id)}for(f=0;f<g.length;f++)if(h=g[f],h._render.water_params.shoremap_image===
e){var m=d,n=e,p=document.createElement("canvas"),l=n.size[0],n=n.size[1];p.width=l;p.height=n;p=p.getContext("2d");p.drawImage(m,0,0);m=p.getImageData(0,0,l,n).data;p=new Float32Array(4);p[0]=1/16581375;p[1]=1/65025;p[2]=1/255;p[3]=1;for(var l=l*n,n=new Float32Array(l),r=0;r<l;r++)n[r]=p[1]*m[4*r+2]+p[2]*m[4*r+3];h._render.shore_distances=n}}},function(){f(b,d)}):f(b,d)}function z(a,b,d,e,f,h){e=a.scenes[0];a=[];var k=["SMAA_EDGE_DETECTION","SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING",
"SMAA_RESOLVE"];for(h=0;h<k.length;h++){var g=xa.get_subs(e,k[h]);g&&a.push(g)}if(a.length){e=[];T(b.filepath);h=ka.AT_IMAGE_ELEMENT;e.push({id:"SEARCH_TEXTURE",type:h,filepath:V.paths.smaa_search_texture_path});e.push({id:"AREA_TEXTURE",type:h,url:V.paths.smaa_area_texture_path});for(h=0;h<a.length;h++)if(k=a[h],"SMAA_BLENDING_WEIGHT_CALCULATION"==k.type){a=k.slinks_internal;for(h=0;h<a.length;h++)if(k=a[h],"u_search_tex"==k.to)var l=k.texture;else if("u_area_tex"==k.to)var m=k.texture;break}e.length?
ka.enqueue(e,function(a,d,e,f){a&&(c(a,f,!1),d="SEARCH_TEXTURE"==d?l:m,d.source="IMAGE",d.auxilary_texture=!0,e=-1!=f.indexOf(".dds")?1:0,sa.update_texture(d,a,e,f,b.id),sa.set_filters(d,sa.TF_LINEAR,sa.TF_LINEAR))},function(){f(b,d)}):f(b,d)}else f(b,d)}function Y(a,b,c,d,e,f){for(c=0;c<a.scenes.length;c++){e=a.scenes[c];b.is_primary||(e=la);var h=qa.get_scene_objs(e,"LAMP",b.id);for(f=0;f<h.length;f++){var k=h[f];k.render.data_id==b.id&&d.added_objects.push({scene:e,obj:k})}h=qa.get_scene_objs(e,
"ALL",b.id);for(f=0;f<h.length;f++)k=h[f],"LAMP"!=k.type&&k.render.data_id==b.id&&(b.load_hidden&&Aa.is_mesh(k)&&xa.change_visibility(k,!0),d.added_objects.push({scene:e,obj:k}))}}function U(a,b,c,d,e,f){var h=d.added_objects;e=d.obj_counter;if(h.length){a=h[e].obj;var k=h[e].scene;e=Aa.get_scene_data(a,k);xa.append_object(k,a,!1);a.anchor&&pa.append(a);d=++d.obj_counter/h.length;"LAMP"==a.type&&qa.sort_lamps(k);h=e.cube_refl_subs;if(null!=a.render.cube_reflection_id&&h){var g=ra.get_trans_view(a.render.world_tsr);
xa.update_cube_reflect_subs(h,g)}h=a.reflective_objs;h.length&&k._render.reflection_params&&(k=ra.get_trans_view(a.render.world_tsr),a=ra.get_quat_view(a.render.world_tsr),e=e.plane_refl_subs,xa.update_plane_reflect_subs(e,k,a),Aa.update_refl_objects(h,e.camera.reflection_plane))}else d=1;f(b,c,d)}function P(a,b,c,d,e,f){if(b.is_primary){a=xa.get_main();d=xa.get_rendered_scenes();for(f=0;f<d.length;f++){var h=d[f];xa.prepare_rendering(h,a);h.b4w_use_logic_editor&&ta.init_logic(h,b.id)}xa.set_active(a)}else xa.update_scene_permanent_uniforms(la);
a=qa.get_all_objects(b.id);qa.update_objects_dynamics(a);e(b,c)}function da(a,b,c,d,e,f){if(b.is_primary)for(d=0;d<a.scenes.length;d++)O(a.scenes[d],b.id),B(a.scenes[d],b.id);else O(la,b.id),B(la,b.id);e(b,c)}function fa(a,b,c,d,e,f){for(d=0;d<a.scenes.length;d++)a.scenes[d].camera=null;b.has_video_textures||b.has_background_music||b.init_wa_context?Pa||aa(a,e,b,c):e(b,c)}function aa(a,b,c,d){var e=ub.parentElement;tb=e.style.zIndex;e.style.zIndex="999";Pa=document.createElement("div");Pa.style.position=
"relative";Pa.style.height="88px";Pa.style.width="88px";var f=Math.round(ub.offsetHeight/2-44),h=Math.round(ub.offsetWidth/2-44);Pa.style.top=f.toString()+"px";Pa.style.left=h.toString()+"px";Pa.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALAAAACwCAYAAACvt+ReAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAbrwAAG68BXhqRHAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAABVDSURBVHic7Z15kF1Vncc/v05Ys7JIQJZ0GLaAgCzCQARGFMIwZKTiqCPBAbTEEodBhYKALJKSVWYsCpTBcgCLAdQBHWZACCCyhCElIRiWEMOSBZAkCglJOoTQyW/++J3Xfe95971+273v3fvOp6qr+5573+vT3d8+93vP+Z3fTwjUhKoKsC0wLvKxDTA68rEVMNK9ZDiwpft6PdDvvl4LvA+sBt5zn1cCy4EVwDJgpYhouj9RMZB2d6ATUdWtgD2BXvcxARgPbJ5RFzYAS4BFwGL38YqIvJ/R988NQcCAqm4LHADsA+yLibannX1KYBMm6JeBBcA8EVnZ3i61n64UsKoOAyYCh7iPCeTvd6HA68BcYA6wQEQ2trdL2ZO3P1rDqGoPsD9wNHAkMKqBt1nNoFctfV7j2ldj/rbPXdsvIuvd994S88QAIzCfHPXOHyHurRvt21PALOAFEdnUwHvkjsILWFV7gcnAUcDYWl8GvAEsZNCDLhKR91rfw4RvrjoWuyv0us97ALtS+99rFfAEMFNElqTRx06hkAJ2I94ngRMwXzsUmzCxzsP85csisja9HtaPqo7CbM9EzK/vRW1/vwXATODJ0h2hSBRKwO5hbAom3KFuw2uAZzD/+JyIrEm5ey1FVUcDB2Ee/hPU9vM+ANwnIu+m3L3MKISAVXU3YCrwNwx6zSTWArOBJ7Gn+P4q1+YGVR0OfByzSX+N+exKfAg8DtwtIm9m0L1UybWAVfWjwJcw4Vb6WRT4A3YbnV0U0VZCVTfDRDwZOJDKv5dNwGPAXSLydja9az25FLCqbg9MA44FhlW4bDXwIPYgszyrvnUSqrojJuRqlqof+C1wp4i8k1XfWkWuBKyqmwN/D3wRW7ZN4m3gfzHhfpBV3zoZNyofBXwem81I4gPgHsxabMiqb82SGwGr6lHAV7A50yQWA3cCT4c4gmRcPMeRwCnY0ngSK4BbRGRWZh1rgo4XsJtZOAvzdUm8CfwSeKxbJu+bxQl5EnAqsEuFy+YAPxKRP2fWsQboWAG7X/JJwGkMRnVFWQXcDjwchNsYbnVyMibkMQmXvA/8DLi/U+9qHSlg95B2HvCxhNP9wG+AO0SkL+F8oE7cws9UzCNvlnDJAuA6EVmWacdqoOMErKpHA98keS7zReAGEXkr2151B6q6C3A2sF/C6bWYpXgy215Vp2MErKpbYMI9NuF0H3ArNrPQkbeyouCs2wnA6SQPIo8AN3XKDE9HCFhVdwK+iwWv+DwLXF+k5c88oKrbAecAByecfh24shMsRdsFrKqHYn53pHdqAzYtdk8YdduDG40nA18DtvBOrwP+TURmZ96xCG0VsKp+DrtV+f1YDFwrIkuz7lOgHBeSej6wm38KmzP+deadcrRFwG765kxsmszncexBrXChf3nGzVScg63o+cwEftyOHSGZC9htmLwAONQ71Y/9N/9P1n0K1I6qngycQXkMyjPANVkPPJkKWFVHApcDe3un1mIPBc9n2Z9AY6jqgcBFlM9SLAAuy3J+PjMBu20yM4DdvVPLge+JyBtZ9SXQPC4G+zJsD1+U14BLs9p+lYmAXTzDFZRHQi0EZojIqiz6EWgtqroNcCmWQyPKUuDiLKY+Uxewqo4BrqL8CfZF4PKQrCPfuIe7S7Dg+ShvARekPTilKmBVHYGNvHt4p54FrshT3GmgMm4V9SJsf16URcBFae43TE3Abrbh+5Q/sM0Gri761p5uwwXNTwcO904twOxEKrMTqaRPcvO851Eu3uewqZYg3oIhIh9iVnGOd2ofYLrLhtRy0sr/dSbl/4nzMdvwYUrfM9Bm3MB0JfCCd+pQbFNCy2m5gN3ysL/CthCbWgmrawXHPdfMAF7xTk12iyAtpaUCVtXDsNiGKMuxqbIg3i7BzSzNwPbXRfmqC95qGS0TsKqOA75N/MGwjzDP25W41K+XYausA83AeS58tiW0RMCRucBo7oF+zPMWOrlcoDJudfUqIBrkMxK40KVIaJpWjcBnUR6MfkuIbQiIyDzgNq95d+AbrXj/pgWsqpMo3wb0eIgqC5Rw8cL+Xrrj3P7HpmhKwKr6EeBfvOYlwA3NvG+gkFyPxUhEOcvtQG+YhgXstpucSzykbgO2kyLMOARiOE1ci2XHLDES+I7TUkM0MwJPoTxvw63hoS1QCRFZjCVKiXIAcGKj79mQgJ11+LLX/BxwX6MdCXQN92K7N6Kc1qiVaHQE/ibx7JB9wA/D7uHAUDiN3MhgMRyArWlwqbluAbsskf5qyq0hb0OgVlwe4tu85sPcjFZd1CVgN/l8htf8IrYrNRCohwexAK8oX3OxxTVT7wg8FdghctyPbYEP1iFQF04zNzBYQxpge+Cz9bxPzQJ2qYb+wWu+NyTaCzSKW2q+32v+gttDWRP1jMDTiOfpXYUllg4EmuFOrJ5JiS2xDPI1UZOAXTWgT3vNt4f8vIFmcRq63Wv+jCtQMyS1jsCnEM/E8haWZjO3qOrDqrp/u/sRAGwSIFqzbjjwj7W8cEgBuwQWftDFfxagMvpngLmqerNbmAm0CVci4ude87GquvNQr61lBP6cd90SrCJ6ERiO7d/7o6pe0KoY1UBDPI5lJS3Rg2mvKlUF7J4Gj/Ga7yjgtNk2wNXAC6r6+XZ3phtxmvqF1/wpl/2nIkONwFOI1x7+E/B0/d3LDXsBvwz+uG08hRWqLLEZySl4B6goYLdN6ASv+b8LOPomEfxxG3Be+F6v+cRqq3PVRuCjie9xWwM82nj3ckfwx+3hYeLzwqNITqoNVBfw8d7xg10aqB78cYa46kd+bM3kStcnCtjVRNgn2gQ81Gznck7wx9kxE9NciYluOreMSiOwr/g/iMjbiVd2H8Efp4wr3+XvaPcdAZAgYJeYz/ccIVwyTvDH6ePf8Y9x2oyRNALvD4yNHPdhKVED5QR/nB5PY7XoSmwD7OtflCRgf9n4/0I61CEJ/rjFuCSB/sBZNhsRE7DL4XqEd01Rlo2zIPjj1uJrb5JvI/wReCIwOnK8GpiXQseKTPDHrWMutv5QYix2txvAF7Bf42BOsA8NE/xxkzjtzfWaYxr1BezvNvbTxQfqJ/jj5njWO45pdEDALuqnN3JuE5asJNAagj9ujGeJL2rs4YpmAvER+EDiyakXplkeqUsJ/rhOXMXP16JNRFKaRQU80XtteHhLj+CP68PX4sB8cE9So+Pl1LoTKBH8cW34WowL2BUlHB+5QIE/pt+vgCP44+rMJ+6DJ7h49YEReE/io/Ebwf9mTvDHFRCR1dhO+BLDcOWLS6Lt9V7j1/gKZEfwx8ks9I4nwKCAd/dOLkq9O4GhCP44jp84vRcqj8BBwJ1D8MeGr8legB5Xn8CPdg9lAjqL4I/jOSMAxquq9ADbAtFfyJpQWbNj6Vp/7BKoR3PxbQmM7QHGedcuy6xXgUbpVn+83DselyRg/6JA59Jt/tjX5g5BwPmnm/xx4gjs5576S0adCbSWbvDHK7zj7XqI78AAy7weyC9F9serveNRSQIOS8jFoIj+2Bfw6CDgYlM0f+xrc3QPVnC52kWB/FMUf+yPwCN7sBysUT7IqDOB7Mm7P97gHW+eJOCwC7n45NUff+gdb5YkYP+iQDHJoz9OFPBwrzGMwN1FnvxxooADgRLvt7sD9dJD+Yjrj8iBYrMSmA7sLyL3tbszQ1Bmd4djw/Lm3kX+016gePQDtwAXi8if292ZGqko4ChhBC4+jwDfFpEX292ROqlJwBVLGgVyz0Lg3BxYhUr4MyUbeihfeRtFoGjkyedWoyzsYTgJ68sZdSaQPnn0udVIFHBZhE9GnQmkS159bjV8bb4XBFw88u5zq+Hb27XDMX8UZfuMOhNoLSuBa4AfugIpRWQH7/id4ZTvM9oxo84EWkPRfG41fG0uTxKwr/JA51JEn1sNX5uJAg4jcOdTZJ9bjbId9D3Au8SD2EdFaxAEOoqizOfWjapuC4yINL0PvNcjIgos9a7vzapjgZroB34C7C0i1xT4Ia0aE7zjJSIyUPUwMfNfoCN4BDhIRL7eBQ9p1ej1jhfBYODOYu+kr/ZA9nSrz63EeO94CQwK2B+B90y9O4FKdMN8biPs5R0vhkEBvwJsxGoPAOyqqqNCnYxM6ab53LpQ1dHAzpGmjcCr4DK0i8h64jZCgH0y6l8g+Nyh2Jd4Ec7XnWZjlYkq1uIKpMZCYIqIHNdFixGN4GvxpdIX1QScx8QXeaFr53Mb5EDveECr0e1Dz2PF5EpD9d6qOsbVqg20huBz60RVxxCvoqUkjcAishJ4PXKhAB9Pu4NdRPC5jXEIcf/7SrSGi58XYm7CiwPNEXxuc/ganBM98AU8xzs+TFXDLuXGCD63SZz2fAHHBllfwAuI79AYSbAR9RLiFlrHwcTT/67CKzkbE7CIbASe8t7kk6l0rZgEn9tajvaOZ4nIpmhDUm60Wd7xEarqJ5QIxAk+t8W4bJmHec2+NhMF/DwWI1xiBHB467pWKILPTY8jga0jx+8SmT4rUSZgFx/sK/2ElnYt/wSfmz7HecdPOG3GqJRedaZ3fKCq7tSSbuWf4HNTRlV3BA7wmh9KujZRwCKyBJuRGGgCjm9J7/JL8LnZMZn44sV8EfF3DQGVR2AoH4VPUNUtm+1ZDgk+N0NUdQvKLauvxQGqCfgJ4nnTRgHHNt613BF8bns4jngGnjUkzD6UqChgEfkA+I3XPFVVu6EsQfC5bcBp67Ne831Oi4kMJcb7iecP3hE4orHu5YLgc9vLJCA6WbAB02BFqgpYRN4FHveap6mqJF2fY4LPbTNu9D3Fa340GnmWRC124G4guny3G+VLfHkl+NzO4Rhg18jxRuBXQ71oSAGLyJvAY17zNFUdlnB5nngAOCD43PbjRt8ves2/E5E/DfXaWh/I7iJejuuj5HxeWEROFBF/G1WgPZwI7BI57gd+XssLaxKwiLwN/NZrPlVVRyRdHwjUiqqOBKZ5zQ+LyLJaXl/PlNidwPrI8RjgS3W8PhBIYhrxed/12B2/JmoWsIi8gz3QRTlJVXdJuj4QGApV3Q34W6/5F272qybqXZT4FfF8wsOBbxVwWi2QMk4z/0x8Z/wy4N563qcuAbtpplu95n0I4ZaB+jmR8oQlP613KrPuZWERmQX83ms+XVW3q/e9At2Jqm4PnOY1zxaR2fW+V6NxDTcCfZHjEQQrEaiBiHWI7rZYB/x7I+/XkICdyb7daz4ImNLI+wW6ipOBQ72220TkL428WTORZfcDL3htp6tqbxPvGSgwqro78E9e8zxsVbQhGhaw25/0r8DaSPPmwPldGvgeqIKqbgWcD0R3uK/BEnmX7XWrlaZie92wf4PXvBtwbvDDgRJOC+cQXy4G+HGj1qFE08HpIvIUFgAe5QjKA5MD3ctUyhPkzBSRJ5t941btrriJeGZLgDNU1c/rGugyVPUgyn3vq8DNrXj/lgjYbfn4PvG8asOA74aHuu7FLRVPZ7D2CpjvvapVsdct298mIiuAHxAPft8auERVt2nV9wnkA1dZ83vEq2sqcJ2I+OWNG6alGzRF5DnKl5rHAZe6p9BAF6CqWwOXUV6c+6ci8mwrv1fLdxiLyK8Bf1/ZnsCMML1WfFxeh0uBv/JOPSgidQXq1EJaW+R/Avjr2hOBi13WwUABcQmpLwQ+5p2agz3ot5xUBOxyuF5HPD0VWLLsC0K61uLh/qYXUb5MPB+42uWebjmpLja4LUdXAHt4p54HZpSK1QXyjbMNF2PxMFEWAReKyNryV7WG1FfLXJnQq7EVuigvAZeLyLq0+xBID/dccwnltdzeBKYPldehWVJPEyUiq7H/Tj+74H7AFWGKLb+4qbJrKBfvUuCitMULGYzAJdzu0xmUVx1/BxuJ/ZW8QAfjFim+R/lU2WvApVkVyMw04MZ54sspLyTeB1wpIvOy7E+gMdzy8HTiixRgD2yXi0hf+avSIfOIMeeZLgA+4Z3aiC2C3NtMeF0gPVxU2VQstsHPzPR74NqsH8zbEvLoUgmdCZyUcHo2FiOa2X9xYGjcwPMtksuuPQjclNZUWTXaGrOrqicDX03ox1Lsv3lx5p0KlOF2UpxPeTzvJuA/0lhhq5W2B52r6gHYL2esd+pD4A7gnmAp2oOzDFOAM4jvpACLKvuBiPj1tTOl7QIGUNVx2CqOv34OVhv3epcZKJARbuv7OZQvToDNNFzZyqiyRukIAcNAZcZvUF4fDGyW4mfAA2E0Thc36v4d9qC2dcIlM4GbOyWXcscIuISqTgLOJl7kucR84AYReSPbXnUHbm73bCzwymcNcKPbQtYxdJyAYeD29R3Ki92B5Y69D7grzFS0BrfIdAqW7ml4wiXzsJmhpjZgpkFHChhqupWtxpKrPNSO6Zsi4LLsnwCcSjzFaYl1wG10sHXrWAGXcOvtX8cq2CSxHPgvTMibKlwTiOAGh0nAl4GdK1z2DPCjThx1o3S8gEs4b/wVbItSEkuxxMizOnW0aDduAWkSZhd2rXDZMmxu9+nMOtYEuREwDET8n4jd8pJsBdiIfC82Iod4YwaCzY8CvkD5YkSJ9Vj+57s7ZYahFnIl4BLOVkwDPk3yQwfYU/ODmJDfzqpvnYSq7oQVzp5MsscFeyh+GHsorjkzeqeQSwGXUNUdsTodn6JybLNiO0BmYjloczO6NIKbTz8SqyK1P5X/xhuB32HCbfuCRKPkWsAlXJ2OqZiQq+23W4cFC80C5opIf5Vrc4OzCAdhNuFwKtsrsCX6R7El+iHrsHU6hRBwCbe74yTMJ1e6ZZbow56052JiTn33QCtR1bHAwcAh2EbKoUqercFS4t6Xt5+1GoUScAm3yfAo7Dbq12FIfAmWr+t5bLXvZbcVqmNQ1THYCtm+2Bae3ant7zcfeAh4slrV97xSSAFHccujx2P1nbet9WXAW1j1+iVY4sIlWT3kuHoj44EJQC+WGKaecmbvAk9gGSALvexeeAGXcJP3+2Ej8yTKwzdroQ+bJ12BTdetwFYE10Q+r8PiZPtL03guGHw49qC5NWZvRkc+74DNb5c+GqmAugrz9rOAl7plLrxrBBzFTejvhXnHQ7C8FXn7XSjwCvCs+1jYjSuRefujpYLzl/tj/nIi5i/9PV/tZiNmZV7Gcmq8mNXO304mCDgBd8vfA/OfvZgXHQ9klZxwPbAY89+L3NevhpXFcoKA68BN05V86g7Adgz62NGYd90KG72Hua8B3sdG0H5MnH2YZy755ncY9NTLijTNlTb/Dz+sKh/f1rAbAAAAAElFTkSuQmCC')";
Pa.style.backgroundSize="88px";Ga=document.createElement("div");Ga.style.position="relative";Ga.style.height=ub.offsetHeight.toString()+"px";Ga.style.width=ub.offsetWidth.toString()+"px";Ga.style.background="rgba(0, 0, 0, 0.5)";Ga.style.zIndex="999";e.appendChild(Ga);Ga.appendChild(Pa);Pa.addEventListener("click",function(){c.has_video_textures&&(sa.play(),sa.pause(),sa.reset());if(c.has_background_music){if(c.is_primary)for(var e=0;e<a.scenes.length;e++)B(a.scenes[e],c.id,!0);else B(la,c.id,!0);
Ea.pause()}c.init_wa_context&&Ea.play_empty_sound();W();b(c,d)},!1)}function W(){if(Pa){var a=ub.parentElement;a.style.zIndex=tb;Ga.removeChild(Pa);a.removeChild(Ga);Pa=Ga=null;tb=0}}function T(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function Z(a,b,c){ga.is_animated(b)&&ga.remove(b);qa.clear_outline_anim(b);S.check_sensor_manifold(b)&&S.remove_sensor_manifold(b);H.obj_has_physics(b)&&H.remove_bounding_object(b);xa.remove_object_bundles(a,b,c);Aa.is_speaker(b)&&Ea.speaker_remove(b);
pa.is_anchor(b)&&pa.remove(b)}function ba(a){var b=ga.get_bpy_armobj(a);a=b&&b.parent==a?null:a.parent||b;return a?1+ba(a):0}var pa=t("__anchors"),ga=t("__animation"),ka=t("__assets"),J=t("__batch");t("__camera");var V=t("__config"),S=t("__controls"),R=t("__dds"),ua=t("__extensions");t("__lights");var ia=t("__loader");t("__mat4");var na=t("__md5"),ja=t("__nla"),ta=t("__logic_nodes"),ea=t("__nodemat"),qa=t("__objects"),Aa=t("__obj_util"),H=t("__physics"),ha=t("__print"),oa=t("__reformer"),ca=t("__renderer"),
xa=t("__scenes"),Ea=t("__sfx"),X=t("__shaders"),sa=t("__textures"),va=t("__time"),bb=t("__transform"),ra=t("__tsr"),wa=t("__util");t("__vec4");var ya=V.defaults,Wb=V.assets,ic=V.physics,zb=V.animation,fb=V.sfx,Hb=null,ma=null,jc="",la=null,gb={},Pa=null,Ga=null,tb=0,Da=["LAMP","CAMERA"],Fc=["MESH","CAMERA","EMPTY"],ub=null;a.is_primary_loaded=function(a){return ia.is_primary_loaded(a)};a.update=function(){ia.update_scheduler(Hb)};a.setup_canvas=function(a){ub=a};a.update_media_controls=function(a,
b){if(Pa){Ga.style.height=b.toString()+"px";Ga.style.width=a.toString()+"px";var c=Math.round(b/2-44),d=Math.round(a/2-44);Pa.style.top=c.toString()+"px";Pa.style.left=d.toString()+"px"}};a.load=function(a,c,f,h,k){var m={load_main:{priority:ia.ASYNC_PRIORITY,background_loading:!1,inputs:[],is_resource:!1,relative_size:500,primary_only:!1,cb_before:b},duplicate_objects:{priority:ia.SYNC_PRIORITY,background_loading:!1,inputs:["load_main"],is_resource:!1,relative_size:50,primary_only:!1,cb_before:D},
load_binaries:{priority:ia.ASYNC_PRIORITY,background_loading:!1,inputs:["load_main"],is_resource:!1,relative_size:500,primary_only:!1,cb_before:e},wait_for_shaders:{priority:ia.SYNC_PRIORITY,background_loading:!1,inputs:[],is_resource:!1,relative_size:50,primary_only:!0,cb_loop:d},prepare_bindata:{priority:ia.SYNC_PRIORITY,background_loading:!1,inputs:["duplicate_objects","load_binaries"],is_resource:!1,relative_size:100,primary_only:!1,cb_before:l},prepare_bpy_data:{priority:ia.SYNC_PRIORITY,background_loading:!1,
inputs:["duplicate_objects","prepare_bindata"],is_resource:!1,relative_size:100,primary_only:!1,cb_before:g},process_objects:{priority:ia.SYNC_PRIORITY,background_loading:!1,inputs:["prepare_bpy_data"],is_resource:!1,relative_size:150,primary_only:!1,cb_before:p},process_scenes:{priority:ia.SYNC_PRIORITY,background_loading:!1,inputs:["process_objects","wait_for_shaders"],is_resource:!1,relative_size:300,primary_only:!1,cb_before:K},load_smaa_textures:{priority:ia.ASYNC_PRIORITY,background_loading:!1,
inputs:["process_scenes"],is_resource:!1,relative_size:30,primary_only:!0,cb_before:z},load_shoremap:{priority:ia.ASYNC_PRIORITY,background_loading:!1,inputs:["process_scenes"],is_resource:!1,relative_size:30,primary_only:!0,cb_before:G},load_textures:{priority:ia.ASYNC_PRIORITY,background_loading:!0,inputs:["process_scenes"],is_resource:!0,relative_size:500,primary_only:!1,cb_before:E},update_scenes_nla:{priority:ia.SYNC_PRIORITY,background_loading:!1,inputs:["process_scenes","load_textures"],is_resource:!1,
relative_size:50,primary_only:!1,cb_before:y},wait_physics_workers:{priority:ia.SYNC_PRIORITY,background_loading:!1,inputs:["load_shoremap"],is_resource:!1,relative_size:20,primary_only:!1,cb_loop:I},add_physics_objects:{priority:ia.SYNC_PRIORITY,background_loading:!1,inputs:["wait_physics_workers"],is_resource:!1,relative_size:50,primary_only:!1,cb_before:Q},add_objects:{priority:ia.SYNC_PRIORITY,background_loading:!1,inputs:["add_physics_objects"],is_resource:!1,relative_size:600,primary_only:!1,
cb_before:Y,cb_loop:U,cb_after:P,cb_param:{added_objects:[],obj_counter:0}},load_speakers:{priority:ia.ASYNC_PRIORITY,background_loading:!0,inputs:["add_objects"],is_resource:!0,relative_size:100,primary_only:!1,cb_before:L},mobile_media_start:{priority:ia.SYNC_PRIORITY,background_loading:!1,inputs:["load_textures","update_scenes_nla","load_speakers"],is_resource:!0,relative_size:5,primary_only:!1,cb_before:fa,cb_loop:fa},synchronize_media:{priority:ia.SYNC_PRIORITY,background_loading:!0,inputs:["mobile_media_start"],
is_resource:!0,relative_size:50,primary_only:!1,cb_before:da},start_nla:{priority:ia.SYNC_PRIORITY,background_loading:!0,inputs:["mobile_media_start"],is_resource:!1,relative_size:5,primary_only:!0,cb_before:F}},n=ia.get_scheduler();n||(n=ia.create_scheduler(),Hb={},ma={},gb={});Hb[n.threads.length]={};return ia.create_thread(m,a,c,f,v,h||fb.audio_loading_hack,ya.do_not_load_resources,k)};a.unload=function(a){var b=ia.get_scheduler();if(!b||!b.threads.length||a&&!ia.thread_is_finished(b.threads[a]))ha.error("Unable to unload data!");
else{if(0==a)ha.log("%cUNLOAD ALL","color: #00a"),pa.cleanup(),ga.cleanup(),Ea.cleanup(),ja.cleanup(),xa.cleanup(),ia.cleanup(),H.cleanup(),qa.cleanup(),wa.cleanup(),ca.cleanup(),ea.cleanup(),X.cleanup(),S.cleanup(),ua.cleanup(),ka.cleanup(),sa.cleanup(),ta.cleanup(),ma=null,gb={},Hb=la=null;else{ha.log("%cUNLOAD DATA "+a,"color: #00a");ga.remove_actions(a);for(var b=xa.get_all_scenes(),c=0;c<b.length;c++)for(var d=b[c],e=qa.get_scene_objs(d,"ALL",a),f=e.length-1;0<=f;f--){var h=e[f];Z(d,h,!0);e.splice(f,
1);var k=qa.get_scene_objs(d,h.type,a),h=k.indexOf(h);-1!=h&&k.splice(h,1)}}W()}};a.prepare_object_unloading=Z;a.set_debug_resources_root=function(a){jc=a}};b4w.module.__batch=function(a,t){function v(a){a={type:a,subtype:"",id:0,render_id:0,odd_id_prop:"",textures:[],texture_names:[],material_names:[],common_attributes:[],uv_maps_usage:null,vertex_colors_usage:{},shader:null,shaders_info:{vert:null,frag:null,directives:[],node_elements:[]},attribute_setters:[],particle_system:null,bufs_data:null,use_shape_keys:!1,debug_sphere:!1,debug_sphere_dynamic:!1,wireframe_mode:0,num_vertices:0,num_triangles:0,jitter_amp:0,jitter_freq:0,grass_scale_threshold:0,
grass_size:0,grass_map_dim:new Float32Array(3),cube_fog:new Float32Array(16),alpha_clip:!1,blend:!1,color_mask:!1,depth_mask:!1,xray:!1,use_backface_culling:!1,use_shadeless:!1,dynamic_geometry:!1,shadow_cast:!1,shadow_cast_only:!1,shadow_receive:!1,reflexible:!1,reflexible_only:!1,reflective:!1,dynamic_grass:!1,procedural_sky:!1,draw_mode:W.DM_DEFAULT,zsort_type:W.ZSORT_DISABLED,can_fork_outline:!1,forked_batch:!1,psys_name:"",shadow_source:"",halo:!1,halo_size:0,halo_hardness:0,halo_stars_blend:0,
halo_stars_height:0,halo_rings_color:new Float32Array(3),halo_lines_color:new Float32Array(3),halo_particles:!1,ambient:0,emit:0,diffuse_intensity:1,reflect_factor:0,specular_color_factor:0,specular_alpha:1,parallax_scale:0,diffuse_color_factor:0,alpha_factor:1,normal_factor:0,mirror_factor:0,offset_z:0,refr_bump:0,diffuse_params:Array(2),specular_params:new Float32Array(3),texture_scale:new Float32Array(3),specular_color:new Float32Array(3),diffuse_color:new Float32Array(4),fresnel_params:new Float32Array(4),
lamp_uuid_indexes:null,lamp_light_positions:null,lamp_light_directions:null,lamp_light_color_intensities:null,lamp_light_factors:null,has_nodes:!1,water:!1,water_dynamic:!1,water_shore_smoothing:!1,water_generated_mesh:!1,water_num_cascads:0,water_subdivs:0,water_detailed_dist:0,water_norm_uv_velocity:.1,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,foam_uv_freq:new Float32Array(2),foam_mag:new Float32Array(2),foam_scale:new Float32Array(2),shallow_water_col:new Float32Array(3),shore_water_col:new Float32Array(3),
normalmap_scales:null,refractive:!1,particles_data:null};a.diffuse_color[3]=1;a.color_mask=!0;a.depth_mask=!0;return a}function c(a){switch(a.type){case "MAIN":case "PARTICLES":a.subtype=a.blend?a.xray?"XRAY":"BLEND":"OPAQUE";break;case "DEPTH":a.subtype=a.has_nodes?"NODES":"DEPTH";break;case "COLOR_ID":a.subtype=a.xray?"COLOR_ID_XRAY":"COLOR_ID"}}function b(a){var b=a.bufs_data;a.bufs_data=null;var c=ba.copy_object_props_by_value(a);a.bufs_data=b;c.bufs_data=b;return c}function e(a,b){for(var c=
[],d=0;d<a.length;d++){var e=a[d],f=e._object.render,h=U.zero_bounding_box();U.copy_bb(f.bb_original,h);var k=e.data.b4w_bounding_cylinder_radius,g=e.data.b4w_bounding_sphere_radius,m=e.data.b4w_bounding_sphere_center,p=e.data.b4w_bounding_ellipsoid_axes,r=e.data.b4w_bounding_ellipsoid_center;if(f.billboard){var k=Math.max(Math.abs(h.max_x),Math.abs(h.min_x)),g=Math.max(Math.abs(h.max_y),Math.abs(h.min_y)),q=Math.max(Math.abs(h.max_z),Math.abs(h.min_z)),q=Math.sqrt(k*k+g*g+q*q),k=Math.sqrt(k*k+g*
g);h.max_x=h.max_y=h.max_z=q;h.min_x=h.min_y=h.min_z=-q;g=q;m[0]=m[1]=m[2]=0;p[0]=p[1]=p[2]=q;r[0]=r[1]=r[2]=0}f.bb_local=h;q=U.bounding_box_transform(h,f.world_tsr);f.bb_world=q;n(f,k,k,h);h=U.create_bounding_sphere(g,m);f.bs_local=h;h=U.bounding_sphere_transform(h,f.world_tsr);f.bs_world=h;p=U.create_bounding_ellipsoid([p[0],0,0],[0,p[1],0],[0,0,p[2]],r);f.be_local=p;p=U.bounding_ellipsoid_transform(p,f.world_tsr);f.be_world=p;c=c.concat(l(e,f,b))}return c}function d(a,b,c){for(var d=[],e=[],f=
{},h=0;h<a.length;h++){var k=a[h],g=k._object.render,m=U.zero_bounding_box();U.copy_bb(g.bb_original,m);var n=U.bounding_box_transform(m,g.world_tsr),p=U.create_bounding_sphere(k.data.b4w_bounding_sphere_radius,k.data.b4w_bounding_sphere_center),r=U.bounding_sphere_transform(p,g.world_tsr),q=k.data.b4w_bounding_ellipsoid_axes,q=U.create_bounding_ellipsoid([q[0],0,0],[0,q[1],0],[0,0,q[2]],k.data.b4w_bounding_ellipsoid_center),u=U.bounding_ellipsoid_transform(q,g.world_tsr);g.bb_local=m;g.bb_world=
n;g.bs_local=p;g.bs_world=r;g.be_local=q;g.be_world=u;m={};m.shadow_cast=g.shadow_cast;m.shadow_cast_only=g.shadow_cast_only;m.shadow_receive=g.shadow_receive;m.selectable=g.selectable;m.origin_selectable=g.origin_selectable;m.outlining=g.outlining;m.origin_outlining=g.origin_outlining;m.outline_anim_settings_default=g.outline_anim_settings_default;m.reflexible=g.reflexible;m.reflexible_only=g.reflexible_only;m.reflective=g.reflective;m.cube_reflection_id=g.cube_reflection_id;m.plane_reflection_id=
g.plane_reflection_id;m.reflection_type=g.reflection_type;m.caustics=g.caustics;m.wind_bending=g.wind_bending;m.main_bend_col=g.main_bend_col;m.detail_bend_col=g.detail_bend_col;m.billboard=g.billboard;m.billboard_type=g.billboard_type;m.billboard_spherical=g.billboard_spherical;m.dynamic_grass=g.dynamic_grass;m.do_not_cull=g.do_not_cull;m.disable_fogging=g.disable_fogging;m.mats_values=g.mats_values;m.mats_value_inds=g.mats_value_inds;m.mats_anim_inds=g.mats_anim_inds;m.mats_rgbs=g.mats_rgbs;m.mats_rgb_inds=
g.mats_rgb_inds;m.mats_rgb_anim_inds=g.mats_rgb_anim_inds;m.dynamic_geometry=g.dynamic_geometry;n=g.bs_world.center;m.grid_id=0==c?[0,0]:[Math.floor(n[0]/c),Math.floor(n[2]/c)];m.lod_dist_max=g.lod_dist_max;m.lod_dist_min=g.lod_dist_min;m.lod_transition_ratio=g.lod_transition_ratio;m.do_not_render=g.do_not_render;g=JSON.stringify(m);f[g]=f[g]||[];f[g].push(k)}for(var x in f){m=JSON.parse(x);c=f[x];var k=ba.create_render("STATIC"),t;for(t in m)k[t]=m[t];k.data_id=a[0]._object.render.data_id;k.wind_bending_amp=
0;k.wind_bending_freq=0;k.detail_bending_freq=0;k.detail_bending_amp=0;k.branch_bending_amp=0;k.hide=!1;for(h=0;h<c.length;h++)g=c[h]._object,0==h?(k.bb_world=na.clone_object_r(g.render.bb_world),k.bs_world=na.clone_object_r(g.render.bs_world),k.be_local=na.clone_object_r(g.render.be_local),k.be_world=na.clone_object_r(g.render.be_world)):(U.expand_bounding_box(k.bb_world,g.render.bb_world),U.expand_bounding_sphere(k.bs_world,g.render.bs_world));k.bb_local=na.clone_object_r(k.bb_world);k.bs_local=
na.clone_object_r(k.bs_world);e.push({render:k,bpy_objects:c})}for(a=0;a<e.length;a++)for(f=e[a].render,h=e[a].bpy_objects,x=0;x<h.length;x++){t=h[x];c=t._object.render;k=l(t,f,b);g=ia.create();c.billboard&&!c.billboard_pres_glob_orientation?(m=ia.get_trans_view(c.world_tsr),ia.set_trans(m,g)):ia.copy(c.world_tsr,g);m={};if(f.wind_bending||f.billboard)m.au_center_pos=[g[0],g[1],g[2]];f.wind_bending&&(m.au_wind_bending_amp=[c.wind_bending_amp],m.au_wind_bending_freq=[t.b4w_wind_bending_freq],m.au_detail_bending_amp=
[t.b4w_detail_bending_amp],m.au_detail_bending_freq=[t.b4w_detail_bending_freq],m.au_branch_bending_amp=[t.b4w_branch_bending_amp]);for(n=0;n<k.length;n++)q=k[n].render,p=k[n].submesh,r=k[n].batch,q.is_hair_particles?q.billboard?W.submesh_apply_particle_transform(p,g):W.submesh_apply_transform(p,g):("COLOR_ID"==r.type&&(k[n].render=c,r.odd_id_prop=t.uuid,w(r,c),q=O(c),B(r,q,0)),p=W.submesh_apply_transform(p,g),W.submesh_apply_params(p,m));d=d.concat(k)}return d}function l(a,b,c){var d=[],e=q(c,b),
f=O(b),h=a.data,k=h.materials,l=Array(k.length),m=S.find_subs(c,"MAIN_OPAQUE"),n=!1;m&&(n=m.light_positions.length?!0:!1);for(var p=0;p<e.length;p++)for(var r=e[p],u=0;u<k.length;u++){var x=k[u];if(("LENS_FLARES"!=x.name||n)&&!W.has_empty_submesh(h,u)){var t=v(r);"COLOR_ID"==r&&(t.can_fork_outline=!(a.b4w_do_not_render||x.b4w_do_not_render));"MAIN"==r&&(l[u]=t);if(N(t,x)){"DEPTH"==r&&l[u]&&(t.use_shadeless=l[u].use_shadeless);t.draw_mode=b.use_shape_keys||b.dynamic_geometry?W.DM_DYNAMIC_TRIANGLES:
W.DM_DEFAULT;w(t,b);for(var z=t,V=a.particle_systems,G=0;G<V.length;G++){var A=V[G].settings.b4w_vcol_from_name,D=V[G].settings.b4w_vcol_to_name;""!==A&&""!==D&&(z.vertex_colors_usage[A]={generate_buffer:!1,src:[{name:A,mask:7}]})}"DYNAMIC"==b.type&&(t.odd_id_prop=a.uuid);B(t,f);var K=W.extract_submesh(h,u,t.common_attributes,b.bone_skinning_info,t.vertex_colors_usage,t.uv_maps_usage);"LENS_FLARES"==x.name&&(K=pa.prepare_lens_flares(K));d.push({batch:t,submesh:K,mat_names:[x.name],render:b,rel_bpy_objects:[a]})}}}var F=
a.particle_systems;if(0<F.length&&d.length){for(var E=!1,C=!1,p=0;p<F.length;p++){var I=F[p],Y=I.settings;Y.use_render_emitter&&(E=!0);"HAIR"!=Y.type||"OBJECT"!=Y.render_type&&"GROUP"!=Y.render_type&&I.transforms.length||(C=!0);if(E&&C)break}var M=d[0].batch.vertex_colors_usage;if(C)if(1<k.length){for(var ua,H={},P=0;P<F.length;P++){var U=F[P].settings;if("HAIR"==U.type&&("OBJECT"==U.render_type||"GROUP"==U.render_type)){var Q=U.b4w_vcol_from_name,ga=U.b4w_vcol_to_name;""!==Q&&""!==ga&&(H[Q]=na.clone_object_r(M[Q]))}}"a_bending_col_main"in
M&&(H.a_bending_col_main=na.clone_object_r(M.a_bending_col_main));"a_bending_col_detail"in M&&(H.a_bending_col_detail=na.clone_object_r(M.a_bending_col_detail));ua=W.extract_submesh_all_mats(h,[],H)}else ua=d[0].submesh;else ua=null;for(var ka,T=ua,aa=a._object,da=[],Z=a.particle_systems,ta=a.data,qa=0;qa<Z.length;qa++){var ba=Z[qa],ha=ba.settings;if(ha.count)if("EMITTER"==ha.type){if("DYNAMIC"==b.type){var Aa=v("PARTICLES"),Ib,ab=ta.materials,Mb=ba.settings.material-1;Mb>=ab.length&&(fa.warn('Wrong material used for rendering particle system "'+
ba.name+'"'),Mb=0);Ib=ab[Mb];"HALO"===ba.settings.render_type&&(Aa.halo_particles=!0);g(Aa,Ib);var Ka=Aa,yc=ba.settings;switch(yc.b4w_billboard_align){case "VIEW":y(Ka,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":y(Ka,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":y(Ka,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":y(Ka,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";}y(Ka,"BILLBOARD",0);y(Ka,"SOFT_PARTICLES",yc.b4w_enable_soft_particles&&
0<yc.b4w_particles_softness&&ea.depth_tex_available?1:0);y(Ka,"SOFT_STRENGTH",R.glsl_value(yc.b4w_particles_softness));R.set_directive(Ka.shaders_info,"WORLD_SPACE","WORLD"==yc.b4w_coordinate_system?1:0);Aa.dynamic_geometry=!0;Aa.odd_id_prop=aa.name+"_"+ha.uuid;Aa.psys_name=ba.name;B(Aa,f);pa.init_particles_data(Aa,ba,Ib);var Ya=pa.generate_emitter_particles_submesh(Aa,ta,ba,aa.render.world_tsr);da.push({batch:Aa,submesh:Ya,mat_names:[Ib.name],render:b,rel_bpy_objects:[a]})}}else if("HAIR"==ha.type){var wb=
na.init_rand_r_seed(ba.seed);ha.b4w_dynamic_grass&&(b.do_not_cull=!0);var Ra=J.check_particles_bin_format(ea.loaded_data_version)&&!ha.b4w_initial_rand_rotation&&!ha.b4w_hair_billboard,Ba=4;Ra&&(Ba=8);if(ba.transforms.length)var Ma=ba.transforms;else for(var Fa=W.geometry_random_points(T,ha.count,!1,wb),Ma=new Float32Array(Fa.length*Ba),za=0;za<Fa.length;za++){var Nb=.75+.5*na.rand_r(wb);Ma[za*Ba]=Fa[za][0];Ma[za*Ba+1]=Fa[za][1];Ma[za*Ba+2]=Fa[za][2];Ma[za*Ba+3]=Nb;Ra&&(Ma[za*Ba+4]=1,Ma[za*Ba+5]=
0,Ma[za*Ba+6]=0,Ma[za*Ba+7]=0)}var zc=S.find_subs(c,"GRASS_MAP")?!0:!1;if("OBJECT"==ha.render_type)var Xa=[q(c,ha.dupli_object._object.render,!0)],jb=L(a,b,M,T,[ha.dupli_object],Xa,[Ma],ha,ba,zc,wb,!1),da=da.concat(jb);else if("GROUP"==ha.render_type){for(var Ab=ha.dupli_group.objects,Xa=[],za=0;za<Ab.length;za++){var sc=q(c,Ab[za]._object.render,!0);Xa.push(sc)}for(var eb=!1,tc=[],za=0;za<Ab.length;za++)tc.push(Ab[za]._object);if(ha.use_whole_group){for(var Ac,Eb=Ma,Xb=tc,Yb=Ra,Ic=Ba,Bb={},Fb=new Float32Array([0,
0,0,1]),Sa=0;Sa<Eb.length;Sa+=Ic)for(var Ha=0;Ha<Xb.length;Ha++){var Za=ja.create(),ac=ia.get_scale(Xb[Ha].render.world_tsr),kc=ia.get_trans_view(Xb[Ha].render.world_tsr);ja.scale(kc,ac,Za);var Jb=ja.clone([Eb[Sa],Eb[Sa+1],Eb[Sa+2]]);Bb[Ha]||(Bb[Ha]=new Float32Array(Eb.length));Yb&&(Bb[Ha][Sa+4]=Fb[0]=Eb[Sa+4],Bb[Ha][Sa+5]=Fb[1]=Eb[Sa+5],Bb[Ha][Sa+6]=Fb[2]=Eb[Sa+6],Bb[Ha][Sa+7]=Fb[3]=Eb[Sa+7],na.quat_bpy_b4w(Fb,Fb),na.transformQuatFast(Za,Fb,Za));ja.add(Jb,Za,Jb);Bb[Ha][Sa]=Jb[0];Bb[Ha][Sa+1]=Jb[1];
Bb[Ha][Sa+2]=Jb[2];Bb[Ha][Sa+3]=Eb[Sa+3]}Ac=Bb;eb=!0}else{var Cb;if(ha.use_group_count){for(var rb=Ma,Bc=tc,Ob=ha.dupli_weights,lc=wb,Jc=Ra,Db=Ba,kb={},La=[],Ua=0;Ua<Bc.length;Ua++)for(var hb=Bc[Ua],Va=hb.origin_name||hb.name,Pb=0;Pb<Ob.length;Pb++){var Ca=Ob[Pb];Va==Ca.name&&La.push(Ca)}Ob.length!=La.length&&fa.error("dupli weights match failed");for(Ua=0;Ua<rb.length;Ua+=Db){for(var Ta,ob=La,lb=[0],Ia=0;Ia<ob.length;Ia++)lb[Ia+1]=lb[Ia]+ob[Ia].count;for(var Qb=lb[lb.length-1]*na.rand_r(lc),pc=0,
Ia=0;Ia<lb.length;Ia++)if(Qb>=lb[Ia]&&Qb<lb[Ia+1]){pc=Ia;break}Ta=pc;kb[Ta]=kb[Ta]||[];kb[Ta].push(rb[Ua],rb[Ua+1],rb[Ua+2],rb[Ua+3]);Jc&&kb[Ta].push(rb[Ua+4],rb[Ua+5],rb[Ua+6],rb[Ua+7])}for(Ta in kb)kb[Ta]=new Float32Array(kb[Ta]);Cb=kb}else{for(var mb=Ma,bc=wb,qc=Ra,nb=Ba,Zb=tc.length,Wa={},ib=0;ib<mb.length;ib+=nb){var pb=Math.floor(Zb*na.rand_r(bc));Wa[pb]=Wa[pb]||[];Wa[pb].push(mb[ib],mb[ib+1],mb[ib+2],mb[ib+3]);qc&&Wa[pb].push(mb[ib+4],mb[ib+5],mb[ib+6],mb[ib+7])}for(pb in Wa)Wa[pb]=new Float32Array(Wa[pb]);
Cb=Wa}Ac=Cb}jb=L(a,b,M,T,Ab,Xa,Ac,ha,ba,zc,wb,eb);da=da.concat(jb)}"INSTANCE"==ha.b4w_wind_bend_inheritance&&aa.render.wind_bending&&fa.warn('Emitter object "'+aa.name+"\" has a particle system with wind bending inheritance from the particle instance. Wind bending on the emitter isn't disabled. Expect unforeseen behavior.")}else throw"Unknown particle settings type";}ka=da;d=E?d.concat(ka):ka}return d}function n(a,b,c,d){a.bcyl_local=U.create_bounding_cylinder(b,d);a.bcap_local=U.create_bounding_capsule(c,
d);a.bcon_local=U.create_bounding_cone(b,d)}function q(a,b,c){var d;b.do_not_render&&!c?(d=[],b.selectable&&S.find_subs(a,"COLOR_PICKING")&&d.push("COLOR_ID")):(d=["MAIN","NODES_GLOW"],(b.selectable&&S.find_subs(a,"COLOR_PICKING")||b.outlining&&S.find_subs(a,"OUTLINE_MASK"))&&!c&&d.push("COLOR_ID"),S.find_subs(a,"WIREFRAME")&&d.push("WIREFRAME"),((b.shadow_cast||b.shadow_receive)&&S.find_subs(a,"DEPTH")||S.find_subs(a,"SHADOW_CAST"))&&d.push("DEPTH"),S.find_subs(a,"GRASS_MAP")&&d.push("GRASS_MAP"));
d.push("PHYSICS");if(b.shadow_cast_only||b.reflexible_only)for(a=null,b.shadow_cast_only&&(a=["MAIN","NODES_GLOW","COLOR_ID","PHYSICS","WIREFRAME"]),b.reflexible_only&&(b=["COLOR_ID","PHYSICS","DEPTH","WIREFRAME"],a=null!==a?na.array_intersect(a,b):b),b=a,a=0;a<b.length;a++)c=d.indexOf(b[a]),-1!==c&&d.splice(c,1);return d}function g(a,b,c){switch(a.type){case "MAIN":if(b.b4w_do_not_render)a=!1;else{if(b.use_nodes)h(a,b,"MAIN");else{k(a,b);var d=b.game_settings.alpha_blend;a.xray=b.b4w_render_above_all&&
"OPAQUE"!=d&&"CLIP"!=d;a.offset_z=b.offset_z;a.texture_scale.set([1,1,1]);var e=b.texture_slots;ta.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.diffuse_color);switch(b.name){case "LENS_FLARES":C(a,"special_lens_flares.glslv","special_lens_flares.glslf");E(a,"a_position");E(a,"a_texcoord");var g=c?[1,1,1,0]:null,g=f(e[0],g);I(a,g);break;default:C(a,"main_stack.glslv","main_stack.glslf");if(!b.use_shadeless){var l=Z.create_lighting_graph(b.uuid,b.name,{use_shadeless:b.use_shadeless,
diffuse_shader:b.diffuse_shader,specular_shader:b.specular_shader});a.shaders_info.node_elements=Z.compose_node_elements(l)}var m=p("use_map_color_diffuse",!0,e),n=p("use_map_color_spec",!0,e),r=p("use_map_normal",!0,e),q=p("use_map_mirror",!0,e),g=p("use_stencil",!0,e),l=m[0],n=n[0],r=r[0],q=q[0],m=m[1],e=g[0]&&p("use_rgb_to_intensity",!0,e)[0];if(l){switch(l.blend_type){case "MIX":y(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":y(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}g=
"IMAGE"==l.texture._render.source&&c?[a.diffuse_color[0],a.diffuse_color[1],a.diffuse_color[2],1]:"ENVIRONMENT_MAP"==l.texture._render.source&&c?[.8,.8,.8,1]:null;g=f(l,g);I(a,g,"u_colormap0");ea.alpha_clip_filtering_hack&&"CLIP"==d&&ua.set_filters(g,ua.TF_NEAREST,ua.TF_NEAREST);a.diffuse_color_factor=l.diffuse_color_factor;a.alpha_factor=l.use_map_alpha?l.alpha_factor:0;a.texture_scale.set(l.scale)}d=l&&l==n;n&&(d||(g=c?[.5,.5,.5,1]:null,g=f(n,g),I(a,g,"u_specmap0")),a.specular_color_factor=n.specular_color_factor);
if(r&&(E(a,"a_normal"),E(a,"a_tangent"),g=c?[.5,.5,1,1]:null,g=f(r,g),I(a,g,"u_normalmap0"),a.normal_factor=r.normal_factor,g=r.texture,g.b4w_use_map_parallax&&ea.parallax)){var x=R.glsl_value(g.b4w_parallax_steps),t=R.glsl_value(g.b4w_parallax_lod_dist);y(a,"PARALLAX",1);y(a,"PARALLAX_STEPS",x);y(a,"PARALLAX_LOD_DIST",t);a.parallax_scale=g.b4w_parallax_scale}q&&(g=c?[0,0,.5,1]:null,g=f(q,g),I(a,g,"u_mirrormap"),a.mirror_factor=q.mirror_factor);if(q=l&&m&&e?1:0)g=c?[.8,.8,.8,1]:null,g=f(m,g),I(a,
g,"u_colormap1"),g=c?[.5,.5,.5,1]:null,g=f(e,g),I(a,g,"u_stencil0");(c=l||n||r)&&a.texture_scale.set(c.scale);y(a,"TEXTURE_SPEC",void 0==n?0:1);y(a,"ALPHA_AS_SPEC",d?1:0);y(a,"TEXTURE_STENCIL_ALPHA_MASK",q);E(a,"a_position");E(a,"a_normal");(l||n||r)&&E(a,"a_texcoord");if(b.b4w_water){a.water=!0;a.water_dynamic=b.b4w_water_dynamic;b.b4w_water_shore_smoothing&&!a.blend?(fa.warn('Material: "'+b.name+'" is opaque.',"Disabling shore smoothing."),a.water_shore_smoothing=!1):a.water_shore_smoothing=b.b4w_water_shore_smoothing;
C(a,"special_water.glslv","special_water.glslf");c=Z.create_lighting_graph(b.uuid,b.name,{use_shadeless:!1,diffuse_shader:b.diffuse_shader,specular_shader:b.specular_shader});a.shaders_info.node_elements=Z.compose_node_elements(c);E(a,"a_position");ea.water_wireframe_debug?(E(a,"a_polyindex"),a.depth_mask=!0,a.wireframe_edge_color=[0,0,0],y(a,"DEBUG_WIREFRAME",1)):y(a,"DEBUG_WIREFRAME",0);d=b.texture_slots;c=p("use_map_normal",!0,d);q=p("use_map_mirror",!0,d)[0];c.length&&(g=f(c[0]),I(a,g,"u_normalmap0"),
a.water_norm_uv_velocity=b.b4w_water_norm_uv_velocity);y(a,"NUM_NORMALMAPS",c.length);a.normalmap_scales=Array(c.length);for(g=0;g<c.length;g++)a.normalmap_scales[g]=new Float32Array(2),a.normalmap_scales[g].set([c[g].scale[0],c[g].scale[1]]);q&&(g=f(q),I(a,g,"u_mirrormap"),a.mirror_factor=q.mirror_factor);q=null;if(ea.foam)for(g=0;g<d.length;g++){var w=d[g];if(!0===w.texture.b4w_water_foam){q=w;break}}q?(y(a,"FOAM",1),g=f(q),I(a,g,"u_foam"),a.foam_factor=b.b4w_foam_factor,a.foam_uv_freq.set(q.texture.b4w_foam_uv_freq),
a.foam_mag.set(q.texture.b4w_foam_uv_magnitude),a.foam_scale[0]=q.scale[0],a.foam_scale[1]=q.scale[1]):y(a,"FOAM",0);for(g=0;g<d.length;g++)if(w=d[g],!0===w.texture.b4w_shore_dist_map){var J=w;break}J&&ea.allow_vertex_textures?(J=f(J),I(a,J,"u_shore_dist_map"),y(a,"SHORE_PARAMS",1),J=w.texture.b4w_shore_boundings,y(a,"MAX_SHORE_DIST",R.glsl_value(w.texture.b4w_max_shore_dist)),y(a,"SHORE_MAP_SIZE_X",R.glsl_value(J[0]-J[1])),y(a,"SHORE_MAP_SIZE_Y",R.glsl_value(J[2]-J[3])),y(a,"SHORE_MAP_CENTER_X",
R.glsl_value((J[0]+J[1])/2)),y(a,"SHORE_MAP_CENTER_Y",R.glsl_value((J[2]+J[3])/2))):y(a,"SHORE_PARAMS",0);if(b.b4w_generated_mesh&&ea.depth_tex_available)y(a,"GENERATED_MESH",1),a.water_generated_mesh=!0,a.water_num_cascads=b.b4w_water_num_cascads,a.water_subdivs=b.b4w_water_subdivs,a.water_detailed_dist=b.b4w_water_detailed_dist;else{E(a,"a_normal");if(q||c.length)E(a,"a_texcoord"),E(a,"a_tangent");y(a,"GENERATED_MESH",0)}if(b.b4w_water_dynamic){w=R.glsl_value(b.b4w_water_dst_noise_scale0);J=R.glsl_value(b.b4w_water_dst_noise_scale1);
c=R.glsl_value(b.b4w_water_dst_noise_freq0);var d=R.glsl_value(b.b4w_water_dst_noise_freq1),q=R.glsl_value(b.b4w_water_dir_min_shore_fac),g=R.glsl_value(b.b4w_water_dir_freq),x=R.glsl_value(b.b4w_water_dir_noise_scale),t=R.glsl_value(b.b4w_water_dir_noise_freq),z=R.glsl_value(b.b4w_water_dir_min_noise_fac),B=R.glsl_value(b.b4w_water_dst_min_fac),v=R.glsl_value(b.b4w_water_waves_hor_fac);y(a,"DST_NOISE_SCALE_0",w);y(a,"DST_NOISE_SCALE_1",J);y(a,"DST_NOISE_FREQ_0",c);y(a,"DST_NOISE_FREQ_1",d);y(a,"DIR_MIN_SHR_FAC",
q);y(a,"DIR_FREQ",g);y(a,"DIR_NOISE_SCALE",x);y(a,"DIR_NOISE_FREQ",t);y(a,"DIR_MIN_NOISE_FAC",z);y(a,"DST_MIN_FAC",B);y(a,"WAVES_HOR_FAC",v)}D(a,b);A(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);a.shore_water_col.set(b.b4w_shore_water_col);a.shallow_water_col_fac=b.b4w_shallow_water_col_fac;a.shore_water_col_fac=b.b4w_shore_water_col_fac;y(a,"ABSORB",R.glsl_value(b.b4w_water_absorb_factor));y(a,"SSS_STRENGTH",R.glsl_value(b.b4w_water_sss_strength));y(a,"SSS_WIDTH",R.glsl_value(b.b4w_water_sss_width))}"HALO"===
b.type&&(w=b.halo,C(a,"halo.glslv","halo.glslf"),y(a,"NUM_RINGS",w.ring_count),y(a,"NUM_LINES",w.line_count),y(a,"NUM_STARS",w.star_tip_count),y(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0),a.common_attributes=["a_position"],a.halo_size=w.size,a.halo_hardness=w.hardness/20,a.halo_rings_color.set(w.b4w_halo_rings_color),a.halo_lines_color.set(w.b4w_halo_lines_color),a.halo_stars_blend=1/b.b4w_halo_stars_blend_height,a.halo_stars_height=b.b4w_halo_stars_min_height,a.halo=!0);y(a,"TEXCOORD",0);y(a,"NORMAL_TEXCOORD",
0);l&&u(a,l,"TEXTURE_COLOR0_CO");m&&u(a,m,"TEXTURE_COLOR1_CO");e&&u(a,e,"TEXTURE_STENCIL_ALPHA_MASK_CO");n&&u(a,n,"TEXTURE_SPEC_CO");r&&u(a,r,"TEXTURE_NORM_CO");y(a,"SHADELESS",b.use_shadeless?1:0);a.use_shadeless=b.use_shadeless}d=b.game_settings.alpha_blend;y(a,"ALPHA","OPAQUE"===d?0:1);y(a,"ALPHA_CLIP","CLIP"===d?1:0);y(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(y(a,"VERTEX_COLOR",1),E(a,"a_color")):y(a,"VERTEX_COLOR",0);a.ambient=b.ambient;a.diffuse_intensity=
b.diffuse_intensity;a.emit=b.emit;a.specular_color.set(b.specular_color);a.specular_alpha=b.specular_alpha;D(a,b);A(a,b);b.b4w_wettable?y(a,"WETTABLE",1):y(a,"WETTABLE",0);K(a,b);a.refractive=b.b4w_refractive;a.refr_bump=b.b4w_refr_bump}a=!0}break;case "NODES_GLOW":a=h(a,b,"GLOW");break;case "DEPTH":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type)a=!1;else if(k(a,b),a.blend)a=!1;else{l=b.game_settings.alpha_blend;b.use_nodes&&"CLIP"==l?h(a,b,"DEPTH"):(C(a,"depth.glslv",
"depth.glslf"),ta.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.diffuse_color));E(a,"a_position");E(a,"a_normal");y(a,"ALPHA","OPAQUE"===l?0:1);a.texture_scale.set([1,1,1]);if((b=p("use_map_color_diffuse",!0,b.texture_slots)[0])&&"CLIP"===l){a.texture_scale.set(b.scale);y(a,"TEXTURE_COLOR",1);E(a,"a_texcoord");if("IMAGE"==b.texture._render.source||"ENVIRONMENT_MAP"==b.texture._render.source)l=f(b),I(a,l,"u_colormap0");"NONE"==b.texture._render.source&&(l=f(b),I(a,l,"u_colormap0"))}else y(a,
"TEXTURE_COLOR",0);a=!0}break;case "PHYSICS":b.b4w_collision?(a.use_ghost=b.b4w_use_ghost,a.collision_id=b.b4w_collision_id,a.collision_margin=b.b4w_collision_margin,a.collision_group=b.b4w_collision_group,a.collision_mask=b.b4w_collision_mask,a.friction=b.physics.friction,a.elasticity=b.physics.elasticity,a=!0):b.b4w_water?(a.water=!0,a.water_dynamics=b.b4w_water_dynamic,a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,
a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,a=!0):a=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||"HALO"===b.type)a=!1;else{k(a,b);a.zsort_type=W.ZSORT_DISABLED;a.depth_mask=!0;a.blend=!1;l=b.game_settings.alpha_blend;
a.xray=b.b4w_render_above_all&&"OPAQUE"!=l&&"CLIP"!=l;b.use_nodes&&"CLIP"==l?h(a,b,"COLOR_ID"):(C(a,"color_id.glslv","color_id.glslf"),ta.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.diffuse_color));E(a,"a_position");y(a,"ALPHA","OPAQUE"===l?0:1);a.texture_scale.set([1,1,1]);if((b=p("use_map_color_diffuse",!0,b.texture_slots)[0])&&"CLIP"===l){a.texture_scale.set(b.scale);y(a,"TEXTURE_COLOR",1);E(a,"a_texcoord");if("IMAGE"==b.texture._render.source||"ENVIRONMENT_MAP"==b.texture._render.source)l=
f(b),I(a,l,"u_colormap0");"NONE"==b.texture._render.source&&(l=f(b),I(a,l,"u_colormap0"))}else y(a,"TEXTURE_COLOR",0);a=!0}break;case "GRASS_MAP":!b.b4w_terrain||b.b4w_do_not_render?a=!1:(k(a,b),a.blend=!1,a.zsort_type=W.ZSORT_DISABLED,a.depth_mask=!0,C(a,"grass_map.glslv","grass_map.glslf"),E(a,"a_position"),l=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,b=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,a.vertex_colors_usage.a_grass_size={generate_buffer:!0,src:[]},l?(a.vertex_colors_usage.a_grass_size.src.push({name:l,
mask:4}),y(a,"DYNAMIC_GRASS_SIZE",1)):y(a,"DYNAMIC_GRASS_SIZE",0),a.vertex_colors_usage.a_grass_color={generate_buffer:!0,src:[]},b?(a.vertex_colors_usage.a_grass_color.src.push({name:b,mask:7}),y(a,"DYNAMIC_GRASS_COLOR",1)):y(a,"DYNAMIC_GRASS_COLOR",0),a=!0);break;case "WIREFRAME":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type?a=!1:(C(a,"wireframe.glslv","wireframe.glslf"),E(a,"a_position"),E(a,"a_normal"),E(a,"a_polyindex"),a.depth_mask=!0,a.wireframe_mode=0,a.wireframe_edge_color=
[0,0,0],a=!0);break;case "PARTICLES":if(b.b4w_do_not_render)a=!1;else{l=b.texture_slots;if(a.halo_particles)C(a,"particles_color.glslv","particles_color.glslf");else if(C(a,"particles_texture.glslv","particles_texture.glslf"),n=Z.create_lighting_graph(b.uuid,b.name,{use_shadeless:!1,diffuse_shader:b.diffuse_shader,specular_shader:b.specular_shader}),a.shaders_info.node_elements=Z.compose_node_elements(n),l=p("use_map_color_diffuse",!0,l)[0]){y(a,"TEXTURE_COLOR",1);switch(l.blend_type){case "MIX":y(a,
"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":y(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.diffuse_color_factor=l.diffuse_color_factor;a.alpha_factor=l.use_map_alpha?l.alpha_factor:0;l=f(l);I(a,l)}ta.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.diffuse_color);a.ambient=b.ambient;a.diffuse_intensity=b.diffuse_intensity;a.emit=b.emit;a.specular_color.set(b.specular_color);a.specular_alpha=b.specular_alpha;E(a,"a_position");E(a,"a_normal");
l=b.game_settings.alpha_blend;y(a,"ALPHA","OPAQUE"===l?0:1);y(a,"ALPHA_CLIP","CLIP"===l?1:0);y(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);D(a,b);A(a,b);k(a,b);l=b.game_settings.alpha_blend;a.xray=b.b4w_render_above_all&&"OPAQUE"!=l&&"CLIP"!=l;a.offset_z=b.offset_z;a=!0}break;default:throw"Wrong batch type: "+a.type;}return a}function u(a,b,c){switch(b.texture_coords){case "UV":case "ORCO":y(a,c,"TEXTURE_COORDS_UV_ORCO");y(a,"TEXCOORD",1);break;case "NORMAL":y(a,c,"TEXTURE_COORDS_NORMAL");y(a,"NORMAL_TEXCOORD",
1);break;default:y(a,c,0)}}function k(a,b){var c=b.game_settings,d=c.alpha_blend;switch(d){case "ALPHA_SORT":a.blend=!0;a.zsort_type=W.ZSORT_BACK_TO_FRONT;a.depth_mask=!0;a.alpha_clip=!1;break;case "ALPHA":a.blend=!0;a.zsort_type=W.ZSORT_DISABLED;a.depth_mask=!0;a.alpha_clip=!1;break;case "CLIP":a.blend=!1;a.zsort_type=W.ZSORT_DISABLED;a.depth_mask=!0;a.alpha_clip=!0;break;case "ADD":a.blend=!0;a.zsort_type=W.ZSORT_DISABLED;a.depth_mask=!1;a.alpha_clip=!1;break;case "OPAQUE":a.blend=!1;a.zsort_type=
W.ZSORT_DISABLED;a.depth_mask=!0;a.alpha_clip=!1;break;default:throw Error("Unknown alpha blend mode: "+d);}a.use_backface_culling=c.use_backface_culling}function f(a,b){var c=a.texture,d=c._render,c=c.image;d&&b&&c&&ua.update_texture(d,b,c._is_dds,c.filepath);return d}function p(a,b,c){for(var d=[],e=c.length,f=0;f<e;f++){var h=c[f];h[a]==b&&h.texture&&h.texture._render&&d.push(h)}return d}function K(a,b){var c=b.raytrace_transparency;a.fresnel_params[0]=c.fresnel;a.fresnel_params[1]=1-c.fresnel_factor/
5;c=b.raytrace_mirror;a.reflect_factor=c.reflect_factor;a.fresnel_params[2]=c.fresnel;a.fresnel_params[3]=1-c.fresnel_factor/5}function D(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":c=b.specular_hardness;break;case "WARDISO":c=b.specular_slope;break;case "TOON":c=b.specular_toon_size;d=b.specular_toon_smooth;break;case "BLINN":c=b.specular_ior;d=b.specular_hardness;break;default:fa.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.specular_params[0]=
b.specular_intensity;a.specular_params[1]=c;a.specular_params[2]=d}function A(a,b){switch(b.diffuse_shader){case "LAMBERT":a.diffuse_params[0]=0;a.diffuse_params[1]=0;break;case "OREN_NAYAR":a.diffuse_params[0]=b.roughness;a.diffuse_params[1]=0;break;case "FRESNEL":a.diffuse_params[0]=b.diffuse_fresnel;a.diffuse_params[1]=b.diffuse_fresnel_factor;break;case "MINNAERT":a.diffuse_params[0]=b.darkness;a.diffuse_params[1]=0;break;case "TOON":a.diffuse_params[0]=b.diffuse_toon_size;a.diffuse_params[1]=
b.diffuse_toon_smooth;break;default:fa.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.name+'")'),a.diffuse_params[0]=0,a.diffuse_params[1]=0}}function h(a,b,c){if(!b.use_nodes||b.b4w_do_not_render)return!1;var d;switch(c){case "MAIN":C(a,"main.glslv","main.glslf");d=!1;break;case "GLOW":C(a,"main.glslv","main.glslf");d=!0;break;case "DEPTH":C(a,"depth.glslv","depth.glslf");d=!1;break;case "COLOR_ID":C(a,"color_id.glslv","color_id.glslf"),d=!1}c=Z.compose_nmat_graph(b.node_tree,
b.uuid,!1,b.name,c);if(!c)return fa.error('Failed to create node graph for material "'+b.name+'", disable nodes'),x(a,b),!0;a.has_nodes=!0;y(a,"NODES",1);y(a,"NODES_GLOW",d?1:0);var e=b.game_settings.alpha_blend;y(a,"ALPHA","OPAQUE"===e?0:1);y(a,"ALPHA_CLIP","CLIP"===e?1:0);y(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);E(a,"a_position");b.use_orco_tex_coord&&E(a,"a_orco_tex_coord");k(a,b);a.offset_z=b.offset_z;e=b.game_settings.alpha_blend;a.xray=b.b4w_render_above_all&&"OPAQUE"!=e&&
"CLIP"!=e;ta.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.diffuse_color);a.emit=b.emit;a.ambient=b.ambient;K(a,b);b.b4w_wettable?y(a,"WETTABLE",1):y(a,"WETTABLE",0);a.shaders_info.node_elements=Z.compose_node_elements(c);var f=!1;T.traverse(c,function(b,c){switch(c.type){case "UVMAP":case "TEX_COORD_UV":case "GEOMETRY_UV":case "UV_MERGED":var d=c.data.name,h=c.data.value;a.uv_maps_usage||(a.uv_maps_usage={});a.uv_maps_usage[h]=d;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":d=
c.data.name;a.vertex_colors_usage[d]={generate_buffer:!0,src:[{name:c.data.value}]};h=0;if("GEOMETRY_VC"==c.type)h=7;else for(var k=0;k<c.outputs.length;k++){var g="RGB".indexOf(c.outputs[k].identifier);-1<g&&(h|=1<<2-g)}a.vertex_colors_usage[d].src[0].mask=h;break;case "TEX_COORD_NO":case "GEOMETRY_NO":E(a,"a_normal");break;case "MATERIAL_BEGIN":E(a,"a_normal");f=!0;break;case "TEXTURE_COLOR":case "TEXTURE_ENVIRONMENT":d=c.data.name;h=c.data.value;!1!==h._render.allow_node_dds&&(h._render.allow_node_dds=
"TEXTURE_ENVIRONMENT"!=c.type?!0:!1);I(a,h._render,d);ea.alpha_clip_filtering_hack&&"CLIP"==e&&ua.set_filters(c.data.value._render,ua.TF_NEAREST,ua.TF_NEAREST);break;case "TEXTURE_NORMAL":case "B4W_PARALLAX":y(a,"CALC_TBN_SPACE",1);E(a,"a_normal");E(a,"a_tangent");d=c.data.name;h=c.data.value;h._render.allow_node_dds=!1;I(a,h._render,d);break;case "LAMP":c.data&&(a.lamp_uuid_indexes=c.data);break;case "B4W_REFRACTION":a.refractive=!0}});f||(a.use_shadeless=!0);return!0}function x(a,b){switch(a.type){case "DEPTH":C(a,
"depth.glslv","depth.glslf");break;case "COLOR_ID":C(a,"color_id.glslv","color_id.glslf");break;default:C(a,"main_stack.glslv","main_stack.glslf")}y(a,"SHADELESS",1);E(a,"a_position");E(a,"a_normal");ta.set(1,0,1,1,a.diffuse_color);if(b){var c=b.game_settings.alpha_blend;y(a,"ALPHA","OPAQUE"===c?0:1);y(a,"ALPHA_CLIP","CLIP"===c?1:0);y(a,"VERTEX_COLOR",0);a.offset_z=b.offset_z;k(a,b)}return!0}function w(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.is_hair_particles?y(a,"AU_QUALIFIER","attribute"):
y(a,"AU_QUALIFIER","uniform"),y(a,"STATIC_BATCH",0)):(y(a,"AU_QUALIFIER","attribute"),y(a,"STATIC_BATCH",1));"WIREFRAME"==a.type&&(aa.get_standard_derivatives()?y(a,"WIREFRAME_QUALITY",1):y(a,"WIREFRAME_QUALITY",0),a.debug_sphere?(y(a,"DEBUG_SPHERE",1),a.debug_sphere_dynamic?y(a,"DEBUG_SPHERE_DYNAMIC",1):y(a,"DEBUG_SPHERE_DYNAMIC",0)):y(a,"DEBUG_SPHERE",0),y(a,"ALPHA",1));b.use_shape_keys&&(a.use_shape_keys=b.use_shape_keys);b.wind_bending?(""!==b.main_bend_col?(a.vertex_colors_usage.a_bending_col_main=
{generate_buffer:!0,src:[{name:b.main_bend_col,mask:4}]},E(a,"a_bending_col_main"),""!==b.detail_bend_col.leaves_stiffness&&""!==b.detail_bend_col.leaves_phase&&""!==b.detail_bend_col.overall_stiffness?(a.vertex_colors_usage.a_bending_col_detail={generate_buffer:!0,src:[{name:b.detail_bend_col.leaves_stiffness,mask:4},{name:b.detail_bend_col.leaves_phase,mask:2},{name:b.detail_bend_col.overall_stiffness,mask:1}]},E(a,"a_bending_col_detail"),E(a,"a_normal"),y(a,"DETAIL_BEND",1)):y(a,"DETAIL_BEND",
0),y(a,"MAIN_BEND_COL",1)):y(a,"MAIN_BEND_COL",0),y(a,"WIND_BEND",1)):y(a,"WIND_BEND",0);b.bend_center_only?y(a,"BEND_CENTER_ONLY",1):y(a,"BEND_CENTER_ONLY",0);y(a,"BILLBOARD_PRES_GLOB_ORIENTATION",b.billboard_pres_glob_orientation|0);b.billboard?y(a,"BILLBOARD",1):y(a,"BILLBOARD",0);b.billboard&&b.is_hair_particles?y(a,"HAIR_BILLBOARD",1):y(a,"HAIR_BILLBOARD",0);b.billboard_spherical?y(a,"BILLBOARD_SPHERICAL",1):y(a,"BILLBOARD_SPHERICAL",0);switch(b.billboard_type){case "RANDOM":y(a,"BILLBOARD_RANDOM",
1);y(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":y(a,"BILLBOARD_RANDOM",0);y(a,"BILLBOARD_JITTERED",1);break;default:y(a,"BILLBOARD_RANDOM",0),y(a,"BILLBOARD_JITTERED",0)}b.dynamic_grass&&ea.allow_vertex_textures?y(a,"DYNAMIC_GRASS",1):y(a,"DYNAMIC_GRASS",0);a.dynamic_grass=b.dynamic_grass;a.dynamic_geometry=b.dynamic_geometry;a.shadow_cast=b.shadow_cast;a.shadow_cast_only=b.shadow_cast_only;a.shadow_receive=b.shadow_receive&&!a.use_shadeless&&!(a.blend&&ea.disable_blend_shadows_hack);a.reflexible=
b.reflexible;a.reflexible_only=b.reflexible_only;a.reflective=b.reflective;b.is_skinning?(E(a,"a_influence"),y(a,"SKINNED",1),ea.amd_skinning_hack?(y(a,"DISABLE_TANGENT_SKINNING",1),y(a,"FRAMES_BLENDING",0)):(y(a,"DISABLE_TANGENT_SKINNING",0),b.frames_blending?y(a,"FRAMES_BLENDING",1):y(a,"FRAMES_BLENDING",0)),y(a,"MAX_BONES",b.max_bones)):(y(a,"SKINNED",0),y(a,"FRAMES_BLENDING",0),y(a,"DISABLE_TANGENT_SKINNING",0));b.vertex_anim?(y(a,"VERTEX_ANIM",1),ea.vert_anim_mix_normals_hack?y(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",
.5):y(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):y(a,"VERTEX_ANIM",0);if(b.is_skinning&&b.vertex_anim)throw"Skinning and vertex animation are mutually exlusive";b.disable_fogging?y(a,"DISABLE_FOG",1):y(a,"DISABLE_FOG",0);if(a.has_nodes){for(var c=a.shaders_info.node_elements,d=b.mats_value_inds,e=b.mats_rgb_inds,f=0;f<c.length;f++){var h=c[f];switch(h.id){case "VALUE":var k=h.param_values[0];if(k)for(var g=0;g<d.length;g+=2)if(d[g]==k){h.dirs.push(["VALUE_IND",d[g+1]]);break}break;case "RGB":if(k=
h.param_values[0])for(g=0;g<e.length;g+=2)if(e[g]==k){h.dirs.push(["RGB_IND",e[g+1]]);break}}}y(a,"NUM_VALUES",b.mats_values.length);y(a,"NUM_RGBS",b.mats_rgbs.length)}}}function r(a,b,c){if(b.length){for(var d=ba.get_first_lamp_with_shadows(b)||b[0],e=a.shaders_info,f=0,h=0;h<a.shaders_info.node_elements.length;h++){var k=a.shaders_info.node_elements[h];if("LIGHTING_LAMP"==k.id){var g=b[f++%b.length],l=g.light;"AREA"==l.type&&(g=b[f++%b.length],l=g.light);var n=ba.get_scene_data(g,c);if("SPOT"==
l.type||"POINT"==l.type)var p=Math.cos(l.spot_size/2);if("SPOT"==l.type)var r=l.spot_blend*(1-p);n=n.light_index;g=g==d?0:-1;k.dirs=[["LAMP_TYPE",l.type],["LAMP_IND",n],["LAMP_LIGHT_FACT_IND",Math.floor(n/2)],["LAMP_FAC_CHANNELS",0==n%2?"rg":"ba"],["LAMP_SPOT_SIZE",R.glsl_value(p||.01)],["LAMP_SPOT_BLEND",R.glsl_value(r||.01)],["LAMP_LIGHT_DIST",R.glsl_value(l.distance)],["LAMP_SHADOW_MAP_IND",g]]}}if(a.lamp_uuid_indexes){c=0;for(var q in a.lamp_uuid_indexes)c++;a.lamp_light_positions=new Float32Array(3*
c);a.lamp_light_directions=new Float32Array(3*c);a.lamp_light_color_intensities=new Float32Array(3*c);a.lamp_light_factors=new Float32Array(4*c);R.set_directive(e,"NUM_LAMP_LIGHTS",c);for(h=0;h<b.length;h++)m(a,b[h])}}}function m(a,b){if(b.uuid in a.lamp_uuid_indexes){var c=a.lamp_uuid_indexes[b.uuid],d=ia.get_trans_view(b.render.world_tsr);a.lamp_light_positions.set(d,3*c);a.lamp_light_directions.set(b.light.direction,3*c);a.lamp_light_color_intensities.set(b.light.color_intensity,3*c);var d=H,e=
b.light;d[0]=-1;d[1]=-1;d[2]=-1;d[3]=e.use_specular?1:0;switch(e.type){case "POINT":d[2]=e.distance;break;case "SPOT":d[2]=e.distance;var f=d[0]=Math.cos(e.spot_size/2);d[1]=e.spot_blend*(1-f)}a.lamp_light_factors.set(d,4*c)}}function E(a,b){var c=a.common_attributes;-1==c.indexOf(b)&&c.push(b)}function y(a,b,c){R.set_directive(a.shaders_info,b,c)}function M(a,b){if("PHYSICS"==a.type)0<b.shape_keys.length&&W.submesh_init_shape_keys(b,b.va_frames[0]),a.submesh=b;else{var c=a.zsort_type,d=a.draw_mode;
a.halo&&(b=W.extract_halo_submesh(b));a.water_generated_mesh&&(b=ga.generate_multigrid(a.water_num_cascads,a.water_subdivs,a.water_detailed_dist));c=W.submesh_to_bufs_data(b,c,d,a.vertex_colors_usage);a.bufs_data=c;a.dynamic_geometry||c.info_for_z_sort_updates||a.use_shape_keys||(c.ibo_array=null,c.vbo_array=null);c=b.va_frames.length;a.num_vertices=b.base_length*c;a:switch(a.draw_mode){case W.DM_DEFAULT:case W.DM_TRIANGLES:case W.DM_DYNAMIC_TRIANGLES:d=!0;break a;default:d=!1}d?W.is_indexed(b)?a.num_triangles=
b.indices.length/3*c:a.num_triangles=b.base_length/3*c:a.num_triangles=0}}function L(a,b,c,d,e,f,h,k,g,l,m,n){var p=a._object,r=[],q=k.b4w_dynamic_grass;if(!l&&q)return r;for(var u="INSTANCE"==k.b4w_wind_bend_inheritance,x="INSTANCE"==k.b4w_shadow_inheritance,t="INSTANCE"==k.b4w_reflection_inheritance,z=[],y=[],V=0;V<e.length;V++){var G=e[V]._object.render,S=na.clone_object_nr(b);S.billboard=k.b4w_hair_billboard;S.billboard_type=k.b4w_hair_billboard_type;S.billboard_spherical="SPHERICAL"==k.b4w_hair_billboard_geometry;
S.dynamic_grass=q;S.is_hair_particles=!0;S.mats_values=G.mats_values;S.mats_value_inds=G.mats_value_inds;S.mats_rgbs=G.mats_rgbs;S.mats_rgb_inds=G.mats_rgb_inds;u?(S.wind_bending=G.wind_bending,S.wind_bending_angle=G.wind_bending_angle,S.wind_bending_freq=G.wind_bending_freq,S.detail_bending_freq=G.detail_bending_freq,S.main_bend_col=G.main_bend_col,S.detail_bending_amp=G.detail_bending_amp,S.branch_bending_amp=G.branch_bending_amp,S.wind_bending_amp=G.wind_bending_amp,S.detail_bend_col=G.detail_bend_col,
S.bend_center_only=!1):(S.wind_bending=p.render.wind_bending,S.wind_bending_angle=p.render.wind_bending_angle,S.wind_bending_freq=p.render.wind_bending_freq,S.detail_bending_freq=p.render.detail_bending_freq,S.main_bend_col=p.render.main_bend_col,S.detail_bending_amp=p.render.detail_bending_amp,S.branch_bending_amp=p.render.branch_bending_amp,S.wind_bending_amp=p.render.wind_bending_amp,S.detail_bend_col=p.render.detail_bend_col,S.bend_center_only=!0);x?(S.shadow_cast=G.shadow_cast,S.shadow_cast_only=
G.shadow_cast_only,S.shadow_receive=G.shadow_receive):(S.shadow_cast=p.render.shadow_cast,S.shadow_cast_only=p.render.shadow_cast_only,S.shadow_receive=p.render.shadow_receive);t?(S.reflexible=G.reflexible,S.reflexible_only=G.reflexible_only,S.reflective=G.reflective,S.cube_reflection_id=G.cube_reflection_id,S.plane_reflection_id=G.plane_reflection_id,S.reflection_type=G.reflection_type):(S.reflexible=p.render.reflexible,S.reflexible_only=p.render.reflexible_only,S.reflective=p.render.reflective,
S.cube_reflection_id=p.render.cube_reflection_id,S.plane_reflection_id=p.render.plane_reflection_id,S.reflection_type=p.render.reflection_type);z.push(S);var R=h[V];R||(R=new Float32Array);n&&na.init_rand_r_seed(g.seed,m);var A=new Float32Array(3),D=new Float32Array([0,0,0,1]),K=[],F=J.check_particles_bin_format(ea.loaded_data_version)&&!k.b4w_initial_rand_rotation&&!k.b4w_hair_billboard,E=4;F&&(E=8);for(var C=0;C<R.length;C+=E){A[0]=R[C];A[1]=R[C+1];A[2]=R[C+2];var I=R[C+3]*ia.get_scale(G.world_tsr);
if(k.b4w_initial_rand_rotation){switch(k.b4w_rotation_type){case "XYZ":var Y=new Float32Array([na.rand_r(m),na.rand_r(m),na.rand_r(m)]);ja.normalize(Y,Y);break;case "Z":Y=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+k.b4w_rotation_type;}ka.setAxisAngle(Y,k.b4w_rand_rotation_strength*(2*Math.PI*na.rand_r(m)-Math.PI),D)}else if(F&&(D.set(R.subarray(C+4,C+8)),na.quat_bpy_b4w(D,D),!k.use_whole_group))if(k.use_rotation_dupli){var M=ia.get_quat_view(G.world_tsr);ka.multiply(D,
M,D)}else ka.multiply(D,Aa,D);var L=ia.set_sep(A,I,D,ia.create());K.push(L)}y.push(K)}for(var ua={},V=0;V<e.length;V++){var H=e[V],P=f[V],S=z[V],U={};S.wind_bending&&(U.au_wind_bending_amp=[S.wind_bending_amp],U.au_wind_bending_freq=[S.wind_bending_freq],U.au_detail_bending_freq=[S.detail_bending_freq],U.au_detail_bending_amp=[S.detail_bending_amp],U.au_branch_bending_amp=[S.branch_bending_amp],S.wind_bending_amp=0,S.wind_bending_freq=0,S.detail_bending_freq=0,S.detail_bending_amp=0,S.branch_bending_amp=
0);var Q=O(S),K=y[V];if(K.length)for(var pa=H.data,ga=pa.materials,T=Array(ga.length),C=0;C<ga.length;C++)if(!W.has_empty_submesh(pa,C))for(var aa=0;aa<P.length;aa++){var da=P[aa],Z=v(da),ta=ga[C];"COLOR_ID"==da&&(Z.can_fork_outline=!(H.b4w_do_not_render||ta.b4w_do_not_render));"MAIN"==da&&(T[C]=Z);if(N(Z,ta)){"DEPTH"==da&&T[C]&&(Z.use_shadeless=T[C].use_shadeless);Z.draw_mode=W.DM_DEFAULT;w(Z,S);Z.odd_id_prop=k.uuid;"JITTERED"==k.b4w_hair_billboard_type&&(Z.jitter_amp=k.b4w_hair_billboard_jitter_amp,
Z.jitter_freq=k.b4w_hair_billboard_jitter_freq);q&&(Z.grass_scale_threshold=k.b4w_dynamic_grass_scale_threshold);u||(delete Z.vertex_colors_usage.a_bending_col_main,delete Z.vertex_colors_usage.a_bending_col_detail);B(Z,Q);var qa=W.extract_submesh(pa,C,Z.common_attributes,b.bone_skinning_info,Z.vertex_colors_usage,Z.uv_maps_usage),ha=W.make_clone_submesh(qa,U,K),ba=ha,Ya=K;ba.va_common.au_center_pos=new Float32Array(3*ba.base_length);for(var wb=Ya.length,Ra=ba.base_length/wb,Ba=0;Ba<wb;Ba++)for(var Ma=
Ya[Ba],Fa=3*Ra*Ba,za=0;za<Ra;za++)ba.va_common.au_center_pos[Fa+3*za]=Ma[0],ba.va_common.au_center_pos[Fa+3*za+1]=Ma[1],ba.va_common.au_center_pos[Fa+3*za+2]=Ma[2];ha=ba;if(S.wind_bending&&S.bend_center_only){var Nb=ha,zc=p.render.world_tsr;Nb.va_common.a_emitter_center=new Float32Array(3*Nb.base_length);var Xa=ja.fromValues(0,0,0);ia.transform_vec3(Xa,zc,Xa);for(var jb=0;jb<Nb.base_length;jb++)Nb.va_common.a_emitter_center[3*jb]=Xa[0],Nb.va_common.a_emitter_center[3*jb+1]=Xa[1],Nb.va_common.a_emitter_center[3*
jb+2]=Xa[2];ha=Nb}var Ab=k.b4w_vcol_from_name,sc=k.b4w_vcol_to_name,eb=Z,tc=c,Ac=!u,Eb=pa,Xb=[];if(""!==Ab&&""!==sc){var Yb,Ic=sc,Bb=eb.vertex_colors_usage,Fb=[],Sa=void 0;for(Sa in Bb)for(var Ha=Bb[Sa].src,Za=0,ac=0;ac<Ha.length;ac++){var kc=Ha[ac].mask;Ic==Ha[ac].name&&Fb.push(Sa,kc,Za);Za+=na.rgb_mask_get_channels_count(kc)}Yb=Fb;if(0<Yb.length)for(var Jb=0;Jb<Yb.length;Jb+=3)Xb.push({emitter_attr:Ab,emitter_mask:7,particle_attr:Yb[Jb],particle_mask:Yb[Jb+1],dst_channel_offset:Yb[Jb+2]});else W.has_attr(eb.common_attributes,
"a_color")&&sc==Eb.active_vcol_name&&Xb.push({emitter_attr:Ab,emitter_mask:7,particle_attr:"a_color",particle_mask:7,dst_channel_offset:0})}Ac&&("a_bending_col_main"in tc&&Xb.push({emitter_attr:"a_bending_col_main",emitter_mask:4,particle_attr:"a_bending_col_main",particle_mask:4,dst_channel_offset:0}),"a_bending_col_detail"in tc&&Xb.push({emitter_attr:"a_bending_col_detail",emitter_mask:7,particle_attr:"a_bending_col_detail",particle_mask:7,dst_channel_offset:0}));for(var Cb=ha,rb=K,Bc=d,Ob=Xb,lc=
Z.vertex_colors_usage,Jc=!1,Db=0;Db<Ob.length;Db++){var kb=Ob[Db].emitter_attr,La=Bc.va_common[kb];if(La&&0<La.length){Jc=!0;break}}if(Jc){var Ua,hb=p.render.bb_local,Va=Bc.va_frames[0].a_position,Pb=rb,Ca=ua,Ta=new Float32Array(3),ob=new Float32Array(3),lb=new Uint32Array(Pb.length);if(!("verts_indices"in Ca)){Ca.cell_size=new Float32Array(3);Ca.base_point=new Float32Array(3);Ca.verts_indices=new Uint32Array(Va.length/3);Ca.octs_indices=new Uint32Array(Va.length/3);Ca.cell_size[0]=(hb.max_x-hb.min_x)/
20;Ca.cell_size[1]=(hb.max_y-hb.min_y)/20;Ca.cell_size[2]=(hb.max_z-hb.min_z)/20;Ca.base_point[0]=hb.min_x;Ca.base_point[1]=hb.min_y;Ca.base_point[2]=hb.min_z;for(var Ia=0;Ia<Va.length/3;Ia++){var Qb=Va[3*Ia+1],pc=Va[3*Ia+2],mb=na.trunc((Va[3*Ia]-Ca.base_point[0])/Ca.cell_size[0]),bc=na.trunc((Qb-Ca.base_point[1])/Ca.cell_size[1]),qc=na.trunc((pc-Ca.base_point[2])/Ca.cell_size[2]),mb=na.clamp(mb,0,19),bc=na.clamp(bc,0,19),qc=na.clamp(qc,0,19);Ca.verts_indices[Ia]=Ia;Ca.octs_indices[Ia]=qc*Math.pow(20,
2)+20*bc+mb}W.sort_two_arrays(Ca.octs_indices,Ca.verts_indices,W.SORT_NUMERIC,!0);Ca.verts_offsets=new Uint32Array(Math.pow(20,3));for(Ia=0;Ia<Ca.octs_indices.length;Ia++)Ca.verts_offsets[Ca.octs_indices[Ia]]++;delete Ca.octs_indices;for(Ia=1;Ia<Ca.verts_offsets.length;Ia++)Ca.verts_offsets[Ia]+=Ca.verts_offsets[Ia-1]}for(var nb=0;nb<Pb.length;nb++){Ta[0]=Pb[nb][0];Ta[1]=Pb[nb][1];Ta[2]=Pb[nb][2];for(var Zb=1E10,Wa=-1,ib=na.trunc((Ta[0]-Ca.base_point[0])/Ca.cell_size[0]),pb=na.trunc((Ta[1]-Ca.base_point[1])/
Ca.cell_size[1]),uc=na.trunc((Ta[2]-Ca.base_point[2])/Ca.cell_size[2]),ib=na.clamp(ib,0,19),pb=na.clamp(pb,0,19),uc=na.clamp(uc,0,19),Gb=uc*Math.pow(20,2)+20*pb+ib,cc=Ca.verts_offsets[Gb],Rb=0==Gb?0:Ca.verts_offsets[Gb-1];Rb<cc;Rb++){var Kb=Ca.verts_indices[Rb];ob[0]=Va[3*Kb];ob[1]=Va[3*Kb+1];ob[2]=Va[3*Kb+2];ja.sub(ob,Ta,ob);var xb=ja.sqrLen(ob);xb<=Zb&&(Zb=xb,Wa=Kb)}if(-1==Wa)for(Rb=0;Rb<Va.length/3;Rb++)ob[0]=Va[3*Rb],ob[1]=Va[3*Rb+1],ob[2]=Va[3*Rb+2],ja.sub(ob,Ta,ob),xb=ja.sqrLen(ob),xb<=Zb&&
(Zb=xb,Wa=Rb);lb[nb]=Wa}Ua=lb;for(var dc=Cb.base_length/rb.length,Db=0;Db<Ob.length;Db++){var Na=Ob[Db].particle_attr,Ja=Ob[Db].particle_mask,kb=Ob[Db].emitter_attr,ec=Ob[Db].emitter_mask,La=Bc.va_common[kb];switch(Na){case "a_bending_col_main":var Lb=1;break;case "a_bending_col_detail":Lb=3;break;case "a_color":Lb=3;break;default:for(var yb=Lb=0;yb<lc[Na].src.length;yb++)Lb+=na.rgb_mask_get_channels_count(lc[Na].src[yb].mask)}if(La&&0<La.length){var fc=na.rgb_mask_get_channels_count(ec),Kc=na.rgb_mask_get_channels_count(Ja),
Sb=ec&Ja,rc=na.rgb_mask_get_channels_presence(Sb);Sb!=Ja&&fa.error("Wrong color extraction from "+kb+" to "+Na+".");if("a_bending_col_main"==Na||"a_bending_col_detail"==Na)Cb.va_common[Na]=new Float32Array(Cb.base_length*Kc);for(yb=0;yb<rb.length;yb++){var mc=Ua[yb],Cc=mc*fc,Dc=yb*dc*Lb;if(-1!=mc)for(var Tb=0;Tb<dc;Tb++)for(var $a=Tb*Lb,Oa=0;Oa<rc.length;Oa++)if(rc[Oa]){var Lc=na.rgb_mask_get_channel_presence_index(ec,Oa),Ub=Ob[Db].dst_channel_offset+na.rgb_mask_get_channel_presence_index(Ja,Oa);
Cb.va_common[Na][Dc+$a+Ub]=La[Cc+Lc]}}}else Cb.va_common[Na]=new Float32Array(0)}}ha=Cb;r.push({batch:Z,submesh:ha,mat_names:[ta.name],render:S,rel_bpy_objects:[a]})}}}return r}function N(a,b){var c=!0;"NODES_GLOW"==a.type&&(c=Z.check_material_glow_output(b));return c=c&&g(a,b)}function B(a,b){for(var c=null,d=null,e=0;e<a.textures.length;e++){var f=a.textures[e].canvas_context;f&&(c||(c={}),c[e]=f,a.textures[e].canvas_context=null);if(f=a.textures[e].video_file)d||(d={}),d[e]=f,a.textures[e].video_file=
null}a.id=0;a.render_id=b;a.id=na.calc_variable_id(a,b);if(c)for(var h in c)a.textures[h].canvas_context=c[h];if(d)for(h in d)a.textures[h].video_file=d[h]}function O(a){var b=a.bone_pointers;a.bone_pointers=null;var c=na.calc_variable_id(a,0);a.bone_pointers=b;return c}function F(a,b,c,d,e){var f=v("WIREFRAME");C(f,"wireframe.glslv","wireframe.glslf");f.wireframe_mode=0;f.debug_sphere=!0;f.depth_mask=!0;f.odd_id_prop=c;e&&(f.debug_sphere_dynamic=!0);w(f,b);b=O(b);B(f,b);d?(d=ga.generate_uv_sphere(16,
8,1,a.center,!1,!1),W.scale_submesh_xyz(d,[a.axis_x[0],a.axis_y[1],a.axis_z[2]],a.center)):d=ga.generate_uv_sphere(16,8,a.radius,a.center,!1,!1);W.submesh_drop_indices(d,1,!0);d.va_common.a_polyindex=W.extract_polyindices(d);M(f,d);return f}function C(a,b,c){a.shaders_info.vert=b;a.shaders_info.frag=c;R.set_default_directives(a.shaders_info)}function I(a,b,c){1==a.textures.length&&0==a.texture_names.length&&a.texture_names.push("default0");c=c||"default"+String(a.textures.length);-1==a.texture_names.indexOf(c)&&
(a.textures.push(b),a.texture_names.push(c));a.shader&&V.assign_texture_uniforms(a)}function Q(a){if(!a.shaders_info)throw"No shaders info for batch "+a.name;a.shader=R.get_compiled_shader(a.shaders_info);V.assign_uniform_setters(a.shader);V.assign_attribute_setters(a);V.assign_texture_uniforms(a)}function G(a,b,c){a=a.scenes_data[0].batches;for(var d=0;d<a.length;d++)if(a[d].type==c&&!a[d].forked_batch&&-1!=a[d].material_names.indexOf(b))return a[d];return null}function z(a,b,c){a=a.scenes_data[0].batches;
for(var d=0;d<a.length;d++)if(a[d].type==c&&a[d].forked_batch&&-1!=a[d].material_names.indexOf(b))return a[d];return null}function Y(a,b){a.diffuse_color.set(b.diffuse_color);a.diffuse_intensity=b.diffuse_intensity;a.specular_color.set(b.specular_color);a.specular_color_factor=b.specular_color_factor;a.specular_params.set(b.specular_params);a.emit=b.emit;a.ambient=b.ambient;a.diffuse_color_factor=b.diffuse_color_factor;a.alpha_factor=b.alpha_factor;a.reflect_factor=b.reflect_factor;a.fresnel_params.set(b.fresnel_params);
a.parallax_scale=b.parallax_scale;a.shallow_water_col.set(b.shallow_water_col);a.shallow_water_col_fac=b.shallow_water_col_fac;a.shore_water_col.set(b.shore_water_col);a.shore_water_col_fac=b.shore_water_col_fac;a.foam_factor=b.foam_factor;a.water_norm_uv_velocity=b.water_norm_uv_velocity}var U=t("__boundings"),P=t("__camera"),da=t("__config"),fa=t("__print"),aa=t("__extensions"),W=t("__geometry"),T=t("__graph");t("__lights");var Z=t("__nodemat"),ba=t("__obj_util"),pa=t("__particles"),ga=t("__primitives"),
ka=t("__quat"),J=t("__reformer"),V=t("__renderer"),S=t("__scenegraph"),R=t("__shaders");t("__scenes");var ua=t("__textures"),ia=t("__tsr"),na=t("__util"),ja=t("__vec3"),ta=t("__vec4"),ea=da.defaults,qa=["MAIN"],Aa=new Float32Array([0,-Math.sqrt(.5),0,Math.sqrt(.5)]);new Float32Array(3);var H=new Float32Array(4);a.BATCH_INHERITED_TEXTURES=ha;var ha="u_colormap0 u_colormap1 u_stencil0 u_specmap0 u_normalmap0 u_mirrormap".split(" ");a.init_batch=v;a.generate_main_batches=function(a,b,f,h){for(var k=
[],g=[],l=0;l<b.length;l++){var m=b[l],n=m._object;n.is_hair_dupli||(ba.is_dynamic(n)?k.push(m):g.push(m))}for(var l=[],l=l.concat(e(k,a._render.graph)),n=l=l.concat(d(g,a._render.graph,a.b4w_batch_grid_size)),k=[],g=[],p={},l=0;l<n.length;l++){var q=n[l].batch,u=n[l].render,x=null;if(q.id in p){for(var w=p[q.id],t=g[w].batch,J=g[w].render,z=null,B=null,m=0;m<q.textures.length;m++){var v=q.textures[m].canvas_context;v&&(z||(z={}),z[m]=v,q.textures[m].canvas_context=null);if(v=q.textures[m].video_file)B||
(B={}),B[m]=v,q.textures[m].video_file=null}na.strict_objs_is_equal(q,t,!0)&&na.strict_objs_is_equal(u,J,!0)&&(x=g[w]);if(z)for(m in z)q.textures[m].canvas_context=z[m];if(B)for(m in B)q.textures[m].video_file=B[m];if(!x){do q.id++;while(p[q.id])}}x||(x={batch:q,render:n[l].render,rel_bpy_objects:[],submeshes:[],mat_names:[]},p[q.id]=g.length,g.push(x));x.rel_bpy_objects=x.rel_bpy_objects.concat(n[l].rel_bpy_objects);n[l].submesh&&n[l].submesh.base_length&&x.submeshes.push(n[l].submesh);if(x.mat_names.length)for(m=
0;m<n[l].mat_names.length;m++)q=n[l].mat_names[m],-1==x.mat_names.indexOf(q)&&x.mat_names.push(q);else x.mat_names=n[l].mat_names;W.sort_two_arrays(x.mat_names,x.submeshes,W.SORT_STRING,!1)}for(l=0;l<g.length;l++){n=g[l].submeshes;if(0==n.length)m=na.create_empty_submesh(na.unique_name("%empty"));else if(1==n.length)m=n[0];else{p=[];for(m=0;m<n.length;m++)W.is_long_submesh(n[m])||p.push(m);if(p.length<n.length)for(m=0;m<p.length;m++)W.submesh_drop_indices(n[p[m]]);m=W.submesh_list_join(n)}k.push({batch:g[l].batch,
render:g[l].render,submesh:m,mat_names:g[l].mat_names,rel_bpy_objects:g[l].rel_bpy_objects})}for(g=0;g<k.length;g++)if(n=k[g].batch,n.material_names=k[g].mat_names,M(n,k[g].submesh),r(n,f,a),"STATIC"==k[g].render.type&&"COLOR_ID"!=n.type)l=na.unique_name("%meta%"+n.type+"%"+n.material_names.join("%")+"%"),l=ba.create_object(l,"MESH"),l.render=k[g].render,ba.append_scene_data(l,a),ba.append_batch(l,a,n),h.push(l);else for(p=[],m=0;m<k[g].rel_bpy_objects.length;m++)l=k[g].rel_bpy_objects[m]._object,
-1==p.indexOf(l.name)&&(ba.append_batch(l,a,n),p.push(l.name));if(ea.wireframe_debug){for(g=0;g<k.length;g++)if(f=k[g].render,"DYNAMIC"==f.type&&(l=k[g].rel_bpy_objects[0]._object,-1<qa.indexOf(k[g].batch.type))){m=ba.get_scene_data(l,a);n=m.batches;p=!1;for(m=0;m<n.length;m++)n[m].debug_sphere&&(p=!0);p||(f=F(f.be_local,f,l.name,!0,!0),ba.append_batch(l,a,f))}for(g=0;g<h.length;g++)l=h[g],f=l.render,m=ba.get_scene_data(l,a),n=m.batches,-1<qa.indexOf(n[0].type)&&(f=F(f.bs_local,f,l.name,!1),ba.append_batch(l,
a,f))}for(g=0;g<b.length;g++)for(m=ba.get_scene_data(b[g]._object,a),n=m.batches,m=0;m<n.length;m++)c(n[m]);for(g=0;g<h.length;g++)for(m=ba.get_scene_data(h[g],a),n=m.batches,m=0;m<n.length;m++)c(n[m])};a.generate_sky_meta_obj=function(a,b){var d=a._render.world_light_set,e=v("MAIN");C(e,"special_skydome.glslv","special_skydome.glslf");if(b.procedural_skydome)y(e,"PROCEDURAL_SKYDOME",1),e.procedural_sky=!0;else{var h=d.sky_texture_param;if(h){y(e,"WO_SKYTEX",1);var k=f(d.sky_texture_slot,null);I(e,
k,"u_sky");h.invert&&y(e,"MTEX_NEGATIVE",1);h.use_rgb_to_intensity&&y(e,"MTEX_RGBTOINT",1);y(e,"BLENDTYPE",h.blend_type);h.use_map_blend&&y(e,"WOMAP_BLEND",1);h.use_map_horizon&&y(e,"WOMAP_HORIZ",1);h.use_map_zenith_up&&y(e,"WOMAP_ZENUP",1);h.use_map_zenith_down&&y(e,"WOMAP_ZENDOWN",1)}d.use_sky_blend&&y(e,"WO_SKYBLEND",1);d.use_sky_paper&&y(e,"WO_SKYPAPER",1);d.use_sky_real&&y(e,"WO_SKYREAL",1)}b.reflexible&&(e.reflexible=!0,b.reflexible_only&&(e.reflexible_only=!0));e.offset_z=99999;E(e,"a_position");
d=ga.generate_fullscreen_quad();M(e,d);c(e);d=na.unique_name("%meta_sky%");d=ba.create_object(d,"MESH");ba.append_scene_data(d,a);h=ba.get_scene_data(d,a);d.render=ba.create_render("STATIC");d.render.do_not_cull=!0;d.render.bb_local=U.zero_bounding_box();d.render.bs_local=U.zero_bounding_sphere();d.render.bb_world=U.zero_bounding_box();d.render.bs_world=U.zero_bounding_sphere();h.batches.push(e);return d};a.create_forked_batches=function(a,c,d){d=ba.get_scene_data(a,d).batches;var e=[],f=S.find_subs(c,
"SHADOW_CAST"),h=S.find_subs(c,"MAIN_PLANE_REFLECT"),k=S.find_subs(c,"MAIN_CUBE_REFLECT"),g=S.find_subs(c,"OUTLINE_MASK");c=S.find_subs(c,"COLOR_PICKING");for(var l=0;l<d.length;l++){var m=d[l],n=null;"DEPTH"==m.type&&f&&m.shadow_cast&&(n=b(m),n.subtype="SHADOW_CAST");"MAIN"!=m.type&&"PARTICLES"!=m.type||!h&&!k||m.blend||!m.reflexible||(n=b(m),n.subtype="REFLECT");"COLOR_ID"==m.type&&m.can_fork_outline&&g&&a.render.outlining&&(c&&a.render.selectable?(n=b(m),n.subtype="OUTLINE"):m.subtype="OUTLINE");
n&&(n.forked_batch=!0,B(n,a.render.id),e.push(n))}d.push.apply(d,e)};a.set_local_cylinder_capsule=n;a.wb_angle_to_amp=function(a,b,c){if(b)b=c*(b.max_y-b.min_y);else throw"No bounding box for mesh";if(0==b)return 0;a=b*Math.tan(a/180*Math.PI);return.5*(Math.sqrt(2*Math.sqrt(4*a+1)+2)/2-1)/b};a.bb_bpy_to_b4w=function(a){return{max_x:a.max_x,min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}};a.get_batch_texture=f;a.update_batch_material_debug=x;a.update_batch_lights=r;a.set_lamp_data=
m;a.assign_shadow_receive_dirs=function(a,b,c){c&&c.camera.type==P.TYPE_PERSP&&y(a,"PERSPECTIVE_SHADOW_CAST",1);y(a,"CSM_SECTION0",0);y(a,"CSM_SECTION1",0);y(a,"CSM_SECTION2",0);y(a,"CSM_SECTION3",0);if(b){for(c=0;c<b.csm_num;c++)y(a,"CSM_SECTION"+String(c),1);y(a,"SHADOW_TEX_RES",R.glsl_value(b.csm_resolution));y(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);y(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)}else y(a,"SHADOW_TEX_RES",0),y(a,"CSM_FADE_LAST_CASCADE",0),y(a,"CSM_BLEND_BETWEEN_CASCADES",
0)};a.set_batch_directive=y;a.get_batch_directive=function(a,b){return R.get_directive(a.shaders_info,b)};a.update_batch_geometry=M;a.update_batch_id=B;a.calculate_render_id=O;a.create_bounding_ellipsoid_batch=F;a.append_texture=I;a.replace_texture=function(a,b,c){c=a.texture_names.indexOf(c);-1<c&&(a.textures[c]=b)};a.create_shadeless_batch=function(a,b,c){var d=v("MAIN");1>c&&(d.blend=!0);ta.set(b[0],b[1],b[2],c,d.diffuse_color);d.draw_mode=W.DM_TRIANGLES;M(d,a);C(d,"main_stack.glslv","main_stack.glslf");
y(d,"SHADELESS",1);Q(d);return d};a.update_shader=Q;a.check_batch_perm_uniform=function(a,b){return a.shader.permanent_uniform_setters.length?a.shader.permanent_uniform_setters_table[b]?!0:!1:!1};a.create_depth_pack_batch=function(a){a=v("DEPTH_PACK");a.use_backface_culling=!0;a.depth_mask=!1;var b=ga.generate_fullscreen_tri();M(a,b);C(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");Q(a);return a};a.create_postprocessing_batch=function(a){var b=v("POSTPROCESSING");C(b,"postprocessing/postprocessing.glslv",
"postprocessing/postprocessing.glslf");switch(a){case "NONE":y(b,"POST_EFFECT","POST_EFFECT_NONE");break;case "GRAYSCALE":y(b,"POST_EFFECT","POST_EFFECT_GRAYSCALE");break;case "X_BLUR":y(b,"POST_EFFECT","POST_EFFECT_X_BLUR");break;case "Y_BLUR":y(b,"POST_EFFECT","POST_EFFECT_Y_BLUR");break;case "X_GLOW_BLUR":y(b,"POST_EFFECT","POST_EFFECT_X_GLOW_BLUR");break;case "Y_GLOW_BLUR":y(b,"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR");break;case "X_EXTEND":y(b,"POST_EFFECT","POST_EFFECT_X_EXTEND");break;case "Y_EXTEND":y(b,
"POST_EFFECT","POST_EFFECT_Y_EXTEND");break;case "FLIP_CUBEMAP_COORDS":y(b,"POST_EFFECT","FLIP_CUBEMAP_COORDS");break;default:throw"Wrong postprocessing effect: "+a;}b.use_backface_culling=!0;b.depth_mask=!1;a=ga.generate_fullscreen_tri();M(b,a);Q(b);return b};a.create_ssao_batch=function(a){var b=v("SSAO");b.depth_mask=!1;b.use_backface_culling=!0;var c=ga.generate_fullscreen_tri();M(b,c);C(b,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");y(b,"SSAO_QUALITY","SSAO_QUALITY_"+a.ssao_samples);
y(b,"SSAO_HEMISPHERE",a.ssao_hemisphere?1:0);a={texture:ua.generate_texture("SSAO_TEXTURE",a)};c={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,203,0,117,73,12,0])};a=f(a,c);I(b,a,"u_ssao_special_tex");Q(b);return b};a.create_ssao_blur_batch=function(a){var b=v("SSAO_BLUR");b.depth_mask=!1;b.use_backface_culling=!0;var c=ga.generate_fullscreen_tri();
M(b,c);C(b,"postprocessing/postprocessing.glslv","postprocessing/ssao_blur.glslf");y(b,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);Q(b);return b};a.create_dof_batch=function(a){a=v("DOF");a.depth_mask=!1;a.use_backface_culling=!0;var b=ga.generate_fullscreen_tri();M(a,b);C(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");y(a,"DEPTH_RGBA",1);Q(a);return a};a.create_outline_batch=function(){var a=v("OUTLINE");a.depth_mask=!1;a.use_backface_culling=!0;var b=ga.generate_fullscreen_tri();
M(a,b);C(a,"postprocessing/postprocessing.glslv","postprocessing/outline.glslf");Q(a);return a};a.create_glow_combine_batch=function(){var a=v("GLOW_COMBINE");a.depth_mask=!1;a.use_backface_culling=!0;var b=ga.generate_fullscreen_tri();M(a,b);C(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");Q(a);return a};a.create_god_rays_batch=function(a,b,c,d){a=v("GOD_RAYS");a.depth_mask=!1;a.use_backface_culling=!0;var e=ga.generate_billboard();M(a,e);C(a,"postprocessing/god_rays.glslv",
"postprocessing/god_rays.glslf");y(a,"DEPTH_RGBA",b?1:0);y(a,"WATER_EFFECTS",c?1:0);y(a,"STEPS_PER_PASS",R.glsl_value(d,1));Q(a);return a};a.create_god_rays_combine_batch=function(a,b){var c=v("GOD_RAYS_COM");c.depth_mask=!1;c.use_backface_culling=!0;var d=ga.generate_fullscreen_tri();M(c,d);C(c,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");y(c,"SAFARI_CANVAS_ALPHA_HACK",ea.safari_canvas_alpha_hack?1:0);Q(c);return c};a.create_procedural_sky_batch=function(){var a=
v("SKY");a.depth_mask=!1;a.use_backface_culling=!0;var b=ga.generate_cube();M(a,b);C(a,"procedural_skydome.glslv","procedural_skydome.glslf");y(a,"WATER_EFFECTS",1);Q(a);return a};a.create_antialiasing_batch=function(a){var b=v("ANTIALIASING");b.depth_mask=!1;b.use_backface_culling=!0;var c=ga.generate_fullscreen_tri();M(b,c);C(b,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");ea.quality_aa_method?(y(b,"AA_METHOD","AA_METHOD_FXAA_QUALITY"),y(b,"AA_QUALITY",a.fxaa_quality)):
y(b,"AA_METHOD","AA_METHOD_FXAA_LIGHT");Q(b);return b};a.create_smaa_batch=function(a){var b=v("SMAA"),c=ga.generate_fullscreen_tri();M(b,c);C(b,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");y(b,"AA_METHOD","AA_METHOD_SMAA_HIGH");y(b,"SMAA_PASS",a);y(b,"SMAA_PREDICATION",0);y(b,"SMAA_REPROJECTION",0);Q(b);b.depth_mask=!1;b.use_backface_culling=!0;return b};a.create_compositing_batch=function(){var a=v("COMPOSITING");a.depth_mask=!1;a.use_backface_culling=!0;var b=ga.generate_fullscreen_tri();
M(a,b);C(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");Q(a);return a};a.create_motion_blur_batch=function(a){a=v("MOTION_BLUR");a.use_backface_culling=!0;a.depth_mask=!1;var b=ga.generate_fullscreen_tri();M(a,b);C(a,"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf");Q(a);return a};a.create_anaglyph_batch=function(a){a=v("ANAGLYPH");a.use_backface_culling=!0;a.depth_mask=!1;var b=ga.generate_fullscreen_tri();M(a,b);C(a,"postprocessing/postprocessing.glslv",
"postprocessing/anaglyph.glslf");Q(a);return a};a.create_luminance_batch=function(){var a=v("LUMINANCE");a.depth_mask=!1;a.use_backface_culling=!0;var b=ga.generate_fullscreen_tri();M(a,b);C(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");Q(a);return a};a.create_average_luminance_batch=function(){var a=v("LUMINANCE");a.depth_mask=!1;a.use_backface_culling=!0;var b=ga.generate_fullscreen_tri();M(a,b);C(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");
Q(a);return a};a.create_luminance_trunced_batch=function(){var a=v("LUMINANCE_X_BLUR");a.depth_mask=!1;a.use_backface_culling=!0;var b=ga.generate_fullscreen_tri();M(a,b);C(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");Q(a);return a};a.create_bloom_blur_batch=function(){var a=v("POSTPROCESSING");a.use_backface_culling=!0;a.depth_mask=!1;var b=ga.generate_fullscreen_tri();M(a,b);C(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");Q(a);
return a};a.create_bloom_combine_batch=function(){var a=v("BLOOM");a.depth_mask=!1;a.use_backface_culling=!0;var b=ga.generate_fullscreen_tri();M(a,b);C(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");Q(a);return a};a.create_velocity_batch=function(){var a=v("VELOCITY");a.depth_mask=!1;a.use_backface_culling=!0;var b=ga.generate_fullscreen_tri();M(a,b);C(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");Q(a);return a};a.create_anchor_visibility_batch=
function(){var a=v("ANCHOR_VISIBILITY");a.depth_mask=!0;a.use_backface_culling=!0;a.draw_mode=W.DM_POINTS;C(a,"anchors.glslv","anchors.glslf");var b=ga.generate_index(1);M(a,b);y(a,"ANCHOR_NUM",1);Q(a);a.positions=new Float32Array([0,0,0]);return a};a.update_anchor_visibility_batch=function(a,b){var c=b.length/3;if(c!=a.positions.length/3){var d=ga.generate_index(c);M(a,d);y(a,"ANCHOR_NUM",c);Q(a)}a.positions=b};a.find_batch_material=G;a.find_batch_material_forked=z;a.set_material_props=Y;a.check_batch_type=
function(a,b){for(var c=a.scenes_data[0].batches,d=0;d<c.length;d++)if(c[d].type==b)return!0;return!1};a.clear_batch=function(a){for(var b=a.textures,c=0;c<b.length;c++)ua.delete_texture(b[c].w_texture);W.cleanup_bufs_data(a.bufs_data)};a.inherit_material=function(a,b,c,d){for(var e=["MAIN","DEPTH","COLOR_ID"],f=!1,h=0;h<e.length;h++){var k=e[h],g=G(a,b,k),l=G(c,d,k);if(g&&l){var f=!0,m=z(c,d,k);"MAIN"==k&&(Y(l,g),m&&Y(m,g));for(k=0;k<l.texture_names.length;k++){var n=l.texture_names[k];if(-1!==ha.indexOf(n)){var p=
g.texture_names.indexOf(n);-1!==p&&(l.textures[k]=g.textures[p],m&&(n=m.texture_names.indexOf(n),-1!==n&&(m.textures[n]=g.textures[p])))}}}}f||fa.error("Wrong objects for inheriting material!")}};b4w.module.__nodemat=function(a,t){function v(a,b,e,h,g){var m=ea.get_active(),m=d(b,g,m.uuid);if(m in ha)return ha[m];if("DEPTH"!=g&&"COLOR_ID"!=g){b=R.create();for(var r=a.nodes,x=0;x<r.length;x++)if(null==L(b,r[x],0,h,g))return ha[m]=null;if(e&&-1==y(a,b,"GROUP_OUTPUT","group"))return null;x=Z(b);r=e?a.links:a.links.slice();if(!ba(b,r,x))return null;if(e)return b;for(x=0;x<r.length;x++){e=r[x];for(var w=f(e.from_node,b),t=f(e.to_node,b),J=0;J<w.length;J++)for(var z=0;z<t.length;z++){var B=w[J],
V=t[z],S=R.get_node_attr(b,B),G=R.get_node_attr(b,V);if(!W(b,B,V,S,G,e))return ha[m]=null}}k(b);a="GLOW"==g?y(a,b,"B4W_GLOW_OUTPUT","material",!0):y(a,b,"OUTPUT","material",!1,!0);-1==a&&(b=n(),a=0);p(b);a=R.subgraph_node_conn(b,a,R.BACKWARD_DIR);c(a,h,g);q(a);D(a);E(a);u(a,h,g)}else h=v(a,b,e,h,"MAIN"),h=R.clone(h,function(a){var b=qa.clone_object_nr(a);b.inputs=qa.clone_object_r(a.inputs);b.outputs=qa.clone_object_r(a.outputs);return b}),a=y(a,h,"OUTPUT","material",!1,!0),l(h,a),a=R.subgraph_node_conn(h,
a,R.BACKWARD_DIR),q(a);return ha[m]=a}function c(a,c,d){var e=[];R.traverse(a,function(a,b){"MATERIAL"!=b.type&&"MATERIAL_EXT"!=b.type||e.push({node_id:a,node:b})});for(d=0;d<e.length;++d){var f=e[d].node_id,h=e[d].node,k=R.gen_node_id(a);R.append_node(a,k,h.data.material_begin);var g=R.gen_node_id(a);R.append_node(a,g,h.data.material_end);R.append_edge(a,k,g,[4,2]);for(var l={5:["LIGHTING_APPLY",10],6:["LIGHTING_APPLY",6],7:["MATERIAL_END",3],8:["MATERIAL_END",4],9:["MATERIAL_END",5]},m=R.in_edge_count(a,
f),n=[],p=[],r=[],q={},u=0;u<m;u++){var x=R.get_in_edge(a,f,u);x in q||(q[x]=0);var w=R.get_edge_attr(a,x,f,q[x]++);n.push([x,f,w]);var t=l[w[1]];if(t)switch(t[0]){case "MATERIAL_END":p.push([x,g,[w[0],t[1]]]);break;case "LIGHTING_APPLY":r.push([x,[w[0],t[1]]])}else p.push([x,k,w])}b(a,h.data.value,k,g,r,c);for(u=0;u<n.length;u++)R.remove_edge_by_attr(a,n[u][0],n[u][1],n[u][2]);for(u=0;u<p.length;u++)R.append_edge(a,p[u][0],p[u][1],p[u][2]);h=R.out_edge_count(a,f);k=[];l=[];m={};for(u=0;u<h;u++)n=
R.get_out_edge(a,f,u),n in m||(m[n]=0),w=R.get_edge_attr(a,f,n,m[n]++),k.push([f,n,w]),l.push([g,n,w]);for(u=0;u<k.length;u++)R.remove_edge_by_attr(a,k[u][0],k[u][1],k[u][2]);for(u=0;u<l.length;u++)R.append_edge(a,l[u][0],l[u][1],l[u][2]);R.remove_node(a,f)}}function b(a,b,c,d,f,h){var k={name:"LIGHTING_AMBIENT",type:"LIGHTING_AMBIENT"},g=L(a,k,0,h,null),l=g;e(a,c,g,"E");e(a,c,g,"A");e(a,c,g,"D");g=ea.get_active();g=na.get_scene_objs(g,"LAMP",na.DATA_ID_ALL);if(!b.use_shadeless)for(var m,n,p=0;p<
g.length;p++){var r=g[p].light,k={name:"LIGHTING_LAMP",type:"LIGHTING_LAMP"};m=L(a,k,0,h,null);k={name:"LIGHTING_APPLY",type:"LIGHTING_APPLY"};n=L(a,k,0,h,null);e(a,l,n,"color");e(a,l,n,"specular");e(a,m,n,"ldir");e(a,c,n,"normal");e(a,c,n,"D");e(a,c,n,"S");e(a,m,n,"lcolorint");e(a,c,m,"shadow_factor");l="COOKTORR"==b.specular_shader?"SPECULAR_PHONG":"SPECULAR_"+b.specular_shader;k={name:l,type:l};k=L(a,k,0,h,null);e(a,m,k,"ldir");e(a,m,k,"lfac");e(a,c,k,"normal");e(a,k,n,"sfactor");"SPECULAR_PHONG"!=
l&&"SPECULAR_BLINN"!=l||e(a,m,k,"norm_fac");e(a,c,k,"sp_params");l="HEMI"==r.type?"DIFFUSE_LAMBERT":"DIFFUSE_"+b.diffuse_shader;k={name:l,type:l};k=L(a,k,0,h,null);e(a,m,k,"ldir");e(a,m,k,"lfac");e(a,c,k,"normal");e(a,m,k,"norm_fac");e(a,k,n,"lfactor");"DIFFUSE_LAMBERT"!=l&&e(a,c,k,"dif_params");for(m=0;m<f.length;m++)R.append_edge(a,f[m][0],n,f[m][1]);l=n}e(a,l,d,"color");e(a,l,d,"specular")}function e(a,b,c,d){for(var e=R.get_node_attr(a,b),f=R.get_node_attr(a,c),h,k=0;k<f.inputs.length;k++)if(d==
f.inputs[k].identifier){h=k;break}for(var g,k=0;k<e.outputs.length;k++)if(d==e.outputs[k].identifier){g=k;break}void 0!=h&&void 0!=g&&R.append_edge(a,b,c,[g,h])}function d(a,b,c){switch(b){case "GLOW":return a+c+"11";case "COLOR_ID":case "DEPTH":return a+c+"00";default:return a+c+"10"}}function l(a,b){R.traverse_edges(a,function(c,d,e){var f=R.get_node_attr(a,d);d==b&&"Color"==f.inputs[e[1]].identifier&&R.remove_edge_by_attr(a,c,d,e)})}function n(){var a=R.create(),b={data:null,dirs:[],params:[],
inputs:[{default_value:new Float32Array([0,0,0]),identifier:"Color",is_linked:!1,name:"Color"},{default_value:1,identifier:"Alpha",is_linked:!1,name:"Alpha"}],outputs:[],type:"OUTPUT",vparams:[]};R.append_node(a,0,b);return a}function q(a){R.traverse(a,function(b,c){for(var d=c.inputs,e=c.outputs,f=0;f<d.length;f++)g(a,d[f],b,f,1);for(f=0;f<e.length;f++)g(a,e[f],b,f,0)})}function g(a,b,c,d,e){if(b.is_linked){var f=!0;R.traverse_edges(a,function(a,b,h){if(!e&&a==c&&h[0]==d||e&&b==c&&h[1]==d)f=!1});
f&&(b.is_linked=!1)}}function u(a,b,c){var d=[];R.traverse_edges(a,function(e,f,h){var k=R.get_node_attr(a,e),g=R.get_node_attr(a,f),k=qa.is_vector(k.outputs[h[0]].default_value),g=qa.is_vector(g.inputs[h[1]].default_value);if(k!=g){var l,m={default_value:[0,0,0],identifier:"Vector",is_linked:!0,name:"Vector"},n={default_value:0,identifier:"Value",is_linked:!0,name:"Value"};k&&!g?l=M("vector_to_scalar","B4W_VECTOSCAL",[m],[n]):!k&&g&&(l=M("scalar_to_vector","B4W_SCALTOVEC",[n],[m]));L(a,l,0,b,c);
d.push([e,f,a.nodes[a.nodes.length-2],h])}});for(var e=0;e<d.length;++e)R.remove_edge_by_attr(a,d[e][0],d[e][1],d[e][3]),R.append_edge(a,d[e][0],d[e][2],[d[e][3][0],0]),R.append_edge(a,d[e][2],d[e][1],[0,d[e][3][1]])}function k(a){var b=[];R.traverse(a,function(c,d){switch(d.type){case "B4W_TRANSLUCENCY":R.traverse_edges(a,function(a,e,f){a==c&&"Translucency"==d.outputs[f[0]].name&&b.push(a,e,[f[0]+1,f[1]+1])})}});for(var c=0;c<b.length;c+=3)R.append_edge(a,b[c],b[c+1],b[c+2])}function f(a,b){var c=
[];R.traverse(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;throw"Node not found";}function p(a){var b=[];R.traverse(a,function(a,c){"B4W_PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=0;c<b.length;c+=2){var d=b[c],e=b[c+1];if("B4W_PARALLAX"==e.type){var f=K(a,d,1);if(-1!=f){var h=R.get_in_edge(a,f,0);R.remove_edge(a,f,d,-1);-1!=h&&R.remove_edge(a,h,f,-1);d=R.get_node_attr(a,f);e.data=d.data;e.params[0]=d.params[0];R.remove_node(a,f)}e.inputs.splice(1,1)}else if("REROUTE"==
e.type){for(var e=R.get_in_edge(a,d,0),k=R.out_edge_count(a,d),f=[],h=[],g=[],l=0;l<k;l++){var m=R.get_out_edge(a,d,l),n=h.indexOf(m);-1!=n?g[n]+=1:(h.push(m),g.push(1),f.push(d,m))}if(-1!=e)for(k=R.get_edge_attr(a,e,d,0)[0],l=0;l<h.length;l++)for(m=0;m<g[l];m++)n=R.get_edge_attr(a,d,h[l],m)[1],R.append_edge(a,e,h[l],[k,n]);for(l=0;l<f.length;l+=2)R.remove_edge(a,f[l],f[l+1],-1)}}}function K(a,b,c){a=a.edges;for(var d=0;d<a.length;d+=3)if(a[d+1]==b&&a[d+2][1]==c)return a[d];return-1}function D(a){h(a);
w(a);A(a)}function A(a,b){var c=[],d="",e="",f={};R.traverse(a,function(a,b){if("GEOMETRY_UV"==b.type||"UVMAP"==b.type||"TEX_COORD_UV"==b.type){c.push(a,b);var h=b.data.value;d?d==h||e||(e=h,f[e]=0):(d=h,f[d]=0);f[h]++}});for(var h in f)if(2>f[h]){for(var k=0;k<c.length;k+=2)c[k+1].data.value==h&&c.splice(k,2);delete f[h];d==h&&(d=e,e="");e==h&&(e="")}if(!(3>c.length)){var k={default_value:[0,0,0],identifier:"UV_geom",is_linked:!1,name:"UV_geom"},g={default_value:[0,0,0],identifier:"UV_cycles",is_linked:!1,
name:"UV_cycles"};h=M("merged_uv","UV_MERGED",[],[k,g]);h.uv_layer=d;L(a,h,0,"",b);var l=a.nodes[a.nodes.length-2];h=a.nodes[a.nodes.length-1];if(e){g=M("merged_uv","UV_MERGED",[],[k,g]);g.uv_layer=e;L(a,g,0,"",b);var n=a.nodes[a.nodes.length-2],g=a.nodes[a.nodes.length-1]}else g=null;for(var p=-1,r=null,k=0;k<c.length;k+=2){var q=c[k],u=c[k+1];m(u,c[1])?(p=l,r=h):g&&(p=n,r=g);for(var x=[],w=R.out_edge_count(a,q),t={},J=0;J<w;J++){var z=R.get_out_edge(a,q,J);z in t||(t[z]=0);var B=R.get_edge_attr(a,
q,z,t[z]++);x.push(q,z,B);B=B.splice(0,B.length);switch(u.type){case "GEOMETRY_UV":B[0]=0;r.outputs[0].is_linked=!0;break;case "UVMAP":case "TEX_COORD_UV":B[0]=1,r.outputs[1].is_linked=!0}R.append_edge(a,p,z,B)}for(var J=0;J<x.length;J+=3)R.remove_edge(a,x[J],x[J+1],0);R.remove_node(a,q)}}}function h(a){var b=[];R.traverse(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type&&"GEOMETRY_LO"!=c.type&&"GEOMETRY_OR"!=c.type||
b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],f=b[d+1],h=!0,k=0;k<c.length;k++){var g=c[k];if(r(f,g.attr)){h=[];k=R.out_edge_count(a,e);for(n=0;n<k;n++){var l=R.get_out_edge(a,e,n),m=R.get_edge_attr(a,e,l,0);h.push(e,l,m);R.append_edge(a,g.id,l,m)}for(var n=0;n<h.length;n+=3)R.remove_edge(a,h[n],h[n+1],0);R.remove_node(a,e);h=!1;break}}h&&(g={id:e,attr:f},c.push(g))}}function x(a){for(var b={},c=0;c<a.nodes.length;c+=2)b[a.nodes[c]]=[];for(c=0;c<a.edges.length;c+=3){var d=a.edges[c],
e=a.edges[c+1];a:for(var f=b[e],h=d,k=0;k<=f.length;k++){if(k>=f.length||f[k]>h)f.splice(k,0,h);else if(f[k]!=h)continue;break a}for(var e=b[e],d=b[d],h=f=0,k=e.length+d.length,g=[],l=0;l<k;l++)f>e.length||e[f]>d[h]?g.push(d[h++]):g.push(e[f++])}return b}function w(a){var b=[];R.traverse(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});if(b.length){for(var c=x(a),d=[],e=0;e<b.length;e+=2){for(var f=b[e],h=b[e+1],k=!0,g=0;g<d.length;g++){var l=d[g];if(!(3<=l.merged_nodes.length||
!r(h,l.attr)||-1<c[f].indexOf(l.id)||-1<c[l.id].indexOf(f))){for(var m=!1,n=0;n<l.merged_nodes.length;n++){var p=l.merged_nodes[n].id;if(-1<c[f].indexOf(p)||-1<c[p].indexOf(f)){m=!0;break}}if(!m){for(var g=[],p=R.in_edge_count(a,f),q={},n=0;n<p;n++)m=R.get_in_edge(a,f,n),m in q||(q[m]=0),k=R.get_edge_attr(a,m,f,q[m]++),g.push(m,f,k);for(var p=[],q=R.out_edge_count(a,f),u={},n=0;n<q;n++)m=R.get_out_edge(a,f,n),m in u||(u[m]=0),k=R.get_edge_attr(a,f,m,u[m]++),p.push(f,m,k);k=g.concat(p);for(n=0;n<k.length;n+=
3)R.remove_edge(a,k[n],k[n+1],0);R.remove_node(a,f);n={id:f,attr:h,edges_in:g,edges_out:p};l.merged_nodes.push(n);k=!1;break}}}k&&(l={id:f,attr:h,merged_nodes:[]},d.push(l))}for(e=0;e<d.length;e++){l=d[e];c=l.merged_nodes.length;for(g=0;g<c;g++){h=l.merged_nodes[g];n=h.attr;f=h.edges_in;h=h.edges_out;l.attr.inputs[g+1].is_linked=n.inputs[0].is_linked;l.attr.inputs[g+1].default_value=n.inputs[0].default_value;l.attr.outputs[2*(g+1)].is_linked=n.outputs[0].is_linked;l.attr.outputs[2*(g+1)].default_value=
n.outputs[0].default_value;l.attr.outputs[2*(g+1)+1].is_linked=n.outputs[1].is_linked;l.attr.outputs[2*(g+1)+1].default_value=n.outputs[1].default_value;for(n=0;n<f.length;n+=3)m=f[n],k=f[n+2],k[1]+=g+1,R.append_edge(a,m,l.id,k);for(n=0;n<h.length;n+=3)m=h[n+1],k=h[n+2],k[0]+=2*(g+1),R.append_edge(a,l.id,m,k);l.attr.dirs.push(["USE_uv"+(g+2),1])}R.remove_node(a,l.id);R.append_node(a,l.id,l.attr)}}}function r(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":return a.data.value==b.data.value;
case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":case "GEOMETRY_LO":case "GEOMETRY_OR":return!0;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value.uuid==b.data.value.uuid;default:return!1}}function m(a,b){var c=["GEOMETRY_UV","TEX_COORD_UV","UVMAP"];return-1!=c.indexOf(a.type)&&-1!=c.indexOf(b.type)?a.data.value==b.data.value:!1}function E(a){var b=[];R.traverse(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=b[c],
e=b[c+1],f=!1,h=[],k=[],g=[[],[],[]],l=R.out_edge_count(a,d),m=0;m<l;m++){var n=R.get_out_edge(a,d,m);if("SEPRGB"!=R.get_node_attr(a,n).type){f=!1;break}h.push(d,n);for(var p={},r=R.out_edge_count(a,n),f=0;f<r;f++){var q=R.get_out_edge(a,n,f);q in p||(p[q]=0);var u=R.get_edge_attr(a,n,q,p[q]++);h.push(n,q);g[u[0]].push(d,q,u)}k.push(n);f=!0}if(f){for(m=d=l=0;m<g.length;m++)g[m].length&&(l++,d|=1<<2-m);if(l){e.type+=l;e.outputs=[];for(m=0;m<g.length;m++)if(g[m].length)for(e.outputs.push({default_value:0,
identifier:"RGB"[m],is_linked:!0,name:"RGB"[m]}),f=0;f<g[m].length;f+=3)g[m][f+2][0]=qa.rgb_mask_get_channel_presence_index(d,m);for(m=0;m<h.length;m+=2)R.remove_edge(a,h[m],h[m+1],0);for(m=0;m<k.length;m++)R.remove_node(a,k[m]);for(m=0;m<g.length;m++)for(f=0;f<g[m].length;f+=3)R.append_edge(a,g[m][f],g[m][f+1],g[m][f+2])}}}}function y(a,b,c,d,e,h){a=a.nodes;for(var k=null,g=0;g<a.length;g++){var l=a[g];e?"GROUP"==l.type&&l.node_tree_name==c&&(k=l):l.type==c&&(k=l)}return k?f(k,b)[0]:(h||ja.error('No "'+
c+'" node in node '+d),-1)}function M(a,b,c,d){return{name:a,type:b,inputs:c,outputs:d}}function L(a,b,c,d,e){var f=b.name,h=b.type,k=[],g=[],l=[],m=[],n=null,p=[];switch(h){case "BSDF_ANISOTROPIC":case "BSDF_DIFFUSE":case "BSDF_GLOSSY":case "BSDF_GLASS":case "BSDF_HAIR":case "BSDF_TRANSPARENT":case "BSDF_TRANSLUCENT":case "BSDF_REFRACTION":case "BSDF_TOON":case "BSDF_VELVET":case "SUBSURFACE_SCATTERING":case "EMISSION":case "AMBIENT_OCCLUSION":case "VOLUME_ABSORPTION":case "VOLUME_SCATTER":case "BUMP":case "NORMAL_MAP":case "VECT_TRANSFORM":case "BLACKBODY":case "WAVELENGTH":case "SEPXYZ":case "COMBXYZ":case "LIGHT_FALLOFF":case "TEX_IMAGE":case "TEX_ENVIRONMENT":case "TEX_SKY":case "TEX_NOISE":case "TEX_WAVE":case "TEX_MUSGRAVE":case "TEX_GRADIENT":case "TEX_MAGIC":case "TEX_CHECKER":case "TEX_BRICK":case "WIREFRAME":case "LAYER_WEIGHT":case "TANGENT":case "LIGHT_PATH":case "ATTRIBUTE":case "HOLDOUT":case "PARTICLE_INFO":case "HAIR_INFO":case "OBJECT_INFO":case "SCRIPT":case "NEW_GEOMETRY":g=
da(b);l=fa(b);ja.warn(h+" node is not fully supported.");break;case "BRIGHTCONTRAST":case "ADD_SHADER":case "MIX_SHADER":g=da(b);l=fa(b);break;case "UVMAP":var r=b.uv_layer;r||(h="EMPTY_UV");if("EMPTY_UV"!=h){var n=F("param_"+h+"_a"),q=F("param_"+h+"_v");k.push(aa(n));k.push(aa(q));m.push(aa(q));n={name:n,value:r}}l=fa(b);break;case "UV_MERGED":n=F("param_UV_MERGED_a");q=F("param_UV_MERGED_v");k.push(aa(n));k.push(aa(q));l.push(Y(b,"UV_geom"));l.push(Y(b,"UV_cycles"));m.push(aa(q));n={name:n,value:b.uv_layer};
break;case "CAMERA":g=[];l=fa(b);break;case "COMBRGB":case "COMBHSV":g=da(b);l=fa(b);break;case "CURVE_RGB":g=da(b);l=fa(b);ja.warn("CURVE_RGB node is not fully supported.");break;case "CURVE_VEC":g=da(b);l=fa(b);ja.warn("CURVE_VEC node is not fully supported.");break;case "GEOMETRY":if(!C(b))return!0;h=I(b,c);if(!h)return ja.error("Geometry output is not supported"),null;switch(h){case "GEOMETRY_UV":(r=b.uv_layer)||(h="EMPTY_UV");"EMPTY_UV"!=h&&(n=F("param_GEOMETRY_UV_a"),q=F("param_GEOMETRY_UV_v"),
k.push(aa(n)),k.push(aa(q)),m.push(aa(q)),n={name:n,value:r});l.push(Y(b,"UV"));break;case "GEOMETRY_VC":(r=b.color_layer)||(h="EMPTY_VC");"EMPTY_VC"!=h&&(n=F("param_GEOMETRY_VC_a"),q=F("param_GEOMETRY_VC_v"),k.push(aa(n)),k.push(aa(q)),m.push(aa(q)),n={name:n,value:r});l.push(Y(b,"Vertex Color"));break;case "GEOMETRY_NO":l.push(Y(b,"Normal"));break;case "GEOMETRY_FB":l.push(Y(b,"Front/Back"));break;case "GEOMETRY_VW":l.push(Y(b,"View"));break;case "GEOMETRY_GL":l.push(Y(b,"Global"));break;case "GEOMETRY_LO":l.push(Y(b,
"Local"));break;case "GEOMETRY_OR":r=F("param_GEOMETRY_OR_v"),k.push(aa(r)),l.push(Y(b,"Orco")),m.push(aa(r))}break;case "TEX_COORD":if(!C(b))return!0;h=Q(b,c);if(!h)return ja.error("Texture coordinate output is not supported"),null;switch(h){case "TEX_COORD_UV":(r=b.uv_layer)||(h="EMPTY_UV");"EMPTY_UV"!=h&&(n=F("param_TEX_COORD_UV_a"),q=F("param_TEX_COORD_UV_v"),k.push(aa(n)),k.push(aa(q)),m.push(aa(q)),n={name:n,value:b.uv_layer});l.push(Y(b,"UV"));break;case "TEX_COORD_NO":l.push(Y(b,"Normal"));
break;case "TEX_COORD_GE":r=F("param_TEX_COORD_GE_v");k.push(aa(r));l.push(Y(b,"Generated"));m.push(aa(r));break;case "TEX_COORD_OB":l.push(Y(b,"Object"));ja.warn('Output "Object" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_CA":l.push(Y(b,"Camera"));break;case "TEX_COORD_WI":l.push(Y(b,"Window"));ja.warn('Output "Window" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_RE":l.push(Y(b,"Reflection")),ja.warn('Output "Reflection" of node "Texture Coordinate" doesn\'t supported fully.')}break;
case "GROUP":r=b.node_tree_name;switch(r){case "B4W_LINEAR_TO_SRGB":if(!N(b,[1],[1])){n=B(b,d,e);break}h="B4W_LINEAR_TO_SRGB";break;case "B4W_NORMAL_VIEW":case "B4W_VECTOR_VIEW":if(!N(b,[1],[1])){n=B(b,d,e);break}h="B4W_VECTOR_VIEW";break;case "B4W_SRGB_TO_LINEAR":if(!N(b,[1],[1])){n=B(b,d,e);break}h="B4W_SRGB_TO_LINEAR";break;case "B4W_REFLECT":if(!N(b,[1,1],[1])){n=B(b,d,e);break}h="B4W_REFLECT";break;case "B4W_REFRACTION":if(!N(b,[1,0],[1])){n=B(b,d,e);break}h="B4W_REFRACTION";break;case "B4W_PARALLAX":if(!N(b,
[1,1,0,0,0],[1])){n=B(b,d,e);break}h="B4W_PARALLAX";q=F("temp_texture");m.push(aa(q));break;case "B4W_CLAMP":if(!N(b,[1],[1])){n=B(b,d,e);break}h="B4W_CLAMP";break;case "B4W_TRANSLUCENCY":if(!N(b,[0,0,0,0,0],[0])){n=B(b,d,e);break}h="B4W_TRANSLUCENCY";break;case "B4W_TIME":if(!N(b,[],[0])){n=B(b,d,e);break}h="B4W_TIME";break;case "B4W_SMOOTHSTEP":if(!N(b,[0,0,0],[0])){n=B(b,d,e);break}h="B4W_SMOOTHSTEP";break;case "B4W_GLOW_OUTPUT":h="B4W_GLOW_OUTPUT";break;default:n=B(b,d,e)}g=da(b);l=fa(b);"B4W_TRANSLUCENCY"==
r&&(r=P("TranslucencyParams","TranslucencyParams",[0,0,0,0]),r.is_linked=l[0].is_linked,l.push(r));break;case "LAMP":n=b.lamp;if(!n)return ja.error("There is no lamp in node: "+b.name),null;l.push(Y(b,"Color"));l.push(Y(b,"Light Vector"));l.push(Y(b,"Distance"));l.push(Y(b,"Visibility Factor"));n.uuid in oa?p.push(["LAMP_INDEX",String(oa[n.uuid])]):(oa[n.uuid]=ca,p.push(["LAMP_INDEX",String(ca++)]));n=oa;break;case "LIGHTING_AMBIENT":g=[P("E","E",[0,0,0],!0),P("A","A",[0,0,0],!0),P("D","D",[0,0,0],
!0)];l=[P("color","color",[0,0,0],!0),P("specular","specular",[0,0,0],!0)];break;case "LIGHTING_BEGIN":l=[P("E","E",[0,0,0],!0),P("A","A",[0,0,0],!0),P("D","D",[0,0,0],!0),P("S","S",[0,0,0],!0),P("normal","normal",[0,0,0],!0),P("dif_params","dif_params",[0,0],!0),P("sp_params","sp_params",[0,0],!0),P("shadow_factor","shadow_factor",0,!0),P("translucency_color","translucency_color",0,!0),P("translucency_params","translucency_params",[0,0,0,0],!0)];break;case "LIGHTING_END":g=[P("color","color",[0,
0,0],!0),P("specular","specular",[0,0,0],!0)];break;case "LIGHTING_LAMP":g=[P("shadow_factor","shadow_factor",0,!0)];l=[P("ldir","ldir",[0,0,0],!0),P("lfac","lfac",[0,0],!0),P("lcolorint","lcolorint",[0,0,0],!0),P("norm_fac","norm_fac",0,!0)];break;case "DIFFUSE_LAMBERT":g=[P("ldir","ldir",[0,0,0],!0),P("lfac","lfac",[0,0],!0),P("normal","normal",[0,0,0],!0),P("norm_fac","norm_fac",0,!0)];l=[P("lfactor","lfactor",0,!0)];break;case "DIFFUSE_FRESNEL":case "DIFFUSE_MINNAERT":case "DIFFUSE_OREN_NAYAR":case "DIFFUSE_TOON":g=
[P("ldir","ldir",[0,0,0],!0),P("lfac","lfac",[0,0],!0),P("normal","normal",[0,0,0],!0),P("norm_fac","norm_fac",0,!0),P("dif_params","dif_params",[0,0],!0)];l=[P("lfactor","lfactor",0,!0)];break;case "SPECULAR_BLINN":case "SPECULAR_PHONG":g=[P("ldir","ldir",[0,0,0],!0),P("lfac","lfac",[0,0],!0),P("normal","normal",[0,0,0],!0),P("norm_fac","norm_fac",0,!0),P("sp_params","sp_params",[0,0],!0)];l=[P("sfactor","sfactor",0,!0)];break;case "SPECULAR_TOON":case "SPECULAR_WARDISO":g=[P("ldir","ldir",[0,0,
0],!0),P("lfac","lfac",[0,0],!0),P("normal","normal",[0,0,0],!0),P("sp_params","sp_params",[0,0],!0)];l=[P("sfactor","sfactor",0,!0)];break;case "LIGHTING_APPLY":g=[P("color","color",[0,0,0,0],!0),P("specular","specular",[0,0,0],!0),P("lfactor","lfactor",0,!0),P("sfactor","sfactor",0,!0),P("ldir","ldir",[0,0,0],!0),P("normal","normal",[0,0,0],!0),P("translucency_params","translucency_params",[0,0,0,0],!0),P("D","D",[0,0,0],!0),P("S","S",[0,0,0],!0),P("lcolorint","lcolorint",[0,0,0],!0),P("translucency_color",
"translucency_color",0,!0)];l=[P("color","color",[0,0,0,0],!0),P("specular","specular",[0,0,0],!0)];break;case "NORMAL":g=da(b);l=fa(b);r=Y(b,"Normal");m.push(aa(F("param_NORMAL_Normal"),r.default_value,3));break;case "MAPPING":r=b.vector_type;h="MAPPING";g.push(z(b,"Vector"));l.push(Y(b,"Vector"));var q=b.rotation,u=b.scale,x=b.translation,w=ua.create(),t=qa.euler_to_rotation_matrix(q);"TEXTURE"==r&&(u[0]=u[0]||1,u[1]=u[1]||1,u[2]=u[2]||1);var J=new Float32Array([u[0],0,0,0,u[1],0,0,0,u[2]]);ua.multiply(t,
J,w);w=qa.mat3_to_mat4(w,ia.create());switch(r){case "POINT":w[12]=x[0];w[13]=x[1];w[14]=x[2];break;case "TEXTURE":w[12]=x[0];w[13]=x[1];w[14]=x[2];w=ia.invert(w,w);break;case "NORMAL":ia.invert(w,w),ia.transpose(w,w)}switch(r){case "NORMAL":p.push(["MAPPING_IS_NORMAL",1]);case "TEXTURE":p.push(["MAPPING_TRS_MATRIX",ta.glsl_value(w,16)]);break;case "POINT":0!==Aa.length(q)?p.push(["MAPPING_TRS_MATRIX",ta.glsl_value(w,16)]):(0!==Aa.length(u)&&p.push(["MAPPING_SCALE",ta.glsl_value(u,3)]),0!==Aa.length(x)&&
p.push(["MAPPING_TRANSLATION",ta.glsl_value(x,3)]));break;case "VECTOR":0!==Aa.length(q)?p.push(["MAPPING_TRS_MATRIX",ta.glsl_value(w,16)]):0!==Aa.length(u)&&p.push(["MAPPING_SCALE",ta.glsl_value(u,3)])}b.use_min&&p.push(["MAPPING_MIN_CLIP",ta.glsl_value(b.min,3)]);b.use_max&&p.push(["MAPPING_MAX_CLIP",ta.glsl_value(b.max,3)]);break;case "MATERIAL":case "MATERIAL_EXT":n=[];r=[];q=[];u=[P("E","E",[0,0,0],!0),P("A","A",[0,0,0],!0),P("D","D",[0,0,0],!0),P("S","S",[0,0,0],!0),P("normal","normal",[0,0,
0],!0),P("dif_params","dif_params",[0,0],!0),P("sp_params","sp_params",[0,0],!0),P("shadow_factor","shadow_factor",0,!0)];x=[P("color","color",[0,0,0],!0),P("specular","specular",[0,0,0],!0),P("normal","normal",[0,0,0],!0)];w=[Y(b,"Color"),Y(b,"Alpha"),Y(b,"Normal")];t=[];J=z(b,"Color");J.default_value.splice(3);q.push(J);g.push(J);J=z(b,"Spec");J.default_value.splice(3);q.push(J);g.push(J);q.push(P("DiffuseIntensity","DiffuseIntensity",b.diffuse_intensity));g.push(J);var v=z(b,"Normal");v.default_value.splice(3);
q.push(v);g.push(v);"MATERIAL_EXT"==h?((J=z(b,"Emit"))||(J=P("Emit","Emit",0)),q.push(J),g.push(J),(J=z(b,"Translucency"))?(J.default_value=0,J.name="Translucency",J.identifier="Translucency"):J=P("Translucency","Translucency",0),g.push(J),(J=z(b,"Translucency"))?(J.default_value=[0,0,0,0],J.name="TranslucencyParams",J.identifier="TranslucencyParams"):J=P("TranslucencyParams","TranslucencyParams",[0,0,0,0]),g.push(J),l=z(b,"Reflectivity"),J=z(b,"Ray Mirror"),l?(J=l,l="Reflectivity"):J?l="Ray Mirror":
(J=l,l="Reflectivity"),J||(J=P(l,l,0)),g.push(J),x.push(J),(J=z(b,"SpecTra"))||(J=P("SpecTra","SpecTra",0)),g.push(J),x.push(J),(J=z(b,"Alpha"))||(J=P("Alpha","Alpha",b.alpha)),g.push(J),x.push(J),w.push(Y(b,"Diffuse")),w.push(Y(b,"Spec")),n.push(["MATERIAL_EXT",1]),r.push(["MATERIAL_EXT",1])):(q.push(P("emit_intensity","emit_intensity",0)),x.push(P("reflect_factor","reflect_factor",0)),x.push(P("specular_alpha","specular_alpha",0)),x.push(P("alpha_in","alpha_in",0)),w.push(P("diffuse_out","diffuse_out",
0)),w.push(P("spec_out","spec_out",0)),n.push(["MATERIAL_EXT",0]),r.push(["MATERIAL_EXT",0]));t.push(aa(F("param_MATERIAL_alpha"),b.alpha));t.push(aa(F("param_MATERIAL_spec_alpha"),b.specular_alpha));l=w;v.is_linked&&n.push(["USE_MATERIAL_NORMAL",1]);b.use_diffuse&&(n.push(["USE_MATERIAL_DIFFUSE",1]),r.push(["USE_MATERIAL_DIFFUSE",1]));b.use_specular&&r.push(["USE_MATERIAL_SPECULAR",1]);var J=[],V=0;switch(b.specular_shader){case "COOKTORR":case "PHONG":v=b.specular_hardness;break;case "WARDISO":v=
b.specular_slope;break;case "TOON":v=b.specular_toon_size;V=b.specular_toon_smooth;break;case "BLINN":v=b.specular_ior;V=b.specular_hardness;break;default:ja.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.material_name+'")'),v=b.specular_hardness}var y,S;switch(b.diffuse_shader){case "LAMBERT":S=y=0;break;case "OREN_NAYAR":y=b.roughness;S=0;break;case "FRESNEL":y=b.diffuse_fresnel;S=b.diffuse_fresnel_factor;break;case "MINNAERT":y=b.darkness;S=0;break;case "TOON":y=b.diffuse_toon_size;
S=b.diffuse_toon_smooth;break;default:ja.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.material_name+'")'),S=y=0}J.push(aa(F("param_MATERIAL_diffuse"),[y,S],2));J.push(aa(F("param_MATERIAL_spec"),[b.specular_intensity,v,V],3));n.push(["SHADELESS_MAT",b.use_shadeless?1:0]);v={name:b.name,value:{specular_shader:b.specular_shader,diffuse_shader:b.diffuse_shader,use_shadeless:b.use_shadeless}};n={name:b.name,value:{specular_shader:b.specular_shader,diffuse_shader:b.diffuse_shader,
use_shadeless:b.use_shadeless},material_begin:{name:"material_begin",type:"MATERIAL_BEGIN",inputs:q,outputs:u,params:J,data:v,dirs:n,vparams:[]},material_end:{name:"material_end",type:"MATERIAL_END",inputs:x,outputs:w,params:t,data:v,dirs:r,vparams:[]}};break;case "MATH":switch(b.operation){case "ADD":h="MATH_ADD";break;case "SUBTRACT":h="MATH_SUBTRACT";break;case "MULTIPLY":h="MATH_MULTIPLY";break;case "DIVIDE":h="MATH_DIVIDE";break;case "SINE":h="MATH_SINE";break;case "COSINE":h="MATH_COSINE";break;
case "TANGENT":h="MATH_TANGENT";break;case "ARCSINE":h="MATH_ARCSINE";break;case "ARCCOSINE":h="MATH_ARCCOSINE";break;case "ARCTANGENT":h="MATH_ARCTANGENT";break;case "POWER":h="MATH_POWER";break;case "LOGARITHM":h="MATH_LOGARITHM";break;case "MINIMUM":h="MATH_MINIMUM";break;case "MAXIMUM":h="MATH_MAXIMUM";break;case "ROUND":h="MATH_ROUND";break;case "LESS_THAN":h="MATH_LESS_THAN";break;case "GREATER_THAN":h="MATH_GREATER_THAN";break;case "MODULO":h="MATH_MODULO";break;case "ABSOLUTE":h="MATH_ABSOLUTE";
break;default:return ja.error("Unsupported MATH operation: "+b.operation),null}p.push(["MATH_USE_CLAMP",Number(b.use_clamp)]);g=da(b);l=fa(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":h="MIX_RGB_MIX";break;case "ADD":h="MIX_RGB_ADD";break;case "MULTIPLY":h="MIX_RGB_MULTIPLY";break;case "SUBTRACT":h="MIX_RGB_SUBTRACT";break;case "SCREEN":h="MIX_RGB_SCREEN";break;case "DIVIDE":h="MIX_RGB_DIVIDE";break;case "DIFFERENCE":h="MIX_RGB_DIFFERENCE";break;case "DARKEN":h="MIX_RGB_DARKEN";break;case "LIGHTEN":h=
"MIX_RGB_LIGHTEN";break;case "OVERLAY":h="MIX_RGB_OVERLAY";break;case "DODGE":h="MIX_RGB_DODGE";break;case "BURN":h="MIX_RGB_BURN";break;case "HUE":h="MIX_RGB_HUE";break;case "SATURATION":h="MIX_RGB_SATURATION";break;case "VALUE":h="MIX_RGB_VALUE";break;case "COLOR":h="MIX_RGB_COLOR";break;case "SOFT_LIGHT":h="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":h="MIX_RGB_LINEAR_LIGHT";break;default:return ja.error("Unsupported MIX_RGB blend type: "+b.blend_type),null}p.push(["MIX_RGB_USE_CLAMP",Number(b.use_clamp)]);
g=da(b);l=fa(b);break;case "OUTPUT":g=da(b);l=[];break;case "RGB":r=d+"%join%"+b.name;r={name:"-1",value:r};m.push(r);l.push(Y(b,"Color"));break;case "SEPRGB":case "SEPHSV":g=da(b);l=fa(b);break;case "TEXTURE":h=G(b);if("TEXTURE_EMPTY"==h)l.push(Y(b,"Color")),l.push(Y(b,"Normal")),l.push(Y(b,"Value"));else if("TEXTURE_ENVIRONMENT"==h)g.push(z(b,"Vector")),l.push(Y(b,"Color")),l.push(Y(b,"Value"));else{if("TEXTURE_NORMAL"==h&&"ENVIRONMENT_MAP"==b.texture.type)return ja.error("Wrong output for ENVIRONMENT_MAP texture: "+
b.name),null;for(n=0;4>n;++n)n?(J=P("Vector"+n,"Vector"+n,[0,0,0]),"TEXTURE_COLOR"==h&&(r=P("Color"+n,"Color"+n,[0,0,0]),q=P("Value"+n,"Value"+n,0)),"TEXTURE_NORMAL"==h&&(r=P("Normal"+n,"Normal"+n,[0,0,0]),q=P("Value"+n,"Value"+n,0))):(J=z(b,"Vector"),"TEXTURE_COLOR"==h&&(r=Y(b,"Color"),q=Y(b,"Value")),"TEXTURE_NORMAL"==h&&(r=Y(b,"Normal"),q=Y(b,"Value"))),g.push(J),l.push(r),l.push(q)}q=F("param_TEXTURE_texture");m.push(aa(q));n={name:q,value:b.texture};break;case "VALTORGB":g=da(b);l=fa(b);ja.warn("VALTORGB node is not fully supported.");
break;case "VALUE":h="VALUE";r=d+"%join%"+b.name;r={name:"-1",value:r};m.push(r);l.push(Y(b,"Value"));break;case "VECT_MATH":switch(b.operation){case "ADD":h="VECT_MATH_ADD";break;case "SUBTRACT":h="VECT_MATH_SUBTRACT";break;case "AVERAGE":h="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":h="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":h="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":h="VECT_MATH_NORMALIZE";break;default:return ja.error("Unsupported VECT_MATH operation: "+b.operation),null}g=
da(b);l=fa(b);break;default:g=da(b),l=fa(b)}h={name:f,type:h,vparams:k,inputs:g,outputs:l,params:m,data:n,dirs:p};f=R.gen_node_id(a);R.append_node(a,R.gen_node_id(a),h);if(h="GEOMETRY"==b.type||"TEX_COORD"==b.type)a:{h=b.outputs;for(g=k=0;g<h.length;g++)if(h[g].is_linked&&k++>c){h=!0;break a}h=!1}return h&&null==L(a,b,++c,d,e)?null:f}function N(a,b,c){for(var d=a.inputs,e=a.outputs,f=a.node_tree_name,h=0;h<b.length;h++){var k=d[h],g=b[h];if(!k||k.default_value instanceof Array!=g)return ja.warn('Wrong inputs for custom node group "'+
a.name+'" of type: "',f,'".Processing as general node group.'),!1}for(h=0;h<c.length;h++)if(b=e[h],d=c[h],!b||b.default_value instanceof Array!=d)return ja.warn('Wrong outputs for custom node group "'+a.name+'" of type: "',f,'".Processing as general node group.'),!1;return!0}function B(a,b,c){var d=a.node_group.node_tree,e={},f;for(f in d)if("links"==f||"nodes"==f){e[f]=[];for(var h=0;h<d[f].length;h++){e[f][h]={};for(var k in d[f][h])if("links"==f){e[f][h][k]={};for(var g in d[f][h][k])e[f][h][k][g]=
O(d[f][h][k][g])}else e[f][h][k]=O(d[f][h][k])}}else e[f]=O(d[f]);d=a.node_tree_name;if("B4W_REPLACE"==d||"B4W_LEVELS_OF_QUALITY"==d)f=M("Group input","GROUP_INPUT",[],a.inputs),h=M("Group output","GROUP_OUTPUT",a.outputs,[]),k=null,k="B4W_REPLACE"==d||"B4W_LEVELS_OF_QUALITY"==d&&(xa.quality==S.P_LOW||xa.force_low_quality_nodes)?{from_node:f,from_socket:f.outputs[1],to_node:h,to_socket:h.inputs[0]}:{from_node:f,from_socket:f.outputs[0],to_node:h,to_socket:h.inputs[0]},e.nodes=[f,h],e.links=[k];d=
a.name;f=e.nodes;h=e.links;for(k=0;k<f.length;k++)f[k].name=T(f[k].type,d,f[k].name);for(k=0;k<h.length;k++)h[k].from_node.name=T(h[k].from_node.type,d,h[k].from_node.name),h[k].to_node.name=T(h[k].to_node.type,d,h[k].to_node.name);return{node_group_graph:v(e,a.node_group.uuid,!0,b,c),node_group_links:e.links}}function O(a){var b=typeof a;return"string"!=b&&"number"!=b&&"boolean"!=b&&a?qa.clone_object_nr(a):a}function F(a){H[a]||(H[a]=0);var b=a+H[a],b=b.replace(/ /g,"_").replace(/\//g,"_");H[a]++;
return b}function C(a){a=a.outputs;for(var b=0;b<a.length;b++)if(a[b].is_linked)return!0;return!1}function I(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var f=c[e];if(f.is_linked&&!(d++<b))switch(f.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";case "Local":return"GEOMETRY_LO";case "Orco":return"GEOMETRY_OR";default:return null}}}
function Q(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var f=c[e];if(f.is_linked&&!(d++<b))switch(f.identifier){case "Camera":return"TEX_COORD_CA";case "Generated":return"TEX_COORD_GE";case "Normal":return"TEX_COORD_NO";case "Object":return"TEX_COORD_OB";case "Reflection":return"TEX_COORD_RE";case "UV":return"TEX_COORD_UV";case "Window":return"TEX_COORD_WI";default:return null}}}function G(a){if(!a.texture)return"TEXTURE_EMPTY";for(var b=a.outputs,c=!1,d=!1,e=!1,f=0;f<b.length;f++){var h=b[f];
if(h.is_linked)switch(h.identifier){case "Color":c=!0;break;case "Normal":d=!0;break;case "Value":e=!0;break;default:throw"Unknown texture output";}}if(c)return d&&ja.warn('Node "'+a.name+'" has both Color and Normal outputs. Normal will be omitted'),"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";if(d)return"TEXTURE_NORMAL";if(e)return"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR"}function z(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==
b)return U(e)}return null}function Y(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return U(e)}return null}function U(a){var b=a.name,c=a.identifier,d=a.is_linked;a=a.default_value;a=qa.is_vector(a)?a.slice(0):a;return{name:b,identifier:c,is_linked:d,default_value:a}}function P(a,b,c,d){return{name:a,identifier:b,is_linked:d||!1,default_value:c}}function da(a){for(var b=[],c=0;c<a.inputs.length;c++){var d=U(a.inputs[c]);d.default_value.length&&d.default_value.splice(3);
b.push(d)}return b}function fa(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=U(a.outputs[c]);b.push(d)}return b}function aa(a,b,c){b=null===b||void 0===b?null:ta.glsl_value(b,c);return{name:a,value:b}}function W(a,b,c,d,e,f){var h=[],k=f.from_socket.identifier;f=f.to_socket.identifier;var g=d.outputs;for(d=0;d<g.length;d++)if(g[d].identifier==k){h.push(d);break}e=e.inputs;for(d=0;d<e.length;d++)if(e[d].identifier==f){h.push(d);break}2==h.length&&R.append_edge(a,b,c,h);return!0}function T(a,b,
c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"%join%"+c}function Z(a){var b=[];R.traverse(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function ba(a,b,c){for(var d=0;d<c.length;d++){var e=c[d].data.node_group_graph,f=c[d].data.node_group_links;if(!e)return!1;R.traverse(e,function(b,c){R.append_node(a,R.gen_node_id(a),c)});for(e=0;e<f.length;e++)b.push(f[e]);V(c[d],b,a)}return!0}function pa(a,b,c,d,e,f){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+
"*GI*")||e.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||f.push(c)}}function ga(a,b,c){for(var d=[],e=0;e<c.length;e++){for(var f=c[e],h=null,k=0;k<b.length;k++)if(f.from_socket.identifier==b[k].to_socket.identifier){h=b[k];break}h?(f.from_node=h.from_node,f.from_socket=h.from_socket):d.push(f)}for(e=0;e<b.length;e++)a.splice(a.indexOf(b[e]),1);return d}function ka(a,b){if(b.length)for(var c=b[0].from_node.name,d=0;d<a.length;d++)a[d].from_node.name==c&&b.push(a[d])}function J(a,b,c,
d){for(var e=0;e<d.length;e++){for(var h=d[e],k,g=0;g<c.inputs.length;g++)if(h.from_socket.identifier==c.inputs[g].identifier){k=c.inputs[g].default_value;break}for(var g=h,l=b,m=k,n=f(g.to_node,l),p=0;p<n.length;p++)for(var r=R.get_node_attr(l,n[p]),q=0;q<r.inputs.length;q++){var u=r.inputs[q];if(u.identifier==g.to_socket.identifier){r=u.default_value instanceof Object?0:1;if((m instanceof Object?0:1)==r)u.default_value=m;else switch(r){case 0:u=u.default_value;u[0]=u[1]=u[2]=m;break;case 1:u.default_value=
(m[0]+m[1]+m[2])/3}break}}h=a.indexOf(h);-1!=h&&a.splice(h,1)}}function V(a,b,c){for(var d=a.name,e=[],f=[],h=[],k=[],g=0;g<b.length;g++){var l=b[g];pa(l.from_node,d,l,e,h,k);pa(l.to_node,d,l,f,h,k)}f=ga(b,f,h);e=ga(b,k,e);ka(b,f);J(b,c,a,f);if(e.length){var m;R.traverse(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(m=b)});J(b,c,m,e)}}var S=t("__config"),R=t("__graph"),ua=t("__mat3"),ia=t("__mat4"),na=t("__objects"),ja=t("__print"),ta=t("__shaders"),ea=t("__scenes"),qa=t("__util"),
Aa=t("__vec3"),H={},ha={},oa={},ca=0;new Float32Array(4);var xa=S.defaults;a.compose_nmat_graph=v;a.create_lighting_graph=function(a,c,e){var f=ea.get_active();a=d(a,"MAIN",f.uuid);if(a in ha)return ha[a];var f=R.create(),h={name:"LIGHTING_BEGIN",type:"LIGHTING_BEGIN"},k=L(f,h,0,c,null),h={name:"LIGHTING_END",type:"LIGHTING_END"},h=L(f,h,0,c,null);b(f,e,k,h,[[k,[8,10]],[k,[9,6]]],c);q(f);return ha[a]=f};a.compose_node_elements=function(a){var b=[],c={};H={};var d=R.topsort(a);R.traverse(d,function(a,
d){var e;e=[];for(var f=[],h=[],k=[],g=[],l=[],m=0;m<d.inputs.length;m++){var n=d.inputs[m];if(n.is_linked)e.push(null),f.push(null);else{e.push(F("in_"+d.type+"_"+n.identifier));var p=ta.glsl_value(n.default_value,0);xa.shader_constants_hack&&(0<=d.type.indexOf("MIX_RGB_")&&("Color1"==n.identifier||"Color2"==n.identifier||"Fac"==n.identifier)||0<=d.type.indexOf("MATH_")&&("Value"==n.identifier||"Value_001"==n.identifier)||0<=d.type.indexOf("VECT_MATH_")&&"Vector_001"==n.identifier||0<=d.type.indexOf("LIGHTING_APPLY")||
0<=d.type.indexOf("MATERIAL_END")||0<=d.type.indexOf("MATERIAL_BEGIN"))&&(n=p,n=n.replace(/(,)/g,"$1 "),n=n.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3"),n=n.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1UNITY_VALUE_NODES$3"),p=n=n.replace(/\s+/g,""));f.push(p)}}for(m=0;m<d.outputs.length;m++)n=d.outputs[m],n.is_linked?h.push(null):h.push(F("out_"+d.type+"_"+n.identifier));for(m=0;m<d.params.length;m++)n=d.params[m],k.push(n.name),g.push(n.value);for(m=0;m<d.vparams.length;m++)l.push(d.vparams[m].name);
e={id:d.type,inputs:e,input_values:f,outputs:h,params:k,param_values:g,vparams:l,dirs:JSON.parse(JSON.stringify(d.dirs))};b.push(e);c[a]=e});R.traverse_edges(d,function(a,b,e){var f=R.get_node_attr(d,a);R.get_node_attr(d,b);var h=f.outputs[e[0]];a=c[a].outputs;b=c[b].inputs;f=a[e[0]]||F("out_"+f.type+"_"+h.identifier);a[e[0]]=f;b[e[1]]=f});return b};a.check_material_glow_output=function(a){if(a.node_tree)for(var b=0;b<a.node_tree.nodes.length;b++){var c=a.node_tree.nodes[b];if("GROUP"==c.type&&"B4W_GLOW_OUTPUT"==
c.node_tree_name)return!0}return!1};a.cleanup=function(){for(var a in ha)delete ha[a];for(var b in oa)delete oa[b];ca=0}};b4w.module.__animation=function(a,t){function v(a,b){var c=a.anim_slots[b];c&&c.finish_callback&&c.exec_finish_callback&&(c.exec_finish_callback=!1,c.finish_callback(a,b))}function c(a,b,c){c=a.anim_slots[c];c.type=30;var d=b.frame_start,e=b.frame_end-d+1;c.start=d;c.length=e;c.current_frame_float=d;c.animation_name=b.name;for(e=d=0;e<a.vertex_anim.length;e++){var f=a.vertex_anim[e];if(f==b)break;else d+=f.frame_end-f.frame_start+1}c.va_frame_offset=d}function b(a,b,c){for(var d=a.scenes_data,e=0;e<
d.length;e++)for(var f=d[e].batches,h=0;h<f.length;h++){var k=f[h].particles_data;if(k&&k.name==b){var g=a.anim_slots[c];g.type=50;g.animation_name=k.name;g.start=k.frame_start;g.length=k.frame_end-g.start;k.cyclic||(g.length+=k.lifetime_frames)}}}function e(a){return a.replace(/_B4W_BAKED$/,"")}function d(a,b){if(a.animation_data){var c=a.animation_data.action;c&&c._render.type==ja&&b.push(c)}for(var c=a.nodes,e=0;e<c.length;e++){var f=c[e];f.node_group&&(f=f.node_group.node_tree)&&d(f,b)}}function l(a){return z.is_mesh(a)&&
a.render.vertex_anim?!0:!1}function n(a,b,c){var d=a.anim_slots;if(-1==c)for(c=0;8>c;c++){var e=d[c];e&&(e.current_frame_float=b,g(a,0,c,!0))}else if(e=d[c])e.current_frame_float=b,g(a,0,c,!0)}function q(a,b,c){if(-1==b)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function g(a,b,c,d){A(a,b,c,d);v(a,c);a.render.anim_mixing&&(w(a,b),x(a,b))}function u(a,b,c){var d=b.frame_range;if(d[0]>d[1])return P.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),!1;var e=
b._render,h=a.anim_slots[c];h.animation_name=b.name;h.action_frame_range=d;h.action_step=e.pierce_step;h.action_bflags=e.bflags;h.channels_mask.set(e.channels_mask);h.start=d[0];h.length=d[1]-d[0];h.current_frame_float=d[0];switch(e.type){case ua:if(z.is_armature(a)){h.type=10;var g=k(a,b);if(!g){for(var g=a.render.bone_pointers,d=[],l=[],n=b._render.num_pierced,q=0;q<n;q++){for(var u in g){var x=g[u],w=x.tsr_basis,t=b._render.bones[u];t?Z.copy(t.subarray(8*q,8*q+8),w):Z.identity(w);x.tsr_channel_cache_valid=
!1}x=r(g);d.push(x.trans);l.push(x.quats)}g={trans:d,quats:l};a.action_anim_cache.push(b,g)}h.trans=g.trans;h.quats=g.quats;h=g;u=a.render;g=u.skinned_renders;l=a.anim_slots[c];d=l.skinning_data;a:{n=u.skinning_data_cache;for(q=0;q<n.length;q+=2)if(b==n[q]){n=n[q+1];break a}n=null}if(n)l.skinning_data=n;else{for(l=0;l<g.length;l++){for(var n=g[l].bone_skinning_info,q=[],x=[],w=h.trans,t=h.quats,J=0;J<w.length;J++){var B=m(w[J],t[J],n);q.push(B.trans);x.push(B.quats)}d.push({trans:q,quats:x})}u.skinning_data_cache.push(b,
d)}u.anim_mixing&&(b=u.two_last_skeletal_slots,c>b[1]?(h=b[1],b[1]=c,b[0]=h):c>b[0]&&c<b[1]&&(b[0]=c),f(a))}break;case ia:z.is_speaker(a)&&(h.volume=e.params.volume||null,h.pitch=e.params.pitch||null,h.type=40);break;case ta:z.is_lamp(a)&&(h.color=e.params.color||null,h.energy=e.params.energy||null,h.type=70);break;case ja:if("MESH"==a.type){h.type=60;u=k(a,b);if(!u){u=[];d=[];l=[];n=[];q=b._render;x=a.render.mats_anim_inds;w=a.render.mats_rgb_anim_inds;for(g in q.params)t=b.name+"%join%"+g,K(g,t,
q,d,u,x),K(g,t,q,n,l,w);u={val_inds:u,values:d,rgb_inds:l,rgbs:n};a.action_anim_cache.push(b,u)}h.node_value_inds=u.val_inds;h.nodemat_values=u.values;h.node_rgb_inds=u.rgb_inds;h.nodemat_rgbs=u.rgbs}break;case na:if(u=e.params.tsr){h.type=20;g=k(a,b);if(!g){g=b._render.num_pierced;d=[];l=[];for(n=0;n<g;n++)d.push(u.subarray(8*n,8*n+4)),l.push(u.subarray(8*n+4,8*n+8));g={trans:d,quats:l};a.action_anim_cache.push(b,g)}h.trans=g.trans;h.quats=g.quats;Y.obj_has_particles(a)&&Y.update_start_pos(a,h.trans[0],
h.quats[0])}else return P.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),!1}z.is_armature(a)&&e.type!=ua&&p(a,c);return!0}function k(a,b){for(var c=a.action_anim_cache,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function f(a){var b=a.render.two_last_skeletal_slots;if(-1!=b[0]&&-1!=b[1]){var c=a.anim_slots;a=c[b[1]].current_frame_float;var d=Math.floor(a),e=a-d,b=c[b[0]];a=b.current_frame_float;d=Math.floor(a);b.current_frame_float=d+e}}function p(a,b){var c=
a.render.two_last_skeletal_slots,d=c[1];c[0]=-1;c[1]=-1;if(-1!=b)for(var e=a.anim_slots;0<=d;d--){var f=e[d];if(f&&10==f.type)if(d>c[1])c[1]=d;else{d>c[0]&&(c[1]=d);break}}}function K(a,b,c,d,e,f){for(var h=0;h<f.length;h+=2)b==f[h]&&(e.push(f[h+1]),d.push(new Float32Array(c.params[a])))}function D(a){a=a._render;for(var b in a.params)if(-1!=b.indexOf("nodes"))return!0;return!1}function A(a,b,c,d){if((c=a.anim_slots[c])&&null!=c.type&&(c.play||d)){var e=a.render,f=c.current_frame_float,k=c.start,
g=c.length,f=f+c.speed*b*W.get_framerate(),l=c.type,m=c.speed;if(0<=m&&f>=k+g||0>m&&f<k)switch(d||(c.exec_finish_callback=!0),c.behavior){case 10:f=0<=m?(f-k)%g+k:k+g-1E-6;break;case 20:f=0<=m?k:k+g-1E-6;c.play=!1;break;case 30:f=0<=m?k+g-1E-6:k,c.play=!1}c.current_frame_float=f;switch(l){case 10:if(!e.anim_mixing){d=h(c);b=d[0];f=d[1];d=d[2];e.quats_before=c.quats[b];e.quats_after=c.quats[f];e.trans_before=c.trans[b];e.trans_after=c.trans[f];e.frame_factor=d;d=e.skinned_renders;c=c.skinning_data;
for(k=0;k<d.length;k++)g=d[k],l=c[k],g.quats_before=l.quats[b],g.quats_after=l.quats[f],g.trans_before=l.trans[b],g.trans_after=l.trans[f],g.frame_factor=e.frame_factor;T.update_transform(a)}break;case 20:d=h(c);var e=qa,f=d[0],k=d[1],g=d[2],l=c.trans,m=l[f][1],n=l[f][2],p=l[k][1],r=l[k][2];e[0]=(1-g)*l[f][0]+g*l[k][0];e[1]=(1-g)*m+g*p;e[2]=(1-g)*n+g*r;f=H;n=d[0];k=d[1];g=d[2];l=c.quats;m=ha;m[0]=l[n][0];m[1]=l[n][1];m[2]=l[n][2];m[3]=l[n][3];n=oa;n[0]=l[k][0];n[1]=l[k][1];n[2]=l[k][2];n[3]=l[k][3];
da.slerp(m,n,g,f);k=d[2];g=c.trans;d=(1-k)*g[d[0]][3]+k*g[d[1]][3];c.trans_smooth_period&&(k=Aa,T.get_translation(a,k),ba.smooth_v(e,k,b,c.trans_smooth_period,e));c.quat_smooth_period&&(k=ha,T.get_rotation(a,k),ba.smooth_q(f,k,b,c.quat_smooth_period,f));k=c.channels_mask;k[0]&&T.set_translation_rel(a,e);k[1]&&T.set_rotation_rel(a,f);k[2]&&T.set_scale_rel(a,d);T.update_transform(a);U.sync_transform(a);break;case 30:d=c.current_frame_float-c.start;0>d&&(d=0);d>=c.length&&(d=c.length);a=Math.floor(d);
b=a+1;d-=a;10!=c.behavior&&b==c.length&&(b=--a,d=1);c=c.va_frame_offset;ea[0]=a+c;ea[1]=b+c;ea[2]=d;d=ea;e.va_frame=d[0];e.va_frame_factor=d[2];break;case 40:d=h(c);b=d[0];e=d[1];d=d[2];c.volume&&aa.set_volume(a,(1-d)*c.volume[b]+d*c.volume[e]);c.pitch&&aa.playrate(a,(1-d)*c.pitch[b]+d*c.pitch[e]);break;case 50:b=f/W.get_framerate();Y.set_time(a,c.animation_name,b);break;case 60:d=h(c);b=d[0];e=d[1];d=d[2];l=c.nodemat_values;m=c.node_value_inds;f=c.nodemat_rgbs;k=c.node_rgb_inds;for(c=0;c<m.length;c++)n=
l[c],g=m[c],a.render.mats_values[g]=(1-d)*n[b]+d*n[e];for(c=0;c<k.length;c++)m=f[c],g=k[c],l=m.subarray(3*b,3*b+3),m=m.subarray(3*e,3*e+3),l=pa.lerp(l,m,d,qa),a.render.mats_rgbs[3*g]=l[0],a.render.mats_rgbs[3*g+1]=l[1],a.render.mats_rgbs[3*g+2]=l[2];break;case 70:d=h(c);b=d[0];e=d[1];d=d[2];k=c.channels_mask;(f=c.energy)&&k[0]&&ka.set_light_energy(a.light,(1-d)*f[b]+d*f[e]);(c=c.color)&&k[1]&&(qa[0]=(1-d)*c[3*b]+d*c[3*e],qa[1]=(1-d)*c[3*b+1]+d*c[3*e+1],qa[2]=(1-d)*c[3*b+2]+d*c[3*e+2],ka.set_light_color(a.light,
qa));b=a.scenes_data;for(c=0;c<b.length;c++)J.update_lamp_scene_color_intensity(a,b[c].scene);break;default:ba.panic("Unknown animation type:"+l)}}}function h(a){var b=a.action_frame_range[0],c=a.action_frame_range[1]-b,b=a.current_frame_float-b;0>b&&(b=0);b>=c&&(b=c);b/=a.action_step;c=Math.floor(b);a=a.action_bflags[c]?b-c:0;b=Math.ceil(c+a);ea[0]=c;ea[1]=b;ea[2]=a;return ea}function x(a,b){var c=a.render,d=c.anim_mix_factor,e=c.two_last_skeletal_slots,f=e[0],e=e[1];if(-1!=e){if(-1!=f){var k=a.anim_slots[f];
if(k.play||0==b){var g=h(k),l=g[0],m=g[1];c.frame_factor=g[2];var g=k.quats[l],n=k.quats[m],l=k.trans[l],m=k.trans[m]}else d=1}else d=1;e=a.anim_slots[e];if(e.play||0==b){var f=h(e),p=f[0],r=f[1];c.frame_factor=f[2]}else if(-1!=f&&k.play)d=0;else return;f=e.quats[p];k=e.quats[r];p=e.trans[p];r=e.trans[r];if(1==d)c.quats_before.set(f),c.quats_after.set(k),c.trans_before.set(p),c.trans_after.set(r);else if(0==d)c.quats_before.set(g),c.quats_after.set(n),c.trans_before.set(l),c.trans_after.set(m);else{for(e=
0;e<g.length;e+=4){for(var q=H,u=ha,x=0;4>x;x++)q[x]=g[e+x],u[x]=f[e+x];da.slerp(q,u,d,q);for(x=0;4>x;x++)c.quats_before[e+x]=q[x];for(x=0;4>x;x++)q[x]=n[e+x],u[x]=k[e+x];da.slerp(q,u,d,q);for(x=0;4>x;x++)c.quats_after[e+x]=q[x]}ba.blend_arrays(l,p,d,c.trans_before);ba.blend_arrays(m,r,d,c.trans_after)}T.update_transform(a);ga.update_skinned_renders(a)}}function w(a,b){var c=a.render,d=c.anim_mix_factor,e=c.anim_mix_factor_change_speed;if(0!=e){var d=c.anim_destination_mix_factor-d,f=e*b;ba.sign(d)==
ba.sign(e)&&Math.abs(f)<Math.abs(d)?c.anim_mix_factor+=f:(c.anim_mix_factor=c.anim_destination_mix_factor,c.anim_mix_factor_change_speed=0)}}function r(a){var b=[],c=[],d=new Float32Array(4),e=new Float32Array(4),f;for(f in a){var h=a[f],k=d,g=e,l=h.chain,m=l[l.length-1],n=m.tsr_channel_cache;m.tsr_channel_cache_valid||Z.identity(n);for(m=l.length-1;0<=m;m--){var p=l[m],r=p.tsr_channel_cache;if(p.tsr_channel_cache_valid)n=r;else{var q=p.tsr_local_rest,u=p.tsr_basis;Z.invert(q,ca);Z.multiply(u,ca,
ca);Z.multiply(q,ca,ca);Z.multiply(n,ca,r);n=r;p.tsr_channel_cache_valid=!0}}l=p.tsr_channel_cache;k[0]=l[0];k[1]=l[1];k[2]=l[2];k[3]=l[3];g[0]=l[4];g[1]=l[5];g[2]=l[6];g[3]=l[7];da.normalize(g,g);h=h.bone_index;for(k=0;4>k;k++)g=4*h+k,b[g]=d[k],c[g]=e[k]}return{trans:b,quats:c}}function m(a,b,c){var d=[],e=[];new Float32Array(4);new Float32Array(4);for(var f in c)for(var h=c[f],k=h.bone_index,h=h.deform_bone_index,g=0;4>g;g++){var l=4*h+g,m=4*k+g;d[l]=a[m];e[l]=b[m]}d=new Float32Array(d);e=new Float32Array(e);
return{trans:d,quats:e}}function E(a){var b=a._render;if(b.bones)b.type=ua;else if(b.params)if("volume"in b.params||"pitch"in b.params)b.type=ia;else if(D(a))b.type=ja;else{var c;a:{if(a._render.params){a=a.fcurves;for(c in a)if("color"==c&&!a[c][3]){c=!0;break a}if("energy"==c){c=!0;break a}}c=!1}b.type=c?ta:na}else b.type=R}function D(a){if(a=a._render.params)for(var b in a)if(-1!=b.indexOf("nodes"))return!0;return!1}function y(a,b){b[0]=b[1]=b[2]=0;for(var c in a)"location"==c?b[0]=1:"rotation_quaternion"==
c?b[1]=1:"scale"==c&&(b[2]=1)}function M(a,b){b[0]=b[1]=0;for(var c in a)"energy"==c?b[0]=1:"color"==c&&(b[1]=1)}function L(a,b,c,d,e,f,h){var k=a+(b-a)/2,g=N(k,d,e,f,h)-c;return.02>Math.abs(g)?k:0<g?L(a,k,c,d,e,f,h):L(k,b,c,d,e,f,h)}function N(a,b,c,d,e){var f=1-a;return b*f*f*f+3*c*f*f*a+3*d*f*a*a+e*a*a*a}function B(a,b){var c={type:null,animation_name:null,action_frame_range:null,action_step:0,action_bflags:null,channels_mask:new Int8Array(3),quats:null,trans:null,skinning_data:[],play:!1,behavior:20,
current_frame_float:0,start:0,length:0,trans_smooth_period:0,quat_smooth_period:0,exec_finish_callback:!1,va_frame_offset:null,speed:1,volume:null,pitch:null,color:null,energy:null,nodemat_values:[],node_value_inds:[],nodemat_rgbs:[],node_rgb_inds:[]};if(!a.anim_slots.length)for(var d=0;8>d;d++)a.anim_slots.push(null);a.anim_slots[b]=c;-1==xa.indexOf(a)&&xa.push(a)}function O(a,b){T.update_transform(a);U.sync_transform(a);g(a,0,b,!0)}function F(a,d,e){e=e||0;if(z.is_mesh(a)){var f=C(a,d);if(f)return B(a,
e),c(a,f,e),O(a,e),!0;if((f=I(a,d))&&"EMITTER"==f.p_type)return B(a,e),b(a,f.name,e),O(a,e),!0}if(f=ba.keysearch("name",d,Ea)||ba.keysearch("name",d+"_B4W_BAKED",Ea)){B(a,e);if(u(a,f,e))return O(a,e),!0;a.anim_slots[e]=null}P.error('Unsupported object: "'+a.name+'" or animation name: "'+d+'"');return!1}function C(a,b){for(var c=0;c<a.vertex_anim.length;c++){var d=a.vertex_anim[c];if(d.name===b)return d}return null}function I(a,b){for(var c=a.scenes_data,d=0;d<c.length;d++)for(var e=c[d].batches,f=
0;f<e.length;f++){var h=e[f].particles_data;if(h&&h.name===b)return h}return null}function Q(a){a=a.modifiers;for(var b=0;b<a.length;b++){var c=a[b];if("ARMATURE"==c.type)return c.object}return null}var G=t("__config"),z=t("__obj_util"),Y=t("__particles"),U=t("__physics"),P=t("__print"),da=t("__quat"),fa=t("__reformer"),aa=t("__sfx"),W=t("__time"),T=t("__transform"),Z=t("__tsr"),ba=t("__util"),pa=t("__vec3"),ga=t("__armature"),ka=t("__lights"),J=t("__scenes"),V=G.animation,S=G.defaults;a.LAST_FRAME_EPSILON=
1E-6;a.OBJ_ANIM_TYPE_NONE=0;a.OBJ_ANIM_TYPE_ARMATURE=10;a.OBJ_ANIM_TYPE_OBJECT=20;a.OBJ_ANIM_TYPE_VERTEX=30;a.OBJ_ANIM_TYPE_SOUND=40;a.OBJ_ANIM_TYPE_PARTICLES=50;a.OBJ_ANIM_TYPE_MATERIAL=60;a.OBJ_ANIM_TYPE_LIGHT=70;a.SLOT_0=0;a.SLOT_1=1;a.SLOT_2=2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=-1;a.AB_CYCLIC=10;a.AB_FINISH_RESET=20;a.AB_FINISH_STOP=30;var R=a.AT_NONE=0,ua=a.AT_ARMATURE=1,ia=a.AT_SPEAKER=2,na=a.AT_OBJECT=3,ja=a.AT_MATERIAL=4,ta=a.AT_LIGHT=5,ea=Array(3),qa=new Float32Array(3),
Aa=new Float32Array(3),H=new Float32Array(4),ha=new Float32Array(4),oa=new Float32Array(4),ca=Z.create();new Float32Array(16);var xa=[],Ea=[];a.get_max_bones=function(){return ba.trunc((S.max_vertex_uniform_vectors-50)/4)};a.frame_to_sec=function(a){return a/W.get_framerate()};a.update=function(a){for(var b=0;b<xa.length;b++){for(var c=xa[b],d=0;8>d;d++)A(c,a,d);c.render.anim_mixing&&(w(c,a),x(c,a))}for(b=0;b<xa.length;b++)for(c=xa[b],d=0;8>d&&c.anim_slots.length;d++)v(c,d)};a.get_all_actions=function(){return Ea};
a.get_anim_names=function(a){var b=[];if(l(a))for(var c=0;c<a.vertex_anim.length;c++)b.push(a.vertex_anim[c].name);for(var d=[],c=0;c<Ea.length;c++){var f=Ea[c],h=f._render;h.type==na?d.push(f):h.type==ua&&"ARMATURE"==a.type?d.push(f):h.type==ia&&"SPEAKER"==a.type&&d.push(f)}if("MESH"==a.type)for(c=0;c<a.actions.length;c++)f=a.actions[c],f._render.type==ja&&d.push(f);for(c=0;c<d.length;c++)b.push(e(d[c].name));if(Y.obj_has_particles(a)&&Y.obj_has_anim_particles(a))for(a=a.scenes_data,c=0;c<a.length;c++)for(d=
a[c].batches,f=0;f<d.length;f++)(h=d[f].particles_data)&&b.push(h.name);return b};a.strip_baked_suffix=e;a.get_anim_type=function(a,b){var c=a.anim_slots[b];return c?c.type:0};a.apply_def=function(a){for(var d=0,e=a.scenes_data,f=0;f<e.length;f++)for(var h=e[f].batches,k=0;k<h.length;k++){var g=h[k].particles_data;g&&"EMITTER"==g.p_type&&(B(a,d),b(a,g.name,d),O(a,d),a.anim_slots[d].behavior=a.anim_behavior_def,g.cyclic&&(a.anim_slots[d].behavior=10),d++)}e=a.actions.slice();for(f=0;f<e.length;f++)h=
e[f],B(a,d),u(a,h,d)?(O(a,d),a.anim_slots[d].behavior=a.anim_behavior_def,d++):a.anim_slots[d]=null;l(a)&&(B(a,d),c(a,a.vertex_anim[0],d),O(a,d),a.anim_slots[d].behavior=a.anim_behavior_def)};a.anim_behavior_bpy_b4w=function(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:ba.panic("Wrong animation behavior")}};a.get_bpy_material_actions=function(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++){var e=a[c].node_tree;e&&d(e,b)}return b};
a.play=function(a,b,c){q(a.anim_slots,c,function(a){a.play=!0;a.finish_callback=b?b:null;a.exec_finish_callback=!1});a.render.anim_mixing&&f(a)};a.stop=function(a,b){q(a.anim_slots,b,function(a){a.play=!1;a.finish_callback=null;a.exec_finish_callback=!1})};a.is_play=function(a,b){var c=a.anim_slots;if(-1==b)for(var d=0;8>d;d++){if(c[d]&&c[d].play)return!0}else if(c=c[b])return c.play;return!1};a.set_frame=n;a.set_first_frame=function(a,b){b=b||0;q(a.anim_slots,b,function(c){n(a,c.start,b)})};a.get_current_frame_float=
function(a,b){var c=a.anim_slots[b];return c&&c.current_frame_float?c.current_frame_float:0};a.is_cyclic=function(a,b){var c=a.anim_slots[b];return c&&10==c.behavior};a.set_behavior=function(a,b,c){q(a.anim_slots,c,function(a){a.behavior=b})};a.get_behavior=function(a,b){var c=a.anim_slots[b];return c&&c.behavior};a.apply_smoothing=function(a,b,c,d){q(a.anim_slots,d,function(a){a.trans_smooth_period=b||0;a.quat_smooth_period=c||0})};a.remove_slot_animation=function(a,b){if(-1==b)for(var c=0;8>c;c++)a.anim_slots[c]=
null;else a.anim_slots[b]=null;a.render.anim_mixing&&p(a,b)};a.update_object_animation=g;a.obj_is_animatable=function(a){if("ARMATURE"==a.type||a.armobj)return!0;for(var b=0;b<a.actions.length;b++){var c=a.actions[b]._render.type;if(c==na||c==ua||c==ia&&"SPEAKER"==a.type||c==ta&&"LAMP"==a.type||c==ja&&"MESH"==a.type)return!0}return Y.obj_has_particles(a)&&Y.obj_has_anim_particles(a)||"MESH"==a.type&&a.vertex_anim.length?!0:!1};a.bpy_obj_is_animatable=function(a,b){if("ARMATURE"==b.type||Q(a))return!0;
for(var c=0;c<b.actions.length;c++){var d=b.actions[c]._render.type;if(d==na||d==ua||d==ia&&"SPEAKER"==b.type||d==ja&&"MESH"==b.type)return!0}return Y.bpy_obj_has_particles(a)&&Y.bpy_obj_has_anim_particles(a)||"MESH"==b.type&&a.data.b4w_vertex_anim.length?!0:!1};a.is_animated=function(a){return Boolean(a.anim_slots.length)};a.calc_pose_data=r;a.extract_skinned_pose_data=m;a.append_action=function(a){var b=new RegExp(/pose.bones\[\".+\"\]/g),c=Z.create(),d=function(a,d,e,f,h){if(-1<e.search(b)){a=
d;e=e.split('"')[1];var k=c}else 8==h?(e="tsr",k=c):k=1<h?new Float32Array(h):0;if(!a[e]){h=a;d=e;if("object"==typeof k&&k.length)for(var g=k.length,l=new Float32Array(f*g),m=0;m<f;m++)for(var n=0;n<g;n++)l[m*g+n]=k[n];else if("number"==typeof k)for(l=new Float32Array(f),m=0;m<f;m++)l[m]=k;else ba.panic("Wrong storage default value");h[d]=l}return a[e]},e=function(a,b){if(-1<a.indexOf("location"))var c=0,d=b;else-1<a.indexOf("rotation_quaternion")?(c=4,d=0==b?3:b-1):-1<a.indexOf("scale")?(c=3,d=0):
(c=0,d=b);return c+d},f=function(a,b){for(var c=0;c<b;c++){var d=a.subarray(8*c+4,8*c+8);da.normalize(d,d)}},h=a._render={type:R,num_pierced:0,pierce_step:0,params:null,bones:null,bflags:null,channels_mask:new Int8Array(3)};h.pierce_step=1/V.frame_steps;var k=a.fcurves,g={},l={},m=0,n;for(n in k){var p=k[n],r;for(r in p){var q=p[r],u=q._pierced_points;fa.check_anim_fcurve_completeness(q,a);q=q.num_channels;m||(m=u.length);for(var q=d(g,l,n,m,q),x=q.length/m,w=e(n,r|0),t=0;t<m;t++)q[t*x+w]=u[t]}}if(ba.get_dict_length(g)){for(var J in g)"tsr"==
J&&f(g[J],m);h.params=g}if(ba.get_dict_length(l)){for(var z in l)f(l[z],m);h.bones=l}h.num_pierced=m;h.bflags=a._bflags;"tsr"in g&&y(k,h.channels_mask);("color"in g||"energy"in g)&&M(k,h.channels_mask);E(a);Ea.push(a)};a.get_approx_curve_length=function(a,b){return(b-a)*V.frame_steps+1};a.approximate_curve=function(a,b,c,d,e,f){var h,k,g=new Float32Array(2),l=new Float32Array(2),m=new Float32Array(2),n=new Float32Array(2),p=b[1],r=b[2],q=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var u=
0,x=0,w=null;e<=f;e++)if(e<p)for(var t=0;t<V.frame_steps;t++)c[u++]=r;else if(e>q)for(t=0;t<V.frame_steps;t++)c[u++]=a;else{var J=b[x],z=3;0===J&&(z+=2);0===w&&(z+=2);var B=2===J?0:1;if(b[x+1]==b[x+z+1])w=J,x+=z;else{t=0;e==b[x+1]&&(B&&(d[u]=1),c[u]=b[x+2],u++,t++);if(e==q)for(;t<V.frame_steps;t++)c[u++]=a;else for(g[0]=b[x+1],g[1]=b[x+2],0!==J?(l[0]=0,l[1]=0):0===w?(l[0]=b[x+5],l[1]=b[x+6]):(l[0]=b[x+3],l[1]=b[x+4]),0!==J?(m[0]=0,m[1]=0):(m[0]=b[x+z+3],m[1]=b[x+z+4]),n[0]=b[x+z+1],n[1]=b[x+z+2];t<
V.frame_steps;t++){var v=e+t/V.frame_steps;switch(J){case 0:h=g;k=l;var y=m,S=n,G=[],R=[],A=void 0,D=void 0,K=void 0,A=void 0;G[0]=h[0]-k[0];G[1]=h[1]-k[1];R[0]=S[0]-y[0];R[1]=S[1]-y[1];K=S[0]-h[0];A=Math.abs(G[0]);D=Math.abs(R[0]);0!=A+D&&A+D>K&&(A=K/(A+D),k[0]=h[0]-A*G[0],k[1]=h[1]-A*G[1],y[0]=S[0]-A*R[0],y[1]=S[1]-A*R[1]);B&&(d[u]=1);h=u;k=g;y=l;S=m;G=n;v=L(0,1,v,k[0],y[0],S[0],G[0]);v=N(v,k[1],y[1],S[1],G[1]);c[h]=v;u++;break;case 1:k=g[0];y=g[1];h=S=(n[1]-y)/(n[0]-k);k=y-S*k;B&&(d[u]=1);c[u]=
h*v+k;u++;break;case 2:B&&(d[u]=1);c[u]=b[x+2];u++;break;default:ba.panic("Unknown keyframe interpolation mode: "+J)}}e+1==b[x+z+1]&&(w=J,x+=z)}}};a.apply=F;a.apply_by_uuid=function(a,b,c){c=c||0;var d=ba.keysearch("uuid",b,Ea);if(d){B(a,c);if(u(a,d,c))return O(a,c),!0;a.anim_slots[c]=null}P.error('Unsupported object: "'+a.name+'" or animation uuid: "'+b+'"');return!1};a.validate_action_by_name=function(a,b){var c=ba.keysearch("name",b,Ea)||ba.keysearch("name",b+"_B4W_BAKED",Ea);if(c){if(c._render.type==
R)return!1}else if(!(I(a,b)||z.is_mesh(a)&&C(a,b)))return!1;return!0};a.get_slot_num_by_anim=function(a,b){for(var c=a.anim_slots,d=0;d<c.length;d++){var f=c[d];if(f&&e(f.animation_name)==e(b))return d}return-1};a.get_anim_by_slot_num=function(a,b){var c=a.anim_slots[b];return c&&c.animation_name?e(c.animation_name):null};a.remove=function(a){a.anim_slots.length=0;a=xa.indexOf(a);-1!=a&&xa.splice(a,1)};a.remove_actions=function(a){for(var b=Ea.length-1;0<=b;b--)Ea[b]._data_id==a&&Ea.splice(b,1)};
a.apply_to_first_empty_slot=function(a,b){if(!a.anim_slots.length)return F(a,b,0)?0:-1;for(var c=0;c<a.anim_slots.length;c++)if(!a.anim_slots[c])return F(a,b,c)?c:-1};a.set_skel_mix_factor=function(a,b,c){a.render.anim_mix_factor_change_speed=(b-a.render.anim_mix_factor)/c;a.render.anim_destination_mix_factor=b};a.set_speed=function(a,b,c){q(a.anim_slots,c,function(a){a.speed=b})};a.get_speed=function(a,b){return a.anim_slots[b].speed};a.get_anim_start_frame=function(a,b){return a.anim_slots[b].start};
a.get_anim_length=function(a,b){return a.anim_slots[b].length};a.cleanup=function(){xa.length=0;Ea.length=0};a.fcurve_replace_euler_by_quat=function(a){var b=(a[0]||a[1]||a[2])._pierced_points.length,c=H,d=qa,e=Boolean(a[0]);e||(a[0]={_pierced_points:new Float32Array(b),num_channels:8});var f=Boolean(a[1]);f||(a[1]={_pierced_points:new Float32Array(b),num_channels:8});var h=Boolean(a[2]);h||(a[2]={_pierced_points:new Float32Array(b),num_channels:8});a[3]={_pierced_points:new Float32Array(b),num_channels:8};
for(var k=0;k<b;k++)d[0]=e?a[0]._pierced_points[k]:0,d[1]=f?a[1]._pierced_points[k]:0,d[2]=h?a[2]._pierced_points[k]:0,ba.euler_to_quat(d,c),a[0]._pierced_points[k]=c[3],a[1]._pierced_points[k]=c[0],a[2]._pierced_points[k]=c[1],a[3]._pierced_points[k]=c[2]};a.get_bpy_armobj=Q};b4w.module.__time=function(a,t){var v=t("__config");t("__print");t("__util");var c=0,b=0,e=[],d=0,l=0,n=[],q=-1;a.set_timeline=function(a){c=a;b=performance.now();for(a=0;a<e.length;a++){var d=e[a];c>d.expire_time&&(e.splice(a,1),a--,d.callback())}for(a=0;a<n.length;a++){var d=n[a],k=1-(d.expire_time-c)/d.duration,k=Math.min(k,1);d.callback(d.from+k*(d.to-d.from));1==k&&(n.splice(a,1),a--)}};a.get_timeline=function(){return c};a.set_timeout=function(a,l){var k;d++;k=d;var f={id:k,callback:a,expire_time:c+
(performance.now()-b+l)/1E3};e.push(f);return k};a.clear_timeout=function(a){for(var b=0;b<e.length;b++)if(e[b].id==a){e.splice(b,1);break}};a.clear_animation=function(a){for(var b=n.length;b--;)if(n[b].id==a){n.splice(b,1);break}};a.animate=function(a,b,d,e){d/=1E3;var p;l++;p=l;n.push({id:p,callback:e,from:a,to:b,expire_time:c+d,duration:d});e(a);return p};a.reset=function(a){b=c=0;e.length=0;l=d=n.length=0};a.get_framerate=function(){return-1!==v.animation.framerate?v.animation.framerate:q};a.set_framerate=
function(a){q=a}};b4w.module.__transform=function(a,t){function v(a,b){if(g.has_child_of(a)){var c=g.get_child_of_offset(a);D.set_trans(b,c)}else D.set_trans(b,a.render.world_tsr)}function c(a,b){var c=a.render;if(g.has_child_of(a)){D.set_quat(b,c.world_tsr);var d=g.get_child_of_parent_tsr(a),d=D.invert(d,y),e=g.get_child_of_offset(a);D.multiply(d,c.world_tsr,e)}else D.set_quat(b,c.world_tsr)}function b(a,b){if(g.has_child_of(a)){var c=g.get_child_of_offset(a);D.set_quat(b,c)}else D.set_quat(b,a.render.world_tsr)}
function e(a,b){if(g.has_child_of(a)){var c=g.get_child_of_offset(a);D.copy(b,c)}else D.copy(b,a.render.world_tsr)}function d(a,b){if(g.has_child_of(a)){var c=g.get_child_of_offset(a);D.copy(c,b)}else D.copy(a.render.world_tsr,b);return b}function l(a){var b=a.render,c=a.scenes_data,d=a.type;"CAMERA"==d&&q.update_camera_upside_down(a);g.update_constraint(a,L);"CAMERA"==d&&q.update_camera(a);var e=D.get_trans_view(b.world_tsr),m=D.get_quat_view(b.world_tsr);"CAMERA"==d&&D.set_scale(1,b.world_tsr);
b.bb_local&&b.bb_world&&(n.bounding_box_transform(b.bb_local,b.world_tsr,b.bb_world),n.bounding_sphere_transform(b.bs_local,b.world_tsr,b.bs_world),n.bounding_ellipsoid_transform(b.be_local,b.world_tsr,b.be_world));switch(d){case "SPEAKER":K.speaker_update_transform(a,L);break;case "MESH":var w=a.armobj;w&&(D.invert(w.render.world_tsr,y),D.multiply(y,b.world_tsr,y),r.set(y[0],y[1],y[2],y[3],b.arm_rel_trans),f.set(y[4],y[5],y[6],y[7],b.arm_rel_quat));break;case "CAMERA":q.update_camera_transform(a);
if(p.check_active()){var t=p.get_active();p.get_camera(t)==a&&K.listener_update_transform(t,e,m,L)}break;case "LAMP":u.update_light_transform(a)}for(t=0;t<c.length;t++){var z=c[t];if(z.is_active){var w=z.scene,v=w._render,E=z.batches;switch(d){case "LAMP":p.update_lamp_scene(a,w);break;case "CAMERA":p.schedule_grass_map_update(w);v.shadow_params&&v.shadow_params.enable_csm&&p.schedule_shadow_update(w);break;case "MESH":b.bb_local&&b.bb_world&&(b.shadow_cast&&p.schedule_shadow_update(w),v=z.cube_refl_subs,
null!=b.cube_reflection_id&&v&&p.update_cube_reflect_subs(v,e));a.anim_slots.length&&k.obj_has_anim_particles(a)&&k.update_emitter_transform(a,E);break;case "EMPTY":A.update_force(a)}z=z.plane_refl_subs;E=a.reflective_objs;E.length&&z&&(v=z.camera,p.update_plane_reflect_subs(z,e,m),h.update_refl_objects(E,v.reflection_plane),q.set_view(v,p.get_camera(w)),x.extract_frustum_planes(v.view_proj_matrix,v.frustum_planes))}}c=a.cons_descends;for(t=0;t<c.length;t++)l(c[t]);a=a.cons_armat_bone_descends;for(t=
0;t<a.length;t++)c=a[t],w=c[0],g.update_bone_constraint(w,c[1]);b.force_zsort=!0}var n=t("__boundings"),q=t("__camera"),g=t("__constraints"),u=t("__lights");t("__mat3");t("__mat4");var k=t("__particles"),f=t("__quat"),p=t("__scenes"),K=t("__sfx"),D=t("__tsr"),A=t("__objects"),h=t("__obj_util"),x=t("__util"),w=t("__vec3"),r=t("__vec4"),m=new Float32Array(3),E=new Float32Array(4);new Float32Array(9);var y=D.create(),M=D.create(),L=0;a.SPACE_WORLD=0;a.SPACE_LOCAL=1;a.SPACE_PARENT=2;a.update=function(a){L=
a};a.set_translation=function(a,b){var c=a.render;if(g.has_child_of(a)){D.set_trans(b,c.world_tsr);var d=g.get_child_of_parent_tsr(a),d=D.invert(d,y),e=g.get_child_of_offset(a);D.multiply(d,c.world_tsr,e)}else D.set_trans(b,c.world_tsr)};a.set_translation_rel=v;a.get_translation=function(a,b){var c=D.get_trans_view(a.render.world_tsr);w.copy(c,b);return b};a.get_translation_rel=function(a,b){if(g.has_child_of(a)){var c=g.get_child_of_offset(a);w.copy(D.get_trans_view(c),b)}else c=D.get_trans_view(a.render.world_tsr),
w.copy(c,b);return b};a.set_rotation=c;a.set_rotation_rel=b;a.get_rotation=function(a,b){var c=D.get_quat_view(a.render.world_tsr);f.copy(c,b);return b};a.get_rotation_rel=function(a,b){if(g.has_child_of(a)){var c=g.get_child_of_offset(a);f.copy(D.get_quat_view(c),b)}else c=D.get_quat_view(a.render.world_tsr),f.copy(c,b);return b};a.set_rotation_euler=function(a,b){var d=x.euler_to_quat(b,E);c(a,d)};a.set_rotation_euler_rel=function(a,c){var d=x.euler_to_quat(c,E);b(a,d)};a.set_scale=function(a,b){var c=
a.render;if(g.has_child_of(a)){var c=g.get_child_of_offset(a),d=D.get_scale(g.get_child_of_parent_tsr(a));D.set_scale(b/d,c)}else D.set_scale(b,c.world_tsr)};a.set_scale_rel=function(a,b){var c=a.render;g.has_child_of(a)?(c=g.get_child_of_offset(a),D.set_scale(b,c)):D.set_scale(b,c.world_tsr)};a.get_scale=function(a){return D.get_scale(a.render.world_tsr)};a.get_scale_rel=function(a){return g.has_child_of(a)?(a=g.get_child_of_offset(a),D.get_scale(a)):D.get_scale(a.render.world_tsr)};a.set_tsr=function(a,
b){var c=a.render;if(g.has_child_of(a)){D.set_trans(trans,c.world_tsr);var d=g.get_child_of_parent_tsr(a),d=D.invert(d,y),e=g.get_child_of_offset(a);D.multiply(d,c.world_tsr,e)}else D.copy(b,c.world_tsr)};a.set_tsr_rel=e;a.get_tsr=function(a,b){return D.copy(a.render.world_tsr,b)};a.get_tsr_rel=d;a.get_object_size=function(a){var b=a.render;a=b.bb_original;var c=D.get_scale(b.world_tsr),b=c*(a.max_x-a.min_x),d=c*(a.max_y-a.min_y);a=c*(a.max_z-a.min_z);return.5*Math.sqrt(b*b+d*d+a*a)};a.get_object_center=
function(a,b,c){c||(c=new Float32Array(3));b?(a=a.render,w.copy(a.bs_world.center,c)):(a=a.render,b=a.bb_original,c[0]=(b.max_x+b.min_x)/2,c[1]=(b.max_y+b.min_y)/2,c[2]=(b.max_z+b.min_z)/2,D.transform_vec3(c,a.world_tsr,c));return c};a.move_local=function(a,b,c,e){var f=d(a,y);m[0]=b;m[1]=c;m[2]=e;D.transform_vec3(m,f,m);v(a,m)};a.rotate_local=function(a,b){var c=d(a,y),f=D.set_quat(b,D.identity(M));D.multiply(c,f,f);e(a,f)};a.update_transform=l;a.distance=function(a,b){var c=D.get_trans_view(a.render.world_tsr),
d=D.get_trans_view(b.render.world_tsr);return w.dist(c,d)};a.obj_point_distance=function(a,b){var c=D.get_trans_view(a.render.world_tsr);return w.dist(c,b)};a.get_object_bounding_box=function(a){return{max_x:a.render.bb_world.max_x,min_x:a.render.bb_world.min_x,max_y:a.render.bb_world.max_y,min_y:a.render.bb_world.min_y,max_z:a.render.bb_world.max_z,min_z:a.render.bb_world.min_z}}};b4w.module.__tsr=function(a,t){function v(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a}function c(){var a=new Float32Array(9);a[3]=1;a[7]=1;return a}function b(a,b,c,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=b;d[4]=c[0];d[5]=c[1];d[6]=c[2];d[7]=c[3];return d}function e(a,b,c){var d=b[0],e=b[1],h=b[2],k=b[3],g=b[4],l=b[5],m=b[6];b=b[7];var n=a[0]*k,q=a[1]*k,u=a[2]*k;a=b*n+l*u-m*q;var k=b*q+m*n-g*u,t=b*u+g*q-l*n,n=-g*n-l*q-m*u;c[0]=a*b+n*-g+k*-m-t*-l;c[1]=k*b+n*-l+t*-g-a*-m;c[2]=t*b+n*-m+a*-l-k*-g;
c[0]+=d;c[1]+=e;c[2]+=h;return c}t("__mat3");var d=t("__mat4"),l=t("__quat"),n=t("__util"),q=t("__vec3"),g=new Float32Array(3),u=new Float32Array(4),k=new Float32Array(16);a.create=v;a.from_values=function(a,b,c,d,e,h,k,g){var l=v();l[0]=a;l[1]=b;l[2]=c;l[3]=d;l[4]=e;l[5]=h;l[6]=k;l[7]=g;return l};a.create_ext=c;a.from_values_ext=function(a,b,d,e,k,h,g,l){var n=c();n[0]=a;n[1]=b;n[2]=d;n[3]=e;n[4]=k;n[5]=h;n[6]=g;n[7]=l;return n};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];
b[5]=a[5];b[6]=a[6];b[7]=a[7];return b};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.set_sep=b;a.set_trans=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.set_scale=function(a,b){b[3]=a;return b};a.set_transcale=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.set_quat=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3];return b};a.get_trans_view=function(a){return a.subarray(0,3)};a.get_scale=function(a){return a[3]};a.get_quat_view=
function(a){return a.subarray(4,8)};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var d=a[0],e=a[1],h=a[2];u[0]=a[4];u[1]=a[5];u[2]=a[6];u[3]=a[7];l.invert(u,u);var k=u[0],g=u[1],n=u[2],m=u[3],d=d*c,e=e*c,q=h*c,h=m*d+g*q-n*e,t=m*e+n*d-k*q,v=m*q+k*e-g*d,d=-k*d-g*e-n*q;b[0]=-(h*m+d*-k+t*-n-v*-g);b[1]=-(t*m+d*-g+v*-k-h*-n);b[2]=-(v*m+d*-n+h*-g-t*-k);b[3]=c;b[4]=k;b[5]=g;b[6]=n;b[7]=m;return b};a.to_mat4=function(a,b){var c=a.subarray(0,3),e=a[3],k=a.subarray(4,8);d.fromRotationTranslation(k,
c,b);for(c=0;12>c;c++)b[c]*=e;return b};a.from_mat4=function(a,c){var d=n.matrix_to_trans(a,g),e=n.matrix_to_scale(a),k=n.matrix_to_quat(a,u);b(d,e,k,c);return c};a.multiply=function(a,b,c){e(b,a,c);c[3]=a[3]*b[3];var d=a[4],k=a[5],h=a[6];a=a[7];var g=b[4],l=b[5],n=b[6];b=b[7];c[4]=d*b+a*g+k*n-h*l;c[5]=k*b+a*l+h*g-d*n;c[6]=h*b+a*n+d*l-k*g;c[7]=a*b-d*g-k*l-h*n;return c};a.transform_mat4=function(a,b,c){var e=b.subarray(0,3),g=b[3];b=b.subarray(4,8);e=d.fromRotationTranslation(b,e,k);for(b=0;12>b;b++)e[b]*=
g;d.multiply(e,a,c);return c};a.transform_vec3=e;a.transform_vec3_inv=function(a,b,c){var d=b[3],e=a[0]-b[0],h=a[1]-b[1],k=a[2]-b[2];a=b[4];var g=b[5],l=b[6];b=b[7];var m=a*a+g*g+l*l+b*b,m=m?1/m:0;a=-a*m;g=-g*m;l=-l*m;b*=m;var m=b*e+g*k-l*h,n=b*h+l*e-a*k,q=b*k+a*h-g*e,e=-a*e-g*h-l*k;c[0]=m*b+e*-a+n*-l-q*-g;c[1]=n*b+e*-g+q*-a-m*-l;c[2]=q*b+e*-l+m*-g-n*-a;c[0]/=d;c[1]/=d;c[2]/=d;return c};a.transform_vectors=function(a,b,c,d){d||(d=0);var e=a.length,h=b[0],k=b[1],g=b[2],l=b[3],m=b[4],n=b[5],q=b[6];
b=b[7];for(var u=0;u<e;u+=3){var t=a[u]*l,v=a[u+1]*l,B=a[u+2]*l,O=b*t+n*B-q*v,F=b*v+q*t-m*B,C=b*B+m*v-n*t,t=-m*t-n*v-q*B;c[d+u]=O*b+t*-m+F*-q-C*-n;c[d+u+1]=F*b+t*-n+C*-m-O*-q;c[d+u+2]=C*b+t*-q+O*-n-F*-m;c[d+u]+=h;c[d+u+1]+=k;c[d+u+2]+=g}return c};a.transform_dir_vectors=function(a,b,c,d){d||(d=0);var e=a.length,h=b[3],k=b[4],g=b[5],l=b[6];b=b[7];for(var m=0;m<e;m+=3){var n=a[m]*h,q=a[m+1]*h,u=a[m+2]*h,t=b*n+g*u-l*q,v=b*q+l*n-k*u,B=b*u+k*q-g*n,n=-k*n-g*q-l*u;c[d+m]=t*b+n*-k+v*-l-B*-g;c[d+m+1]=v*b+
n*-g+B*-k-t*-l;c[d+m+2]=B*b+n*-l+t*-g-v*-k}return c};a.transform_dir_vec3=function(a,b,c){var d=b[3],e=b[4],h=b[5],k=b[6];b=b[7];var g=a[0]*d,l=a[1]*d,m=a[2]*d;a=b*g+h*m-k*l;var d=b*l+k*g-e*m,n=b*m+e*l-h*g,g=-e*g-h*l-k*m;c[0]=a*b+g*-e+d*-k-n*-h;c[1]=d*b+g*-h+n*-e-a*-k;c[2]=n*b+g*-k+a*-h-d*-e;return c};a.transform_tangents=function(a,b,c,d){d||(d=0);var e=a.length,h=b[3],k=b[4],g=b[5],l=b[6];b=b[7];for(var m=0;m<e;m+=4){var n=a[m]*h,q=a[m+1]*h,u=a[m+2]*h,t=b*n+g*u-l*q,v=b*q+l*n-k*u,B=b*u+k*q-g*n,n=
-k*n-g*q-l*u;c[d+m]=t*b+n*-k+v*-l-B*-g;c[d+m+1]=v*b+n*-g+B*-k-t*-l;c[d+m+2]=B*b+n*-l+t*-g-v*-k;c[d+m+3]=a[m+3]}return c};a.translate=function(a,b,c){var d=a[3],e=a[4],h=a[5],k=a[6],g=a[7],l=b[0]*d,n=b[1]*d,q=b[2]*d;b=g*l+h*q-k*n;var d=g*n+k*l-e*q,u=g*q+e*n-h*l,l=-e*l-h*n-k*q;c[0]=a[0]+b*g+l*-e+d*-k-u*-h;c[1]=a[1]+d*g+l*-h+u*-e-b*-k;c[2]=a[2]+u*g+l*-k+b*-h-d*-e;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.interpolate=function(a,b,c,d){var e=a.subarray(0,3),h=b.subarray(0,3),k=d.subarray(0,
3);q.lerp(e,h,c,k);e=a[3];d[3]=e+c*(b[3]-e);a=a.subarray(4,8);b=b.subarray(4,8);e=d.subarray(4,8);l.slerp(a,b,c,e);return d};a.extrapolate=function(a,b,c,d){var e=a.subarray(0,3),h=b.subarray(0,3),k=d.subarray(0,3);k[0]=h[0]*(c+1)-e[0]*c;k[1]=h[1]*(c+1)-e[1]*c;k[2]=h[2]*(c+1)-e[2]*c;d[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4,8);b=b.subarray(4,8);e=d.subarray(4,8);e[0]=b[0]*(c+1)-a[0]*c;e[1]=b[1]*(c+1)-a[1]*c;e[2]=b[2]*(c+1)-a[2]*c;e[3]=b[3]*(c+1)-a[3]*c;l.normalize(e,e);return d};a.integrate=function(a,
b,c,d,e){e[0]=a[0]+b*c[0];e[1]=a[1]+b*c[1];e[2]=a[2]+b*c[2];e[3]=a[3];c=d[0];var h=d[1];d=d[2];var k=a[4],g=a[5],l=a[6],n=a[7];e[4]=.5*(c*n+h*l-d*g);e[5]=.5*(h*n+d*k-c*l);e[6]=.5*(d*n+c*g-h*k);e[7]=.5*(-c*k-h*g-d*l);e[4]=a[4]+e[4]*b;e[5]=a[5]+e[5]*b;e[6]=a[6]+e[6]*b;e[7]=a[7]+e[7]*b;a=e[4];b=e[5];c=e[6];h=e[7];a=a*a+b*b+c*c+h*h;0<a&&(a=1/Math.sqrt(a),e[4]*=a,e[5]*=a,e[6]*=a,e[7]*=a)}};b4w.module.__util=function(a,t){function v(a){return 0<a?1:0>a?-1:0}function c(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=Math.sqrt(b*b+c*c+d*d),f=1/f;a[0]=b*f;a[1]=c*f;a[2]=d*f;a[3]=e*f}function b(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function e(a,b){var c=b;switch(typeof a){case "number":return d(a,c);case "string":return l(a,c);case "boolean":return d(a|0,c);case "function":case "undefined":return d(0,c);case "object":if(a){var f=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==
a.byteLength)for(f=0;f<a.length;f++)c=d(a[f],c);else if(f)for(f=0;f<a.length;f++)c=e(a[f],c);else for(var h in a)c=e(a[h],c)}else c=d(0,c)}return c}function d(a,b){var c=b;G[0]=a;c=(c<<5)-c+z[0];c&=c;c=(c<<5)-c+z[1];return c&c}function l(a,b){for(var c=b,d=0;d<a.length;d++)var e=a.charCodeAt(d),c=(c<<5)-c+e,c=c&c;return c}function n(a){return(34*a+1)*a%289}function q(a){return a-Math.floor(a)}function g(a){return u((34*a+5)*a)}function u(a){return a-289*Math.floor(a/289)}function k(a){return a-7*
Math.floor(a/7)}function f(a,b,c){a-=b;c-=b;return b+(a-Math.floor(a/c)*c)}function p(a){return f(a,0,2*Math.PI)}function K(a,b){if(a&&b){var c=a instanceof Array,d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,e=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(c!=b instanceof Array||d!=e)return!1;if(c){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(!D(a[c],b[c]))return!1}else if(d){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{for(var f in a)if(!D(a[f],
b[f]))return!1;for(f in b)if(!(f in a))return!1}return!0}return!(a||b)}function D(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return K(a,b);default:return!0}}function A(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=
c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}var h=t("__mat3"),x=t("__mat4"),w=t("__print"),r=t("__tsr"),m=t("__quat"),E=t("__vec3"),y=t("__vec4"),M=0,L={},N=new Float32Array(3),B=new Float32Array(3),O=new Float32Array(4),F=new Float32Array(4),C=new Float32Array(9),I=new Float32Array(16),Q=new Float32Array(16),G=new Float64Array(1),z=new Uint32Array(G.buffer),Y=new Float32Array([0,0,0]),U=new Float32Array([0,0,0,1]),P=new Float32Array([0,0,0,1,0,0,0,1]),da=new Float32Array([1,1,1]),fa=new Float32Array([1,
0,0]),aa=new Float32Array([0,1,0]),W=new Float32Array([0,0,1]),T=new Float32Array([-1,0,0]),Z=new Float32Array([0,-1,0]),ba=new Float32Array([0,0,-1]),pa=Math.floor(44488.07041494893),ga=[new Float32Array([0,0,-1,0,0,-1,0,0,-1,0,0,0,0,0,0,1]),new Float32Array([0,0,1,0,0,-1,0,0,1,0,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,-1,0,0,0,0,-1,0,0,0,0,1]),new Float32Array([-1,0,0,0,0,-1,0,0,0,0,1,0,0,
0,0,1])];a.VEC3_IDENT=Y;a.QUAT4_IDENT=U;a.TSR8_IDENT=P;a.VEC3_UNIT=da;a.AXIS_X=fa;a.AXIS_Y=aa;a.AXIS_Z=W;a.AXIS_MX=T;a.AXIS_MY=Z;a.AXIS_MZ=ba;a.INV_CUBE_VIEW_MATRS=ga;a.keyfind=function(a,b,c){for(var d=[],e=c.length,f=0;f<e;f++){var h=c[f];h[a]==b&&d.push(h)}return d};a.float32_concat=function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.uint32_concat=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.check_endians=function(){var a=
new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.array_intersect=function(a,b){var c=[],d={},e=b.length,f,h;for(f=0;f<e;f++)d[b[f]]=!0;e=a.length;for(f=0;f<e;f++)h=a[f],h in d&&c.push(h);return c};a.sign=v;a.keycheck=function(a,b,c){for(var d=c.length,e=0;e<d;e++)if(c[e][a]==b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.key2search=function(a,b,c,d,e){for(var f=0;f<e.length;f++){var h=e[f];if(h[a]==
b&&h[c]==d)return h}return null};a.get_index_for_key_value=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==c)return d;return-1};a.append_unique=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.check_uniqueness=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==a[d])return!1;return!0};a.trans_matrix=function(a,b,c,d){d||(d=new Float32Array(16));x.identity(d);d[12]=a;d[13]=b;d[14]=c;return d};var ka=1;a.rand=function(){ka=(69069*ka+5)%Math.pow(2,
32);return Math.round(ka/65536)%32768/32767};a.srand=function(a){ka=a};a.rand_r=function(a){var b=a[0]%pa*48271-3399*Math.floor(a[0]/pa);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.init_rand_r_seed=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.euler_to_quat=function(a,b){b||(b=new Float32Array(4));var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),f=Math.sin(a[1]/2),h=Math.sin(a[2]/2),k=Math.sin(a[0]/2);b[0]=f*h*e+c*d*k;b[1]=f*d*e+c*h*k;b[2]=c*h*e-f*d*k;b[3]=c*d*e-
f*h*k;return b};a.euler_to_rotation_matrix=function(a){var b=h.create(),c=Math.cos(a[0]),d=Math.cos(a[1]),e=Math.cos(a[2]),f=Math.sin(a[0]),k=Math.sin(a[1]);a=Math.sin(a[2]);var g=c*e,l=c*a,n=f*e,m=f*a;b[0]=d*e;b[1]=d*a;b[2]=-k;b[3]=k*n-l;b[4]=k*m+g;b[5]=d*f;b[6]=k*g+m;b[7]=k*l-n;b[8]=d*c;return b};a.quat_to_euler=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],h=c*c,k=d*d,g=e*e,l=c*d+e*f;.499999<l?(b[0]=0,b[1]=2*Math.atan2(c,f),b[2]=Math.PI/2):-.499999>l?(b[0]=0,b[1]=-2*Math.atan2(c,f),b[2]=-Math.PI/
2):(b[0]=Math.atan2(2*c*f-2*d*e,1-2*h-2*g),b[1]=Math.atan2(2*d*f-2*c*e,1-2*k-2*g),b[2]=Math.asin(2*c*d+2*e*f));return b};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));E.transformQuat(b,a,c);return c};a.dir_to_quat=function(a,b,c){c||(c=new Float32Array(4));a=E.normalize(a,N);var d=E.dot(b,a);a=E.cross(b,a,B);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.trans_quat_to_plane=function(a,b,c,d){d||(d=new Float32Array(4));
E.transformQuat(c,b,d);d[3]=-E.dot(a,d);return d};a.dir_ground_proj_angle=function(a){var b=r.get_quat_view(a.render.world_tsr);switch(a.type){case "CAMERA":N[0]=0;N[1]=-1;N[2]=0;E.transformQuat(N,b,N);B[0]=0;B[1]=0;B[2]=-1;break;case "MESH":N[0]=0;N[1]=0;N[2]=1;E.transformQuat(N,b,N);B[0]=0;B[1]=0;B[2]=1;break;case "EMPTY":N[0]=0,N[1]=1,N[2]=0,E.transformQuat(N,b,N),B[0]=0,B[1]=1,B[2]=0}N[1]=0;E.normalize(N,N);a=E.dot(N,B);b=0<-N[0]*B[2]?-1:1;return Math.acos(a)*b};a.blend_arrays=function(a,b,c,
d){if(0==c)return a;d=d||[];for(var e=0;e<a.length;e++)d[e]=(1-c)*a[e]+c*b[e];return d};a.unique_id=function(){M++;return M.toString(16)};a.unique_name=function(a){L[a]||(L[a]=0);var b=a+L[a];L[a]++;return b};a.create_empty_va_frame=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.create_empty_submesh=function(a){var b={a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,base_length:0,
indices:null,va_frames:[],va_common:b,shape_keys:[]}};a.clone_object_json=function(a){return JSON.parse(JSON.stringify(a))};a.clone_object_r=function(b){if(!(b instanceof Object))return b;var c;c=b.constructor;switch(c){case Float32Array:case Uint32Array:case Uint16Array:c=new c(b);break;case Array:c=new c(b.length);for(var d=0;d<b.length;d++)c[d]=a.clone_object_r(b[d]);break;default:for(d in c=new c,b)c[d]=a.clone_object_r(b[d])}return c};a.clone_object_nr=function(a){var b=a instanceof Array?[]:
{},c;for(c in a)if(a[c]instanceof Object){var d=a[c].constructor;switch(d){case Float32Array:case Uint32Array:case Uint16Array:b[c]=new d(a[c]);break;case Array:b[c]=a[c].slice(0);break;default:b[c]=a[c]}}else b[c]=a[c];return b};a.matrix_to_quat=function(a,b){b||(b=new Float32Array(4));h.fromMat4(a,C);var c=C[0],d=C[3],e=C[6],f=C[1],k=C[4],g=C[7],l=C[2],n=C[5],q=C[8],c=Math.sqrt(c*c+d*d+e*e)||1,f=Math.sqrt(f*f+k*k+g*g)||1,l=Math.sqrt(l*l+n*n+q*q)||1;C[0]/=c;C[3]/=c;C[6]/=c;C[1]/=f;C[4]/=f;C[7]/=
f;C[2]/=l;C[5]/=l;C[8]/=l;m.fromMat3(C,b);m.normalize(b,b);return b};a.matrix_to_trans=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.matrix_to_scale=function(a){O[0]=.577350269189626;O[1]=.577350269189626;O[2]=.577350269189626;O[3]=0;y.transformMat4(O,a,O);return y.length(O)};a.extract_frustum_planes=function(a,b){var d=b.left,e=b.right,f=b.top,h=b.bottom,k=b.near,g=b.far;d[0]=a[3]+a[0];d[1]=a[7]+a[4];d[2]=a[11]+a[8];d[3]=a[15]+a[12];e[0]=a[3]-a[0];e[1]=a[7]-
a[4];e[2]=a[11]-a[8];e[3]=a[15]-a[12];f[0]=a[3]-a[1];f[1]=a[7]-a[5];f[2]=a[11]-a[9];f[3]=a[15]-a[13];h[0]=a[3]+a[1];h[1]=a[7]+a[5];h[2]=a[11]+a[9];h[3]=a[15]+a[13];k[0]=a[3]+a[2];k[1]=a[7]+a[6];k[2]=a[11]+a[10];k[3]=a[15]+a[14];g[0]=a[3]-a[2];g[1]=a[7]-a[6];g[2]=a[11]-a[10];g[3]=a[15]-a[14];c(d);c(e);c(f);c(h);c(k);c(g);return b};a.sphere_is_out_of_frustum=function(a,c,d){return d<-b(a,c.left)||d<-b(a,c.right)||d<-b(a,c.top)||d<-b(a,c.bottom)||d<-b(a,c.near)||d<-b(a,c.far)?!0:!1};a.ellipsoid_is_out_of_frustum=
function(a,c,d,e,f){h=E.dot(d,c.far);k=E.dot(e,c.far);g=E.dot(f,c.far);h=Math.sqrt(h*h+k*k+g*g);if(h<-b(a,c.near)||h<-b(a,c.far))return!0;var h=E.dot(d,c.left),k=E.dot(e,c.left),g=E.dot(f,c.left);if(Math.sqrt(h*h+k*k+g*g)<-b(a,c.left))return!0;h=E.dot(d,c.right);k=E.dot(e,c.right);g=E.dot(f,c.right);if(Math.sqrt(h*h+k*k+g*g)<-b(a,c.right))return!0;h=E.dot(d,c.top);k=E.dot(e,c.top);g=E.dot(f,c.top);if(Math.sqrt(h*h+k*k+g*g)<-b(a,c.top))return!0;h=E.dot(d,c.bottom);k=E.dot(e,c.bottom);g=E.dot(f,c.bottom);
return Math.sqrt(h*h+k*k+g*g)<-b(a,c.bottom)?!0:!1};a.positions_multiply_matrix=function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=3){var h=a[f],k=a[f+1],g=a[f+2];c[d+f]=b[0]*h+b[4]*k+b[8]*g+b[12];c[d+f+1]=b[1]*h+b[5]*k+b[9]*g+b[13];c[d+f+2]=b[2]*h+b[6]*k+b[10]*g+b[14]}return c};a.vectors_multiply_matrix=function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=3){var h=a[f],k=a[f+1],g=a[f+2];c[d+f]=b[0]*h+b[4]*k+b[8]*g;c[d+f+1]=b[1]*h+b[5]*k+b[9]*g;c[d+f+2]=b[2]*h+b[6]*k+b[10]*g}return c};a.tangents_multiply_matrix=
function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=4){var h=a[f],k=a[f+1],g=a[f+2];c[d+f]=b[0]*h+b[4]*k+b[8]*g;c[d+f+1]=b[1]*h+b[5]*k+b[9]*g;c[d+f+2]=b[2]*h+b[6]*k+b[10]*g;c[d+f+3]=a[f+3]}return c};a.vecdir_multiply_matrix=function(a,b,c){c||(c=new Float32Array(3));O[0]=a[0];O[1]=a[1];O[2]=a[2];O[3]=0;y.transformMat4(O,b,O);c[0]=O[0];c[1]=O[1];c[2]=O[2]};a.flatten=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";
b||(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var f=0;f<d;f++)b[e*d+f]=a[e][f];return b};a.vectorize=function(a,b){b||(b=[]);for(var c=0;c<a.length;c+=3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.binary_search_max=function(b,c,d,e){if(e<d)return d;var f=d+Math.floor((e-d)/2);return b[f]>c?a.binary_search_max(b,c,d,f-1):b[f]<c?a.binary_search_max(b,c,f+1,e):f};a.cmp_arr=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.cmp_arr_float=function(a,
b,c){for(var d=0;d<a.length;d++)if(Math.abs(a[d]-b[d])>c)return!1;return!0};a.scale_mat4=function(a,b,c){c||(c=new Float32Array(16));for(var d=0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.transform_mat4=function(a,b,c,d,e){e||(e=new Float32Array(16));b=x.fromRotationTranslation(c,d,I);x.multiply(b,a,e);return e};a.transform_vec3=function(a,b,c,d,e){e||(e=new Float32Array(3));c=x.fromRotationTranslation(c,d,I);1!==b&&(d=x.identity(Q),b=E.set(b,b,b,N),x.scale(d,
b,d),x.multiply(c,d,c));E.transformMat4(a,c,e);return e};a.transform_vec4=function(a,b,c,d,e){e||(e=new Float32Array(4));b=x.fromRotationTranslation(c,d,I);y.transformMat4(a,b,e);return e};a.inverse_transform_vec3=function(a,b,c,d,e){e||(e=new Float32Array(3));b=x.fromRotationTranslation(c,d,I);x.invert(b,b);E.transformMat4(a,b,e);return e};a.transcale_quat_to_matrix=function(a,b,c){c||(c=new Float32Array(16));x.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.matrix_to_transcale_quat=
function(b,c,d){a.matrix_to_trans(b,c);c[3]=a.matrix_to_scale(b);a.matrix_to_quat(b,d)};a.array_stringify=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.rotate_point_pivot=function(a,b,c,d){d||(d=new Float32Array(3));E.subtract(b,a,N);E.transformQuat(N,c,N);E.subtract(b,N,d)};a.generate_cubemap_matrices=function(){N[0]=0;N[1]=0;N[2]=0;var a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16);
x.lookAt(N,[-1,0,0],[0,-1,0],a);x.scale(a,[-1,1,1],a);x.scale(a,[-1,1,-1],b);x.lookAt(N,[0,-1,0],[0,0,-1],c);x.scale(c,[1,1,-1],c);x.scale(c,[1,-1,-1],d);x.lookAt(N,[0,0,-1],[0,-1,0],e);x.scale(e,[-1,1,1],e);x.scale(e,[-1,1,-1],f);return[a,b,c,d,e,f]};a.generate_inv_cubemap_matrices=function(){N[0]=0;N[1]=0;N[2]=0;var a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16);x.lookAt(N,[1,0,0],[0,-1,0],a);x.scale(a,[-1,
1,-1],b);x.lookAt(N,[0,1,0],[0,0,1],c);x.scale(c,[1,-1,-1],d);x.lookAt(N,[0,0,1],[0,-1,0],e);x.scale(e,[-1,1,-1],f);return[a,b,c,d,e,f]};a.calc_variable_id=function(a,b){return e(a,b)};a.hash_code=e;a.hash_code_string=l;a.mat4_translate=function(a,b,c){var d=b[0],e=b[1];b=b[2];var f,h,k,g,l,n,m,q,r,p,u,t;if(!c||a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;f=a[0];h=a[1];k=a[2];g=a[3];l=a[4];n=a[5];
m=a[6];q=a[7];r=a[8];p=a[9];u=a[10];t=a[11];c[0]=f;c[1]=h;c[2]=k;c[3]=g;c[4]=l;c[5]=n;c[6]=m;c[7]=q;c[8]=r;c[9]=p;c[10]=u;c[11]=t;c[12]=f*d+l*e+r*b+a[12];c[13]=h*d+n*e+p*b+a[13];c[14]=k*d+m*e+u*b+a[14];c[15]=g*d+q*e+t*b+a[15];return c};a.mat3_to_mat4=function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.quat_to_angle_axis=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<
c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.rad=function(a){return a*Math.PI/180};a.deg=function(a){return 180*a/Math.PI};a.snoise=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],c=Math.floor(a[0]+b),d=Math.floor(a[1]+b),e=.211324865405187*c+.211324865405187*d,b=a[0]-c+e;a=a[1]-d+e;var f=b>a?1:0,h=1-f,e=b+.211324865405187-f,k=a+.211324865405187-
h,g=b+-.577350269189626,l=a+-.577350269189626,c=c%289,d=d%289,m=n(n(d)+c),h=n(n(d+h)+c+f),r=n(n(d+1)+c+1),c=Math.max(.5-(b*b+a*a),0),d=Math.max(.5-(e*e+k*k),0),f=Math.max(.5-(g*g+l*l),0),c=c*c*c*c,d=d*d*d*d,f=f*f*f*f,p=2*q(.024390243902439*m)-1,u=2*q(.024390243902439*h)-1,t=2*q(.024390243902439*r)-1,m=Math.abs(p)-.5,h=Math.abs(u)-.5,r=Math.abs(t)-.5,p=p-Math.floor(p+.5),u=u-Math.floor(u+.5),t=t-Math.floor(t+.5);return 130*(c*(1.79284291400159-.85373472095314*(p*p+m*m))*(p*b+m*a)+d*(1.79284291400159-
.85373472095314*(u*u+h*h))*(u*e+h*k)+f*(1.79284291400159-.85373472095314*(t*t+r*r))*(t*g+r*l))};a.cellular2x2=function(a){var b=1/7,c=b/2,d=u(Math.floor(a[0])),e=u(Math.floor(a[1])),f=q(a[0]);a=q(a[1]);var h=f-.5,l=f-1.5,f=a-.5;a-=1.5;var n=g(d),d=g(d+1),m=n,r=d,n=g(n+e),d=g(d+e),m=g(m+e+1),r=g(r+e+1),p=k(n)*b+c,t=k(d)*b+c,x=k(m)*b+c,e=k(r)*b+c,n=k(Math.floor(n*b))*b+c,d=k(Math.floor(d*b))*b+c,m=k(Math.floor(m*b))*b+c,b=k(Math.floor(r*b))*b+c,c=h+.7*p,t=l+.7*t,h=h+.7*x,l=l+.7*e,e=f+.7*n,f=f+.7*d,
n=a+.7*m;a+=.7*b;return Math.min(c*c+e*e,t*t+f*f,h*h+n*n,l*l+a*a)};a.quat_project=function(a,b,c,d,e){e||(e=new Float32Array(4));a=E.transformQuat(b,a,N);b=c[0];var f=c[1];c=c[2];C[0]=f*f+c*c;C[1]=-f*b;C[2]=-c*b;C[3]=-b*f;C[4]=b*b+c*c;C[5]=-c*f;C[6]=-b*c;C[7]=-f*c;C[8]=b*b+f*f;E.transformMat3(a,C,a);E.normalize(a,a);m.rotationTo(d,a,e);return e};a.cam_quat_to_mesh_quat=function(a,b){b||(b=new Float32Array(4));var c=O,d=F,c=m.setAxisAngle([0,1,0],Math.PI,m.create()),d=m.setAxisAngle([1,0,0],Math.PI/
2,m.create());m.multiply(c,d,c);m.multiply(a,c,b);return b};a.cleanup=function(){M=0;L={}};a.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);for(d=0;d<e.length;d++)e[d]=(1-c)*a[d]+c*b[d];return e};a.smooth_q=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);m.slerp(a,b,c,e);return e};a.is_arr_buf_view=function(a){return"object"===
typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?!0:!1};a.is_vector=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=h.fromQuat(a,C);B[0]=0;B[1]=1;B[2]=0;N[0]=c[3];N[1]=c[4];N[2]=c[5];var d=E.cross(B,N,N);E.normalize(d,d);var e=c[7];!b&&0<e&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);B[0]=c[0];B[1]=c[1];B[2]=c[2];E.normalize(B,B);m.rotationTo(B,d,F);m.multiply(F,a,a)};a.get_array_smooth_value=function(a,
b,c,d){c=c*b-.5;var e=d*b-.5;d=c-Math.floor(c);var f=e-Math.floor(e);c=Math.floor(c);var e=Math.floor(e),h=b-1,k=a[e*b+c],g=a[e*b+Math.min(c+1,h)],l=a[Math.min(e+1,h)*b+c];a=a[Math.min(e+1,h)*b+Math.min(c+1,h)];return(k*(1-d)+g*d)*(1-f)+(l*(1-d)+a*d)*f};a.rgb_mask_get_channels_count=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.rgb_mask_get_channels_presence=function(a){for(var b=[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.rgb_mask_get_channel_presence_index=function(a,
b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<(a&2)&&c++;return c};a.gen_uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.get_dict_length=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};a.random_from_array=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.xz_direction=function(a,b,c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=
0;c[2]=a[2]-b[2];E.normalize(c,c)};a.transformQuatFast=function(a,b,c){var d=a[0],e=a[1];a=a[2];var f=b[0],h=b[1],k=b[2];b=b[3];var g=h*a-k*e,l=k*d-f*a,n=f*e-h*d,m=h*n-k*l,k=k*g-f*n,f=f*l-h*g;c[0]=d+2*g*b+2*m;c[1]=e+2*l*b+2*k;c[2]=a+2*n*b+2*f;return c};a.assert=function(a){if(!a)throw Error("Assertion failed");};a.panic=function(a){a&&w.error.apply(w,arguments);throw"engine panic:\nThe engine tried to perform an invalid operation and halted.\nPlease copy the console contents above and submit it to the Blend4Web forum at\nhttps://www.blend4web.com/en/forums/forum/17/";
};a.angle_wrap_periodic=f;a.angle_wrap_0_2pi=p;a.get_file_extension=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};a.strict_objs_is_equal=function(a,b){for(var c in a){var d=!0,e=a[c],f=b[c];switch(typeof e){case "number":case "string":case "boolean":d=e==f;break;case "object":d=K(e,f)}if(!d)return!1}return!0};a.quat_bpy_b4w=function(a,b){var c=a[0],d=a[2],e=a[3];b[0]=a[1];b[1]=d;b[2]=e;b[3]=c;return b};a.gen_color_id=function(a){a+=1;132651<a&&w.error("Color ID pool depleted");var b=Math.floor(a/
2601);a%=2601;var c=Math.floor(a/51);return new Float32Array([b/51,c/51,a%51/51])};a.line_plane_intersect=function(a,b,c,d,e){O.set(a);O[3]=b;F.set(d);F[3]=0;a=y.dot(O,F);if(0==a)return null;F.set(c);F[3]=1;a=-y.dot(O,F)/a;e[0]=c[0]+a*d[0];e[1]=c[1]+a*d[1];e[2]=c[2]+a*d[2];return e};a.get_plane_normal=function(a,b,c,d){var e=b[0]-a[0],f=c[0]-a[0],h=b[1]-a[1],k=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];d[0]=h*a-b*k;d[1]=f*b-e*a;d[2]=e*k-h*f;return d};a.copy_array=function(a,b){for(var c=0;c<a.length;c++)b[c]=
a[c];return b};a.rotation_to_stable=function(a,b,c){var d=E.dot(a,b);-.9999999>d?(E.cross(fa,a,N),1E-6>E.length(N)&&E.cross(aa,a,N),E.normalize(N,N),m.setAxisAngle(N,Math.PI,c)):(E.cross(a,b,N),c.set(N),c[3]=1+d,m.normalize(c,c));return c};a.calc_returning_angle=function(a,b,c){if(b==c)return c-a;a=p(a);b=p(b);c=p(c);var d=Math.abs(b-c);if(.001>d||.001>Math.abs(d-2*Math.PI))return 0;b=2*Math.PI-b;c=p(c+b);a=p(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0};a.smooth_step=function(a,b,c){isFinite(b)&&
isFinite(c)&&(a=clamp(a,b,c));return a*a*(3-2*a)};a.lerp=function(a,b,c){return b+a*(c-b)};a.arrays_have_common=function(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++)if(b[d]==a[c])return!0;return!1};a.create_zero_array=function(a){for(var b=Array(a),c=0;c<a;c++)b[c]=0;return b};a.version_cmp=function(a,b){for(var c=Math.max(a.length,b.length),d=0;d<c;d++){var e=v((d>=a.length?0:a[d])-(d>=b.length?0:b[d]));if(e)return e}return 0};a.version_to_str=function(a){return a.join(".")};a.str_to_version=
function(a){return a.split(".").map(function(a){return a|0})};a.srgb_to_lin=function(a,b){b[0]=Math.pow(a[0],2.2);b[1]=Math.pow(a[1],2.2);b[2]=Math.pow(a[2],2.2);return b};a.lin_to_srgb=function(a,b){b[0]=Math.pow(a[0],1/2.2);b[1]=Math.pow(a[1],1/2.2);b[2]=Math.pow(a[2],1/2.2);return b};a.normpath_preserve_protocol=function(a){var b=a.split("://",2);return 1<b.length?(b[1]=A(b[1]),b.join("://")):A(a)};a.check_npot=function(a){return 0!=parseInt(a.toString(2).substr(1),2)}};b4w.module.__sfx=function(a,t){function v(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;A.warn("deprecated WebAudio implementation");return null}A.warn("WebAudio is not supported");return null}function c(a,c,e){var f=a.sfx;if("NONE"!=f.behavior){var k=f.loop,g=f.pitch;if(f.src&&(k||0<=e)){f.base_seed=Math.floor(5E4*Math.random());var m=O.currentTime+c;f.start_time=m;f.state=20;b(a);"POSITIONAL"==f.behavior||"BACKGROUND_SOUND"==f.behavior?(c=O.createBufferSource(),
c.buffer=f.src,c.playbackRate.value=g,c.onended=function(){f.state=50},k?(f.source_node&&f.source_node.disconnect(),c.loop=!0,c.start(m),f.duration=0):(k=c.buffer?c.buffer.duration:0,e>k?(k=m+e+f.fade_out,c.loop=!0,c.start(m),c.stop(k),f.duration=e):(c.loop=!1,c.start(m),f.duration=k)),c.connect(f.proc_chain_in),f.source_node=c,d(f),l(f)):"BACKGROUND_MUSIC"==f.behavior&&(h.clear_timeout(f.bgm_start_timeout),h.clear_timeout(f.bgm_stop_timeout),e=function(){var b=a.sfx,c=b.src;c&&(c.volume=1,c.loop=
b.loop,b.source_node=b.source_node||O.createMediaElementSource(c),b.source_node.connect(b.proc_chain_in),20==b.state&&(c.currentTime&&(c.currentTime=0),c.play()))},0==c?e():f.bgm_start_timeout=h.set_timeout(e,1E3*c),k?f.duration=0:(e=K(a),f.duration=e));n(f,m)}}}function b(a){var b=a.sfx;if(!b.proc_chain_in){var c=x.get_trans_view(a.render.world_tsr);a=x.get_quat_view(a.render.world_tsr);if(E.mix_mode){var d=O.createBiquadFilter();d.type="peaking"}else d=null;var e=O.createGain();switch(b.behavior){case "POSITIONAL":var f=
O.createPanner();"string"!=typeof f.panningModel?(f.panningModel=f.EQUALPOWER,f.distanceModel=f.INVERSE_DISTANCE):(f.panningModel="equalpower",f.distanceModel="inverse");f.setPosition(c[0],c[1],c[2]);r.copy(c,b.last_position);c=y;w.quat_to_dir(a,w.AXIS_MY,c);f.setOrientation(c[0],c[1],c[2]);r.copy(c,b.direction);f.refDistance=b.dist_ref;f.maxDistance=b.dist_max;f.rolloffFactor=b.attenuation;f.coneInnerAngle=b.cone_angle_inner;f.coneOuterAngle=b.cone_angle_outer;f.coneOuterGain=b.cone_volume_outer;
var h=O.createGain();h.gain.value=p(b);d?(f.connect(d),d.connect(h)):f.connect(h);h.connect(e);b.proc_chain_in=f;if(b.volume_random){var k=O.createGain();e.connect(k);k.connect(O?F._sfx.proc_chain_in:null)}else k=null,e.connect(O?F._sfx.proc_chain_in:null);break;case "BACKGROUND_SOUND":f=null;h=O.createGain();h.gain.value=p(b);d?(b.proc_chain_in=d,d.connect(h)):b.proc_chain_in=h;h.connect(e);b.volume_random?(k=O.createGain(),e.connect(k),k.connect(O?F._sfx.proc_chain_in:null)):(k=null,e.connect(O?
F._sfx.proc_chain_in:null));break;case "BACKGROUND_MUSIC":k=f=null,h=O.createGain(),h.gain.value=p(b),d?(b.proc_chain_in=d,d.connect(h)):b.proc_chain_in=h,h.connect(e),e.connect(O?F._sfx.proc_chain_in:null)}b.panner_node=f;b.filter_node=d;b.gain_node=h;b.fade_gain_node=e;b.rand_gain_node=k}}function e(a){var b=a.sfx,d=b.duration,b=b.delay+b.delay_random*Math.random();c(a,b,d)}function d(a){a.volume_random&&a.rand_gain_node.gain.cancelScheduledValues(a.start_time);a.pitch_random&&a.source_node.playbackRate.cancelScheduledValues(a.start_time);
a.vp_rand_end_time=a.start_time}function l(a){if(a.volume_random||a.pitch_random){var b=a.rand_gain_node,c=a.source_node,d=c.buffer?c.buffer.duration:0;if(d){var e=a.start_time;I[0]=a.base_seed;for(var f=0;5>f;){var h=a.pitch+a.pitch_random*w.rand_r(I);if(e>=a.vp_rand_end_time){if(a.volume_random){var k=1-w.clamp(a.volume_random,0,1)*Math.random();b.gain.setValueAtTime(k,e)}a.pitch_random&&c.playbackRate.setValueAtTime(h,e);f++}e+=d/h}a.vp_rand_end_time=e-.001}}}function n(a,b){if(a.fade_in||a.fade_out){var c=
a.fade_gain_node;c.gain.cancelScheduledValues(b);a.fade_in?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.fade_in)):c.gain.setValueAtTime(1,b);a.fade_out&&!a.loop&&(c.gain.setValueAtTime(1,b+a.duration),c.gain.linearRampToValueAtTime(0,b+a.duration+a.fade_out))}}function q(a){if("SPEAKER"!=a.type)throw"Wrong object type";var b=a.sfx;if(50==b.state)b.state=30;else if(20==b.state||40==b.state){var c=b.fade_gain_node,d=O.currentTime;b.fade_out&&(c.gain.setValueAtTime(c.gain.value,d),
c.gain.linearRampToValueAtTime(0,d+b.fade_out));"BACKGROUND_MUSIC"==b.behavior?b.src&&(h.clear_timeout(b.bgm_start_timeout),h.clear_timeout(b.bgm_stop_timeout),b.bgm_stop_timeout=h.set_timeout(function(){var b=a.sfx.src;b&&(b.currentTime&&(b.currentTime=0),b.pause())},1E3*b.fade_out)):(c=b.source_node,b.duration<c.buffer.duration?b.fade_out&&20==b.state?c.stop(d+b.fade_out):20==b.state&&(c.stop(0),c.disconnect()):c.disconnect(),b.start_time=0,b.pause_time=0,b.buf_offset=0);b.state=30}}function g(a){a=
a.sfx;if(20==a.state){var b=O.currentTime;a.pause_time=b;if("BACKGROUND_MUSIC"==a.behavior){var c=a.src;c&&c.pause()}else{if(b>a.start_time){I[0]=a.base_seed;for(var e=a.source_node.buffer.duration,f=a.start_time;f<b;)c=a.pitch+a.pitch_random*w.rand_r(I),f+=e/c;a.buf_offset=(e/c-(f-b))*c}else a.buf_offset=0;a.source_node.stop(0);a.source_node.disconnect();d(a)}a.state=40}}function u(a){var b=a.sfx;if(40==b.state){var c=O.currentTime;b.start_time+=c-b.pause_time;"BACKGROUND_MUSIC"==b.behavior?b.src.play():
(k(a),b.vp_rand_end_time=c,a=b.source_node,a.onended=function(){b.state=50},a.start(b.start_time,b.buf_offset),l(b));n(b,b.start_time);b.state=20}}function k(a){a=a.sfx;var b=O.createBufferSource();b.loop=a.source_node.loop;b.buffer=a.source_node.buffer;b.playbackRate.value=a.source_node.playbackRate.value;a.panner_node?b.connect(a.panner_node):b.connect(a.gain_node);a.source_node=b}function f(a){a=a.sfx;return!a||20!=a.state&&40!=a.state&&30!=a.state&&50!=a.state?!1:!0}function p(a){return a.muted?
0:a.volume}function K(a){a=a.sfx;return(a=a.src)?a.duration:0}var D=t("__config"),A=t("__print"),h=t("__time"),x=t("__tsr"),w=t("__util"),r=t("__vec3"),m=D.defaults,E=D.sfx;a.AST_NONE=10;a.AST_ARRAY_BUFFER=20;a.AST_HTML_ELEMENT=30;var y=new Float32Array(3),M=new Float32Array(3),L=new Float32Array(3),N=[],B=[],O=null,F=null,C=[],I=[1],Q=null;a.create_sfx=function(){return{uuid:-1,filepath:"",behavior:"NONE",disable_doppler:!1,muted:!1,volume:1,pitch:1,attenuation:1,dist_ref:1,dist_max:1E4,cone_angle_inner:360,
cone_angle_outer:360,cone_volume_outer:1,cyclic:!1,loop:!1,delay:0,delay_random:0,volume_random:0,pitch_random:0,fade_in:0,fade_out:0,start_time:0,pause_time:0,buf_offset:0,duration:0,vp_rand_end_time:0,base_seed:1,src:null,state:10,last_position:new Float32Array(3),direction:new Float32Array(3),speed_avg:new Float32Array(3),bgm_start_timeout:-1,bgm_stop_timeout:-1,duck_time:0}};a.init=function(){var a=document.createElement("audio"),b=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&
(N.push("ogg"),N.push("ogv")),""!=a.canPlayType("audio/mpeg")&&N.push("mp3"),""!=a.canPlayType("audio/mp4")&&(N.push("mp4"),N.push("m4v")),""!=a.canPlayType("audio/webm")&&N.push("webm"));b.canPlayType&&(""!=b.canPlayType("video/ogg")&&B.push("ogv"),""!=b.canPlayType("video/mp4")&&B.push("m4v"),""!=b.canPlayType("video/webm")&&B.push("webm"));(O=E.webaudio?v():null)&&A.log("%cINIT WEBAUDIO: "+O.sampleRate+"Hz","color: #00a")};a.attach_scene_sfx=function(a){var b={listener_last_eye:new Float32Array(3),
listener_direction:new Float32Array(3),listener_speed_avg:new Float32Array(3)};a._sfx=b;if(O){var c=O.createGain(),d=O.createGain();b.gain_node=c;b.fade_gain_node=d;c.connect(d);d.connect(O.destination);if(a.b4w_enable_dynamic_compressor){var d=O.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;d.threshold.value=e.threshold;d.knee.value=e.knee;d.ratio.value=e.ratio;d.attack.value=e.attack;d.release.value=e.release;d.connect(c);b.compressor_node=d;b.proc_chain_in=d}else b.compressor_node=
null,b.proc_chain_in=c;c=O.listener;b.disable_doppler=m.disable_doppler_hack;b.disable_doppler||(c.dopplerFactor=a.audio_doppler_factor,c.speedOfSound=a.audio_doppler_speed);b.muted=!1;b.volume=1;b.duck_time=0}};a.set_active_scene=function(a){F=a};a.detect_audio_container=function(a){a||(a="ogg");return-1<N.indexOf(a)?a:"ogg"==a&&-1<N.indexOf("mp4")?"mp4":"mp3"==a&&-1<N.indexOf("ogg")?"ogg":"mp4"==a&&-1<N.indexOf("ogg")?"ogg":"ogv"==a&&-1<N.indexOf("m4v")?"m4v":"webm"==a&&-1<N.indexOf("m4v")?"m4v":
"m4v"==a&&-1<N.indexOf("webm")?"webm":""};a.detect_video_container=function(a){a||(a="webm");return-1<B.indexOf(a)?a:"ogv"==a&&-1<B.indexOf("m4v")?"m4v":"webm"==a&&-1<B.indexOf("m4v")?"m4v":"m4v"==a&&-1<B.indexOf("webm")?"webm":""};a.update_object=function(a,b){var c=a.data,d=b.sfx;d.uuid=a.data.sound.uuid;d.filepath=a.data.sound.filepath;switch(c.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":d.behavior=O?c.b4w_behavior:"NONE";break;case "BACKGROUND_MUSIC":var e;O?(window.MediaElementAudioSourceNode?
e=!0:(A.warn("MediaElementAudioSourceNode not found"),e=!1),e=e?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):e="NONE";d.behavior=e;break;default:throw"Wrong speaker behavior";}c.sound||(d.behavior="NONE");d.disable_doppler=c.b4w_disable_doppler||m.disable_doppler_hack;d.muted=c.muted;d.volume=c.volume;d.pitch=c.pitch;d.attenuation=c.attenuation;d.dist_ref=c.distance_reference;d.dist_max=c.distance_max||1E4;d.cone_angle_inner=c.cone_angle_inner;d.cone_angle_outer=c.cone_angle_outer;d.cone_volume_outer=c.cone_volume_outer;
d.cyclic=c.b4w_cyclic_play;d.loop=c.b4w_loop;d.delay=c.b4w_delay;d.delay_random=c.b4w_delay_random;d.volume_random=c.b4w_volume_random;d.pitch_random=c.b4w_pitch_random;d.fade_in=c.b4w_fade_in;d.fade_out=c.b4w_fade_out;C.push(b)};a.source_type=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";switch(b.sfx.behavior){case "POSITIONAL":return a.AST_ARRAY_BUFFER;case "BACKGROUND_SOUND":return a.AST_ARRAY_BUFFER;case "BACKGROUND_MUSIC":return a.AST_HTML_ELEMENT;case "NONE":return a.AST_NONE;default:throw"Wrong speaker behavior";
}};a.update_spkobj=function(a,b){var c=a.sfx;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.play_empty_sound=function(){var a=O.createBufferSource();a.buffer=O.createBuffer(1,22050,22050);a.connect(O.destination);a.start(0)};a.decode_audio_data=function(a,b,c){O?O.decodeAudioData(a,b,c):c()};a.speaker_remove=function(a){q(a);a.sfx=null;C.splice(C.indexOf(a),1)};a.cleanup=function(){for(var a=
0;a<C.length;a++){var b=C[a].sfx;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():b.source_node&&b.source_node.disconnect()}F&&F._sfx&&(a=F._sfx,a.listener_last_eye[0]=0,a.listener_last_eye[1]=0,a.listener_last_eye[2]=0,a.listener_speed_avg[0]=0,a.listener_speed_avg[1]=0,a.listener_speed_avg[2]=0);F=null;C.splice(0);Q=null};a.update=function(a,b){if(O&&0!=C.length){for(var c=0;c<C.length;c++){var d=C[c],f=d.sfx,h=O.currentTime;!f.loop&&20==f.state&&f.duration&&f.start_time+f.duration<h&&(f.state=
50);f.cyclic&&50==f.state&&e(d);20==f.state&&3>f.vp_rand_end_time-h&&l(f)}Q&&Q.speakers.length&&(-1==Q.active||a>Q.active_start_time+Q.durations[Q.active])&&(c=Q,-1<c.active&&q(c.speakers[c.active]),-1==c.active&&c.random?d=Math.round(Math.random()*(c.speakers.length-1)):c.random?(d=1+Math.round(Math.random()*(c.speakers.length-2)),d=(c.active+d)%c.speakers.length):d=(c.active+1)%c.speakers.length,e(c.speakers[d]),c.active=d,c.active_start_time=a)}};a.play=c;a.play_def=e;a.stop=q;a.is_playing=function(a){return 20==
a.sfx.state};a.speaker_pause=g;a.speaker_resume=u;a.playrate=function(a,b){var c=a.sfx;c.pitch=b;!f(a)||"POSITIONAL"!=c.behavior&&"BACKGROUND_SOUND"!=c.behavior||(c.source_node.playbackRate.value=b,d(c),l(c))};a.get_playrate=function(a){return a.sfx.pitch};a.cyclic=function(a,b){a.sfx.cyclic=Boolean(b)};a.is_cyclic=function(a){return a.sfx.cyclic};a.listener_update_transform=function(a,b,c,d){if(O&&a._sfx){var e=y;e[0]=0;e[1]=-1;e[2]=0;r.transformQuat(e,c,e);M[0]=0;M[1]=0;M[2]=-1;r.transformQuat(M,
c,M);c=O.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(e[0],e[1],e[2],M[0],M[1],M[2]);r.copy(e,a._sfx.listener_direction);!a._sfx.disable_doppler&&d&&(L[0]=(b[0]-a._sfx.listener_last_eye[0])/d,L[1]=(b[1]-a._sfx.listener_last_eye[1])/d,L[2]=(b[2]-a._sfx.listener_last_eye[2])/d,w.smooth_v(L,a._sfx.listener_speed_avg,d,.3,L),c.setVelocity(L[0],L[1],L[2]),r.copy(L,a._sfx.listener_speed_avg));r.copy(b,a._sfx.listener_last_eye)}};a.listener_reset_speed=function(a,b){if(O&&F._sfx&&!F._sfx.disable_doppler){var c=
y;b?r.copy(b,c):r.copy(F._sfx.listener_direction,c);r.scale(c,a,c);O.listener.setVelocity(c[0],c[1],c[2]);r.copy(c,F._sfx.listener_speed_avg)}};a.speaker_update_transform=function(a,b){var c=a.sfx;if(f(a)&&"POSITIONAL"==c.behavior){var d=x.get_trans_view(a.render.world_tsr),e=x.get_quat_view(a.render.world_tsr),h=c.panner_node;h.setPosition(d[0],d[1],d[2]);var k=y;w.quat_to_dir(e,w.AXIS_MY,k);h.setOrientation(k[0],k[1],k[2]);e=c.last_position;!c.disable_doppler&&b&&(M[0]=(d[0]-e[0])/b,M[1]=(d[1]-
e[1])/b,M[2]=(d[2]-e[2])/b,w.smooth_v(M,c.speed_avg,b,.3,M),h.setVelocity(M[0],M[1],M[2]),r.copy(M,c.speed_avg));r.copy(d,e)}};a.speaker_reset_speed=function(a,b,c){var d=a.sfx;if(f(a)&&"POSITIONAL"==d.behavior&&!d.disable_doppler){var e=y;c?r.copy(c,e):r.copy(d.direction,e);r.scale(e,b,e);d.panner_node.setVelocity(e[0],e[1],e[2]);r.copy(e,d.speed_avg);a=x.get_trans_view(a.render.world_tsr);r.copy(a,d.last_position)}};a.get_spk_behavior=function(a){return a.sfx.behavior};a.check_active_speakers=function(){for(var a=
0;a<C.length;a++)if(f(C[a]))return!0;return!1};a.set_master_volume=function(a){var b=F._sfx;b&&(b.volume=a,O&&(b.gain_node.gain.value=p(b)))};a.get_master_volume=function(){var a=F._sfx;return a?a.volume:0};a.set_volume=function(a,b){var c=a.sfx;c.volume=b;f(a)&&(c.gain_node.gain.value=p(c))};a.get_volume=function(a){return a.sfx.volume};a.mute=function(a,b){a.sfx.muted=Boolean(b);f(a)&&(a.sfx.gain_node.gain.value=p(a.sfx))};a.is_muted=function(a){return a.sfx.muted};a.mute_master=function(a){var b=
F._sfx;b&&(b.muted=Boolean(a),O&&(b.gain_node.gain.value=p(b)))};a.is_master_muted=function(){var a=F._sfx;return a?a.muted:!1};a.get_speaker_objects=function(){return C};a.pause=function(){for(var a=0;a<C.length;a++)g(C[a])};a.resume=function(){for(var a=0;a<C.length;a++)u(C[a])};a.set_compressor_params=function(a,b){if(a._sfx&&a._sfx.compressor_node){var c=a._sfx.compressor_node;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};
a.get_compressor_params=function(a){if(!a._sfx||!a._sfx.compressor_node)return null;a=a._sfx.compressor_node;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};a.duck=function(a,b,c){if(f(a)){a=a.sfx;var d=a.fade_gain_node,e=O.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(b,e+c);a.duck_time=c}};a.unduck=function(a){if(f(a)){a=a.sfx;var b=a.fade_gain_node,c=O.currentTime;b.gain.setValueAtTime(b.gain.value,
c);b.gain.linearRampToValueAtTime(1,c+a.duck_time);a.duck_time=0}};a.duck_master=function(a,b){if(O){var c=F._sfx,d=c.fade_gain_node,e=O.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+b);c.duck_time=b}};a.unduck_master=function(){if(O){var a=F._sfx,b=a.fade_gain_node,c=O.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.duck_time);a.duck_time=0}};a.apply_playlist=function(a,b,c){Q={active:-1,active_start_time:0,random:c,speakers:[],
durations:[]};for(c=0;c<a.length;c++){var d=a[c],e=K(d);0==e?A.warn("Ignoring speaker with zero duration: "+d.name):(q(d),d.sfx.cyclic=!1,Q.speakers.push(d),Q.durations.push(e+b))}};a.get_duration=K;a.clear_playlist=function(){if(Q)for(var a=Q.speakers,b=0;b<a.length;b++)q(a[b]);Q=null};a.get_positional_params=function(a){return(a=a.sfx)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.set_positional_params=function(a,b){var c=a.sfx;if(c&&"POSITIONAL"==
c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var d=c.panner_node;d&&(d.refDistance=c.dist_ref,d.maxDistance=c.dist_max,d.rolloffFactor=c.attenuation)}};a.set_filter_params=function(a,b){var c=a.sfx;c&&c.filter_node&&(c.filter_node.frequency.value=b.freq,c.filter_node.Q.value=b.Q,c.filter_node.gain.value=b.gain)};a.get_filter_params=function(a){return(a=a.sfx)&&a.filter_node?{freq:a.filter_node.frequency.value,Q:a.filter_node.Q.value,gain:a.filter_node.gain.value}:
null};a.get_filter_freq_response=function(a,b,c,d){a=a.sfx;if(!a||!a.filter_node)return null;a.filter_node.getFrequencyResponse(b,c,d)}};b4w.module.__vec3=function(a,t){var v="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new v(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var c=new v(3);c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.fromValues=function(a,c,d){var l=new v(3);l[0]=a;l[1]=c;l[2]=d;return l};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.set=function(a,c,d,l){l[0]=a;l[1]=c;l[2]=d;return l};a.add=function(a,c,d){d[0]=a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];
return d};a.subtract=function(a,c,d){d[0]=a[0]-c[0];d[1]=a[1]-c[1];d[2]=a[2]-c[2];return d};a.sub=a.subtract;a.multiply=function(a,c,d){d[0]=a[0]*c[0];d[1]=a[1]*c[1];d[2]=a[2]*c[2];return d};a.mul=a.multiply;a.divide=function(a,c,d){d[0]=a[0]/c[0];d[1]=a[1]/c[1];d[2]=a[2]/c[2];return d};a.div=a.divide;a.min=function(a,c,d){d[0]=Math.min(a[0],c[0]);d[1]=Math.min(a[1],c[1]);d[2]=Math.min(a[2],c[2]);return d};a.max=function(a,c,d){d[0]=Math.max(a[0],c[0]);d[1]=Math.max(a[1],c[1]);d[2]=Math.max(a[2],
c[2]);return d};a.scale=function(a,c,d){d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;return d};a.scaleAndAdd=function(a,c,d,l){l[0]=a[0]+c[0]*d;l[1]=a[1]+c[1]*d;l[2]=a[2]+c[2]*d;return l};a.distance=function(a,c){var d=c[0]-a[0],l=c[1]-a[1],n=c[2]-a[2];return Math.sqrt(d*d+l*l+n*n)};a.dist=a.distance;a.squaredDistance=function(a,c){var d=c[0]-a[0],l=c[1]-a[1],n=c[2]-a[2];return d*d+l*l+n*n};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],d=a[1];a=a[2];return Math.sqrt(c*c+d*d+a*a)};a.len=a.length;
a.squaredLength=function(a){var c=a[0],d=a[1];a=a[2];return c*c+d*d+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];return c};a.normalize=function(a,c){var d=a[0],l=a[1],n=a[2],d=d*d+l*l+n*n;0<d&&(d=1/Math.sqrt(d),c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]};a.cross=function(a,c,d){var l=a[0],n=a[1];a=a[2];var q=c[0],g=c[1];c=c[2];
d[0]=n*c-a*g;d[1]=a*q-l*c;d[2]=l*g-n*q;return d};a.lerp=function(a,c,d,l){var n=a[0],q=a[1];a=a[2];l[0]=n+d*(c[0]-n);l[1]=q+d*(c[1]-q);l[2]=a+d*(c[2]-a);return l};a.random=function(a,e){a=a||1;var d=2*c()*Math.PI,l=2*c()-1,n=Math.sqrt(1-l*l)*a;e[0]=Math.cos(d)*n;e[1]=Math.sin(d)*n;e[2]=l*a;return e};a.transformMat4=function(a,c,d){var l=a[0],n=a[1];a=a[2];var q=c[3]*l+c[7]*n+c[11]*a+c[15],q=q||1;d[0]=(c[0]*l+c[4]*n+c[8]*a+c[12])/q;d[1]=(c[1]*l+c[5]*n+c[9]*a+c[13])/q;d[2]=(c[2]*l+c[6]*n+c[10]*a+c[14])/
q;return d};a.transformMat3=function(a,c,d){var l=a[0],n=a[1];a=a[2];d[0]=l*c[0]+n*c[3]+a*c[6];d[1]=l*c[1]+n*c[4]+a*c[7];d[2]=l*c[2]+n*c[5]+a*c[8];return d};a.transformQuat=function(a,c,d){var l=a[0],n=a[1],q=a[2];a=c[0];var g=c[1],u=c[2];c=c[3];var k=c*l+g*q-u*n,f=c*n+u*l-a*q,p=c*q+a*n-g*l,l=-a*l-g*n-u*q;d[0]=k*c+l*-a+f*-u-p*-g;d[1]=f*c+l*-g+p*-a-k*-u;d[2]=p*c+l*-u+k*-g-f*-a;return d};a.rotateX=function(a,c,d,l){var n=[],q=[];n[0]=a[0]-c[0];n[1]=a[1]-c[1];n[2]=a[2]-c[2];q[0]=n[0];q[1]=n[1]*Math.cos(d)-
n[2]*Math.sin(d);q[2]=n[1]*Math.sin(d)+n[2]*Math.cos(d);l[0]=q[0]+c[0];l[1]=q[1]+c[1];l[2]=q[2]+c[2];return l};a.rotateY=function(a,c,d,l){var n=[],q=[];n[0]=a[0]-c[0];n[1]=a[1]-c[1];n[2]=a[2]-c[2];q[0]=n[2]*Math.sin(d)+n[0]*Math.cos(d);q[1]=n[1];q[2]=n[2]*Math.cos(d)-n[0]*Math.sin(d);l[0]=q[0]+c[0];l[1]=q[1]+c[1];l[2]=q[2]+c[2];return l};a.rotateZ=function(a,c,d,l){var n=[],q=[];n[0]=a[0]-c[0];n[1]=a[1]-c[1];n[2]=a[2]-c[2];q[0]=n[0]*Math.cos(d)-n[1]*Math.sin(d);q[1]=n[0]*Math.sin(d)+n[1]*Math.cos(d);
q[2]=n[2];l[0]=q[0]+c[0];l[1]=q[1]+c[1];l[2]=q[2]+c[2];return l};a.forEach=function(){var b=a.create();return function(a,c,l,n,q,g){c||(c=3);l||(l=0);for(n=n?Math.min(n*c+l,a.length):a.length;l<n;l+=c)b[0]=a[l],b[1]=a[l+1],b[2]=a[l+2],q(b,g,b),a[l]=b[0],a[l+1]=b[1],a[l+2]=b[2];return a}}();a.angle=function(b,c){var d=a.fromValues(b[0],b[1],b[2]),l=a.fromValues(c[0],c[1],c[2]);a.normalize(d,d);a.normalize(l,l);d=a.dot(d,l);return 1<d?0:Math.acos(d)};a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+
a[2]+")"};"undefined"!==typeof a&&(a.vec3=a)};b4w.module.vec3=b4w.module.__vec3;
b4w.module.__vec4=function(a,t){var v="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new v(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var c=new v(4);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.fromValues=function(a,c,d,l){var n=new v(4);n[0]=a;n[1]=c;n[2]=d;n[3]=l;return n};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.set=function(a,c,d,l,n){n[0]=a;n[1]=c;n[2]=d;n[3]=l;return n};a.add=function(a,c,
d){d[0]=a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];d[3]=a[3]+c[3];return d};a.subtract=function(a,c,d){d[0]=a[0]-c[0];d[1]=a[1]-c[1];d[2]=a[2]-c[2];d[3]=a[3]-c[3];return d};a.sub=a.subtract;a.multiply=function(a,c,d){d[0]=a[0]*c[0];d[1]=a[1]*c[1];d[2]=a[2]*c[2];d[3]=a[3]*c[3];return d};a.mul=a.multiply;a.divide=function(a,c,d){d[0]=a[0]/c[0];d[1]=a[1]/c[1];d[2]=a[2]/c[2];d[3]=a[3]/c[3];return d};a.div=a.divide;a.min=function(a,c,d){d[0]=Math.min(a[0],c[0]);d[1]=Math.min(a[1],c[1]);d[2]=Math.min(a[2],
c[2]);d[3]=Math.min(a[3],c[3]);return d};a.max=function(a,c,d){d[0]=Math.max(a[0],c[0]);d[1]=Math.max(a[1],c[1]);d[2]=Math.max(a[2],c[2]);d[3]=Math.max(a[3],c[3]);return d};a.scale=function(a,c,d){d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;d[3]=a[3]*c;return d};a.scaleAndAdd=function(a,c,d,l){l[0]=a[0]+c[0]*d;l[1]=a[1]+c[1]*d;l[2]=a[2]+c[2]*d;l[3]=a[3]+c[3]*d;return l};a.distance=function(a,c){var d=c[0]-a[0],l=c[1]-a[1],n=c[2]-a[2],q=c[3]-a[3];return Math.sqrt(d*d+l*l+n*n+q*q)};a.dist=a.distance;a.squaredDistance=
function(a,c){var d=c[0]-a[0],l=c[1]-a[1],n=c[2]-a[2],q=c[3]-a[3];return d*d+l*l+n*n+q*q};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],d=a[1],l=a[2];a=a[3];return Math.sqrt(c*c+d*d+l*l+a*a)};a.len=a.length;a.squaredLength=function(a){var c=a[0],d=a[1],l=a[2];a=a[3];return c*c+d*d+l*l+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];c[3]=-a[3];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];c[3]=1/a[3];return c};a.normalize=
function(a,c){var d=a[0],l=a[1],n=a[2],q=a[3],d=d*d+l*l+n*n+q*q;0<d&&(d=1/Math.sqrt(d),c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d,c[3]=a[3]*d);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]};a.lerp=function(a,c,d,l){var n=a[0],q=a[1],g=a[2];a=a[3];l[0]=n+d*(c[0]-n);l[1]=q+d*(c[1]-q);l[2]=g+d*(c[2]-g);l[3]=a+d*(c[3]-a);return l};a.random=function(b,e){b=b||1;e[0]=c();e[1]=c();e[2]=c();e[3]=c();a.normalize(e,e);a.scale(e,b,e);return e};a.transformMat4=function(a,c,d){var l=a[0],
n=a[1],q=a[2];a=a[3];d[0]=c[0]*l+c[4]*n+c[8]*q+c[12]*a;d[1]=c[1]*l+c[5]*n+c[9]*q+c[13]*a;d[2]=c[2]*l+c[6]*n+c[10]*q+c[14]*a;d[3]=c[3]*l+c[7]*n+c[11]*q+c[15]*a;return d};a.transformQuat=function(a,c,d){var l=a[0],n=a[1],q=a[2],g=c[0],u=c[1],k=c[2];c=c[3];var f=c*l+u*q-k*n,p=c*n+k*l-g*q,t=c*q+g*n-u*l,l=-g*l-u*n-k*q;d[0]=f*c+l*-g+p*-k-t*-u;d[1]=p*c+l*-u+t*-g-f*-k;d[2]=t*c+l*-k+f*-u-p*-g;d[3]=a[3];return d};a.forEach=function(){var b=a.create();return function(a,c,l,n,q,g){c||(c=4);l||(l=0);for(n=n?Math.min(n*
c+l,a.length):a.length;l<n;l+=c)b[0]=a[l],b[1]=a[l+1],b[2]=a[l+2],b[3]=a[l+3],q(b,g,b),a[l]=b[0],a[l+1]=b[1],a[l+2]=b[2],a[l+3]=b[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=a)};b4w.module.vec4=b4w.module.__vec4;
b4w.module.__quat=function(a,t){var v=t("__vec3"),c=t("__vec4"),b=t("__mat3"),e="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new e(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=v.create(),c=v.fromValues(1,0,0),e=v.fromValues(0,1,0);return function(q,g,u){var k=v.dot(q,g);if(-.9999999>k)return v.cross(c,q,b),1E-6>v.length(b)&&v.cross(e,q,b),v.normalize(b,b),a.setAxisAngle(b,Math.PI,u),u;if(.9999999<k)return u[0]=0,u[1]=0,u[2]=0,u[3]=1,u;v.cross(q,
g,b);u[0]=b[0];u[1]=b[1];u[2]=b[2];u[3]=1+k;return a.normalize(u,u)}}();a.setAxes=function(){var c=b.create();return function(b,e,q,g){c[0]=e[0];c[3]=e[1];c[6]=e[2];c[1]=q[0];c[4]=q[1];c[7]=q[2];c[2]=-b[0];c[5]=-b[1];c[8]=-b[2];return a.normalize(a.fromMat3(c,g),g)}}();a.clone=c.clone;a.fromValues=c.fromValues;a.copy=c.copy;a.set=c.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=.5;var e=Math.sin(b);c[0]=e*a[0];c[1]=e*a[1];c[2]=e*a[2];c[3]=Math.cos(b);
return c};a.add=c.add;a.multiply=function(a,b,c){var e=a[0],g=a[1],u=a[2];a=a[3];var k=b[0],f=b[1],p=b[2];b=b[3];c[0]=e*b+a*k+g*p-u*f;c[1]=g*b+a*f+u*k-e*p;c[2]=u*b+a*p+e*f-g*k;c[3]=a*b-e*k-g*f-u*p;return c};a.mul=a.multiply;a.scale=c.scale;a.rotateX=function(a,b,c){b*=.5;var e=a[0],g=a[1],u=a[2];a=a[3];var k=Math.sin(b);b=Math.cos(b);c[0]=e*b+a*k;c[1]=g*b+u*k;c[2]=u*b-g*k;c[3]=a*b-e*k;return c};a.rotateY=function(a,b,c){b*=.5;var e=a[0],g=a[1],u=a[2];a=a[3];var k=Math.sin(b);b=Math.cos(b);c[0]=e*
b-u*k;c[1]=g*b+a*k;c[2]=u*b+e*k;c[3]=a*b-g*k;return c};a.rotateZ=function(a,b,c){b*=.5;var e=a[0],g=a[1],u=a[2];a=a[3];var k=Math.sin(b);b=Math.cos(b);c[0]=e*b+g*k;c[1]=g*b-e*k;c[2]=u*b+a*k;c[3]=a*b-u*k;return c};a.calculateW=function(a,b){var c=a[0],e=a[1],g=a[2];b[0]=c;b[1]=e;b[2]=g;b[3]=Math.sqrt(Math.abs(1-c*c-e*e-g*g));return b};a.dot=c.dot;a.lerp=c.lerp;a.slerp=function(a,b,c,e){var g=a[0],u=a[1],k=a[2];a=a[3];var f=b[0],p=b[1],t=b[2];b=b[3];var v,A,h;A=g*f+u*p+k*t+a*b;0>A&&(A=-A,f=-f,p=-p,
t=-t,b=-b);1E-6<1-A?(v=Math.acos(A),h=Math.sin(v),A=Math.sin((1-c)*v)/h,c=Math.sin(c*v)/h):A=1-c;e[0]=A*g+c*f;e[1]=A*u+c*p;e[2]=A*k+c*t;e[3]=A*a+c*b;return e};a.invert=function(a,b){var c=a[0],e=a[1],g=a[2],u=a[3],k=c*c+e*e+g*g+u*u,k=k?1/k:0;b[0]=-c*k;b[1]=-e*k;b[2]=-g*k;b[3]=u*k;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=c.length;a.len=a.length;a.squaredLength=c.squaredLength;a.sqrLen=a.squaredLength;a.normalize=c.normalize;a.fromMat3=function(a,
b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=.5*c,c=.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var e=0;a[4]>a[0]&&(e=1);a[8]>a[3*e+e]&&(e=2);var g=(e+1)%3,u=(e+2)%3,c=Math.sqrt(a[3*e+e]-a[3*g+g]-a[3*u+u]+1);b[e]=.5*c;c=.5/c;b[3]=(a[3*g+u]-a[3*u+g])*c;b[g]=(a[3*g+e]+a[3*e+g])*c;b[u]=(a[3*u+e]+a[3*e+u])*c}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=a)};b4w.module.quat=b4w.module.__quat;
b4w.module.__mat3=function(a,t){var v="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new v(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};a.clone=function(a){var b=new v(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];
b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,b){if(b===a){var e=a[1],d=a[2],l=a[5];b[1]=a[3];b[2]=a[6];b[3]=e;b[5]=a[7];b[6]=d;b[7]=l}else b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8];return b};a.invert=function(a,b){var e=a[0],d=a[1],l=a[2],n=a[3],q=a[4],g=a[5],u=a[6],k=a[7],f=a[8],p=f*q-g*k,t=-f*n+g*
u,v=k*n-q*u,A=e*p+d*t+l*v;if(!A)return null;A=1/A;b[0]=p*A;b[1]=(-f*d+l*k)*A;b[2]=(g*d-l*q)*A;b[3]=t*A;b[4]=(f*e-l*u)*A;b[5]=(-g*e+l*n)*A;b[6]=v*A;b[7]=(-k*e+d*u)*A;b[8]=(q*e-d*n)*A;return b};a.adjoint=function(a,b){var e=a[0],d=a[1],l=a[2],n=a[3],q=a[4],g=a[5],u=a[6],k=a[7],f=a[8];b[0]=q*f-g*k;b[1]=l*k-d*f;b[2]=d*g-l*q;b[3]=g*u-n*f;b[4]=e*f-l*u;b[5]=l*n-e*g;b[6]=n*k-q*u;b[7]=d*u-e*k;b[8]=e*q-d*n;return b};a.determinant=function(a){var b=a[3],e=a[4],d=a[5],l=a[6],n=a[7],q=a[8];return a[0]*(q*e-d*
n)+a[1]*(-q*b+d*l)+a[2]*(n*b-e*l)};a.multiply=function(a,b,e){var d=a[0],l=a[1],n=a[2],q=a[3],g=a[4],u=a[5],k=a[6],f=a[7];a=a[8];var p=b[0],t=b[1],v=b[2],A=b[3],h=b[4],x=b[5],w=b[6],r=b[7];b=b[8];e[0]=p*d+t*q+v*k;e[1]=p*l+t*g+v*f;e[2]=p*n+t*u+v*a;e[3]=A*d+h*q+x*k;e[4]=A*l+h*g+x*f;e[5]=A*n+h*u+x*a;e[6]=w*d+r*q+b*k;e[7]=w*l+r*g+b*f;e[8]=w*n+r*u+b*a;return e};a.mul=a.multiply;a.translate=function(a,b,e){var d=a[0],l=a[1],n=a[2],q=a[3],g=a[4],u=a[5],k=a[6],f=a[7];a=a[8];var p=b[0];b=b[1];e[0]=d;e[1]=
l;e[2]=n;e[3]=q;e[4]=g;e[5]=u;e[6]=p*d+b*q+k;e[7]=p*l+b*g+f;e[8]=p*n+b*u+a;return e};a.rotate=function(a,b,e){var d=a[0],l=a[1],n=a[2],q=a[3],g=a[4],u=a[5],k=a[6],f=a[7];a=a[8];var p=Math.sin(b);b=Math.cos(b);e[0]=b*d+p*q;e[1]=b*l+p*g;e[2]=b*n+p*u;e[3]=b*q-p*d;e[4]=b*g-p*l;e[5]=b*u-p*n;e[6]=k;e[7]=f;e[8]=a;return e};a.scale=function(a,b,e){var d=b[0];b=b[1];e[0]=d*a[0];e[1]=d*a[1];e[2]=d*a[2];e[3]=b*a[3];e[4]=b*a[4];e[5]=b*a[5];e[6]=a[6];e[7]=a[7];e[8]=a[8];return e};a.fromTranslation=function(a,
b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=a[0];b[7]=a[1];b[8]=1;return b};a.fromRotation=function(a,b){var e=Math.sin(a),d=Math.cos(a);b[0]=d;b[1]=e;b[2]=0;b[3]=-e;b[4]=d;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.fromScaling=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=a[1];b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.fromMat2d=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=0;b[3]=a[2];b[4]=a[3];b[5]=0;b[6]=a[4];b[7]=a[5];b[8]=1;return b};a.fromQuat=function(a,b){var e=a[0],d=a[1],l=a[2],n=a[3],q=e+
e,g=d+d,u=l+l,e=e*q,k=d*q,d=d*g,f=l*q,p=l*g,l=l*u,q=n*q,g=n*g,n=n*u;b[0]=1-d-l;b[3]=k-n;b[6]=f+g;b[1]=k+n;b[4]=1-e-l;b[7]=p-q;b[2]=f-g;b[5]=p+q;b[8]=1-e-d;return b};a.normalFromMat4=function(a,b){var e=a[0],d=a[1],l=a[2],n=a[3],q=a[4],g=a[5],u=a[6],k=a[7],f=a[8],p=a[9],t=a[10],v=a[11],A=a[12],h=a[13],x=a[14],w=a[15],r=e*g-d*q,m=e*u-l*q,E=e*k-n*q,y=d*u-l*g,M=d*k-n*g,L=l*k-n*u,N=f*h-p*A,B=f*x-t*A,f=f*w-v*A,O=p*x-t*h,p=p*w-v*h,t=t*w-v*x,v=r*t-m*p+E*O+y*f-M*B+L*N;if(!v)return null;v=1/v;b[0]=(g*t-u*p+
k*O)*v;b[1]=(u*f-q*t-k*B)*v;b[2]=(q*p-g*f+k*N)*v;b[3]=(l*p-d*t-n*O)*v;b[4]=(e*t-l*f+n*B)*v;b[5]=(d*f-e*p-n*N)*v;b[6]=(h*L-x*M+w*y)*v;b[7]=(x*E-A*L-w*m)*v;b[8]=(A*M-h*E+w*r)*v;return b};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==
typeof a&&(a.mat3=a)};b4w.module.mat3=b4w.module.__mat3;
b4w.module.__mat4=function(a,t){var v="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new v(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var b=new v(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.copy=function(a,b){b[0]=a[0];
b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,b){if(b===a){var e=a[1],d=a[2],l=a[3],n=a[6],q=a[7],g=a[11];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=e;b[6]=a[9];b[7]=a[13];b[8]=d;b[9]=n;b[11]=a[14];b[12]=l;b[13]=
q;b[14]=g}else b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15];return b};a.invert=function(a,b){var e=a[0],d=a[1],l=a[2],n=a[3],q=a[4],g=a[5],u=a[6],k=a[7],f=a[8],p=a[9],t=a[10],v=a[11],A=a[12],h=a[13],x=a[14],w=a[15],r=e*g-d*q,m=e*u-l*q,E=e*k-n*q,y=d*u-l*g,M=d*k-n*g,L=l*k-n*u,N=f*h-p*A,B=f*x-t*A,O=f*w-v*A,F=p*x-t*h,C=p*w-v*h,I=t*w-v*x,Q=r*I-m*C+E*F+y*O-M*B+L*N;if(!Q)return null;
Q=1/Q;b[0]=(g*I-u*C+k*F)*Q;b[1]=(l*C-d*I-n*F)*Q;b[2]=(h*L-x*M+w*y)*Q;b[3]=(t*M-p*L-v*y)*Q;b[4]=(u*O-q*I-k*B)*Q;b[5]=(e*I-l*O+n*B)*Q;b[6]=(x*E-A*L-w*m)*Q;b[7]=(f*L-t*E+v*m)*Q;b[8]=(q*C-g*O+k*N)*Q;b[9]=(d*O-e*C-n*N)*Q;b[10]=(A*M-h*E+w*r)*Q;b[11]=(p*E-f*M-v*r)*Q;b[12]=(g*B-q*F-u*N)*Q;b[13]=(e*F-d*B+l*N)*Q;b[14]=(h*m-A*y-x*r)*Q;b[15]=(f*y-p*m+t*r)*Q;return b};a.adjoint=function(a,b){var e=a[0],d=a[1],l=a[2],n=a[3],q=a[4],g=a[5],u=a[6],k=a[7],f=a[8],p=a[9],t=a[10],v=a[11],A=a[12],h=a[13],x=a[14],w=a[15];
b[0]=g*(t*w-v*x)-p*(u*w-k*x)+h*(u*v-k*t);b[1]=-(d*(t*w-v*x)-p*(l*w-n*x)+h*(l*v-n*t));b[2]=d*(u*w-k*x)-g*(l*w-n*x)+h*(l*k-n*u);b[3]=-(d*(u*v-k*t)-g*(l*v-n*t)+p*(l*k-n*u));b[4]=-(q*(t*w-v*x)-f*(u*w-k*x)+A*(u*v-k*t));b[5]=e*(t*w-v*x)-f*(l*w-n*x)+A*(l*v-n*t);b[6]=-(e*(u*w-k*x)-q*(l*w-n*x)+A*(l*k-n*u));b[7]=e*(u*v-k*t)-q*(l*v-n*t)+f*(l*k-n*u);b[8]=q*(p*w-v*h)-f*(g*w-k*h)+A*(g*v-k*p);b[9]=-(e*(p*w-v*h)-f*(d*w-n*h)+A*(d*v-n*p));b[10]=e*(g*w-k*h)-q*(d*w-n*h)+A*(d*k-n*g);b[11]=-(e*(g*v-k*p)-q*(d*v-n*p)+f*
(d*k-n*g));b[12]=-(q*(p*x-t*h)-f*(g*x-u*h)+A*(g*t-u*p));b[13]=e*(p*x-t*h)-f*(d*x-l*h)+A*(d*t-l*p);b[14]=-(e*(g*x-u*h)-q*(d*x-l*h)+A*(d*u-l*g));b[15]=e*(g*t-u*p)-q*(d*t-l*p)+f*(d*u-l*g);return b};a.determinant=function(a){var b=a[0],e=a[1],d=a[2],l=a[3],n=a[4],q=a[5],g=a[6],u=a[7],k=a[8],f=a[9],p=a[10],t=a[11],v=a[12],A=a[13],h=a[14];a=a[15];return(b*q-e*n)*(p*a-t*h)-(b*g-d*n)*(f*a-t*A)+(b*u-l*n)*(f*h-p*A)+(e*g-d*q)*(k*a-t*v)-(e*u-l*q)*(k*h-p*v)+(d*u-l*g)*(k*A-f*v)};a.multiply=function(a,b,e){var d=
a[0],l=a[1],n=a[2],q=a[3],g=a[4],u=a[5],k=a[6],f=a[7],p=a[8],t=a[9],v=a[10],A=a[11],h=a[12],x=a[13],w=a[14];a=a[15];var r=b[0],m=b[1],E=b[2],y=b[3];e[0]=r*d+m*g+E*p+y*h;e[1]=r*l+m*u+E*t+y*x;e[2]=r*n+m*k+E*v+y*w;e[3]=r*q+m*f+E*A+y*a;r=b[4];m=b[5];E=b[6];y=b[7];e[4]=r*d+m*g+E*p+y*h;e[5]=r*l+m*u+E*t+y*x;e[6]=r*n+m*k+E*v+y*w;e[7]=r*q+m*f+E*A+y*a;r=b[8];m=b[9];E=b[10];y=b[11];e[8]=r*d+m*g+E*p+y*h;e[9]=r*l+m*u+E*t+y*x;e[10]=r*n+m*k+E*v+y*w;e[11]=r*q+m*f+E*A+y*a;r=b[12];m=b[13];E=b[14];y=b[15];e[12]=r*d+
m*g+E*p+y*h;e[13]=r*l+m*u+E*t+y*x;e[14]=r*n+m*k+E*v+y*w;e[15]=r*q+m*f+E*A+y*a;return e};a.mul=a.multiply;a.translate=function(a,b,e){var d=b[0],l=b[1];b=b[2];var n,q,g,u,k,f,p,t,v,A,h,x;a===e?(e[12]=a[0]*d+a[4]*l+a[8]*b+a[12],e[13]=a[1]*d+a[5]*l+a[9]*b+a[13],e[14]=a[2]*d+a[6]*l+a[10]*b+a[14],e[15]=a[3]*d+a[7]*l+a[11]*b+a[15]):(n=a[0],q=a[1],g=a[2],u=a[3],k=a[4],f=a[5],p=a[6],t=a[7],v=a[8],A=a[9],h=a[10],x=a[11],e[0]=n,e[1]=q,e[2]=g,e[3]=u,e[4]=k,e[5]=f,e[6]=p,e[7]=t,e[8]=v,e[9]=A,e[10]=h,e[11]=x,
e[12]=n*d+k*l+v*b+a[12],e[13]=q*d+f*l+A*b+a[13],e[14]=g*d+p*l+h*b+a[14],e[15]=u*d+t*l+x*b+a[15]);return e};a.scale=function(a,b,e){var d=b[0],l=b[1];b=b[2];e[0]=a[0]*d;e[1]=a[1]*d;e[2]=a[2]*d;e[3]=a[3]*d;e[4]=a[4]*l;e[5]=a[5]*l;e[6]=a[6]*l;e[7]=a[7]*l;e[8]=a[8]*b;e[9]=a[9]*b;e[10]=a[10]*b;e[11]=a[11]*b;e[12]=a[12];e[13]=a[13];e[14]=a[14];e[15]=a[15];return e};a.rotate=function(a,b,e,d){var l=e[0],n=e[1];e=e[2];var q=Math.sqrt(l*l+n*n+e*e),g,u,k,f,p,t,v,A,h,x,w,r,m,E,y,M,L,N,B,O;if(1E-7>Math.abs(q))return null;
q=1/q;l*=q;n*=q;e*=q;g=Math.sin(b);u=Math.cos(b);k=1-u;b=a[0];q=a[1];f=a[2];p=a[3];t=a[4];v=a[5];A=a[6];h=a[7];x=a[8];w=a[9];r=a[10];m=a[11];E=l*l*k+u;y=n*l*k+e*g;M=e*l*k-n*g;L=l*n*k-e*g;N=n*n*k+u;B=e*n*k+l*g;O=l*e*k+n*g;l=n*e*k-l*g;n=e*e*k+u;d[0]=b*E+t*y+x*M;d[1]=q*E+v*y+w*M;d[2]=f*E+A*y+r*M;d[3]=p*E+h*y+m*M;d[4]=b*L+t*N+x*B;d[5]=q*L+v*N+w*B;d[6]=f*L+A*N+r*B;d[7]=p*L+h*N+m*B;d[8]=b*O+t*l+x*n;d[9]=q*O+v*l+w*n;d[10]=f*O+A*l+r*n;d[11]=p*O+h*l+m*n;a!==d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);
return d};a.rotateX=function(a,b,e){var d=Math.sin(b);b=Math.cos(b);var l=a[4],n=a[5],q=a[6],g=a[7],u=a[8],k=a[9],f=a[10],p=a[11];a!==e&&(e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]);e[4]=l*b+u*d;e[5]=n*b+k*d;e[6]=q*b+f*d;e[7]=g*b+p*d;e[8]=u*b-l*d;e[9]=k*b-n*d;e[10]=f*b-q*d;e[11]=p*b-g*d;return e};a.rotateY=function(a,b,e){var d=Math.sin(b);b=Math.cos(b);var l=a[0],n=a[1],q=a[2],g=a[3],u=a[8],k=a[9],f=a[10],p=a[11];a!==e&&(e[4]=a[4],e[5]=a[5],e[6]=a[6],
e[7]=a[7],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]);e[0]=l*b-u*d;e[1]=n*b-k*d;e[2]=q*b-f*d;e[3]=g*b-p*d;e[8]=l*d+u*b;e[9]=n*d+k*b;e[10]=q*d+f*b;e[11]=g*d+p*b;return e};a.rotateZ=function(a,b,e){var d=Math.sin(b);b=Math.cos(b);var l=a[0],n=a[1],q=a[2],g=a[3],u=a[4],k=a[5],f=a[6],p=a[7];a!==e&&(e[8]=a[8],e[9]=a[9],e[10]=a[10],e[11]=a[11],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]);e[0]=l*b+u*d;e[1]=n*b+k*d;e[2]=q*b+f*d;e[3]=g*b+p*d;e[4]=u*b-l*d;e[5]=k*b-n*d;e[6]=f*b-q*d;e[7]=p*b-g*d;return e};
a.fromTranslation=function(a,b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=a[0];b[13]=a[1];b[14]=a[2];b[15]=1;return b};a.fromScaling=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=a[1];b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=a[2];b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromRotation=function(a,b,e){var d=b[0],l=b[1];b=b[2];var n=Math.sqrt(d*d+l*l+b*b),q;if(1E-7>Math.abs(n))return null;n=1/n;d*=n;l*=n;b*=n;n=Math.sin(a);a=Math.cos(a);
q=1-a;e[0]=d*d*q+a;e[1]=l*d*q+b*n;e[2]=b*d*q-l*n;e[3]=0;e[4]=d*l*q-b*n;e[5]=l*l*q+a;e[6]=b*l*q+d*n;e[7]=0;e[8]=d*b*q+l*n;e[9]=l*b*q-d*n;e[10]=b*b*q+a;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e};a.fromXRotation=function(a,b){var e=Math.sin(a),d=Math.cos(a);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=d;b[6]=e;b[7]=0;b[8]=0;b[9]=-e;b[10]=d;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromYRotation=function(a,b){var e=Math.sin(a),d=Math.cos(a);b[0]=d;b[1]=0;b[2]=-e;b[3]=0;b[4]=0;b[5]=1;b[6]=
0;b[7]=0;b[8]=e;b[9]=0;b[10]=d;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromZRotation=function(a,b){var e=Math.sin(a),d=Math.cos(a);b[0]=d;b[1]=e;b[2]=0;b[3]=0;b[4]=-e;b[5]=d;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromRotationTranslation=function(a,b,e){var d=a[0],l=a[1],n=a[2],q=a[3],g=d+d,u=l+l,k=n+n;a=d*g;var f=d*u,d=d*k,p=l*u,l=l*k,n=n*k,g=q*g,u=q*u,q=q*k;e[0]=1-(p+n);e[1]=f+q;e[2]=d-u;e[3]=0;e[4]=f-q;e[5]=1-(a+n);e[6]=l+g;e[7]=0;e[8]=
d+u;e[9]=l-g;e[10]=1-(a+p);e[11]=0;e[12]=b[0];e[13]=b[1];e[14]=b[2];e[15]=1;return e};a.fromQuat=function(a,b){var e=a[0],d=a[1],l=a[2],n=a[3],q=e+e,g=d+d,u=l+l,e=e*q,k=d*q,d=d*g,f=l*q,p=l*g,l=l*u,q=n*q,g=n*g,n=n*u;b[0]=1-d-l;b[1]=k+n;b[2]=f-g;b[3]=0;b[4]=k-n;b[5]=1-e-l;b[6]=p+q;b[7]=0;b[8]=f+g;b[9]=p-q;b[10]=1-e-d;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.frustum=function(a,b,e,d,l,n,q){var g=1/(b-a),u=1/(d-e),k=1/(l-n);q[0]=2*l*g;q[1]=0;q[2]=0;q[3]=0;q[4]=0;q[5]=2*l*u;q[6]=0;q[7]=0;q[8]=
(b+a)*g;q[9]=(d+e)*u;q[10]=(n+l)*k;q[11]=-1;q[12]=0;q[13]=0;q[14]=n*l*2*k;q[15]=0;return q};a.perspective=function(a,b,e,d,l){a=1/Math.tan(a/2);var n=1/(e-d);l[0]=a/b;l[1]=0;l[2]=0;l[3]=0;l[4]=0;l[5]=a;l[6]=0;l[7]=0;l[8]=0;l[9]=0;l[10]=(d+e)*n;l[11]=-1;l[12]=0;l[13]=0;l[14]=2*d*e*n;l[15]=0;return l};a.perspectiveFromFieldOfView=function(a,b,e,d){var l=Math.tan(a.upDegrees*Math.PI/180),n=Math.tan(a.downDegrees*Math.PI/180),q=Math.tan(a.leftDegrees*Math.PI/180);a=Math.tan(a.rightDegrees*Math.PI/180);
var g=2/(q+a),u=2/(l+n);d[0]=g;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=u;d[6]=0;d[7]=0;d[8]=-((q-a)*g*.5);d[9]=(l-n)*u*.5;d[10]=e/(b-e);d[11]=-1;d[12]=0;d[13]=0;d[14]=e*b/(b-e);d[15]=0;return d};a.ortho=function(a,b,e,d,l,n,q){var g=1/(a-b),u=1/(e-d),k=1/(l-n);q[0]=-2*g;q[1]=0;q[2]=0;q[3]=0;q[4]=0;q[5]=-2*u;q[6]=0;q[7]=0;q[8]=0;q[9]=0;q[10]=2*k;q[11]=0;q[12]=(a+b)*g;q[13]=(d+e)*u;q[14]=(n+l)*k;q[15]=1;return q};a.lookAt=function(c,b,e,d){var l,n,q,g,u,k,f,p,t=c[0],v=c[1];c=c[2];q=e[0];g=e[1];n=e[2];f=b[0];
e=b[1];l=b[2];if(1E-7>Math.abs(t-f)&&1E-7>Math.abs(v-e)&&1E-7>Math.abs(c-l))return a.identity(d);b=t-f;e=v-e;f=c-l;p=1/Math.sqrt(b*b+e*e+f*f);b*=p;e*=p;f*=p;l=g*f-n*e;n=n*b-q*f;q=q*e-g*b;(p=Math.sqrt(l*l+n*n+q*q))?(p=1/p,l*=p,n*=p,q*=p):q=n=l=0;g=e*q-f*n;u=f*l-b*q;k=b*n-e*l;(p=Math.sqrt(g*g+u*u+k*k))?(p=1/p,g*=p,u*=p,k*=p):k=u=g=0;d[0]=l;d[1]=g;d[2]=b;d[3]=0;d[4]=n;d[5]=u;d[6]=e;d[7]=0;d[8]=q;d[9]=k;d[10]=f;d[11]=0;d[12]=-(l*t+n*v+q*c);d[13]=-(g*t+u*v+k*c);d[14]=-(b*t+e*v+f*c);d[15]=1;return d};a.str=
function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],
2))};"undefined"!==typeof a&&(a.mat4=a)};b4w.module.mat4=b4w.module.__mat4;b4w.module.__md5=function(a,t){function v(a,l){var g=a[0],u=a[1],k=a[2],f=a[3],g=b(g,u,k,f,l[0],7,-680876936),f=b(f,g,u,k,l[1],12,-389564586),k=b(k,f,g,u,l[2],17,606105819),u=b(u,k,f,g,l[3],22,-1044525330),g=b(g,u,k,f,l[4],7,-176418897),f=b(f,g,u,k,l[5],12,1200080426),k=b(k,f,g,u,l[6],17,-1473231341),u=b(u,k,f,g,l[7],22,-45705983),g=b(g,u,k,f,l[8],7,1770035416),f=b(f,g,u,k,l[9],12,-1958414417),k=b(k,f,g,u,l[10],17,-42063),u=b(u,k,f,g,l[11],22,-1990404162),g=b(g,u,k,f,l[12],7,1804603682),f=b(f,g,u,
k,l[13],12,-40341101),k=b(k,f,g,u,l[14],17,-1502002290),u=b(u,k,f,g,l[15],22,1236535329),g=e(g,u,k,f,l[1],5,-165796510),f=e(f,g,u,k,l[6],9,-1069501632),k=e(k,f,g,u,l[11],14,643717713),u=e(u,k,f,g,l[0],20,-373897302),g=e(g,u,k,f,l[5],5,-701558691),f=e(f,g,u,k,l[10],9,38016083),k=e(k,f,g,u,l[15],14,-660478335),u=e(u,k,f,g,l[4],20,-405537848),g=e(g,u,k,f,l[9],5,568446438),f=e(f,g,u,k,l[14],9,-1019803690),k=e(k,f,g,u,l[3],14,-187363961),u=e(u,k,f,g,l[8],20,1163531501),g=e(g,u,k,f,l[13],5,-1444681467),
f=e(f,g,u,k,l[2],9,-51403784),k=e(k,f,g,u,l[7],14,1735328473),u=e(u,k,f,g,l[12],20,-1926607734),g=c(u^k^f,g,u,l[5],4,-378558),f=c(g^u^k,f,g,l[8],11,-2022574463),k=c(f^g^u,k,f,l[11],16,1839030562),u=c(k^f^g,u,k,l[14],23,-35309556),g=c(u^k^f,g,u,l[1],4,-1530992060),f=c(g^u^k,f,g,l[4],11,1272893353),k=c(f^g^u,k,f,l[7],16,-155497632),u=c(k^f^g,u,k,l[10],23,-1094730640),g=c(u^k^f,g,u,l[13],4,681279174),f=c(g^u^k,f,g,l[0],11,-358537222),k=c(f^g^u,k,f,l[3],16,-722521979),u=c(k^f^g,u,k,l[6],23,76029189),
g=c(u^k^f,g,u,l[9],4,-640364487),f=c(g^u^k,f,g,l[12],11,-421815835),k=c(f^g^u,k,f,l[15],16,530742520),u=c(k^f^g,u,k,l[2],23,-995338651),g=d(g,u,k,f,l[0],6,-198630844),f=d(f,g,u,k,l[7],10,1126891415),k=d(k,f,g,u,l[14],15,-1416354905),u=d(u,k,f,g,l[5],21,-57434055),g=d(g,u,k,f,l[12],6,1700485571),f=d(f,g,u,k,l[3],10,-1894986606),k=d(k,f,g,u,l[10],15,-1051523),u=d(u,k,f,g,l[1],21,-2054922799),g=d(g,u,k,f,l[8],6,1873313359),f=d(f,g,u,k,l[15],10,-30611744),k=d(k,f,g,u,l[6],15,-1560198380),u=d(u,k,f,g,
l[13],21,1309151649),g=d(g,u,k,f,l[4],6,-145523070),f=d(f,g,u,k,l[11],10,-1120210379),k=d(k,f,g,u,l[2],15,718787259),u=d(u,k,f,g,l[9],21,-343485551);a[0]=g+a[0]&4294967295;a[1]=u+a[1]&4294967295;a[2]=k+a[2]&4294967295;a[3]=f+a[3]&4294967295}function c(a,b,c,d,e,f){b=(b+a&4294967295)+(d+f&4294967295)&4294967295;return(b<<e|b>>>32-e)+c&4294967295}function b(a,b,d,e,k,f,l){return c(b&d|~b&e,a,b,k,f,l)}function e(a,b,d,e,k,f,l){return c(b&e|d&~e,a,b,k,f,l)}function d(a,b,d,e,k,f,l){return c(d^(b|~e),
a,b,k,f,l)}var l="0123456789abcdef".split("");a.hexdigest=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var d;for(d=64;d<=b.length;d+=64){for(var e=b.substring(d-64,d),f=[],p=void 0,p=0;64>p;p+=4)f[p>>2]=e.charCodeAt(p)+(e.charCodeAt(p+1)<<8)+(e.charCodeAt(p+2)<<16)+(e.charCodeAt(p+3)<<24);v(a,f)}b=b.substring(d-64);e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<b.length;d++)e[d>>2]|=b.charCodeAt(d)<<(d%4<<3);e[d>>2]|=128<<(d%4<<3);if(55<d)for(v(a,e),d=0;16>d;d++)e[d]=
0;e[14]=8*c;v(a,e);for(b=0;b<a.length;b++){c=a;d=b;e=a[b];f="";for(p=0;4>p;p++)f+=l[e>>8*p+4&15]+l[e>>8*p&15];c[d]=f}return a.join("")}};b4w.module.shader_texts=function(a,t){a["anchors.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"void main ( ) { gl_FragColor = vec4 ( 1.0 ) ; }".split(" ")}]};a["anchors.glslv"]={type:"group",parts:[{type:"var",name:"ANCHOR_NUM",tokens:["0"]},{type:"include",file:"math.glslv"},{type:"textline",tokens:"attribute float a_index ; uniform vec3 u_position [ ANCHOR_NUM ] ; uniform mat4 u_view_proj_matrix ; void main ( ) { gl_Position = u_view_proj_matrix * vec4 ( u_position [ int ( a_index ) ] , 1.0 ) ; gl_PointSize = 4.0 ; }".split(" ")}]};
a["color_id.glslf"]={type:"group",parts:[{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",tokens:["0"]},{type:"var",name:"NUM_VALUES",tokens:["0"]},{type:"var",name:"NUM_RGBS",tokens:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",tokens:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",
tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",tokens:["0.0"]},{type:"var",name:"RGB_IND",tokens:["0"]},{type:"var",name:"VALUE_IND",tokens:["0"]},{type:"var",name:"LAMP_INDEX",tokens:["0"]},{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},
{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"var",name:"NUM_LFACTORS",tokens:["0"]},{type:"include",file:"precision_statement.glslf"},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"pack.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",
parts:[{type:"if",expression:["CAUSTICS"],group:{type:"group",parts:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"textline",tokens:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",expression:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_sampler",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_OUTLINE",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_color_id",";"]}]}}]},{type:"condition",parts:[{type:"if",
expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",
expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_scene_depth",
";"]}]}}]}]}}]},{type:"textline",tokens:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_mirror_factor",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_refl_plane",
";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_LAMP"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_VALUE"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_RGB"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_OUTLINE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_outline_intensity",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"varying vec3 bC ; varying vec4 bD ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bE",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bF",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},
"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bH",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"uniform float u_perspective_cast_far_bound ; varying vec4 bI ; varying vec4 bJ ; varying vec4 bK ; varying vec4 bL ; uniform float u_perspective_cast_far_bound ; uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ; uniform sampler2D u_shadow_map1 ; uniform sampler2D u_shadow_map2 ; uniform sampler2D u_shadow_map3 ; uniform sampler2D u_shadow_mask ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",
expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION"],
group:{type:"group",parts:[{type:"include",file:"refraction.glslf"}]}}]}]}}]},{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",tokens:"void main ( ) { mat4 qN ; float qO , qP ; vec3 qQ , qR , qS , qT ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NODES"],group:{type:"group",parts:[{type:"textline",tokens:"qQ = u_camera_eye_frag - bC ; qQ = normalize ( qQ ) ;".split(" ")},{type:"condition",
parts:[{type:"if",expression:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"qN = O ( u_view_tsr_frag ) ; qM ( qQ , qN , qR , qS , qT , qO , qP ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"qM ( qQ , mat4 ( 0.0 ) , qR , qS , qT , qO , qP ) ;".split(" ")}]}}]},{type:"textline",tokens:["qP","=","qP",";"]}]}},{type:"else",group:{type:"group",
parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"qP = ( texture2D ( u_sampler , bM ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"qP = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"if ( qP < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_OUTLINE"],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_outline_intensity ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["color_id.glslv"]={type:"group",parts:[{type:"var",name:"AU_QUALIFIER",tokens:["uniform"]},{type:"var",name:"MAX_BONES",tokens:["0"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",tokens:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",
file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",tokens:["attribute","vec3","a_position",";"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:5}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",
"ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_tangent",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",
expression:["MAIN_BEND_COL"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","float","a_bending_col_main",";"]},{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["attribute",
"vec3","a_position_next",";"]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_normal_next",";"]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",
tokens:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"textline",tokens:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",
parts:[{type:"textline",tokens:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["BILLBOARD_JITTERED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},
{type:"textline",tokens:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"varying vec3 bC ; varying vec4 bD ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:5}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bE",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",
parts:[{type:"textline",tokens:["varying","vec4","bF",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying",
"float","bH",";"]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",tokens:"void main ( ) { vec4 tv ; float tw , tx , ty ; vec3 tz , tA , tB , tC , tD , tE ; mat4 tF , tG , tH ; tF = O ( u_view_tsr ) ; tz = a_position ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA","CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:5},{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["tA","=","a_normal",";"]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"tB = vec3 ( a_tangent ) ; tC = a_tangent [ 3 ] * cross ( tA , tB ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"tB = vec3 ( 0.0 ) ; tC = vec3 ( 0.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"tA = vec3 ( 0.0 ) ; tB = vec3 ( 0.0 ) ; tC = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:"tz = mix ( tz , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES",
"ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:"tA = mix ( tA , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"tD = vec3 ( a_tangent ) ; tE = a_tangent_next [ 3 ] * cross ( a_normal_next , tD ) ; tB = mix ( tB , tD , u_va_frame_factor ) ; tC = mix ( tC , tE , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"sB ( tz , tB , tC , tA ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["tC","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"tC = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"tG = O ( u_model_tsr ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:"tB = ( tG * vec4 ( tC , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"tH = ru ( u_camera_eye , tB , tF , tG ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:"tH = ro ( u_camera_eye , tB , tF ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"tH = tH * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , tB ) ;".split(" ")}]}}]},{type:"textline",tokens:"c tI = rB ( tz - tC , tC , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , tH ) ; tI . b = tB ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:"c tI = rB ( tz , tC , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , tG ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"tp ( tI . a , tI . b , tA ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL","DETAIL_BEND",
{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["tA","=","a_normal",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"tA = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"tp ( tI . a , tI . b , tA ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2},{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],
group:{type:"group",parts:[{type:"textline",tokens:"bM = rE ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bC = tI . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",
places:5}],group:{type:"group",parts:[{type:"textline",tokens:"bE = tI . e ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"tw = ( dot ( cross ( tI . e , tI . c ) , tI . d ) < 0.0 ) ? - 1.0 : 1.0 ; bF = vec4 ( tI . c , tw ) ;".split(" ")}]}}]},{type:"textline",tokens:"bD = tF * vec4 ( tI . a , 1.0 ) ; tv = u_proj_matrix * bD ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",
parts:[{type:"textline",tokens:"tv . xy += u_subpixel_jitter * tv . w ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"tw = tv . x ; tx = tv . y ; ty = tv . w ; bG . x = ( tw + ty ) / 2.0 ; bG . y = ( tx + ty ) / 2.0 ; bG . z = ty ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION",
"REFRACTIVE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bH = - bD . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",tokens:["tu","(",")",";"]}]}}]},{type:"textline",tokens:"gl_Position = u_proj_matrix * tF * vec4 ( tI . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",parts:[{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",tokens:["0"]},{type:"var",name:"NUM_VALUES",
tokens:["0"]},{type:"var",name:"NUM_RGBS",tokens:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",tokens:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",tokens:["0.0"]},{type:"var",name:"RGB_IND",tokens:["0"]},{type:"var",name:"VALUE_IND",
tokens:["0"]},{type:"var",name:"LAMP_INDEX",tokens:["0"]},{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"var",name:"NUM_LFACTORS",tokens:["0"]},{type:"include",
file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1},"NODES","ALPHA",{type:"logical_and_expr",places:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"include",file:"procedural.glslf"}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",
parts:[{type:"include",file:"pack.glslf"},{type:"condition",parts:[{type:"if",expression:["CAUSTICS"],group:{type:"group",parts:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"textline",tokens:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",
places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",expression:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",
expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"textline",tokens:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_mirror_factor",";"]}]}},
{type:"elif",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_LAMP"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_VALUE"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_RGB"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",
tokens:["uniform","sampler2D","u_colormap0",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_diffuse_color",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_perspective_cast_far_bound",";"]}]}}]},
{type:"textline",tokens:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},
{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_shadow_mask",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"textline",
tokens:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bC",";"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO",
"CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bE",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bF",";"]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]}]}}]},{type:"condition",
parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"NODES","ALPHA",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bD",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bI",";"]},{type:"condition",parts:[{type:"if",
expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bJ",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bK",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",
places:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bH",";"]}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1},"NODES","ALPHA",{type:"logical_and_expr",places:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"include",file:"shadow.glslf"}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"mirror.glslf"},{type:"include",
file:"environment.glslf"},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION"],group:{type:"group",parts:[{type:"include",file:"refraction.glslf"}]}}]}]}}]},{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",tokens:"void main ( ) { mat4 tv ; float tw , tx ; vec3 ty , tz , tA , tB ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"condition",
parts:[{type:"if",expression:["NODES"],group:{type:"group",parts:[{type:"textline",tokens:"ty = u_camera_eye_frag - bC ; ty = normalize ( ty ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"tv = O ( u_view_tsr_frag ) ; qM ( ty , tv , tz , tA , tB , tw , tx ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:"qM ( ty , mat4 ( 0.0 ) , tz , tA , tB , tw , tx ) ;".split(" ")}]}}]},{type:"textline",tokens:["tx","=","tx",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"tx = ( texture2D ( u_colormap0 , bM ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"tx = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"if ( tx < 0.5 ) discard ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","NO_SHADOWS",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}},{type:"elif",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( dp ( bD . z ) , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor . a += 0.00001 * bF . r ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:["}"]}]};a["depth.glslv"]={type:"group",parts:[{type:"var",name:"AU_QUALIFIER",tokens:["uniform"]},{type:"var",name:"MAX_BONES",tokens:["0"]},{type:"var",name:"SHADOW_TEX_RES",
tokens:["0.0"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",tokens:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",tokens:["attribute","vec3","a_position",";"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND",
"MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA","CALC_TBN_SPACE",{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",parts:[{type:"if",
expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL"],group:{type:"group",
parts:[{type:"textline",tokens:["attribute","float","a_bending_col_main",";"]},{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_position_next",";"]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN",
"USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_normal_next",";"]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2},{type:"logic_negative_expr",places:1},"TEXTURE_COLOR",
{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],
group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",tokens:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["BILLBOARD","SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",
places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_shadow_cast_billboard_view_tsr",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["BILLBOARD_JITTERED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",tokens:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float",
"u_va_frame_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2},{type:"logic_negative_expr",places:1},"TEXTURE_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_normal_offset ; uniform mat3 u_v_light_tsr ; uniform mat4 u_p_light_matrix0 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",
parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bC",";"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL",
"DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:5}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bE",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bF",";"]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",
";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"NODES","ALPHA",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bD",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bI",";"]},
{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bJ",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bK",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE",
"REFL_PLANE",{type:"equal_expr",places:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float",
"bH",";"]}]}}]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",tokens:"void main ( ) { vec2 um ; vec4 un , uo ; float up ; vec3 uq , ur , us , ut , uu , uv ; mat4 uw , ux , uy , uz ; uw = O ( u_view_tsr ) ; uq = a_position ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["ur","=","a_normal",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"ur = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",
parts:[{type:"if",expression:["NODES","ALPHA","CALC_TBN_SPACE",{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:"us = vec3 ( a_tangent ) ; ut = a_tangent [ 3 ] * cross ( ur , us ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"us = vec3 ( 0.0 ) ; ut = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:"uq = mix ( uq , a_position_next , u_va_frame_factor ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:"ur = mix ( ur , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",
parts:[{type:"textline",tokens:"uu = vec3 ( a_tangent ) ; uv = a_tangent_next [ 3 ] * cross ( a_normal_next , uu ) ; us = mix ( us , uu , u_va_frame_factor ) ; ut = mix ( ut , uv , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"sB ( uq , us , ut , ur ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],
group:{type:"group",parts:[{type:"textline",tokens:["ut","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"ut = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"c uA = t_ ( uq , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ur , ut , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , uw ) ;".split(" ")}]}},{type:"else",
group:{type:"group",parts:[{type:"textline",tokens:"ux = O ( u_model_tsr ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:"us = ( ux * vec4 ( ut , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["HAIR_BILLBOARD",{type:"logic_negative_expr",places:1},"SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uy = O ( u_shadow_cast_billboard_view_tsr ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uy","=","uw",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uz = ru ( u_camera_eye , us , uy , ux ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"uz = ro ( u_camera_eye , us , uy ) ;".split(" ")}]}}]},{type:"condition",
parts:[{type:"if",expression:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uz = uz * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , us ) ;".split(" ")}]}}]},{type:"textline",tokens:"c uA = rB ( uq - ut , ut , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ur , uz ) ; uA . b = us ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"c uA = rB ( uq , ut , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ur , ux ) ;".split(" ")}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["ur","=","a_normal",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"ur = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"tp ( uA . a , uA . b , ur ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",
"ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bC = uA . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:5}],group:{type:"group",parts:[{type:"textline",tokens:"bE = uA . e ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],
group:{type:"group",parts:[{type:"textline",tokens:"up = ( dot ( cross ( uA . e , uA . c ) , uA . d ) < 0.0 ) ? - 1.0 : 1.0 ; bF = vec4 ( uA . c , up ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"un = uw * vec4 ( uA . a , 1.0 ) ; uo = u_proj_matrix * un ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",parts:[{type:"textline",tokens:"uo . xy += u_subpixel_jitter * uo . w ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",
"ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bG = L ( uo ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bH = - bD . z / u_view_max_depth ;".split(" ")}]}}]},
{type:"textline",tokens:["tu","(",")",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"bM = rE ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"ul ( uA . a , uA . e ) ;".split(" ")}]}}]},{type:"condition",
parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"NODES","ALPHA",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["bD","=","un",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"um = ( u_proj_matrix * uw [ 3 ] ) . xy ; up = SHADOW_TEX_RES / 2.0 ; um = floor ( um * up + 0.5 ) / up - um ; uo . xy += um ;".split(" ")}]}}]},
{type:"textline",tokens:["gl_Position","=","uo",";","}"]}]};a["grass_map.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_SIZE"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","um",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["varying","float","um",";"]}]}}]}]}},
{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","um",";"]}]}}]}]}}]},{type:"textline",tokens:["void","main","(",")","{"]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_SIZE"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["gl_FragColor","=","um",";"]}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( um , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( 1.0 , um ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:["}"]}]};a["grass_map.glslv"]=
{type:"group",parts:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",tokens:["attribute","vec3","a_position",";"]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_SIZE"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","float","a_grass_size",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"textline",tokens:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",
tokens:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_SIZE"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],
group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","um",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["varying","float","um",";"]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","um",";"]}]}}]}]}}]},{type:"textline",tokens:"void main ( ) { vec4 un ; vec3 uo ; mat4 up , uq , ur ; up = O ( u_view_tsr ) ; uq = O ( u_model_tsr ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:"uo = ( uq * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; ur = ro ( u_camera_eye , uo , up ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"ur = ur * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"c us = rB ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ur ) ; us . b = uo ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"c us = rB ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , uq ) ;".split(" ")}]}}]},{type:"textline",tokens:"un = u_proj_matrix * up * vec4 ( us . a , 1.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_SIZE"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"um = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["um","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["um","=","a_grass_color",";"]}]}}]}]}}]},{type:"textline",tokens:["gl_Position","=","un",";","}"]}]};a["halo.glslf"]={type:"group",parts:[{type:"var",name:"NUM_LINES",tokens:["0"]},{type:"var",name:"NUM_RINGS",tokens:["0"]},{type:"var",
name:"NUM_STARS",tokens:["0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",tokens:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SKY_STARS"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_sun_intensity",
";"]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 un ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"varying vec2 bM ; varying float uo ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_RINGS","NUM_LINES",
{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"const int up = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"const int up = NUM_LINES ;".split(" ")}]}}]},{type:"textline",tokens:"float ur ( float uq ) { return uq - floor ( uq * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_RINGS"],group:{type:"group",parts:[{type:"textline",tokens:"void uA ( inout float us , in float ut [ up ] , in float uu ) { float uv , uw , ux , uy ; for ( int uz = 0 ; uz < NUM_RINGS ; uz ++ ) { uv = 40.0 * ut [ uz ] ; uw = 300.0 * ( ur ( uv ) - 0.005 ) ; ux = uv ; uy = abs ( ux * ( u_halo_size * uw - uu ) ) ; us += 1.0 - min ( uy , 1.0 ) ; } }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["NUM_LINES"],group:{type:"group",parts:[{type:"textline",tokens:"void uJ ( inout float uB , in float uC [ up ] , in float uD ) { float uE , uF , uG , uH ; for ( int uI = 0 ; uI < NUM_LINES ; uI ++ ) { uE = uC [ uI ] ; uF = uE ; uG = 1000.0 * ( ur ( uE ) - 0.005 ) ; uH = 20.0 * abs ( uF * bM . x + uG * bM . y ) ; uB += 1.0 - min ( uH , 1.0 ) ; } uB *= uD ; }".split(" ")}]}}]},{type:"textline",tokens:"void uQ ( inout float uK , in vec2 uL ) { float uM , uN , uO , uP ; uN = atan ( uL . y , uL . x ) ; uN *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; uO = cos ( uN ) ; uP = sin ( uN ) ; uN = ( uO * uL . x + uP * uL . y ) * ( uO * uL . y - uP * uL . x ) ; uM = abs ( uN ) ; if ( uM < 1.0 ) { uM = ( 0.01 * u_halo_size ) / ( uM ) ; uK *= sqrt ( min ( uM , 1.0 ) ) ; } } void main ( ) { vec3 uR ; float uS , uT , uU , uV ; uS = ( bM . x * bM . x + bM . y * bM . y ) ; uT = sqrt ( uS ) ; uS = max ( 1.0 - uS , 0.0 ) ; uS = pow ( uS , u_halo_hardness ) ; uU = u_diffuse_color . a ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["NUM_RINGS","NUM_LINES",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"float uW [ up ] ; for ( int uX = 0 ; uX < up ; uX ++ ) { uW [ uX ] = fract ( uo / ( float ( uX ) + 0.01 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_RINGS"],group:{type:"group",parts:[{type:"textline",tokens:"uV = 0.0 ; uA ( uV , uW , uT ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_LINES"],
group:{type:"group",parts:[{type:"textline",tokens:"uT = 0.0 ; uJ ( uT , uW , uS ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_STARS"],group:{type:"group",parts:[{type:"textline",tokens:"uQ ( uS , bM ) ;".split(" ")}]}}]},{type:"textline",tokens:"uS *= uU ; uR = u_diffuse_color . rgb ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_RINGS"],group:{type:"group",parts:[{type:"textline",tokens:"uV *= uS ; uR += u_halo_rings_color * uV ; uS += uV ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["NUM_LINES"],group:{type:"group",parts:[{type:"textline",tokens:"uT *= uU ; uR += u_halo_lines_color * uT ; uS += uT ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SKY_STARS"],group:{type:"group",parts:[{type:"textline",tokens:"uS *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uT = u_halo_stars_blend * ( un . y - u_halo_stars_height ) ; uS *= clamp ( uT , 0.0 , 1.0 ) ; uS *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"bu ( uR ) ; bx ( uR , uS ) ; gl_FragColor = vec4 ( uR , uS ) ; }".split(" ")}]};a["halo.glslv"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},
{type:"textline",tokens:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform PRECISION float u_halo_size ; varying vec2 bM ; varying float uo ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","un",";"]}]}}]},{type:"textline",tokens:"void main ( ) { vec4 up , uq ; vec3 ur ; mat4 us , ut , uu ; us = O ( u_view_tsr ) ; ut = O ( u_model_tsr ) ; ur = ( ut * vec4 ( a_position , 1.0 ) ) . xyz ; bM = a_halo_bb_vertex * 2.0 ; uo = fract ( ur . x + ur . y + ur . z ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SKY_STARS"],group:{type:"group",parts:[{type:"textline",tokens:"ut = qT ( ur , us ) ; uu = us ; uu [ 3 ] [ 0 ] = 0.0 ; uu [ 3 ] [ 1 ] = 0.0 ; uu [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"ut = qT ( ur , us ) ;".split(" ")}]}}]},{type:"textline",tokens:"up = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; up = ut * up ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SKY_STARS"],
group:{type:"group",parts:[{type:"textline",tokens:"uq = u_proj_matrix * uu * up ; uq . z = 0.99999 * uq . w ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["un","=","up",";"]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"uq = u_proj_matrix * us * up ;".split(" ")}]}}]},{type:"textline",tokens:["gl_Position",
"=","uq",";","}"]}]};a["line.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform vec4 u_diffuse_color ; void main ( ) { gl_FragColor = u_diffuse_color ; }".split(" ")}]};a["line.glslv"]={type:"group",parts:[{type:"var",name:"NUM_POINTS",tokens:["0"]},{type:"include",file:"math.glslv"},{type:"textline",tokens:"attribute float a_point ; uniform vec3 u_line_points [ NUM_POINTS ] ; uniform mat4 u_view_proj_matrix ; void main ( ) { vec3 up ; up = u_line_points [ int ( a_point ) ] ; gl_Position = u_view_proj_matrix * vec4 ( up , 1.0 ) ; }".split(" ")}]};
a["main.glslf"]={type:"group",parts:[{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",tokens:["0"]},{type:"var",name:"NUM_VALUES",tokens:["0"]},{type:"var",name:"NUM_RGBS",tokens:["0"]},{type:"var",name:"PARALLAX_STEPS",tokens:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",tokens:["0.0"]},{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"var",name:"NUM_LIGHTS",tokens:["0"]},
{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"var",name:"NUM_LFACTORS",tokens:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},
{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"procedural.glslf"},{type:"condition",parts:[{type:"if",expression:["CAUSTICS"],group:{type:"group",parts:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"},{type:"textline",tokens:["uniform","float","u_time",";"]},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT",
"SKY_TEXTURE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",expression:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",tokens:["uniform","float","u_environment_energy",";"]},{type:"condition",parts:[{type:"if",expression:["SHADELESS",
{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","CAUSTICS",
{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"textline",tokens:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"USE_NODE_B4W_VECTOR_VIEW",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_FOG"],group:{type:"group",parts:[{type:"textline",
tokens:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS",
"CAUSTICS",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"samplerCube","u_cube_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_perspective_cast_far_bound",";"]}]}}]},{type:"textline",tokens:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","USE_REFRACTION","REFRACTIVE","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{type:"textline",tokens:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_LAMP"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",
parts:[{type:"if",expression:["USE_NODE_VALUE"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_RGB"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]},{type:"textline",tokens:["varying","vec3","bC",";"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",
"WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bE",";"]}]}}]},{type:"textline",tokens:["varying","vec4","bD",";"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bF",";"]}]}}]},{type:"condition",parts:[{type:"if",
expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bI",";"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bJ",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bK",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],
group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","USE_NODE_B4W_REFRACTION",
{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bH",";"]}]}}]},{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"shadow.glslf"}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",places:2}],group:{type:"group",
parts:[{type:"include",file:"refraction.glslf"}]}}]},{type:"include",file:"nodes.glslf"},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",tokens:"void main ( ) { vec2 vd ; mat4 ve ; vec3 vf , vg , vh , vi , vj ; float vk , vl , vm , vn ; vk = length ( bD ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",
tokens:"vl = bC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},"CAUSTICS","WATER_EFFECTS",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["vf","=","u_sun_intensity",";"]}]}}]},{type:"textline",tokens:"vg = normalize ( u_camera_eye_frag - bC ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_VECTOR_VIEW",
"REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"ve = O ( u_view_tsr_frag ) ; qM ( vg , ve , vh , vi , vj , vm , vn ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"qM ( vg , mat4 ( 0.0 ) , vh , vi , vj , vm , vn ) ;".split(" ")}]}}]},{type:"textline",tokens:"vh = vh ; vn = vn ; vj = vj ; vm = vm ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHADELESS",
{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WETTABLE"],group:{type:"group",parts:[{type:"textline",tokens:"vh = max ( vh - sqrt ( 0.01 * - min ( vl , 0.0 ) ) , 0.5 * vh ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CAUSTICS"],group:{type:"group",parts:[{type:"textline",tokens:"bp ( vh , vl , u_time , vm , vj , u_sun_direction , vf , u_sun_quaternion , bC , vk ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["ALPHA_CLIP"],group:{type:"group",parts:[{type:"textline",tokens:"if ( vn < 0.5 ) discard ; vn = 1.0 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NODES_GLOW",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["vn","=","1.0",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",
expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"vc ( vh , length ( bD ) , vg , vl ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vc ( vh , length ( bD ) , vg , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SSAO_ONLY","SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",
places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vd = texture2DProj ( u_shadow_mask , bG ) . rg ; vl = vd . g ; vh = vec3 ( vl ) ;".split(" ")}]}}]},{type:"textline",tokens:["bu","(","vh",")",";"]},{type:"condition",parts:[{type:"if",expression:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2},"NODES_GLOW",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bx ( vh , vn ) ;".split(" ")}]}}]},
{type:"textline",tokens:"gl_FragColor = vec4 ( vh , vn ) ; }".split(" ")}]};a["main.glslv"]={type:"group",parts:[{type:"var",name:"AU_QUALIFIER",tokens:["uniform"]},{type:"var",name:"MAX_BONES",tokens:["0"]},{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",tokens:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",
tokens:["attribute","vec3","a_position",";"]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",places:7}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO",
"CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["AU_QUALIFIER","vec3","au_center_pos",
";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","float","a_bending_col_main",";"]},{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",tokens:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_position_next",";"]},{type:"condition",parts:[{type:"if",expression:["NODES",
{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_normal_next",";"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",
parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_color",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",
parts:[{type:"textline",tokens:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_PASS"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_tsr",";"]}]}}]},
{type:"textline",tokens:["uniform","mat4","u_proj_matrix",";"]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"BILLBOARD",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],
group:{type:"group",parts:[{type:"textline",tokens:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["BILLBOARD_JITTERED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},
{type:"textline",tokens:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE",
"SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_normal_offset ; uniform mat3 u_v_light_tsr ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",tokens:["varying","vec3","bC",";"]},{type:"condition",
parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",places:7}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bE",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","DISABLE_FOG",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","PARALLAX",
{type:"logical_and_expr",places:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bD",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bF",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",
places:1}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","vd",";"]},{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","ve",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE",
"SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bI",";"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bJ",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bK",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",
parts:[{type:"textline",tokens:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","NODES",{type:"logic_negative_expr",
places:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bH",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",parts:[{type:"if",expression:["NODES"],group:{type:"group",parts:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",tokens:"void main ( ) { vec4 vf , vg ; float vh ; vec3 vi , vj , vk , vl , vm , vn , vo ; mat4 vp , vq , vr ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_PASS"],group:{type:"group",parts:[{type:"textline",tokens:["vp","=","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vp = O ( u_view_tsr ) ;".split(" ")}]}}]},{type:"textline",tokens:"vq = O ( u_model_tsr ) ; vi = a_position ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",
{type:"logical_and_expr",places:3},"NODES",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["vj","=","a_normal",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vj = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE","NODES",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",places:2},{type:"logical_and_expr",
places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vk = vec3 ( a_tangent ) ; vl = a_tangent [ 3 ] * cross ( vj , vk ) ;".split(" ")}]}},{type:"elif",expression:["NODES",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vm = ( vq * vec4 ( a_position , 1.0 ) ) . xyz ; vn = normalize ( ( vq * vec4 ( a_normal , 0.0 ) ) . xyz ) ; vm = vm - u_camera_eye ; vl = cross ( vm , vn ) ; vk = cross ( vn , vl ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vk = vec3 ( 0.0 ) ; vl = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:"vi = mix ( vi , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",
places:5}],group:{type:"group",parts:[{type:"textline",tokens:"vj = mix ( vj , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO"],group:{type:"group",parts:[{type:"textline",tokens:"vn = vec3 ( a_tangent ) ; vm = a_tangent_next [ 3 ] * cross ( a_normal_next , vn ) ; vk = mix ( vk , vn , u_va_frame_factor ) ; vl = mix ( vl , vm , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],
group:{type:"group",parts:[{type:"textline",tokens:"sB ( vi , vk , vl , vj ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["vm","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vm = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",
tokens:"c vs = t_ ( vi , vk , vl , vj , vm , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , vp ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:"vn = ( vq * vec4 ( vm , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",
places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vr = ru ( u_camera_eye , vn , vp , vq ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vr = ro ( u_camera_eye , vn , vp ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vo = ( vq * vec4 ( vm , 1.0 ) ) . xyz ; vr = vr * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vo ) ;".split(" ")}]}}]},
{type:"textline",tokens:"c vs = rB ( vi - vm , vm , vk , vl , vj , vr ) ; vs . b = vn ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"c vs = rB ( vi , vm , vk , vl , vj , vq ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vh = ( dot ( cross ( vs . e , vs . c ) , vs . d ) < 0.0 ) ? - 1.0 : 1.0 ; bF = vec4 ( vs . c , vh ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"tp ( vs . a , vs . b , vj ) ;".split(" ")}]}}]},{type:"textline",tokens:"bC = vs . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:6}],group:{type:"group",
parts:[{type:"textline",tokens:"bE = vs . e ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"vd = u_camera_eye - vs . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"bM = rE ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",
parts:[{type:"textline",tokens:"ve = vs . f ;".split(" ")}]}},{type:"elif",expression:["VERTEX_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["ve","=","a_color",";"]}]}}]}]}}]},{type:"textline",tokens:"vf = vp * vec4 ( vs . a , 1.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES","DISABLE_FOG",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2},{type:"logical_or_expr",
places:4}],group:{type:"group",parts:[{type:"textline",tokens:["bD","=","vf",";"]}]}}]},{type:"textline",tokens:"vg = u_proj_matrix * vf ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",parts:[{type:"textline",tokens:"vg . xy += u_subpixel_jitter * vg . w ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2},
"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:"bG = L ( vg ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"ul ( vs . a , vs . e ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","NODES",{type:"logic_negative_expr",places:1},"USE_NODE_B4W_REFRACTION",
{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bH = - vf . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES"],group:{type:"group",parts:[{type:"textline",tokens:["tu","(",")",";"]}]}}]},{type:"textline",tokens:["gl_Position","=","vg",";","}"]}]};a["main_stack.glslf"]={type:"group",parts:[{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},
{type:"var",name:"NUM_LAMP_LIGHTS",tokens:["0"]},{type:"var",name:"NUM_VALUES",tokens:["0"]},{type:"var",name:"NUM_RGBS",tokens:["0"]},{type:"var",name:"PARALLAX_STEPS",tokens:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",tokens:["0.0"]},{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",
tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"var",name:"NUM_LFACTORS",tokens:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",
parts:[{type:"include",file:"procedural.glslf"},{type:"condition",parts:[{type:"if",expression:["CAUSTICS"],group:{type:"group",parts:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"},{type:"textline",tokens:["uniform","float","u_time",";"]},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"samplerCube","u_sky_texture",";"]}]}},{type:"elif",expression:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",tokens:["uniform","float","u_environment_energy",";"]},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",
expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4",
"u_sun_quaternion",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",
parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR0_CO"],
group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_SPEC","ALPHA_AS_SPEC",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_specmap0",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_normalmap0",
";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",parts:[{type:"textline",tokens:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_shadow_mask",
";"]}]}},{type:"elif",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_perspective_cast_far_bound",";"]}]}}]},{type:"textline",tokens:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],
group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",
expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{type:"textline",tokens:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_reflect_factor",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"textline",tokens:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_normal_factor",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["TEXTURE_COLOR0_CO"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_SPEC"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",tokens:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_refr_bump",";"]}]}}]},{type:"textline",tokens:"varying vec3 bC ; varying vec3 bE ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1},
"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bD",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bF",";"]}]}}]},{type:"textline",tokens:["varying","vec3","vd",";"]},
{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","ve",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:["varying","vec4","bI",";"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bJ",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bK",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",
parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2},"REFRACTIVE",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bH",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",
places:1}],group:{type:"group",parts:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"include",file:"refraction.glslf"}]}}]},{type:"include",file:"environment.glslf"},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"lighting_nodes.glslf"}]}}]},{type:"condition",parts:[{type:"if",
expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",tokens:"void main ( ) { vec4 xk , xl , xm , xn ; mat4 xo ; mat3 xp ; vec2 xq , xr , xs , xt ; vec3 xu , xv , xw , xx , xy , xz , xA , xB , xC ; float xD , xE , xF , xG , xH ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2},"WATER_EFFECTS",
"CAUSTICS",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:"xD = length ( bD ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"xE = bC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},"CAUSTICS","WATER_EFFECTS",{type:"logical_and_expr",
places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["xu","=","u_sun_intensity",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:["xq","=","bM",";"]}]}}]},{type:"textline",tokens:"xv = normalize ( bE ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["INVERT_FRONTFACING"],
group:{type:"group",parts:[{type:"textline",tokens:["if","(","!","gl_FrontFacing",")"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["if","(","gl_FrontFacing",")"]}]}}]},{type:"textline",tokens:"xv = xv ; else xv = - xv ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO"],group:{type:"group",parts:[{type:"textline",tokens:"xw = cross ( xv , bF . xyz ) * bF . w ; xp = mat3 ( bF . xyz , xw , xv ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",
expression:["NORMAL_TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"xo = O ( u_view_tsr_frag ) ; xr = normalize ( xo * vec4 ( bE , 0.0 ) ) . st ; xr = xr * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( xD < PARALLAX_LOD_DIST ) { xF = clamp ( 0.5 * ( PARALLAX_LOD_DIST - xD ) , 0.0 , 1.0 ) ; xF = u_parallax_scale * xF ; xw = normalize ( vd * xp ) ; xG = 1.0 / PARALLAX_STEPS ; xs = xw . xy * xF / ( PARALLAX_STEPS * xw . z ) ; xF = 1.0 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["xt","=","xr",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["xt","=","xq",";"]}]}}]},{type:"textline",tokens:"xH = texture2D ( u_normalmap0 , xt ) . a ; for ( float xI = 1.0 ; xI <= PARALLAX_STEPS ; xI ++ ) { if ( xH < xF ) { xF -= xG ; xt -= xs ; xH = texture2D ( u_normalmap0 , xt ) . a ; } } xs = xt + xs ; xG = texture2D ( u_normalmap0 , xs ) . a - ( xF + xG ) ; xF = xH - xF ; xG = xF / ( xF - xG ) ; xt = xG * xs + ( 1.0 - xG ) * xt ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"xq += xt - xr ;".split(" ")}]}}]},{type:"textline",tokens:["xr","=","xt",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"xr += xt - xq ;".split(" ")}]}}]},
{type:"textline",tokens:["xq","=","xt",";"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO"],group:{type:"group",parts:[{type:"textline",tokens:[";"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xk = texture2D ( u_normalmap0 , xr ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"xk = texture2D ( u_normalmap0 , xq ) ;".split(" ")}]}}]},
{type:"textline",tokens:"xw = xk . rgb - 0.5 ; xw = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , xw , u_normal_factor ) ; xw = xp * xw ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["xw","=","xv",";"]}]}}]},{type:"textline",tokens:"xw = normalize ( xw ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"xr = normalize ( xo * vec4 ( xw , 0.0 ) ) . st ; xr = xr * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},
{type:"textline",tokens:"xv = normalize ( vd ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xx = ve ; br ( xx ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xk = vec4 ( xx , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",
parts:[{type:"textline",tokens:["xk","=","u_diffuse_color",";"]}]}}]},{type:"textline",tokens:["xG","=","1.0",";"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xl = texture2D ( u_colormap0 , xr ) ;".split(" ")}]}},{type:"elif",expression:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xl = texture2D ( u_colormap0 , xq ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR0_CO"],group:{type:"group",parts:[{type:"textline",tokens:"br ( xl . rgb ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",parts:[{type:"textline",tokens:[";"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR1_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xm = texture2D ( u_colormap1 , xr ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"xm = texture2D ( u_colormap1 , xq ) ;".split(" ")}]}}]},{type:"textline",tokens:"br ( xm . rgb ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_STENCIL_ALPHA_MASK_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xn = texture2D ( u_stencil0 , xr ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"xn = texture2D ( u_stencil0 , xq ) ;".split(" ")}]}}]},
{type:"textline",tokens:"xl = mix ( xl , xm , xn . r ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xk . rgb = mix ( xk . rgb , xl . rgb , u_diffuse_color_factor ) ; xF = u_alpha_factor * xl . a ; xF += ( 1.0 - step ( 0.0 , xF ) ) ; xk . a = mix ( xF , 1.0 , u_diffuse_color . a ) ; xG = xl . a ;".split(" ")}]}},{type:"elif",expression:["TEXTURE_BLEND_TYPE",
"TEXTURE_BLEND_TYPE_MULTIPLY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xk . rgb *= mix ( vec3 ( 1.0 ) , xl . rgb , u_diffuse_color_factor ) ; xk . a = xl . a ; xG = xl . a ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"xx = u_diffuse_intensity * xk . rgb ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHADELESS"],group:{type:"group",parts:[{type:"textline",tokens:["xy","=","xx",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:"xz = u_environment_energy * dS ( xw ) ; xz = u_ambient * xz ; xF = du ( xx ) ; xA = u_emit * xk . rgb ; xB = u_specular_color ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_SPEC"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["ALPHA_AS_SPEC"],group:{type:"group",parts:[{type:"textline",tokens:"xC = vec3 ( xG ) ;".split(" ")}]}},{type:"elif",expression:["TEXTURE_SPEC_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",
parts:[{type:"textline",tokens:"xC = texture2D ( u_specmap0 , xr ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"xC = texture2D ( u_specmap0 , xq ) . rgb ;".split(" ")}]}}]},{type:"textline",tokens:"br ( xC . rgb ) ; xB = mix ( xB , xC , u_specular_color_factor ) ;".split(" ")}]}}]},{type:"textline",tokens:"xG = u_specular_params [ 0 ] ; xq = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; xB = xG * xB ; xj ( xA , xz , xx , xB , bC , xw , xv , xq , u_diffuse_params , xF , 0.0 , vec4 ( 0.0 ) , xy , xC ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"dP ( xy , xv , xw , u_reflect_factor , xo ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"dP ( xy , xv , xw , u_reflect_factor , mat4 ( 0.0 ) ) ;".split(" ")}]}}]}]}},
{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"dP ( xy , xv , xw , 0.0 , xo ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"dP ( xy , xv , xw , 0.0 , mat4 ( 0.0 ) ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",
places:1}],group:{type:"group",parts:[{type:"textline",tokens:["xy","+=","xC",";"]}]}}]},{type:"textline",tokens:"xG = xk . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WETTABLE"],group:{type:"group",parts:[{type:"textline",tokens:"xy = max ( xy - sqrt ( 0.01 * - min ( xE , 0.0 ) ) , 0.5 * xy ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["CAUSTICS"],group:{type:"group",parts:[{type:"textline",tokens:"bp ( xy , xE , u_time , xF , xw , u_sun_direction , xu , u_sun_quaternion , bC , xD ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["ALPHA_CLIP"],group:{type:"group",parts:[{type:"textline",tokens:"if ( xG < 0.5 ) discard ; xG = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",
parts:[{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"xF = max ( max ( xC . r , xC . g ) , xC . b ) * u_specular_alpha ; xG = xk . a * ( 1.0 - xF ) + xF ;".split(" ")}]}}]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["xG","=","1.0",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:"xy = mix ( ef ( bG , xw . xz * u_refr_bump ) , xy , xG ) ; xG = 1.0 ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"vc ( xy , xD , xv , xE ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vc ( xy , xD , xv , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:["bu","(","xy",")",";"]},{type:"condition",parts:[{type:"if",expression:["ALPHA",
"ALPHA_CLIP",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bx ( xy , xG ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( xy , xG ) ; }".split(" ")}]};a["main_stack.glslv"]={type:"group",parts:[{type:"var",name:"AU_QUALIFIER",tokens:["uniform"]},{type:"var",name:"MAX_BONES",tokens:["0"]},{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",tokens:["u_va_frame_factor"]},
{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",tokens:["attribute","vec3","a_position",";"]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",
places:7}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",parts:[{type:"if",
expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","float","a_bending_col_main",";"]},{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],
group:{type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3",
"a_emitter_center",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_position_next",";"]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_normal_next",
";"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec2","a_texcoord",";"]}]}}]},
{type:"condition",parts:[{type:"if",expression:["VERTEX_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_color",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["REFLECTION_PASS"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_tsr",";"]}]}}]},{type:"textline",tokens:["uniform","mat4","u_proj_matrix",";"]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"BILLBOARD",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"vec3","u_camera_eye",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["BILLBOARD_JITTERED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",tokens:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"float","u_va_frame_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_normal_offset ; uniform mat3 u_v_light_tsr ; uniform mat4 u_p_light_matrix0 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",
parts:[{type:"if",expression:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",tokens:["varying","vec3","bC",";"]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",
places:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",places:7}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bE",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","DISABLE_FOG",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bD",";"]}]}}]},
{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bF",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","vd",";"]},{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2",
"bM",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","ve",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bI",";"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",
tokens:["varying","vec4","bJ",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bK",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",
places:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","NODES",{type:"logic_negative_expr",places:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bH",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},
{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",parts:[{type:"if",expression:["NODES"],group:{type:"group",parts:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",tokens:"void main ( ) { vec4 xk , xl ; float xm ; vec3 xn , xo , xp , xq , xr , xs , xt ; mat4 xu , xv , xw ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFLECTION_PASS"],group:{type:"group",parts:[{type:"textline",tokens:["xu",
"=","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"xu = O ( u_view_tsr ) ;".split(" ")}]}}]},{type:"textline",tokens:"xv = O ( u_model_tsr ) ; xn = a_position ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},"NODES",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:6}],group:{type:"group",
parts:[{type:"textline",tokens:["xo","=","a_normal",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"xo = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE","NODES",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xp = vec3 ( a_tangent ) ; xq = a_tangent [ 3 ] * cross ( xo , xp ) ;".split(" ")}]}},
{type:"elif",expression:["NODES",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xr = ( xv * vec4 ( a_position , 1.0 ) ) . xyz ; xs = normalize ( ( xv * vec4 ( a_normal , 0.0 ) ) . xyz ) ; xr = xr - u_camera_eye ; xq = cross ( xr , xs ) ; xp = cross ( xs , xq ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"xp = vec3 ( 0.0 ) ; xq = vec3 ( 0.0 ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:"xn = mix ( xn , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:5}],group:{type:"group",parts:[{type:"textline",tokens:"xo = mix ( xo , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO"],group:{type:"group",parts:[{type:"textline",tokens:"xs = vec3 ( a_tangent ) ; xr = a_tangent_next [ 3 ] * cross ( a_normal_next , xs ) ; xp = mix ( xp , xs , u_va_frame_factor ) ; xq = mix ( xq , xr , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"sB ( xn , xp , xq , xo ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",
expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["xr","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"xr = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"c xx = t_ ( xn , xp , xq , xo , xr , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , xu ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:"xs = ( xv * vec4 ( xr , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xw = ru ( u_camera_eye , xs , xu , xv ) ;".split(" ")}]}},{type:"else",group:{type:"group",
parts:[{type:"textline",tokens:"xw = ro ( u_camera_eye , xs , xu ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xt = ( xv * vec4 ( xr , 1.0 ) ) . xyz ; xw = xw * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , xt ) ;".split(" ")}]}}]},{type:"textline",tokens:"c xx = rB ( xn - xr , xr , xp , xq , xo , xw ) ; xx . b = xs ;".split(" ")}]}},{type:"else",
group:{type:"group",parts:[{type:"textline",tokens:"c xx = rB ( xn , xr , xp , xq , xo , xv ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xm = ( dot ( cross ( xx . e , xx . c ) , xx . d ) < 0.0 ) ? - 1.0 : 1.0 ; bF = vec4 ( xx . c , xm ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"textline",
tokens:"tp ( xx . a , xx . b , xo ) ;".split(" ")}]}}]},{type:"textline",tokens:"bC = xx . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:"bE = xx . e ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",
expression:["NODES",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"vd = u_camera_eye - xx . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"bM = rE ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"ve = xx . f ;".split(" ")}]}},{type:"elif",expression:["VERTEX_COLOR"],
group:{type:"group",parts:[{type:"textline",tokens:["ve","=","a_color",";"]}]}}]}]}}]},{type:"textline",tokens:"xk = xu * vec4 ( xx . a , 1.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES","DISABLE_FOG",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["bD","=","xk",";"]}]}}]},
{type:"textline",tokens:"xl = u_proj_matrix * xk ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",parts:[{type:"textline",tokens:"xl . xy += u_subpixel_jitter * xl . w ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:4}],group:{type:"group",
parts:[{type:"textline",tokens:"bG = L ( xl ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"ul ( xx . a , xx . e ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","NODES",{type:"logic_negative_expr",places:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"bH = - xk . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES"],group:{type:"group",parts:[{type:"textline",tokens:["tu","(",")",";"]}]}}]},{type:"textline",tokens:["gl_Position","=","xl",";","}"]}]};a["particles_color.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"include",
file:"pack.glslf"}]}}]},{type:"var",name:"SOFT_STRENGTH",tokens:["1.0"]},{type:"textline",tokens:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec2 u_texel_size ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},{type:"textline",tokens:"varying float xk ; varying vec3 ve ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"varying vec4 bD ; varying vec3 bG ; varying float xl ;".split(" ")}]}}]},{type:"textline",tokens:"void main ( ) { vec4 xm ; vec3 xn ; float xo , xp , xq ; vec2 xr , xs ; xr = gl_PointCoord - 0.5 ; xo = 2.0 * length ( xr ) ; xo = smoothstep ( u_p_alpha_start , u_p_alpha_end , xo ) ; xo = u_diffuse_color . a * xk * ( 1.0 - xo ) ; xn = ve * u_diffuse_color . rgb ;".split(" ")},{type:"condition",
parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"xs = bG . xy / bG . z ; xr = vec2 ( xr . x , - xr . y ) * xl * u_texel_size ; xr = vec2 ( xs + xr ) ; xm = texture2D ( u_scene_depth , xr ) ; xp = Z ( xm ) ; xq = - bD . z / u_view_max_depth ; xq = xp - xq ; xq = u_view_max_depth / SOFT_STRENGTH * xq ; xo = xo * min ( xq , 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:["bu","(","xn",")",";"]},{type:"condition",parts:[{type:"if",expression:["ALPHA",
"ALPHA_CLIP",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bx ( xn , xo ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( xn , xo ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",parts:[{type:"var",name:"COLOR_RAMP_LENGTH",tokens:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",tokens:["0"]},{type:"textline",tokens:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SIZE_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",tokens:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform float u_p_wind_fac ; uniform float u_p_max_lifetime ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_PASS"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_tsr",";"]}]}}]},{type:"textline",tokens:"uniform mat4 u_proj_matrix ; uniform vec3 u_wind ; uniform float u_height ; uniform float u_p_size ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WORLD_SPACE",{type:"logic_negative_expr",places:1}],
group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"textline",tokens:"varying float xk ; varying vec3 ve ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"varying vec4 bD ; varying vec3 bG ; varying float xl ;".split(" ")}]}}]},{type:"include",file:"math.glslv"},{type:"include",file:"particles.glslv"},{type:"textline",tokens:"void main ( ) { float x_ , ya , yb , yc ; vec4 yd , ye ; mat4 yf ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_PASS"],group:{type:"group",parts:[{type:"textline",tokens:["yf","=","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"yf = O ( u_view_tsr ) ;".split(" ")}]}}]},{type:"textline",tokens:"xm yg ; yg = xZ ( ) ; yd = yf * vec4 ( yg . b , 1.0 ) ; ye = u_proj_matrix * yd ; gl_Position = ye ; xk = yg . c ; ve = yg . d ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",
parts:[{type:"textline",tokens:["bD","=","yd",";"]}]}}]},{type:"textline",tokens:"x_ = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; x_ = yg . a * x_ ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"ya = ye . x ; yb = ye . y ; yc = ye . w ; bG . x = ( ya + yc ) / 2.0 ; bG . y = ( yb + yc ) / 2.0 ; bG . z = yc ; xl = x_ ;".split(" ")}]}}]},{type:"textline",tokens:["gl_PointSize","=","x_",";","}"]}]};
a["particles_texture.glslf"]={type:"group",parts:[{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"var",name:"NUM_LFACTORS",tokens:["0"]},{type:"include",
file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"include",file:"pack.glslf"}]}}]},{type:"var",name:"PARTICLES_SHADELESS",tokens:["0"]},{type:"var",name:"SOFT_STRENGTH",tokens:["1.0"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_sampler",";"]}]}}]},
{type:"textline",tokens:["uniform","float","u_environment_energy",";"]},{type:"condition",parts:[{type:"if",expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",
places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",parts:[{type:"if",
expression:["USE_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky_texture",
";"]}]}},{type:"elif",expression:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},{type:"textline",tokens:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; varying float xk ; varying vec3 ve ; varying vec2 bM ; varying vec3 bC ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["PARTICLES_SHADELESS",{type:"logic_negative_expr",places:1},"DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","vd",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1},"SOFT_PARTICLES",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4",
"bD",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"include",file:"environment.glslf"},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"fog.glslf"}]}}]},{type:"condition",parts:[{type:"if",expression:["PARTICLES_SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",
parts:[{type:"include",file:"lighting_nodes.glslf"}]}}]},{type:"textline",tokens:"void main ( ) { vec2 x_ ; float ya , yb , yc ; vec3 yd , ye , yf , yg , yh , yi , yj , yk ; vec4 yl , ym ; yl = u_diffuse_color ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"ym = texture2D ( u_sampler , bM ) ; br ( ym . rgb ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"yl . rgb = mix ( yl . rgb , ym . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},{type:"elif",expression:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"yl . rgb *= mix ( vec3 ( 1.0 ) , ym . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",tokens:"yl . a = ym . a ;".split(" ")}]}}]},{type:"textline",tokens:"yl . rgb *= ve ; yd = u_diffuse_intensity * yl . rgb ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["PARTICLES_SHADELESS",{type:"logic_negative_expr",places:1},"DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"ye = normalize ( vd ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["PARTICLES_SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"yf = u_emit * yl . rgb ; yg = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logic_negative_expr",places:1},"SKY_COLOR",{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:"yh = u_environment_energy * dS ( vec3 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"yh = u_environment_energy * dS ( yg ) ;".split(" ")}]}}]},{type:"textline",tokens:"yh = u_ambient * yh ; ya = u_specular_params [ 0 ] ; x_ = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; yi = ya * u_specular_color ; xj ( yf , yh , yd , yi , bC , yg , ye , x_ , u_diffuse_params , 1.0 , 0.0 , vec4 ( 0.0 ) , yj , yk ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["yj","=","yd",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"vc ( yj , length ( bD ) , ye , 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"ya = yl . a * xk ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"yb = - bD . z / u_view_max_depth ; yl = texture2DProj ( u_scene_depth , bG ) ; yc = Z ( yl ) ; yb = yc - yb ; yb = u_view_max_depth / SOFT_STRENGTH * yb ; ya = ya * min ( yb , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",tokens:["bu","(","yj",")",";"]},{type:"condition",parts:[{type:"if",expression:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bx ( yj , ya ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( yj , ya ) ; }".split(" ")}]};a["particles_texture.glslv"]={type:"group",parts:[{type:"var",name:"BILLBOARD_ALIGN",tokens:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",tokens:["0"]},
{type:"var",name:"SIZE_RAMP_LENGTH",tokens:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"define",name:"BILLBOARD_ALIGN_VIEW",tokens:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",tokens:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",tokens:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",tokens:["4"]},{type:"textline",tokens:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SIZE_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",tokens:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform float u_p_wind_fac ; uniform float u_p_max_lifetime ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_PASS"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_tsr",";"]}]}}]},{type:"textline",tokens:"uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ; uniform vec3 u_wind ; uniform float u_p_size ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WORLD_SPACE",{type:"logic_negative_expr",places:1}],
group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"textline",tokens:"varying float xk ; varying vec3 ve ; varying vec2 bM ; varying vec3 vd ; varying vec3 bC ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1},"SOFT_PARTICLES",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bD",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],
group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",tokens:"float yb ( vec2 x_ , vec2 ya ) { return ( atan ( ya . y , ya . x ) - atan ( x_ . y , x_ . x ) ) ; } void main ( ) { vec4 yc , yd , ye ; float yf , yg , yh ; mat4 yi , yj ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFLECTION_PASS"],group:{type:"group",parts:[{type:"textline",tokens:["yi","=","u_view_matrix",";"]}]}},{type:"else",
group:{type:"group",parts:[{type:"textline",tokens:"yi = O ( u_view_tsr ) ;".split(" ")}]}}]},{type:"textline",tokens:"xm yk ; yk = xZ ( ) ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { yf = yk . e ; yj = qT ( yk . b , yi ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { yf = yk . e ; yj = w ( ) ; yj [ 3 ] = vec4 ( yk . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { yf = yk . e ; yj = A ( radians ( 90.0 ) ) ; yj [ 3 ] = vec4 ( yk . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { yf = yb ( vec2 ( EPSILON , 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + yk . e ; yj = y ( radians ( - 90.0 ) ) ; yj [ 3 ] = vec4 ( yk . b , 1.0 ) ; } yc = vec4 ( a_p_bb_vertex * 2.0 * yk . a * u_p_size , 0.0 , 1.0 ) ; yc = yj * C ( yf ) * yc ; yd = yi * yc ; ye = u_proj_matrix * yd ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"yf = ye . x ; yg = ye . y ; yh = ye . w ; bG . x = ( yf + yh ) / 2.0 ; bG . y = ( yg + yh ) / 2.0 ; bG . z = yh ;".split(" ")}]}}]},{type:"textline",tokens:"gl_Position = ye ; xk = yk . c ; ve = yk . d ; bM = a_p_bb_vertex + 0.5 ; bC = yc . xyz ; vd = u_camera_eye - yc . xyz ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1},
"SOFT_PARTICLES",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["bD","=","yd",";"]}]}}]},{type:"textline",tokens:["}"]}]};a["procedural_skydome.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",tokens:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 x_ ; const float ya = 0.99 ; const float yb = 1.8 ; const int yc = 8 ; float yi ( vec3 yd , vec3 ye ) { float yf , yg , yh ; yf = dot ( ye , ye ) ; yg = 2.0 * dot ( ye , yd ) ; yh = dot ( yd , yd ) - 1.0 ; yf = yg * yg - 4.0 * yf * yh ; yf = sqrt ( yf ) ; yf = ( - yg - yf ) / 2.0 ; yf = yh / yf ; return yf ; } float yp ( float yj , float yk ) { float yl , ym , yn , yo ; yl = 3.0 * ( 1.0 - yk * yk ) ; ym = 2.0 * ( 2.0 + yk * yk ) ; yn = 1.0 + yj * yj ; yo = pow ( 1.0 + yk * yk - 2.0 * yk * yj , 1.5 ) ; yo = max ( yo , 0.00001 ) ; return ( yl / ym ) * ( yn / yo ) ; } float yv ( vec3 yq , vec3 yr , float ys ) { vec3 yt ; float yu ; yu = dot ( yr , - yq ) ; if ( yu < 0.0 ) { return 1.0 ; } yt = yq + yu * yr ; if ( length ( yt ) < ys ) { return 0.0 ; } else if ( length ( yt ) >= ys ) { yt = normalize ( yt ) * ys - yq ; yu = acos ( dot ( normalize ( yt ) , yr ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( yu * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 yz ( float yw , vec3 yx , float yy ) { return yx - yx * pow ( u_sky_color , vec3 ( yy / yw ) ) ; } void main ( ) { float yA , yB , yC , yD , yE , yF , yG , yH , yI ; vec3 yJ , yK , yL , yM , yN , yO , yP ; yJ = normalize ( x_ ) ; yK = u_sun_direction ; yA = dot ( yJ , yK ) ; yB = yp ( yA , - 0.01 ) * u_rayleigh_brightness * yK . y ; yC = yp ( yA - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - yK . y ) ; yA = smoothstep ( 0.0 , 100.0 , yp ( yA , 0.9995 ) ) * u_spot_brightness ; yL = vec3 ( 0.0 , ya , 0.0 ) ; yD = yi ( yL , yJ ) ; yE = yD / float ( yc ) ; yF = yv ( yL , yJ , ya - 0.3 ) ; yM = vec3 ( 0.0 , 0.0 , 0.0 ) ; yN = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int yQ = 0 ; yQ < yc ; yQ ++ ) { yG = yE * float ( yQ ) ; yO = yL + yJ * yG ; yH = yv ( yO , yK , ya - 0.2 ) ; yI = yi ( yO , yK ) ; yP = yz ( yI , vec3 ( yb ) , u_scatter_strength ) * yH ; yM += yz ( sqrt ( yG ) , u_sky_color * yP , u_rayleigh_strength ) ; yN += yz ( yG , yP , u_mie_strength ) ; } yM = yM * yF * pow ( yD , u_rayleigh_collection_power ) / float ( yc ) ; yN = ( yN * yF * pow ( yD , u_mie_collection_power ) ) / float ( yc ) ; yM = vec3 ( yA * yN + yC * yN + yB * yM ) ; bu ( yM ) ; gl_FragColor = vec4 ( yM , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 x_ ; void main ( ) { vec4 ya , yb ; ya = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; yb = u_cube_view_matrix * ya ; x_ = yb . xyz ; gl_Position = ya ; }".split(" ")}]};a["special_lens_flares.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",tokens:"uniform sampler2D u_sampler ; varying vec2 bM ; void main ( ) { vec4 ya ; ya = texture2D ( u_sampler , bM ) ; bu ( ya . rgb ) ; bx ( ya . rgb , ya . a ) ; gl_FragColor = ya ; }".split(" ")}]};
a["special_lens_flares.glslv"]={type:"group",parts:[{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"define",name:"LIGHT_INDEX",tokens:["0"]},{type:"include",file:"math.glslv"},{type:"textline",tokens:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 bM ; void main ( ) { vec2 ya ; float yb ; vec4 yc ; vec3 yd ; mat4 ye ; ye = O ( u_view_tsr ) ; bM = a_texcoord ; yd = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; yc = u_proj_matrix * ye * vec4 ( yd , 0.0 ) ; yc . x /= yc . w ; yc . y /= yc . w ; yc += 99999.0 * step ( yc . z , 0.0 ) ; yc += 100.0 * ( step ( 1.0 , abs ( yc . x ) ) + step ( 1.0 , abs ( yc . y ) ) ) ; yc . x = - a_lf_dist * yc . x ; yc . y = - a_lf_dist * yc . y ; yb = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; ya = vec2 ( a_lf_bb_vertex . x / yb , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float yf = 1.9 ; ya *= ( 1.0 + yf * length ( yc . xy ) ) ; } gl_Position = vec4 ( yc . xy + ya , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",parts:[{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"define",name:"INV_PI",tokens:["0.318309886"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"condition",parts:[{type:"if",expression:["WO_SKYTEX","PROCEDURAL_SKYDOME",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_SKYDOME",
{type:"logic_negative_expr",places:1},"WO_SKYTEX",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"blending.glslf"},{type:"textline",tokens:"uniform vec4 u_sky_tex_fac ; uniform vec3 u_sky_tex_color ; uniform float u_sky_tex_dvar ; vec3 Ae ( vec3 z_ , vec3 Aa , float Ab , float Ac ) { float Ad ; Ad = Ab * Ac ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BLENDTYPE","MIX",{type:"equal_expr",places:2}],group:{type:"group",
parts:[{type:"textline",tokens:"return yo ( Aa , z_ , Ad ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","ADD",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return ys ( z_ , Aa , Ad ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","SUBTRACT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return yw ( z_ , Aa , Ad ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","MULTIPLY",{type:"equal_expr",places:2}],group:{type:"group",
parts:[{type:"textline",tokens:"return yB ( z_ , Aa , Ad ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","SCREEN",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return yG ( z_ , Aa , Ad ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","OVERLAY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return yL ( z_ , Aa , Ad ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","DIFFERENCE",{type:"equal_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:"return yP ( z_ , Aa , Ad ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","DIVIDE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return yT ( z_ , Aa , Ad ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","DARKEN",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return yX ( z_ , Aa , Ad ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","LIGHTEN",{type:"equal_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return za ( z_ , Aa , Ad ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","HUE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return zg ( Aa , z_ , Ad ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","SATURATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return zm ( Aa , z_ , Ad ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","VALUE",{type:"equal_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return zs ( Aa , z_ , Ad ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","COLOR",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return zy ( Aa , z_ , Ad ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","SOFT_LIGHT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return zD ( Aa , z_ , Ad ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","LINEAR_LIGHT",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return zH ( Aa , z_ , Ad ) ;".split(" ")}]}}]},{type:"textline",tokens:"return vec3 ( 1.0 , 0.0 , 1.0 ) ; } float Am ( float Af , float Ag , float Ah , float Ai ) { float Aj ; vec3 Ak , Al ; Ak = vec3 ( Af ) , Al = vec3 ( Ag ) ; Aj = Ah * Ai ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BLENDTYPE","MIX",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return yo ( Al , Ak , Aj ) . x ;".split(" ")}]}},
{type:"elif",expression:["BLENDTYPE","ADD",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return ys ( Ak , Al , Aj ) . x ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","SUBTRACT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return yw ( Ak , Al , Aj ) . x ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","MULTIPLY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return zN ( Af , Ag , Aj , Ai ) ;".split(" ")}]}},
{type:"elif",expression:["BLENDTYPE","SCREEN",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return zT ( Af , Ag , Aj , Ai ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","OVERLAY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return zZ ( Af , Ag , Aj , Ai ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","DIFFERENCE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return yP ( Ak , Al , Aj ) . x ;".split(" ")}]}},
{type:"elif",expression:["BLENDTYPE","DIVIDE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return yT ( Ak , Al , Aj ) . x ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","DARKEN",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return yX ( Ak , Al , Aj ) . x ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","LIGHTEN",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return za ( Ak , Al , Aj ) . x ;".split(" ")}]}},
{type:"elif",expression:["BLENDTYPE","SOFT_LIGHT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return zD ( Al , Ak , Aj ) . x ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","LINEAR_LIGHT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return zH ( Al , Ak , Aj ) . x ;".split(" ")}]}}]},{type:"textline",tokens:["return","0.0",";","}"]}]}}]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",
places:1}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},"REFLECTION_PASS",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},
{type:"textline",tokens:["varying","vec3","x_",";"]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",places:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]},{type:"textline",tokens:"void main ( ) { vec4 An ; float Ao , Ap , Aq ; vec3 Ar , As , At , Au , Av ; As = normalize ( x_ ) ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["PROCEDURAL_SKYDOME"],group:{type:"group",parts:[{type:"textline",tokens:"Ar = textureCube ( u_sky , As ) . rgb ;".split(" ")}]}},{type:"elif",expression:["WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",places:2},{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"Ar = u_horizon_color ; bu ( Ar ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:[";"]},{type:"condition",parts:[{type:"if",expression:["WO_SKYPAPER"],
group:{type:"group",parts:[{type:"textline",tokens:"At = vec3 ( bM , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"At = vec3 ( x_ . xy , 0.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:["Ao","=","0.0",";"]},{type:"condition",parts:[{type:"if",expression:["WO_SKYBLEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WO_SKYPAPER"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WO_SKYREAL"],group:{type:"group",
parts:[{type:"textline",tokens:"Ao = abs ( bM . y ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ao = ( bM . y + 1.0 ) * 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ap = acos ( As . y ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WO_SKYREAL"],group:{type:"group",parts:[{type:"textline",tokens:"Ao = abs ( Ap * INV_PI - 0.5 ) * 2.0 ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:"Ao = 1.0 - Ap * INV_PI ;".split(" ")}]}}]}]}}]}]}}]},{type:"textline",tokens:"Au = u_horizon_color ; Av = u_zenith_color ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WO_SKYTEX"],group:{type:"group",parts:[{type:"textline",tokens:"Ap = 1.0 ; An = textureCube ( u_sky , As ) ; br ( An . rgb ) ; Ap = An . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["MTEX_RGBTOINT"],group:{type:"group",parts:[{type:"textline",tokens:"Ap = bB ( An ) ;".split(" ")}]}}]},{type:"condition",
parts:[{type:"if",expression:["MTEX_NEGATIVE"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MTEX_RGBTOINT",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"An = vec4 ( vec3 ( 1.0 ) - An . rgb , An . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ap = 1.0 - Ap ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WOMAP_HORIZ","WOMAP_ZENUP","WOMAP_ZENDOWN",{type:"logical_or_expr",
places:3}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MTEX_RGBTOINT"],group:{type:"group",parts:[{type:"textline",tokens:"An = vec4 ( u_sky_tex_color , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ap = An . a ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WOMAP_HORIZ"],group:{type:"group",parts:[{type:"textline",tokens:"Au = Ae ( An . rgb , Au , Ap , u_sky_tex_fac [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",
parts:[{type:"if",expression:["WOMAP_ZENUP","WOMAP_ZENDOWN",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["Aq","=","0.0",";"]},{type:"condition",parts:[{type:"if",expression:["WO_SKYREAL"],group:{type:"group",parts:[{type:"textline",tokens:"if ( dot ( At , vec3 ( 0.0 , 1.0 , 0.0 ) ) >= 0.0 ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["WOMAP_ZENUP"],group:{type:"group",parts:[{type:"textline",tokens:"Aq = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:[";"]}]}}]},{type:"textline",tokens:["}"]},{type:"condition",parts:[{type:"if",expression:["WOMAP_ZENDOWN"],group:{type:"group",parts:[{type:"textline",tokens:"else Aq = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WOMAP_ZENUP"],group:{type:"group",parts:[{type:"textline",tokens:"Aq = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{type:"elif",expression:["WOMAP_ZENDOWN"],
group:{type:"group",parts:[{type:"textline",tokens:"Aq = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"if ( Aq != 0.0 ) Av = Ae ( An . rgb , Av , Ap , Aq ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WOMAP_BLEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MTEX_RGBTOINT",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"Ap = dot ( An . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ;".split(" ")}]}}]},
{type:"textline",tokens:"Ao = Am ( u_sky_tex_dvar , Ao , Ap , u_sky_tex_fac [ 0 ] ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WO_SKYBLEND"],group:{type:"group",parts:[{type:"textline",tokens:"Ar = mix ( Au , Av , Ao ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["Ar","=","Au",";"]}]}}]},{type:"textline",tokens:["bu","(","Ar",")",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"bu ( Au ) ; bu ( Av ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["WO_SKYBLEND"],group:{type:"group",parts:[{type:"textline",tokens:"Ar = mix ( Au , Av , Ao ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["Ar","=","Au",";"]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},"REFLECTION_PASS",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",
tokens:"br ( Ar ) ; Ao = u_camera_eye_frag . y - WATER_LEVEL ; Ao = min ( - Ao * 0.03 , 0.8 ) ; Ap = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ; Au = vec3 ( 0.0 ) ; An = u_underwater_fog_color_density ; An . rgb = mix ( An . rgb , Au , min ( - As . y + Ao , 1.0 ) ) * Ap ; Ao = clamp ( sign ( As . y - 0.05 * Ao ) , 0.0 , 1.0 ) ; Ar = mix ( An . rgb , Ar , Ao ) ; bu ( Ar ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( Ar , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslv"]={type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 x_ ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",places:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]},{type:"textline",tokens:"void main ( ) { vec4 z_ , Aa ; z_ = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; Aa = u_sky_vp_inverse * z_ ; x_ = Aa . xyz ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",places:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bM = a_position . xy ;".split(" ")}]}}]},{type:"textline",tokens:["gl_Position","=","z_",";","}"]}]};a["special_water.glslf"]={type:"group",parts:[{type:"var",name:"ABSORB",tokens:["0.0"]},{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",
name:"SSS_STRENGTH",tokens:["6.0"]},{type:"var",name:"SSS_WIDTH",tokens:["0.0"]},{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",
tokens:["0"]},{type:"var",name:"NUM_LFACTORS",tokens:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",tokens:["0.001"]},{type:"define",name:"REFR_BUMP",tokens:["0.0005"]},{type:"textline",tokens:["uniform","float","u_time",";"]},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT",
"SKY_TEXTURE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",expression:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",tokens:["uniform","float","u_environment_energy",";"]},{type:"condition",parts:[{type:"if",expression:["NUM_LIGHTS",
0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"textline",tokens:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},
"SHORE_SMOOTHING","WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],
group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE",
"REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",tokens:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_water_norm_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",1,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_normalmap1_scale",";"]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",2,{type:"g_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_normalmap2_scale",";"]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",3,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_normalmap3_scale",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_mirror_factor",
";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_reflect_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_refr_bump",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DEBUG_WIREFRAME"],group:{type:"group",parts:[{type:"textline",
tokens:"const float z_ = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",tokens:"varying vec3 vd ; varying vec3 bC ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2},"GENERATED_MESH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]},{type:"condition",parts:[{type:"if",
expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"varying vec3 bF ; varying vec3 Aa ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC","NUM_NORMALMAPS",0,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bE",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",
places:2},"GENERATED_MESH","DYNAMIC",{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","Ab",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","Ac",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE",{type:"logical_or_expr",places:3}],group:{type:"group",
parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bH",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DEBUG_WIREFRAME"],group:{type:"group",parts:[{type:"textline",tokens:["varying",
"vec3","Ad",";"]}]}}]},{type:"include",file:"environment.glslf"},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","SHORE_SMOOTHING","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"include",file:"refraction.glslf"}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",tokens:"vec3 Ap ( in vec2 Ae , in vec3 Af , in vec3 Ag , in vec3 Ah , out float Ai ) { float Aj , Ak , Al ; vec2 Am ; vec3 An , Ao ; Ai = 0.0 ; An = reflect ( - Ag , Af ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Am = Ae . xy + Af . xz * REFL_BUMP / bH ; Ai = u_reflect_factor ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1},"WATER_EFFECTS",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Ao = u_underwater_fog_color_density . rgb ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ao = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",tokens:"} else { Ao = texture2D ( u_plane_reflection , Am ) . rgb ; br ( Ao ) ; }".split(" ")}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Ai = u_mirror_factor ; Ao = Ah * textureCube ( u_mirrormap , An ) . rgb ; br ( Ao ) ;".split(" ")}]}},{type:"else",group:{type:"group",
parts:[{type:"textline",tokens:"Ai = u_reflect_factor ; Ao = Ah * vec3 ( 0.3 , 0.5 , 1.0 ) ; br ( Ao ) ;".split(" ")}]}}]},{type:"textline",tokens:"An = normalize ( An + Ag ) ; Aj = 1.0 - dot ( Ag , An ) ; Ak = u_fresnel_params [ 3 ] ; Al = u_fresnel_params [ 2 ] ; Al = Ak + ( 1.0 - Ak ) * pow ( Aj , Al ) ; Ai = min ( Ai * Al , 1.0 ) ; return Ao ; }".split(" ")},{type:"include",file:"lighting_nodes.glslf"},{type:"textline",tokens:"void main ( ) { vec4 Aq ; vec2 Ar , As , At ; float Au , Av , Aw , Ax , Ay , Az ; vec3 AA , AB , AC , AD , AE , AF , AG , AH , AI ; mat3 AJ ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"AJ = mat3 ( bF , Aa , bE ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"AA = normalize ( bE ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"AA = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC",
"FOAM",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Au = bC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["GENERATED_MESH"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"Ar = vec2 ( Ab . x , - Ab . z ) + 0.5 ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ar = vec2 ( bC . x , - bC . z ) + 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["Ar","=","bM",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"AB = vec3 ( 0.0 ) ; AC = texture2D ( u_normalmap0 , Ar * u_normalmap0_scale + vec2 ( 0.3 , 0.5 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; AB += AC ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"textline",tokens:"AD = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NORM_FOAM0"],group:{type:"group",parts:[{type:"textline",tokens:["AD","+=","AC",";"]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",1,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"AC = texture2D ( u_normalmap0 , Ar * u_normalmap1_scale + vec2 ( - 0.3 , 0.7 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; AB += AC ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NORM_FOAM1"],group:{type:"group",parts:[{type:"textline",tokens:["AD","+=","AC",";"]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",2,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"AC = texture2D ( u_normalmap0 , Ar * u_normalmap2_scale + vec2 ( 0.0 , 1.1 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; AB += AC ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NORM_FOAM2"],group:{type:"group",parts:[{type:"textline",tokens:["AD","+=","AC",";"]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",3,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"AC = texture2D ( u_normalmap0 , Ar * u_normalmap3_scale + vec2 ( - 0.66 , - 0.3 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; AB += AC ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NORM_FOAM3"],group:{type:"group",parts:[{type:"textline",tokens:["AD","+=","AC",";"]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"textline",tokens:"AD = AJ * AD ; if ( ! f ( AD , vec3 ( 0.0 ) ) ) AD = normalize ( AD ) ; AD = mix ( AA , AD , 0.2 ) ; AD = normalize ( AD ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"AA = mix ( AA , normalize ( AJ * AB ) , 0.3 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"AA = mix ( AA , normalize ( AJ * AB ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",tokens:"AA = normalize ( AA ) ;".split(" ")}]}}]},{type:"textline",tokens:"AB = normalize ( vd ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE",
"REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"As = bG . xy / bG . z ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Av = bH * u_view_max_depth ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING"],
group:{type:"group",parts:[{type:"textline",tokens:"Aw = u_diffuse_color . a ; Aq = texture2DProj ( u_scene_depth , bG ) ; Ax = Z ( Aq ) ; Ay = max ( Ax - bH , 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:"At = As + AA . xz * u_refr_bump / bH ; Ax = dY ( Ax , At , As ) ; Ax = max ( Ax - bH , 0.0 ) ; Ax = u_view_max_depth / ABSORB * Ax ; if ( u_cam_water_depth < 0.0 ) Az = 0.0 ; else Az = min ( Aw * Ax , 1.0 ) ; Ax = u_view_max_depth / ABSORB * Ay ; Aw = min ( 15.0 * Aw * u_view_max_depth * Ay , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ax = u_view_max_depth / ABSORB * Ay ; if ( u_cam_water_depth > 0.0 ) Aw = min ( Aw * Ax , 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"Aw *= min ( 5.0 * Av , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Aw = u_diffuse_color . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:"Az = 1.0 - Aw ; At = As + AA . xz * u_refr_bump / bH ;".split(" ")}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:"AC = texture2D ( u_refractmap , At ) . rgb ; br ( AC ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"Ax = pow ( min ( Ac . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; AE = mix ( u_shallow_water_col , u_diffuse_color . rgb , Ax ) ; Ax = pow ( min ( Ac . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; AE = mix ( u_shore_water_col , AE , Ax ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"AE = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING"],group:{type:"group",parts:[{type:"textline",tokens:"Ay = max ( 1.0 - u_view_max_depth * Ay , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ay = 1.0 - Aw ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",
expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"Au = max ( Au / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"AF = normalize ( vec3 ( Ac . r , 0.0 , Ac . g ) ) ; AF = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , AF , 0.8 ) ) ; Ax = 1.25 * max ( dot ( AD , AF ) - 0.2 , 0.0 ) ; Ax += max ( dot ( AD , vec3 ( 0.0 , - 1.0 , 0.0 ) ) , 0.0 ) ; Ay += Ax * ( 1.0 - Ac . b ) ; Au *= ( 1.0 - 0.95 * pow ( Ac . b , 0.1 ) ) ;".split(" ")}]}}]},
{type:"textline",tokens:"Ay += Au ; Ay = min ( u_foam_factor * Ay , 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"Aq = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + Ar * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",tokens:"Au = u_specular_params [ 0 ] ; Ar = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; AD = Au * u_specular_color ; AF = u_environment_energy * dS ( AA ) ; AF = u_ambient * AF ; AF = AF + u_sun_intensity ;".split(" ")},{type:"condition",
parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"AG = Ap ( As , AA , AB , AF , Au ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"AG = Ap ( vec2 ( 0.0 ) , AA , AB , AF , Au ) ;".split(" ")}]}}]},{type:"textline",tokens:"AE = u_diffuse_intensity * AE ; xj ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , AE , AD , bC , AA , AB , Ar , u_diffuse_params , 1.0 , 0.0 , vec4 ( 0.0 ) , AH , AI ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"Ax = max ( dot ( u_sun_direction , - bE ) + SSS_WIDTH , 0.0 ) * max ( dot ( - AB , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; Ax = clamp ( SSS_STRENGTH * Ax , 0.0 , 1.0 ) ; AH = mix ( AH , u_shallow_water_col , Ax ) ; AH = mix ( AH , u_shore_water_col , Ax ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",
parts:[{type:"textline",tokens:"AH = mix ( AC , AH , Az ) ;".split(" ")}]}}]},{type:"textline",tokens:"AH = mix ( AH , AG , Au ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"textline",tokens:"Au = mix ( Aq . g , Aq . r , max ( 4.0 * ( Ay - 0.75 ) , 0.0 ) ) ; Au = mix ( Aq . b , Au , max ( 2.0 * Ay - 1.0 , 0.0 ) ) ; Au = mix ( 0.0 , Au , Ay ) ; AH = mix ( AH , AF , Au ) ;".split(" ")}]}}]},{type:"textline",tokens:["AH","+=","AI",";"]},{type:"condition",
parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"if ( u_cam_water_depth < 0.0 ) { uW ( AH , Av , u_cam_water_depth ) ; } else { vc ( AH , Av , AB , 1.0 ) ; }".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vc ( AH , Av , AB , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:["bu","(",
"AH",")",";"]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"Aw = max ( Aw , AI . r ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"textline",tokens:["Aw","+=","Au",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"textline",tokens:"bx ( AH , Aw ) ;".split(" ")}]}}]},{type:"condition",
parts:[{type:"if",expression:["DEBUG_WIREFRAME"],group:{type:"group",parts:[{type:"extension",tokens:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",tokens:"AI = fwidth ( Ad ) ; AI = smoothstep ( vec3 ( 0.0 ) , AI * z_ , Ad ) ; Au = min ( min ( AI . x , AI . y ) , AI . z ) ; Au = clamp ( Au , 0.0 , 1.0 ) ; AH = mix ( u_wireframe_edge_color , AH , Au ) ; Aw = mix ( 1.0 , Aw , Au ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( AH , Aw ) ; }".split(" ")}]};a["special_water.glslv"]=
{type:"group",parts:[{type:"var",name:"DIR_MIN_SHR_FAC",tokens:["0.0"]},{type:"var",name:"DIR_FREQ",tokens:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",tokens:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",tokens:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",tokens:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",tokens:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",tokens:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",tokens:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",tokens:["0.0"]},{type:"var",name:"DST_MIN_FAC",
tokens:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",tokens:["0.0"]},{type:"var",name:"PRECISION",tokens:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",tokens:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",tokens:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Y",tokens:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Y",tokens:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",tokens:["0.0"]},{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"var",name:"WAVES_LENGTH",
tokens:["0.0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",tokens:["attribute","vec3","a_position",";"]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"DYNAMIC",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_normal ; attribute vec3 a_tangent ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["GENERATED_MESH",{type:"logic_negative_expr",places:1},"NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DEBUG_WIREFRAME"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","float","a_polyindex",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"textline",tokens:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",
parts:[{type:"textline",tokens:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],
group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",tokens:"varying vec3 vd ; varying vec3 bC ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2},"GENERATED_MESH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"varying vec3 bF ; varying vec3 Aa ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC","NUM_NORMALMAPS",0,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bE",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",
{type:"logical_or_expr",places:2},"GENERATED_MESH","DYNAMIC",{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","Ab",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","Ac",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE",{type:"logical_or_expr",places:3}],
group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bH",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DEBUG_WIREFRAME"],group:{type:"group",parts:[{type:"textline",
tokens:["varying","vec3","Ad",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 Ai ( in vec2 z_ ) { float Ae ; vec4 Af ; vec2 Ag ; Ag = 0.5 + vec2 ( ( z_ . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( z_ . y + SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; Af = texture2D ( u_shore_dist_map , Ag ) ; const vec2 Ah = vec2 ( 1.0 / 255.0 , 1.0 ) ; Ae = dot ( Af . ba , Ah ) ; Ag = normalize ( Af . rg * 2.0 - 1.0 ) ; return vec3 ( Ag , Ae ) ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"define",name:"M_PI",tokens:["3.14159265359"]},{type:"define",name:"SMALL_WAVES_FAC",tokens:["0.3"]},{type:"textline",tokens:"void Au ( inout vec3 Aj , in float Ak , in vec3 Al ) { vec2 Am , An , Ao ; float Ap , Aq , Ar , As , At ; Ap = aU ( DST_NOISE_SCALE_0 * ( Aj . xz + DST_NOISE_FREQ_0 * Ak ) ) * aU ( DST_NOISE_SCALE_1 * ( Aj . zx - DST_NOISE_FREQ_1 * Ak ) ) ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"Aq = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; Ar = Al . b ; As = sqrt ( Ar ) ; Aq = max ( Ar , DIR_MIN_SHR_FAC ) * sin ( As / Aq + DIR_FREQ * Ak ) ; At = max ( aU ( DIR_NOISE_SCALE * ( Aj . xz + DIR_NOISE_FREQ * Ak ) ) , DIR_MIN_NOISE_FAC ) ; Aq *= At ; As = WAVES_HEIGHT * mix ( Aq , Ap , max ( As , DST_MIN_FAC ) ) ; Am = Al . rg ; Aq = WAVES_HOR_FAC * Aq * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - Ar ) , 0.0 ) ; Am = Aq * Am ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"As = WAVES_HEIGHT * Ap ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["GENERATED_MESH"],group:{type:"group",parts:[{type:"textline",tokens:"An = 2.0 * ( Aj . xz - 0.1 * Ak ) ; Ao = 1.3 * ( Aj . zx + 0.03 * Ak ) ; Ap = ay ( 0.5 * An ) . x + ay ( 0.5 * Ao ) . x - 1.0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"Aj . xz += Am ; Ap *= Ar ;".split(" ")}]}}]},
{type:"textline",tokens:"As += SMALL_WAVES_FAC * Ap ;".split(" ")}]}}]},{type:"textline",tokens:"Aj . y += As ; }".split(" ")}]}}]},{type:"textline",tokens:"void main ( ) { vec4 Av , Aw ; vec2 Ax ; float Ay , Az , AA ; vec3 AB , AC , AD , AE ; mat4 AF , AG ; AF = O ( u_view_tsr ) ; AG = O ( u_model_tsr ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEBUG_WIREFRAME"],group:{type:"group",parts:[{type:"textline",tokens:"if ( a_polyindex == 0.0 ) Ad = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) Ad = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) Ad = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",tokens:["AB","=","a_position",";"]},{type:"condition",parts:[{type:"if",expression:["GENERATED_MESH"],group:{type:"group",parts:[{type:"textline",tokens:"Ay = abs ( AB . y ) ; Ax = u_camera_eye . xz - mod ( u_camera_eye . xz , Ay ) ; AB . y = WATER_LEVEL ; AB . xz += Ax ;".split(" ")}]}},{type:"elif",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["bM","=","a_texcoord",";"]}]}}]},
{type:"textline",tokens:"c AH = rB ( AB , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , AG ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"Ac = Ai ( AH . a . xz ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"Az = length ( u_wind ) ; AA = u_time ; AA *= Az ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["GENERATED_MESH"],
group:{type:"group",parts:[{type:"textline",tokens:"Ay = Ay ; AB = AH . a + vec3 ( Ay , 0.0 , 0.0 ) ; AC = AH . a + vec3 ( 0.0 , 0.0 , Ay ) ; if ( a_position . y < 0.0 ) { AH . a . y = WATER_LEVEL - 1.0 ; AB . y = AH . a . y ; AC . y = AH . a . y ; }".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Ab = AH . a ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",
parts:[{type:"textline",tokens:"AB = AH . a + vec3 ( 0.05 , 0.0 , 0.0 ) ; AC = AH . a + vec3 ( 0.0 , 0.0 , 0.05 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"AD = Ai ( AB . xz ) ; AE = Ai ( AC . xz ) ; Au ( AB , AA , AD ) ; Au ( AC , AA , AE ) ; Au ( AH . a , AA , Ac ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Au ( AB , AA , vec3 ( 0.0 ) ) ; Au ( AC , AA , vec3 ( 0.0 ) ) ; Au ( AH . a , AA , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},
{type:"textline",tokens:"AB = normalize ( AB - AH . a ) ; AC = normalize ( AC - AH . a ) ; bE = normalize ( cross ( AC , AB ) ) ; AA = dot ( bE , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; AA = clamp ( 0.8 - AA , 0.0 , 1.0 ) ; bE = mix ( bE , vec3 ( 0.0 , 1.0 , 0.0 ) , AA ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC",{type:"logic_negative_expr",places:1}],group:{type:"group",
parts:[{type:"textline",tokens:"AC = a_tangent ; bE = a_normal ;".split(" ")}]}}]},{type:"textline",tokens:"bF = AC ; Aa = cross ( bE , bF ) ;".split(" ")}]}}]},{type:"textline",tokens:"bC = AH . a ; vd = u_camera_eye - AH . a ; Av = AF * vec4 ( AH . a , 1.0 ) ; Aw = u_proj_matrix * Av ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",
tokens:"AA = Aw . x ; Ay = Aw . y ; Az = Aw . w ; bG . x = ( AA + Az ) / 2.0 ; bG . y = ( Ay + Az ) / 2.0 ; bG . z = Az ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:"bH = - Av . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",tokens:["gl_Position",
"=","Aw",";","}"]}]};a["wireframe.glslf"]={type:"group",parts:[{type:"define",name:"WM_NONE",tokens:["0"]},{type:"define",name:"WM_OPAQUE_WIREFRAME",tokens:["1"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",tokens:["2"]},{type:"define",name:"WM_FRONT_BACK_VIEW",tokens:["3"]},{type:"define",name:"WM_DEBUG_SPHERES",tokens:["4"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE",{type:"logic_negative_expr",
places:1}],group:{type:"group",parts:[{type:"textline",tokens:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",tokens:"varying vec3 Ad ; const float z_ = 1.0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"const vec3 Ae = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"const vec3 Ae = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"const vec3 Af = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 Ag = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 Ah = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"void main ( ) { float Ai , Aj ; vec3 Ak , Al ; Ak = vec3 ( 0.0 ) ; Ai = 0.0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE"],
group:{type:"group",parts:[{type:"textline",tokens:"Al = sign ( Ad - vec3 ( 0.02 * z_ ) ) ; if ( Al . x < 0.0 || Al . y < 0.0 || Al . z < 0.0 ) { Ak = Ae ; Ai = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",expression:["WIREFRAME_QUALITY",0,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Al = sign ( Ad - vec3 ( 0.02 * z_ ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( Al . x < 0.0 || Al . y < 0.0 || Al . z < 0.0 ) Ak = u_wireframe_edge_color ; else Ak = Ah ; Ai = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( Al . x < 0.0 || Al . y < 0.0 || Al . z < 0.0 ) Ai = 1.0 ; else Ai = 0.0 ; Ak = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( Al . x < 0.0 || Al . y < 0.0 || Al . z < 0.0 ) Ak = u_wireframe_edge_color ; else if ( gl_FrontFacing ) Ak = Af ; else Ak = Ag ; Ai = 1.0 ; }".split(" ")}]}},
{type:"elif",expression:["WIREFRAME_QUALITY",1,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"extension",tokens:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",tokens:"Al = fwidth ( Ad ) ; Al = smoothstep ( vec3 ( 0.0 ) , Al * z_ , Ad ) ; Aj = min ( min ( Al . x , Al . y ) , Al . z ) ; Aj = clamp ( Aj , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { Ak = vec3 ( mix ( u_wireframe_edge_color , Ah , Aj ) ) ; Ai = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { Ak = u_wireframe_edge_color ; Ai = mix ( 1.0 , 0.0 , Aj ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) Ak = mix ( u_wireframe_edge_color , Af , Aj ) ; else Ak = mix ( u_wireframe_edge_color , Ag , Aj ) ; Ai = 1.0 ; }".split(" ")}]}}]},
{type:"textline",tokens:["bu","(","Ak",")",";"]},{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"textline",tokens:"bx ( Ak , Ai ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( Ak , Ai ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",parts:[{type:"var",name:"AU_QUALIFIER",tokens:["uniform"]},{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"var",name:"MAX_BONES",tokens:["0"]},{type:"include",file:"math.glslv"},{type:"include",
file:"to_world.glslv"},{type:"textline",tokens:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","float","a_bending_col_main",
";"]},{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],
group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"textline",tokens:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},
{type:"textline",tokens:["varying","vec3","Ad",";"]},{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",tokens:"void main ( ) { vec3 z_ , Ae , Af , Ag , Ah ; mat4 Ai , Aj , Ak ; Ai = O ( u_view_tsr ) ; Aj = O ( u_model_tsr ) ; if ( a_polyindex == 0.0 ) Ad = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) Ad = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) Ad = vec3 ( 0.0 , 0.0 , 1.0 ) ; z_ = a_position ; Ae = a_normal ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE"],group:{type:"group",parts:[{type:"textline",tokens:"c Al = rB ( z_ , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Aj ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:"z_ = mix ( z_ , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],
group:{type:"group",parts:[{type:"textline",tokens:"Af = vec3 ( 0.0 ) ; Ag = vec3 ( 0.0 ) ; sB ( z_ , Af , Ag , Ae ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["Ag","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ag = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],
group:{type:"group",parts:[{type:"textline",tokens:"c Al = t_ ( z_ , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Ag , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , Ai ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:"Af = ( Aj * vec4 ( Ag , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_PRES_GLOB_ORIENTATION",
"STATIC_BATCH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Ak = ru ( u_camera_eye , Af , Ai , Aj ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ak = ro ( u_camera_eye , Af , Ai ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Ah = ( Aj * vec4 ( Ag , 1.0 ) ) . xyz ; Ak = Ak * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , Ah ) ;".split(" ")}]}}]},
{type:"textline",tokens:"c Al = rB ( z_ - Ag , Ag , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Ak ) ; Al . b = Af ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"c Al = rB ( z_ , Ag , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Aj ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"tp ( Al . a , Al . b , Ae ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"gl_Position = u_proj_matrix * Ai * vec4 ( Al . a , 1.0 ) ; }".split(" ")}]};
a["postprocessing/anaglyph.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 bM ; void main ( ) { vec4 z_ , Ae ; z_ = texture2D ( u_sampler_left , bM ) ; Ae = texture2D ( u_sampler_right , bM ) ; gl_FragColor = vec4 ( z_ [ 0 ] , Ae [ 1 ] , Ae [ 2 ] , z_ [ 3 ] + Ae [ 3 ] ) ; }".split(" ")}]};a["postprocessing/antialiasing.glslf"]={type:"group",parts:[{type:"include",
file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",tokens:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 bM ;".split(" ")},{type:"define",name:"AA_METHOD_FXAA_LIGHT",tokens:["1"]},{type:"define",name:"AA_METHOD_FXAA_QUALITY",tokens:["2"]},{type:"define",name:"AA_QUALITY_LOW",tokens:["0"]},{type:"define",name:"AA_QUALITY_MEDIUM",tokens:["1"]},{type:"define",name:"AA_QUALITY_HIGH",tokens:["2"]},{type:"condition",parts:[{type:"if",expression:["AA_METHOD",
"AA_METHOD_FXAA_LIGHT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_REDUCE_MIN",tokens:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",tokens:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",tokens:["8.0"]},{type:"textline",tokens:"vec4 Ag ( float z_ , float Ae ) { vec2 Af ; Af = bM + vec2 ( z_ , Ae ) * u_texel_size ; return texture2D ( u_color , Af ) ; } vec4 At ( ) { vec2 Ah ; float Ai , Aj , Ak , Al , Am , An ; vec4 Ao , Ap , Aq , Ar , As ; Ao = Ag ( - 1.0 , - 1.0 ) ; Ap = Ag ( 1.0 , - 1.0 ) ; Aq = Ag ( - 1.0 , 1.0 ) ; Ar = Ag ( 1.0 , 1.0 ) ; As = Ag ( 0.0 , 0.0 ) ; Ai = bB ( As ) ; Aj = bB ( Ao ) ; Ak = bB ( Ap ) ; Al = bB ( Aq ) ; Am = bB ( Ar ) ; An = min ( Ai , min ( min ( Aj , Ak ) , min ( Al , Am ) ) ) ; Ai = max ( Ai , max ( max ( Aj , Ak ) , max ( Al , Am ) ) ) ; Ah . x = - ( ( Aj + Ak ) - ( Al + Am ) ) ; Ah . y = ( ( Aj + Al ) - ( Ak + Am ) ) ; Am = max ( ( Aj + Ak + Al + Am ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; Am = 1.0 / ( min ( abs ( Ah . x ) , abs ( Ah . y ) ) + Am ) ; Ah = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , Ah * Am ) ) * u_texel_size ; Ar = 0.5 * ( texture2D ( u_color , bM + Ah * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , bM + Ah * ( 2.0 / 3.0 - 0.5 ) ) ) ; Aq = Ar * 0.5 + 0.25 * ( texture2D ( u_color , bM + Ah * - 0.5 ) + texture2D ( u_color , bM + Ah * 0.5 ) ) ; Am = bB ( Aq ) ; if ( ( Am < An ) || ( Am > Ai ) ) return Ar ; else return Aq ; }".split(" ")}]}},
{type:"elif",expression:["AA_METHOD","AA_METHOD_FXAA_QUALITY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_GREEN_AS_LUMA",tokens:["1"]},{type:"define",name:"FXAA_BLEND4WEB",tokens:["1"]},{type:"include",file:"fxaa.glslf"},{type:"condition",parts:[{type:"if",expression:["AA_QUALITY","AA_QUALITY_HIGH",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PRESET",tokens:["39"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",tokens:["1.00"]},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",tokens:["0.063"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",tokens:["0.0312"]}]}},{type:"elif",expression:["AA_QUALITY","AA_QUALITY_MEDIUM",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PRESET",tokens:["20"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",tokens:["0.65"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",tokens:["0.166"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",tokens:["0.0625"]}]}},
{type:"elif",expression:["AA_QUALITY","AA_QUALITY_LOW",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PRESET",tokens:["12"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",tokens:["0.50"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",tokens:["0.166"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",tokens:["0.0833"]}]}}]}]}}]},{type:"textline",tokens:"void main ( ) { vec2 Bk ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["AA_METHOD",
"AA_METHOD_FXAA_LIGHT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = At ( ) ;".split(" ")}]}},{type:"elif",expression:["AA_METHOD","AA_METHOD_FXAA_QUALITY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Bk = u_texel_size ; gl_FragColor = Bj ( bM , u_color , Bk , FXAA_QUALITY_SUBPIX , FXAA_QUALITY_EDGE_THRESHOLD , FXAA_QUALITY_EDGE_THRESHOLD_MIN ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["postprocessing/bloom_blur.glslf"]=
{type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 bM ; void main ( ) { vec4 z_ ; vec2 Ae , Af ; Ae = vec2 ( 0.0 , 0.0 ) ; Af = u_texel_size ; z_ = texture2D ( u_color , bM ) ; gl_FragColor = z_ * 0.0875447373698 ; Ae += Af ; gl_FragColor += texture2D ( u_color , bM + Ae ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , bM - Ae ) * 0.0858112354248 ; Ae += Af ; gl_FragColor += texture2D ( u_color , bM + Ae ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , bM - Ae ) * 0.0808139781061 ; Ae += Af ; gl_FragColor += texture2D ( u_color , bM + Ae ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , bM - Ae ) * 0.0731235112908 ; Ae += Af ; gl_FragColor += texture2D ( u_color , bM + Ae ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , bM - Ae ) * 0.0635705267419 ; Ae += Af ; gl_FragColor += texture2D ( u_color , bM + Ae ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , bM - Ae ) * 0.0530985673112 ; Ae += Af ; gl_FragColor += texture2D ( u_color , bM + Ae ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , bM - Ae ) * 0.0426125984122 ; Ae += Af ; gl_FragColor += texture2D ( u_color , bM + Ae ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , bM - Ae ) * 0.0328565115809 ; Ae += Af ; gl_FragColor += texture2D ( u_color , bM + Ae ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , bM - Ae ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * z_ , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 bM ; void main ( ) { vec4 z_ , Ae ; z_ = texture2D ( u_main , bM ) ; Ae = texture2D ( u_bloom , bM ) ; z_ = z_ ; z_ += Ae ; gl_FragColor = vec4 ( z_ . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"color_util.glslf"},{type:"define",name:"PI_4",tokens:["0.785398163"]},{type:"textline",tokens:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 bM ; void main ( ) { float z_ ; vec3 Ae ; vec4 Af ; Af = texture2D ( u_color , bM ) ; Ae = Af . rgb ; if ( u_brightness < 0.0 ) Ae = Ae * ( 1.0 + u_brightness ) ; else Ae = Ae + ( ( 1.0 - Ae ) * u_brightness ) ; Ae = ( Ae - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; Ae *= u_exposure ; z_ = bB ( vec4 ( Ae , 0.0 ) ) ; Ae = mix ( vec3 ( z_ ) , Ae , u_saturation ) ; gl_FragColor = vec4 ( Ae , Af . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"textline",tokens:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",tokens:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 bM ; void main ( ) { gl_FragColor = V ( clamp ( Bq ( u_depth , bM , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};
a["postprocessing/dof.glslf"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"textline",tokens:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",tokens:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 bM ; void main ( ) { float z_ , Ae ; vec4 Af , Ag ; Af = texture2D ( u_sharp , bM ) ; if ( u_dof_dist > 0.0 ) { z_ = Bq ( u_depth , bM , u_camera_range ) ; z_ *= u_view_max_depth ; if ( z_ < u_dof_dist ) Ae = ( u_dof_dist - z_ ) / u_dof_front ; else Ae = ( z_ - u_dof_dist ) / u_dof_rear ; Ae = clamp ( Ae , 0.0 , 1.0 ) ; Ag = texture2D ( u_blurred , bM ) ; gl_FragColor = mix ( Af , Ag , Ae ) ; } else gl_FragColor = Af ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_src_color ; uniform sampler2D u_glow_mask_small ; uniform sampler2D u_glow_mask_large ; uniform float u_glow_mask_small_coeff ; uniform float u_glow_mask_large_coeff ; varying vec2 bM ; void main ( ) { float z_ ; vec4 Ae , Af , Ag ; Ae = texture2D ( u_src_color , bM ) ; Af = texture2D ( u_glow_mask_small , bM ) ; Ag = texture2D ( u_glow_mask_large , bM ) ; gl_FragColor = Ae ; if ( Ag . a != 0.0 ) { z_ = u_glow_mask_large_coeff * Ag . a ; z_ = clamp ( z_ , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , Ag . rgb / Ag . a , z_ ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , z_ ) ; } if ( Af . a != 0.0 ) { z_ = u_glow_mask_small_coeff * Af . a ; z_ = clamp ( z_ , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , Af . rgb / Af . a , z_ ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , z_ ) ; } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"textline",tokens:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",tokens:["0.0"]},{type:"textline",tokens:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DEPTH_RGBA"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_camera_range",";"]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"varying float Br ; varying vec2 Bs ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"varying vec2 bM ; varying vec4 Bt ; void main ( ) { vec4 Bu ; float Bv , Bw , Bx , By , Bz ; vec2 BA , BB , BC ; BA = ( Bt . xy - bM ) ; Bv = length ( BA ) ; BA = u_radial_blur_step * BA / Bv ; Bw = Bv / u_radial_blur_step ; BA *= min ( Bw , STEPS_PER_PASS ) / STEPS_PER_PASS ; Bw = max ( Bw , STEPS_PER_PASS ) ; BB = bM ; Bx = 0.0 ; for ( float BD = 0.0 ; BD < STEPS_PER_PASS ; BD += 1.0 ) { if ( BD <= Bw ) {".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DEPTH_RGBA"],group:{type:"group",parts:[{type:"textline",tokens:"By = Bq ( u_input , BB , u_camera_range ) ; Bx += max ( ( 1.0 - pow ( Bv , 0.3 ) ) * step ( 0.9 , By ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Bu = texture2D ( u_input , BB ) ; Bx += Z ( Bu ) ;".split(" ")}]}}]},{type:"textline",tokens:"} BB += BA ; }".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEPTH_RGBA","WATER_EFFECTS",
{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"BC = bM + Bs ; Bz = ay ( vec2 ( 2.5 * ( BC . x ) , 2.5 * ( BC . y ) + 1.0 * u_time ) ) . x + 0.75 * ay ( vec2 ( 5.0 * ( BC . x ) - 0.66 * u_time , 5.0 * ( BC . y ) + 0.66 * u_time ) ) . x + 0.5 * aU ( vec2 ( 7.5 * ( BC . x ) + 0.33 * u_time , 7.5 * ( BC . y ) - 0.33 * u_time ) ) ; Bz *= clamp ( 1.2 - sqrt ( 0.2 * Bv ) , 0.0 , 1.0 ) * Br ; Bx = max ( Bz , Bx ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = V ( Bx / STEPS_PER_PASS ) ; }".split(" ")}]};
a["postprocessing/god_rays.glslv"]={type:"group",parts:[{type:"include",file:"math.glslv"},{type:"textline",tokens:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEPTH_RGBA"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_camera_quat ; uniform float u_cam_water_depth ; varying float Br ; varying vec2 Bs ;".split(" ")}]}}]}]}}]},
{type:"textline",tokens:"varying vec2 bM ; varying vec4 Bt ; void main ( ) { float z_ , Ae ; vec3 Af ; bM = a_bb_vertex + 0.5 ; Af = normalize ( u_sun_direction ) ; Bt = u_view_proj_matrix * vec4 ( Af , 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEPTH_RGBA","WATER_EFFECTS",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( u_cam_water_depth < 0.0 ) { Br = 1.0 ; Af = vec3 ( 0.0 , 1.0 , 0.0 ) ; Af = i ( u_camera_quat , Af ) ; Af = normalize ( Af ) ; z_ = dot ( Af , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; Ae = atan ( Af . x , Af . z ) ; Bs = vec2 ( - Ae , acos ( z_ ) ) ; } else { Br = 0.0 ; }".split(" ")}]}}]},
{type:"textline",tokens:"Bt . xy = 0.5 * ( Bt . xy / Bt . w + 1.0 ) ; Bt += 99999.0 * step ( Bt . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/god_rays_combine.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",tokens:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 bM ; void main ( ) { float z_ ; vec3 Ae ; vec4 Af ; Af = texture2D ( u_main , bM ) ; Ae = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; br ( Af . rgb ) ; z_ = Z ( texture2D ( u_god_rays , bM ) ) ; Ae = Af . rgb + u_god_rays_intensity * vec3 ( z_ ) * Ae ; bu ( Ae ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SAFARI_CANVAS_ALPHA_HACK"],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( Ae , max ( 0.01 , Af . a ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( Ae , Af . a ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["postprocessing/luminance.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_input ; varying vec2 bM ; void main ( ) { float z_ ; vec4 Ae ; Ae = texture2D ( u_input , bM ) ; z_ = dot ( Ae . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( z_ ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_av.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_input ; void main ( ) { float z_ , Ae ; Ae = 0.0 ; for ( float Af = 0.025 ; Af < 1.0 ; Af += 0.05 ) for ( float Ag = 0.025 ; Ag < 1.0 ; Ag += 0.05 ) { z_ = max ( texture2D ( u_input , vec2 ( Af , Ag ) ) . r , 0.01 ) ; Ae += log ( z_ ) ; } Ae = exp ( Ae / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( Ae ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_trunced.glslf"]=
{type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 bM ; varying float Bu ; void main ( ) { vec4 Bv ; float Bw , Bx ; Bw = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; Bx = texture2D ( u_luminance , bM ) . r ; Bv = texture2D ( u_main , bM ) ; Bw = Bx / Bw ; Bx = u_bloom_edge_lum ; gl_FragColor = Bv * max ( Bw - Bx , 0.0 ) * Bu ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",parts:[{type:"textline",tokens:"attribute vec2 a_position ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 bM ; varying float Bu ; const vec3 z_ = vec3 ( 0.0 , 1.0 , 0.0 ) ; void Al ( in vec4 Ae , in vec3 Af , out vec3 Ag ) { float Ah , Ai , Aj , Ak ; Ah = Ae . w * Af . x + Ae . y * Af . z - Ae . z * Af . y ; Ai = Ae . w * Af . y + Ae . z * Af . x - Ae . x * Af . z ; Aj = Ae . w * Af . z + Ae . x * Af . y - Ae . y * Af . x ; Ak = - Ae . x * Af . x - Ae . y * Af . y - Ae . z * Af . z ; Ag . x = Ah * Ae . w - Ak * Ae . x - Ai * Ae . z + Aj * Ae . y ; Ag . y = Ai * Ae . w - Ak * Ae . y - Aj * Ae . x + Ah * Ae . z ; Ag . z = Aj * Ae . w - Ak * Ae . z - Ah * Ae . y + Ai * Ae . x ; } void main ( ) { vec3 Am ; bM = 2.0 * a_position ; Al ( u_camera_quat , z_ , Am ) ; Bu = dot ( - Am , u_sun_direction ) * u_bloom_key ; Bu *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; uniform float u_motion_blur_decay_threshold ; varying vec2 bM ; float z_ = 0.0042 ; void main ( ) { vec4 Ae , Af , Ag , Ah ; Ae = texture2D ( u_mb_tex_curr , bM ) ; Af = texture2D ( u_mb_tex_accum , bM ) ; if ( length ( Ae - Af ) > u_motion_blur_decay_threshold ) { Ag = ( 1.0 - u_motion_blur_exp ) * Ae + u_motion_blur_exp * Af ; Ag = Ag - Af ; Ah = Ae - Af ; Ag = min ( max ( abs ( Ag ) , vec4 ( z_ ) ) , abs ( Ah ) ) * sign ( Ag ) ; gl_FragColor = Af + Ag ; } else { gl_FragColor = Ae ; } }".split(" ")}]};
a["postprocessing/outline.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",tokens:"uniform sampler2D u_outline_src ; uniform sampler2D u_outline_mask ; uniform sampler2D u_outline_mask_blurred ; uniform vec3 u_outline_color ; uniform float u_draw_outline ; varying vec2 bM ; void main ( ) { vec3 z_ ; float Ae ; vec4 Af , Ag , Ah ; Af = texture2D ( u_outline_src , bM ) ; gl_FragColor = Af ; if ( u_draw_outline != 0.0 ) { Ag = texture2D ( u_outline_mask , bM ) ; Ah = texture2D ( u_outline_mask_blurred , bM ) ; Ae = Ah . a - Ag . a ; if ( Ae != 0.0 ) { Ae = smoothstep ( 0.0 , 1.0 , Ah . a ) ; if ( Ag . a == 0.0 ) { z_ = u_outline_color ; bu ( z_ ) ; Ag = vec4 ( clamp ( z_ , 0.0 , 1.0 ) , 1.0 ) ; gl_FragColor = mix ( Af , Ag , Ae ) ; } } } }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",tokens:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",tokens:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",tokens:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",tokens:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",tokens:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",tokens:["6"]},{type:"define",name:"FLIP_CUBEMAP_COORDS",tokens:["7"]},
{type:"textline",tokens:"uniform vec2 u_texel_size ; uniform sampler2D u_color ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["POST_EFFECT","FLIP_CUBEMAP_COORDS",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform int u_tex_number ; uniform vec2 u_delta ;".split(" ")}]}}]},{type:"textline",tokens:"varying vec2 bM ; void main ( ) { float z_ , Ae , Af , Ag ; vec2 Ah , Ai ; vec4 Aj ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["POST_EFFECT",
"POST_EFFECT_NONE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = texture2D ( u_color , bM ) ;".split(" ")}]}},{type:"elif",expression:["POST_EFFECT","POST_EFFECT_GRAYSCALE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Aj = texture2D ( u_color , bM ) ; gl_FragColor . rgb = vec3 ( ( Aj . r + Aj . g + Aj . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",expression:["POST_EFFECT","POST_EFFECT_X_BLUR",
{type:"equal_expr",places:2},"POST_EFFECT","POST_EFFECT_Y_BLUR",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Ah = vec2 ( 0.0 , 0.0 ) ; Ai = u_texel_size ; Aj = texture2D ( u_color , bM ) ; gl_FragColor = Aj * 0.2270270270 ; Ah += Ai ; Aj = texture2D ( u_color , bM + Ah ) ; gl_FragColor += Aj * 0.1945945946 ; Aj = texture2D ( u_color , bM - Ah ) ; gl_FragColor += Aj * 0.1945945946 ; Ah += Ai ; Aj = texture2D ( u_color , bM + Ah ) ; gl_FragColor += Aj * 0.1216216216 ; Aj = texture2D ( u_color , bM - Ah ) ; gl_FragColor += Aj * 0.1216216216 ; Ah += Ai ; Aj = texture2D ( u_color , bM + Ah ) ; gl_FragColor += Aj * 0.0540540541 ; Aj = texture2D ( u_color , bM - Ah ) ; gl_FragColor += Aj * 0.0540540541 ; Ah += Ai ; Aj = texture2D ( u_color , bM + Ah ) ; gl_FragColor += Aj * 0.0162162162 ; Aj = texture2D ( u_color , bM - Ah ) ; gl_FragColor += Aj * 0.0162162162 ;".split(" ")}]}},
{type:"elif",expression:["POST_EFFECT","POST_EFFECT_X_GLOW_BLUR",{type:"equal_expr",places:2},"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Ah = vec2 ( 0.0 , 0.0 ) ; Ai = u_texel_size ; Aj = texture2D ( u_color , bM ) ; gl_FragColor = Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.152507 ; Ah += Ai ; Aj = texture2D ( u_color , bM + Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.141763 ; Aj = texture2D ( u_color , bM - Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.141763 ; Ah += Ai ; Aj = texture2D ( u_color , bM + Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.113861 ; Aj = texture2D ( u_color , bM - Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.113861 ; Ah += Ai ; Aj = texture2D ( u_color , bM + Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.079019 ; Aj = texture2D ( u_color , bM - Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.079019 ; Ah += Ai ; Aj = texture2D ( u_color , bM + Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.047383 ; Aj = texture2D ( u_color , bM - Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.047383 ; Ah += Ai ; Aj = texture2D ( u_color , bM + Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.024549 ; Aj = texture2D ( u_color , bM - Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.024549 ; Ah += Ai ; Aj = texture2D ( u_color , bM + Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.01099 ; Aj = texture2D ( u_color , bM - Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.01099 ; Ah += Ai ; Aj = texture2D ( u_color , bM + Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.00425 ; Aj = texture2D ( u_color , bM - Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.00425 ; Ah += Ai ; Aj = texture2D ( u_color , bM + Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.00142 ; Aj = texture2D ( u_color , bM - Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.00142 ; gl_FragColor = clamp ( gl_FragColor , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"elif",expression:["POST_EFFECT","POST_EFFECT_X_EXTEND",{type:"equal_expr",places:2},"POST_EFFECT","POST_EFFECT_Y_EXTEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Ai = u_texel_size ; Aj = texture2D ( u_color , bM ) ; gl_FragColor = Aj ; if ( Aj . a == 0.0 ) { Aj = texture2D ( u_color , bM + Ai ) ; if ( Aj . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , Aj . a ) ; else { Aj = texture2D ( u_color , bM - Ai ) ; if ( Aj . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , Aj . a ) ; } }".split(" ")}]}},
{type:"elif",expression:["POST_EFFECT","FLIP_CUBEMAP_COORDS",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"z_ = u_delta [ 0 ] ; Ae = u_delta [ 1 ] ; Af = 1.0 / 3.0 ; Ag = 0.5 ; Ai = vec2 ( Af , Ag ) ; if ( u_tex_number == 0 ) { Ah = bM * Ai + vec2 ( 2.0 * Af , 0.0 ) ; Ah [ 0 ] = min ( Ah [ 0 ] , 1.0 - z_ ) ; Ah [ 1 ] = min ( Ah [ 1 ] , 0.5 - Ae ) ; gl_FragColor = texture2D ( u_color , vec2 ( 5.0 * Af - Ah [ 0 ] , Ah [ 1 ] ) ) ; } else if ( u_tex_number == 1 ) { Ah = bM * Ai ; Ah [ 0 ] = max ( Ah [ 0 ] , z_ ) ; Ah [ 1 ] = min ( Ah [ 1 ] , 0.5 - Ae ) ; gl_FragColor = texture2D ( u_color , vec2 ( Af - Ah [ 0 ] , Ah [ 1 ] ) ) ; } else if ( u_tex_number == 2 ) { Ah = bM * Ai + vec2 ( Af , Ag ) ; Ah [ 0 ] = max ( Ah [ 0 ] , Af + z_ ) ; Ah [ 0 ] = min ( Ah [ 0 ] , 2.0 * Af - z_ ) ; Ah [ 1 ] = min ( Ah [ 1 ] , 1.0 - Ae ) ; gl_FragColor = texture2D ( u_color , vec2 ( Ah [ 0 ] , 3.0 * Ag - Ah [ 1 ] ) ) ; } else if ( u_tex_number == 3 ) { Ah = bM * Ai + vec2 ( 0.0 , Ag ) ; Ah [ 0 ] = min ( Ah [ 0 ] , Af - z_ ) ; Ah [ 1 ] = min ( Ah [ 1 ] , 1.0 - Ae ) ; gl_FragColor = texture2D ( u_color , vec2 ( Ah [ 0 ] , 3.0 * Ag - Ah [ 1 ] ) ) ; } else if ( u_tex_number == 4 ) { Ah = bM * Ai + vec2 ( Af , 0.0 ) ; Ah [ 0 ] = max ( Ah [ 0 ] , Af + z_ ) ; Ah [ 0 ] = min ( Ah [ 0 ] , 2.0 * Af - z_ ) ; Ah [ 1 ] = min ( Ah [ 1 ] , 0.5 - Ae ) ; gl_FragColor = texture2D ( u_color , vec2 ( 1.0 - Ah [ 0 ] , Ah [ 1 ] ) ) ; } else { Ai = bM * Ai + vec2 ( 2.0 * Af , Ag ) ; Ai [ 0 ] = min ( Ai [ 0 ] , 1.0 - z_ ) ; Ai [ 1 ] = max ( Ai [ 1 ] , 0.5 + Ae ) ; gl_FragColor = texture2D ( u_color , vec2 ( 5.0 * Af - Ai [ 0 ] , Ai [ 1 ] ) ) ; }".split(" ")}]}}]},
{type:"textline",tokens:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",parts:[{type:"textline",tokens:"attribute vec2 a_position ; varying vec2 bM ; void main ( ) { bM = 2.0 * a_position ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",
tokens:["1"]},{type:"define",name:"SMAA_EDGE_DETECTION",tokens:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",tokens:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",tokens:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",tokens:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",tokens:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",tokens:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",tokens:["4"]},{type:"textline",tokens:["uniform","sampler2D","u_color",";"]},{type:"condition",
parts:[{type:"if",expression:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",
tokens:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2},"SMAA_PREDICATION",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},
{type:"textline",tokens:"uniform vec2 u_texel_size ; varying vec2 bM ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","Bv",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"varying vec4 Bw ; varying vec4 Bx ; varying vec4 By ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","Bz",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["AA_METHOD","AA_METHOD_SMAA_LOW",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_THRESHOLD",tokens:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",tokens:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",tokens:["1"]}]}},{type:"elif",expression:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_THRESHOLD",tokens:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",tokens:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",tokens:["1"]}]}},{type:"elif",expression:["AA_METHOD","AA_METHOD_SMAA_HIGH",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_THRESHOLD",tokens:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",tokens:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",
tokens:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",tokens:["25"]}]}},{type:"elif",expression:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_THRESHOLD",tokens:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",tokens:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",tokens:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",tokens:["25"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",
parts:[{type:"define",name:"SMAA_THRESHOLD",tokens:["0.1"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",parts:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",tokens:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",tokens:["8"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",
parts:[{type:"define",name:"SMAA_CORNER_ROUNDING",tokens:["25"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",parts:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",tokens:["2.0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",parts:[{type:"define",name:"SMAA_PREDICATION",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",
parts:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",tokens:["0.01"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",parts:[{type:"define",name:"SMAA_PREDICATION_SCALE",tokens:["2.0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",parts:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",tokens:["0.4"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",parts:[{type:"define",
name:"SMAA_REPROJECTION",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",parts:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",tokens:["30.0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",tokens:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",tokens:["16"]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",tokens:["20"]},
{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",tokens:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",tokens:["(","1.0","/","7.0",")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",tokens:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",tokens:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",tokens:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},{type:"condition",parts:[{type:"if",
expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 BF ( vec2 BA , sampler2D BB ) { float BC , BD , BE ; BC = texture2D ( BB , BA ) . r ; BD = texture2D ( BB , Bw . xy ) . r ; BE = texture2D ( BB , Bw . zw ) . r ; return vec3 ( BC , BD , BE ) ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"vec2 BK ( vec2 BG , sampler2D BH ) { vec2 BI ; vec3 BJ ; BJ = BF ( BG , BH ) ; BI = abs ( BJ . xx - BJ . yz ) ; BI = step ( SMAA_PREDICATION_THRESHOLD , BI ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * BI ) ; }".split(" ")}]}}]},{type:"textline",tokens:"void BO ( bvec2 BL , inout vec2 BM , vec2 BN ) { if ( BL . x ) BM . x = BN . x ; if ( BL . y ) BM . y = BN . y ; } void BO ( bvec4 BP , inout vec4 BQ , vec4 BR ) { BO ( BP . xy , BQ . xy , BR . xy ) ; BO ( BP . zw , BQ . zw , BR . zw ) ; } vec2 BT ( vec2 BS ) { return sign ( BS ) * floor ( abs ( BS ) + .5 ) ; } vec4 BT ( vec4 BU ) { return sign ( BU ) * floor ( abs ( BU ) + .5 ) ; }".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec2 Cg ( vec2 BV , sampler2D BW".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_PREDICATION"],group:{type:"group",parts:[{type:"textline",tokens:[",","sampler2D","BX"]}]}}]},{type:"textline",tokens:") { vec4 BY ; float BZ , B_ , Ca , Cb , Cc ; vec3 Cd ; vec2 Ce , Cf ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["SMAA_PREDICATION"],group:{type:"group",parts:[{type:"textline",tokens:"Ce = BK ( BV , BX ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ce = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",tokens:"Cd = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; BZ = dot ( texture2D ( BW , BV ) . rgb , Cd ) ; B_ = dot ( texture2D ( BW , Bw . xy ) . rgb , Cd ) ; Ca = dot ( texture2D ( BW , Bw . zw ) . rgb , Cd ) ; BY . xy = abs ( BZ - vec2 ( B_ , Ca ) ) ; Ce = step ( Ce , BY . xy ) ; if ( dot ( Ce , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; Cb = dot ( texture2D ( BW , Bx . xy ) . rgb , Cd ) ; Cc = dot ( texture2D ( BW , Bx . zw ) . rgb , Cd ) ; BY . zw = abs ( BZ - vec2 ( Cb , Cc ) ) ; Cf = max ( BY . xy , BY . zw ) ; Cc = dot ( texture2D ( BW , By . xy ) . rgb , Cd ) ; Cb = dot ( texture2D ( BW , By . zw ) . rgb , Cd ) ; BY . zw = abs ( vec2 ( B_ , Ca ) - vec2 ( Cc , Cb ) ) ; Cf = max ( Cf . xy , BY . zw ) ; Cb = max ( Cf . x , Cf . y ) ; Ce . xy *= step ( Cb , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * BY . xy ) ; return Ce ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"vec2 Ci ( vec2 Ch ) { Ch . r = Ch . r * abs ( 5.0 * Ch . r - 5.0 * 0.75 ) ; return BT ( Ch ) ; } vec4 Ci ( vec4 Cj ) { Cj . rb = Cj . rb * abs ( 5.0 * Cj . rb - 5.0 * 0.75 ) ; return BT ( Cj ) ; } vec2 Cr ( sampler2D Ck , vec2 Cl , vec2 Cm , out vec2 Cn ) { vec3 Co ; vec4 Cp ; Cp = vec4 ( Cl , - 1.0 , 1.0 ) ; Co = vec3 ( u_texel_size , 1.0 ) ; for ( int Cq = 0 ; Cq < SMAA_MAX_SEARCH_STEPS_DIAG ; Cq ++ ) { if ( Cp . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && Cp . w > 0.9 ) { Cp . xyz += Co * vec3 ( Cm , 1.0 ) ; Cn = texture2D ( Ck , Cp . xy , 0.0 ) . rg ; Cp . w = dot ( Cn , vec2 ( 0.5 , 0.5 ) ) ; } } return Cp . zw ; } vec2 Cz ( sampler2D Cs , vec2 Ct , vec2 Cu , out vec2 Cv ) { vec3 Cw ; vec4 Cx ; Cx = vec4 ( Ct , - 1.0 , 1.0 ) ; Cx . x += 0.25 * u_texel_size . x ; Cw = vec3 ( u_texel_size , 1.0 ) ; for ( int Cy = 0 ; Cy < SMAA_MAX_SEARCH_STEPS_DIAG ; Cy ++ ) { if ( Cx . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && Cx . w > 0.9 ) { Cx . xyz = Cw * vec3 ( Cu , 1.0 ) + Cx . xyz ; Cv = texture2D ( Cs , Cx . xy , 0.0 ) . rg ; Cv = Ci ( Cv ) ; Cx . w = dot ( Cv , vec2 ( 0.5 , 0.5 ) ) ; } } return Cx . zw ; } vec2 CF ( sampler2D CA , vec2 CB , vec2 CC , float CD ) { vec2 CE ; CE = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * CC + CB ; CE = SMAA_AREATEX_PIXEL_SIZE * CE + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; CE . x += 0.5 ; CE . y += SMAA_AREATEX_SUBTEX_SIZE * CD ; return texture2D ( CA , CE , 0.0 ) . rg ; } vec2 CR ( sampler2D CG , sampler2D CH , vec2 CI , vec2 CJ , vec4 CK ) { vec4 CL , CM , CN ; vec2 CO , CP , CQ ; CO = vec2 ( 0.0 , 0.0 ) ; if ( CJ . r > 0.0 ) { CL . xz = Cr ( CG , CI , vec2 ( - 1.0 , 1.0 ) , CP ) ; CL . x += float ( CP . y > 0.9 ) ; } else CL . xz = vec2 ( 0.0 , 0.0 ) ; CL . yw = Cr ( CG , CI , vec2 ( 1.0 , - 1.0 ) , CP ) ; if ( CL . x + CL . y > 2.0 ) { CM = vec4 ( - CL . x + 0.25 , CL . x , CL . y , - CL . y - 0.25 ) * u_texel_size . xyxy + CI . xyxy ; CN . xy = texture2D ( CG , CM . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; CN . zw = texture2D ( CG , CM . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; CN . yxwz = Ci ( CN . xyzw ) ; CQ = vec2 ( 2.0 , 2.0 ) * CN . xz + CN . yw ; BO ( bvec2 ( step ( 0.9 , CL . zw ) ) , CQ , vec2 ( 0.0 , 0.0 ) ) ; CO += CF ( CH , CL . xy , CQ , CK . z ) ; } CL . xz = Cz ( CG , CI , vec2 ( - 1 , - 1 ) , CP ) ; if ( texture2D ( CG , CI + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { CL . yw = Cz ( CG , CI , vec2 ( 1 , 1 ) , CP ) ; CL . y += float ( CP . y > 0.9 ) ; } else CL . yw = vec2 ( 0.0 , 0.0 ) ; if ( CL . x + CL . y > 2.0 ) { CN = vec4 ( - CL . x , - CL . x , CL . y , CL . y ) * u_texel_size . xyxy + CI . xyxy ; CM . x = texture2D ( CG , CN . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; CM . y = texture2D ( CG , CN . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; CM . zw = texture2D ( CG , CN . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; CP = vec2 ( 2.0 , 2.0 ) * CM . xz + CM . yw ; BO ( bvec2 ( step ( 0.9 , CL . zw ) ) , CP , vec2 ( 0 , 0 ) ) ; CO += CF ( CH , CL . xy , CP , CK . w ) . gr ; } return CO ; }".split(" ")}]}}]},
{type:"textline",tokens:"float CX ( sampler2D CS , vec2 CT , float CU ) { vec2 CV , CW ; CV = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; CW = SMAA_SEARCHTEX_SIZE * vec2 ( CU , 1.0 ) ; CV += vec2 ( - 1.0 , 1.0 ) ; CW += vec2 ( 0.5 , - 0.5 ) ; CV *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; CW *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( CS , CV * CT + CW , 0.0 ) . r ; } float De ( sampler2D CY , sampler2D CZ , vec2 C_ , float Da ) { float Db ; vec2 Dc ; Dc = vec2 ( 0.0 , 1.0 ) ; for ( int Dd = 0 ; Dd < SMAA_MAX_SEARCH_STEPS ; Dd ++ ) { if ( C_ . x > Da && Dc . g > 0.8281 && Dc . r == 0.0 ) { Dc = texture2D ( CY , C_ , 0.0 ) . rg ; C_ = - vec2 ( 2.0 , 0.0 ) * u_texel_size + C_ ; } } Db = - ( 255.0 / 127.0 ) * CX ( CZ , Dc , 0.0 ) + 3.25 ; return u_texel_size . x * Db + C_ . x ; } float Dm ( sampler2D Df , sampler2D Dg , vec2 Dh , float Di ) { float Dj ; vec2 Dk ; Dk = vec2 ( 0.0 , 1.0 ) ; for ( int Dl = 0 ; Dl < SMAA_MAX_SEARCH_STEPS ; Dl ++ ) { if ( Dh . x < Di && Dk . g > 0.8281 && Dk . r == 0.0 ) { Dk = texture2D ( Df , Dh , 0.0 ) . rg ; Dh = vec2 ( 2.0 , 0.0 ) * u_texel_size + Dh ; } } Dj = - ( 255.0 / 127.0 ) * CX ( Dg , Dk , 0.5 ) + 3.25 ; return - u_texel_size . x * Dj + Dh . x ; } float Du ( sampler2D Dn , sampler2D Do , vec2 Dp , float Dq ) { float Dr ; vec2 Ds ; Ds = vec2 ( 1.0 , 0.0 ) ; for ( int Dt = 0 ; Dt < SMAA_MAX_SEARCH_STEPS ; Dt ++ ) { if ( Dp . y > Dq && Ds . r > 0.8281 && Ds . g == 0.0 ) { Ds = texture2D ( Dn , Dp , 0.0 ) . rg ; Dp = - vec2 ( 0.0 , 2.0 ) * u_texel_size + Dp ; } } Dr = - ( 255.0 / 127.0 ) * CX ( Do , Ds . gr , 0.0 ) + 3.25 ; return u_texel_size . y * Dr + Dp . y ; } float DC ( sampler2D Dv , sampler2D Dw , vec2 Dx , float Dy ) { float Dz ; vec2 DA ; DA = vec2 ( 1.0 , 0.0 ) ; for ( int DB = 0 ; DB < SMAA_MAX_SEARCH_STEPS ; DB ++ ) { if ( Dx . y < Dy && DA . r > 0.8281 && DA . g == 0.0 ) { DA = texture2D ( Dv , Dx , 0.0 ) . rg ; Dx = vec2 ( 0.0 , 2.0 ) * u_texel_size + Dx ; } } Dz = - ( 255.0 / 127.0 ) * CX ( Dw , DA . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * Dz + Dx . y ; } vec2 DJ ( sampler2D DD , vec2 DE , float DF , float DG , float DH ) { vec2 DI ; DI = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * BT ( 4.0 * vec2 ( DF , DG ) ) + DE ; DI = SMAA_AREATEX_PIXEL_SIZE * DI + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; DI . y = SMAA_AREATEX_SUBTEX_SIZE * DH + DI . y ; return texture2D ( DD , DI , 0.0 ) . rg ; } void DQ ( sampler2D DK , inout vec2 DL , vec4 DM , vec2 DN ) { vec2 DO , DP ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SMAA_DISABLE_CORNER_DETECTION",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"DO = step ( DN . xy , DN . yx ) ; DP = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * DO ; DP /= DO . x + DO . y ; DO = vec2 ( 1.0 , 1.0 ) ; DO . x -= DP . x * texture2D ( DK , DM . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; DO . x -= DP . y * texture2D ( DK , DM . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; DO . y -= DP . x * texture2D ( DK , DM . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; DO . y -= DP . y * texture2D ( DK , DM . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; DL *= clamp ( DO , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",tokens:"} void DX ( sampler2D DR , inout vec2 DS , vec4 DT , vec2 DU ) { vec2 DV , DW ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_DISABLE_CORNER_DETECTION",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"DV = step ( DU . xy , DU . yx ) ; DW = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * DV ; DW /= DV . x + DV . y ; DV = vec2 ( 1.0 , 1.0 ) ; DV . x -= DW . x * texture2D ( DR , DT . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; DV . x -= DW . y * texture2D ( DR , DT . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; DV . y -= DW . x * texture2D ( DR , DT . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; DV . y -= DW . y * texture2D ( DR , DT . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; DS *= clamp ( DV , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",tokens:["}"]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec4 Ek ( vec2 DY , vec2 DZ , sampler2D D_ , sampler2D Ea , sampler2D Eb , vec4 Ec ) { float Ed , Ee ; vec3 Ef ; vec2 Eg , Eh , Ei ; vec4 Ej ; Ej = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; Eg = texture2D ( D_ , DY ) . rg ; if ( Eg . g > 0.0 ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_DISABLE_DIAG_DETECTION",
{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"Ej . rg = CR ( D_ , Ea , DY , Eg , Ec ) ; if ( Ej . r == - Ej . g ) {".split(" ")}]}}]},{type:"textline",tokens:"; Ef . x = De ( D_ , Eb , Bw . xy , By . x ) ; Ef . y = Bx . y ; Eh . x = Ef . x ; Ed = texture2D ( D_ , Ef . xy , 0.0 ) . r ; Ef . z = Dm ( D_ , Eb , Bw . zw , By . y ) ; Eh . y = Ef . z ; Eh = abs ( BT ( Eh / u_texel_size . xx - DZ . xx ) ) ; Ei = sqrt ( Eh ) ; Ee = texture2D ( D_ , Ef . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; Ej . rg = DJ ( Ea , Ei , Ed , Ee , Ec . y ) ; Ef . y = DY . y ; DQ ( D_ , Ej . rg , Ef . xyzy , Eh ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"} else Eg . r = 0.0 ;".split(" ")}]}}]},{type:"textline",tokens:"} if ( Eg . r > 0.0 ) { ; Ef . y = Du ( D_ , Eb , Bx . xy , By . z ) ; Ef . x = Bw . x ; Eg . x = Ef . y ; Ee = texture2D ( D_ , Ef . xy , 0.0 ) . g ; Ef . z = DC ( D_ , Eb , Bx . zw , By . w ) ; Eg . y = Ef . z ; Eg = abs ( BT ( Eg / u_texel_size . yy - DZ . yy ) ) ; Eh = sqrt ( Eg ) ; Ed = texture2D ( D_ , Ef . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; Ej . ba = DJ ( Ea , Eh , Ee , Ed , Ec . x ) ; Ef . x = DY . x ; DX ( D_ , Ej . ba , Ef . xyxz , Eg ) ; } return Ej ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec4 Ew ( vec2 El , sampler2D Em , sampler2D En".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:[",","sampler2D","Eo"]}]}}]},{type:"textline",tokens:") { bool Ep ; vec2 Eq , Er , Es ; vec4 Et , Eu , Ev ; Et . x = texture2D ( En , Bv . xy ) . a ; Et . y = texture2D ( En , Bv . zw ) . g ; Et . wz = texture2D ( En , El ) . xz ; if ( dot ( Et , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { Eu = texture2D ( Em , El , 0.0 ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:"Ev = texture2D ( Eo , bM ) ; Eq = 2.0 * ag ( Ev ) - 1.0 ; Eu . a = sqrt ( 2.0 * length ( Eq ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"return Eu ; } else { Ep = max ( Et . x , Et . z ) > max ( Et . y , Et . w ) ; Eu = vec4 ( 0.0 , Et . y , 0.0 , Et . w ) ; Eq = Et . yw ; BO ( bvec4 ( Ep , Ep , Ep , Ep ) , Eu , vec4 ( Et . x , 0.0 , Et . z , 0.0 ) ) ; BO ( bvec2 ( Ep , Ep ) , Eq , Et . xz ) ; Eq /= dot ( Eq , vec2 ( 1.0 , 1.0 ) ) ; Eu = Eu * vec4 ( u_texel_size , - u_texel_size ) + El . xyxy ; Et = Eq . x * texture2D ( Em , Eu . xy , 0.0 ) ; Et += Eq . y * texture2D ( Em , Eu . zw , 0.0 ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:"Ev = texture2D ( Eo , Eu . xy ) ; Er = 2.0 * ag ( Ev ) - 1.0 ; Es = Eq . x * Er ; Ev = texture2D ( Eo , Eu . zw ) ; Er = 2.0 * ag ( Ev ) - 1.0 ; Es += Eq . y * Er ; Et . a = sqrt ( 2.0 * length ( Es ) ) ;".split(" ")}]}}]},{type:"textline",tokens:["return","Et",";","}","}"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:"vec4 EG ( vec2 Ex , sampler2D Ey , sampler2D Ez".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:[",","sampler2D","EA"]}]}}]},{type:"textline",tokens:") { float EB ; vec2 EC ; vec4 ED , EE , EF ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:"ED = texture2D ( EA , bM ) ; EC = 2.0 * ag ( ED ) - 1.0 ; ED = texture2D ( Ey , Ex ) ; EE = texture2D ( Ez , Ex - EC ) ; EB = abs ( ED . a * ED . a - EE . a * EE . a ) / 2.0 ; EB = 0.5 * clamp ( 1.0 - sqrt ( EB ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; EF = mix ( ED , EE , EB ) ; EF . a = 1.0 ; return EF ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"ED = texture2D ( Ey , Ex ) ; EE = texture2D ( Ez , Ex ) ; return mix ( ED , EE , 0.5 ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:"void main ( ) { vec4 EH ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"EH = vec4 ( Cg ( bM , u_color".split(" ")},{type:"condition",parts:[{type:"if",
expression:["SMAA_PREDICATION"],group:{type:"group",parts:[{type:"textline",tokens:[",","u_predication_tex"]}]}}]},{type:"textline",tokens:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"EH = Ek ( bM , Bz , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"EH = Ew ( bM , u_color , u_blend".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:[",","u_velocity_tex"]}]}}]},{type:"textline",tokens:[")",";"]}]}},{type:"elif",expression:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"EH = vec4 ( EG ( bM , u_color , u_color_prev".split(" ")},{type:"condition",
parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:[",","u_velocity_tex"]}]}}]},{type:"textline",tokens:[")",")",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"EH = texture2D ( u_color , bM ) ;".split(" ")}]}}]},{type:"textline",tokens:["gl_FragColor","=","EH",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",parts:[{type:"define",name:"SMAA_EDGE_DETECTION",tokens:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",
tokens:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",tokens:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",tokens:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",tokens:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",tokens:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",tokens:["4"]},{type:"textline",tokens:"attribute vec2 a_position ; uniform vec2 u_texel_size ; varying vec2 bM ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","Bv",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"varying vec4 Bw ; varying vec4 Bx ; varying vec4 By ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","Bz",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["AA_METHOD",
"AA_METHOD_SMAA_LOW",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",tokens:["4"]}]}},{type:"elif",expression:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",tokens:["8"]}]}},{type:"elif",expression:["AA_METHOD","AA_METHOD_SMAA_HIGH",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",tokens:["16"]}]}},{type:"elif",
expression:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",tokens:["32"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",tokens:["16"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"void Ae ( vec2 z_ ) { Bw = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + z_ . xyxy ; Bx = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + z_ . xyxy ; By = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + z_ . xyxy ; }".split(" ")}]}},
{type:"elif",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"void Ah ( vec2 Af , out vec2 Ag ) { Ag = Af / u_texel_size ; Bw = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + Af . xyxy ; Bx = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + Af . xyxy ; By = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( Bw . xz , Bx . yw ) ; }".split(" ")}]}},
{type:"elif",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"void Aj ( vec2 Ai ) { Bv = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + Ai . xyxy ; }".split(" ")}]}}]},{type:"textline",tokens:"void main ( ) { bM = 2.0 * a_position ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["Ae",
"(","bM",")",";"]}]}},{type:"elif",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Ah ( bM , Bz ) ;".split(" ")}]}},{type:"elif",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["Aj","(","bM",")",";"]}]}}]},{type:"textline",tokens:"gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]=
{type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"textline",tokens:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_8",tokens:["1"]},{type:"define",name:"SSAO_QUALITY_16",tokens:["2"]},{type:"define",name:"SSAO_QUALITY_24",tokens:["3"]},{type:"define",name:"SSAO_QUALITY_32",tokens:["4"]},{type:"textline",tokens:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; varying vec2 bM ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float Ae ( in vec2 z_ ) { return Bq ( u_depth , z_ , u_camera_range ) ; } void main ( ) { vec3 Af , Ag , Ah ; float Ai , Aj , Ak , Al , Am , An , Ao ; Ai = texture2D ( u_color , bM ) . r ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SSAO_WHITE"],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( Ai , 1.0 , 0.0 , 1.0 ) ; return ;".split(" ")}]}}]},{type:"textline",tokens:"Af = normalize ( 2.0 * texture2D ( u_ssao_special_tex , bM * 0.25 / u_texel_size ) . rgb - 1.0 ) ; Aj = Ae ( bM ) ; Ak = Aj * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SSAO_QUALITY","SSAO_QUALITY_8",{type:"equal_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:"const float Ap = 8.0 ; const int Aq = 1 ;".split(" ")}]}},{type:"elif",expression:["SSAO_QUALITY","SSAO_QUALITY_16",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"const float Ap = 16.0 ; const int Aq = 2 ;".split(" ")}]}},{type:"elif",expression:["SSAO_QUALITY","SSAO_QUALITY_24",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"const float Ap = 24.0 ; const int Aq = 3 ;".split(" ")}]}},
{type:"elif",expression:["SSAO_QUALITY","SSAO_QUALITY_32",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"const float Ap = 32.0 ; const int Aq = 4 ;".split(" ")}]}}]},{type:"textline",tokens:"Al = u_ssao_radius_increase * 0.001 ; const float Ar = 1.0 + 2.4 / Ap ; Am = 0.0 ; for ( int As = 0 ; As < Aq ; As ++ ) for ( int At = - 1 ; At <= 1 ; At += 2 ) for ( int BA = - 1 ; BA <= 1 ; BA += 2 ) for ( int BB = - 1 ; BB <= 1 ; BB += 2 ) { Ag = reflect ( normalize ( vec3 ( At , BA , BB ) ) , Af ) * ( Al *= Ar ) ; Ah = vec3 ( bM , Ak ) ; Ah += vec3 ( Ag . xy , Ag . z * Ak * 2.0 ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SSAO_HEMISPHERE"],group:{type:"group",parts:[{type:"textline",tokens:"Ah . z -= 1.4 * ( Ah . z - Ak ) * step ( Ak , Ah . z ) ;".split(" ")}]}}]},{type:"textline",tokens:"An = Ae ( Ah . xy ) * ( u_camera_range . y - u_camera_range . x ) ; Ao = clamp ( ( Ak - An ) / An , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SSAO_HEMISPHERE"],group:{type:"group",parts:[{type:"textline",tokens:"Am += mix ( 1.0 , Ao , step ( An , Ah . z ) ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Am += mix ( step ( Ah . z , An ) , 0.5 , Ao ) ;".split(" ")}]}}]},{type:"textline",tokens:"} Am = Am / Ap ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SSAO_HEMISPHERE"],group:{type:"group",parts:[{type:"textline",tokens:"Am = clamp ( Am * Am + 0.6 * Am , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Am = clamp ( Am * Am + Am , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",
tokens:"Aj = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * Aj ) ; Am = mix ( 1.0 , Am , Aj ) ; gl_FragColor = vec4 ( Ai , Am , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao_blur.glslf"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"textline",tokens:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"condition",parts:[{type:"if",expression:["SSAO_BLUR_DEPTH"],group:{type:"group",parts:[{type:"include",file:"depth_fetch.glslf"}]}}]},
{type:"textline",tokens:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; varying vec2 bM ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SSAO_BLUR_DEPTH"],group:{type:"group",parts:[{type:"textline",tokens:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float Ae ( in vec2 z_ ) { return Bq ( u_depth , z_ , u_camera_range ) ; }".split(" ")}]}}]},{type:"textline",tokens:"void main ( ) { vec2 Af , Ag ; float Ah , Ai , Aj , Ak , Al , Am , An ; Ah = 0.0 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SSAO_BLUR_DEPTH"],group:{type:"group",parts:[{type:"textline",tokens:"Ai = Ae ( bM ) ; Aj = 0.0 ; Ak = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},{type:"textline",tokens:"Af = vec2 ( - 2.0 ) ; for ( int Ao = 0 ; Ao < 4 ; ++ Ao ) { for ( int Ap = 0 ; Ap < 4 ; ++ Ap ) { Ag = ( Af + vec2 ( float ( Ao ) , float ( Ap ) ) ) * u_texel_size ; Al = texture2D ( u_ssao_mask , bM + Ag ) . g ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SSAO_BLUR_DEPTH"],
group:{type:"group",parts:[{type:"textline",tokens:"Am = Ae ( bM + Ag ) ; An = 1.0 - clamp ( abs ( Am - Ai ) * Ak , 0.0 , 1.0 ) ; Ah += Al * An ; Aj += An ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["Ah","+=","Al",";"]}]}}]},{type:"textline",tokens:["}","}"]},{type:"condition",parts:[{type:"if",expression:["SSAO_BLUR_DEPTH"],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , bM ) . r , Ah / Aj , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , bM ) . r , Ah / 16.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["postprocessing/velocity.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",tokens:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 bM ; void main ( ) { vec2 z_ ; vec4 Ae , Af ; float Ag ; Ag = texture2D ( u_depth , bM ) . x ; Ae = vec4 ( bM * 2.0 - 1.0 , 2.0 * Ag - 1.0 , 1.0 ) ; Af = u_view_proj_inverse * Ae ; Af = Af / Af . w ; Af = u_view_proj_prev * Af ; Af /= Af . w ; z_ = ( Ae . xy - Af . xy ) / 4.0 + 0.5 ; z_ = clamp ( z_ , 0.0 , 1.0 ) ; gl_FragColor = V ( z_ ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"textline",tokens:["precision","PRECISION","float",";"]}]};a["include/math.glslv"]={type:"group",parts:[{type:"var",name:"EPSILON",tokens:["0.0001"]},{type:"textline",tokens:"float a = 0.0 ; float b = 1.0 ; struct c { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool f ( vec3 d , vec3 e ) { return any ( lessThan ( abs ( d - e ) , vec3 ( EPSILON ) ) ) ; } vec3 i ( in vec4 g , in vec3 h ) { return h + 2.0 * cross ( g . xyz , cross ( g . xyz , h ) + g . w * h ) ; } vec4 k ( in vec4 j ) { return vec4 ( - j . xyz , j . w ) / dot ( j , j ) ; } vec3 p ( vec4 l , vec4 m , vec4 n ) { vec3 o ; o = n . xyz * l . w ; o = i ( m , o ) ; o += l . xyz * n . w ; return o ; } vec3 v ( vec4 q , vec4 r , vec4 s ) { vec4 t ; vec3 u ; u = s . xyz - q . xyz * s . w ; t = k ( r ) ; u = i ( t , u ) ; u /= q . w ; return u ; } mat4 w ( ) { return mat4 ( b , a , a , a , a , b , a , a , a , a , b , a , a , a , a , b ) ; } mat4 y ( float x ) { return mat4 ( b , a , a , a , a , cos ( x ) , sin ( x ) , a , a , - sin ( x ) , cos ( x ) , a , a , a , a , b ) ; } mat4 A ( float z ) { return mat4 ( cos ( z ) , a , - sin ( z ) , a , a , b , a , a , sin ( z ) , a , cos ( z ) , a , a , a , a , b ) ; } mat4 C ( float B ) { return mat4 ( cos ( B ) , sin ( B ) , a , a , - sin ( B ) , cos ( B ) , a , a , a , a , b , a , a , a , a , b ) ; } c E ( in c D ) { return c ( D . a , D . b , normalize ( D . c ) , normalize ( D . d ) , normalize ( D . e ) , D . f ) ; }".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 L ( vec4 F ) { vec3 G ; float H , I , J ; H = F . x ; I = F . y ; J = F . w ; G . x = ( H + J ) / 2.0 ; G . y = ( I + J ) / 2.0 ; G . z = J ; return G ; }".split(" ")}]}}]},{type:"textline",tokens:"mat4 O ( mat3 M ) { mat4 N ; N [ 0 ] [ 0 ] = ( b - ( M [ 1 ] [ 2 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) + M [ 2 ] [ 0 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) ) ) * M [ 1 ] [ 0 ] ; N [ 0 ] [ 1 ] = ( M [ 1 ] [ 1 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) + M [ 2 ] [ 1 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) ) * M [ 1 ] [ 0 ] ; N [ 0 ] [ 2 ] = ( M [ 1 ] [ 1 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) - M [ 2 ] [ 1 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) ) * M [ 1 ] [ 0 ] ; N [ 0 ] [ 3 ] = a ; N [ 1 ] [ 0 ] = ( M [ 1 ] [ 1 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) - M [ 2 ] [ 1 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) ) * M [ 1 ] [ 0 ] ; N [ 1 ] [ 1 ] = ( b - ( M [ 1 ] [ 1 ] * ( M [ 1 ] [ 1 ] + M [ 1 ] [ 1 ] ) + M [ 2 ] [ 0 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) ) ) * M [ 1 ] [ 0 ] ; N [ 1 ] [ 2 ] = ( M [ 1 ] [ 2 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) + M [ 2 ] [ 1 ] * ( M [ 1 ] [ 1 ] + M [ 1 ] [ 1 ] ) ) * M [ 1 ] [ 0 ] ; N [ 1 ] [ 3 ] = a ; N [ 2 ] [ 0 ] = ( M [ 1 ] [ 1 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) + M [ 2 ] [ 1 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) ) * M [ 1 ] [ 0 ] ; N [ 2 ] [ 1 ] = ( M [ 1 ] [ 2 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) - M [ 2 ] [ 1 ] * ( M [ 1 ] [ 1 ] + M [ 1 ] [ 1 ] ) ) * M [ 1 ] [ 0 ] ; N [ 2 ] [ 2 ] = ( b - ( M [ 1 ] [ 1 ] * ( M [ 1 ] [ 1 ] + M [ 1 ] [ 1 ] ) + M [ 1 ] [ 2 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) ) ) * M [ 1 ] [ 0 ] ; N [ 2 ] [ 3 ] = a ; N [ 3 ] [ 0 ] = M [ 0 ] [ 0 ] ; N [ 3 ] [ 1 ] = M [ 0 ] [ 1 ] ; N [ 3 ] [ 2 ] = M [ 0 ] [ 2 ] ; N [ 3 ] [ 3 ] = b ; return N ; }".split(" ")}]};
a["include/std_enums.glsl"]={type:"group",parts:[{type:"define",name:"TEXTURE_COORDS_UV_ORCO",tokens:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",tokens:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",tokens:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",tokens:["2"]},{type:"define",name:"SHADOW_SRC_NONE",tokens:["1"]},{type:"define",name:"SHADOW_SRC_DEPTH",tokens:["2"]},{type:"define",name:"SHADOW_SRC_MASK",tokens:["3"]},{type:"define",name:"SHADOW_DST_NONE",tokens:["1"]},{type:"define",
name:"SHADOW_DST_DEPTH",tokens:["2"]},{type:"define",name:"SHADOW_DST_MASK",tokens:["3"]},{type:"define",name:"NO_SHADOWS",tokens:["1"]},{type:"define",name:"SHADOW_CASTING",tokens:["2"]},{type:"define",name:"SHADOW_MASK_GENERATION",tokens:["3"]},{type:"define",name:"SHADOW_MAPPING_OPAQUE",tokens:["4"]},{type:"define",name:"SHADOW_MAPPING_BLEND",tokens:["5"]},{type:"define",name:"SPECULAR_PHONG",tokens:["1"]},{type:"define",name:"SPECULAR_COOKTORR",tokens:["2"]},{type:"define",name:"SPECULAR_WARDISO",
tokens:["3"]},{type:"define",name:"SPECULAR_BLINN",tokens:["4"]},{type:"define",name:"SPECULAR_TOON",tokens:["5"]},{type:"define",name:"DIFFUSE_LAMBERT",tokens:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",tokens:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",tokens:["3"]},{type:"define",name:"DIFFUSE_MINNAERT",tokens:["4"]},{type:"define",name:"DIFFUSE_TOON",tokens:["5"]},{type:"define",name:"MAPPING_TYPE_TEXTURE",tokens:["0.0"]},{type:"define",name:"MAPPING_TYPE_POINT",tokens:["1.0"]},{type:"define",
name:"MAPPING_TYPE_VECTOR",tokens:["2.0"]},{type:"define",name:"MAPPING_TYPE_NORMAL",tokens:["3.0"]},{type:"define",name:"MIX",tokens:["0"]},{type:"define",name:"ADD",tokens:["1"]},{type:"define",name:"SUBTRACT",tokens:["2"]},{type:"define",name:"MULTIPLY",tokens:["3"]},{type:"define",name:"SCREEN",tokens:["4"]},{type:"define",name:"OVERLAY",tokens:["5"]},{type:"define",name:"DIFFERENCE",tokens:["6"]},{type:"define",name:"DIVIDE",tokens:["7"]},{type:"define",name:"DARKEN",tokens:["8"]},{type:"define",
name:"LIGHTEN",tokens:["9"]},{type:"define",name:"HUE",tokens:["10"]},{type:"define",name:"SATURATION",tokens:["11"]},{type:"define",name:"VALUE",tokens:["12"]},{type:"define",name:"COLOR",tokens:["13"]},{type:"define",name:"SOFT_LIGHT",tokens:["14"]},{type:"define",name:"LINEAR_LIGHT",tokens:["15"]},{type:"define",name:"REFL_NONE",tokens:["0"]},{type:"define",name:"REFL_MIRRORMAP",tokens:["1"]},{type:"define",name:"REFL_PLANE",tokens:["2"]},{type:"define",name:"REFL_CUBE",tokens:["3"]},{type:"define",
name:"INVERSE_QUADRATIC",tokens:["0"]},{type:"define",name:"LINEAR",tokens:["1"]},{type:"define",name:"QUADRATIC",tokens:["2"]},{type:"define",name:"HEMI",tokens:["1"]},{type:"define",name:"SPOT",tokens:["2"]},{type:"define",name:"POINT",tokens:["3"]},{type:"define",name:"SUN",tokens:["4"]}]};a["include/pack.glslf"]={type:"group",parts:[{type:"textline",tokens:"float P = 255.0 ; float Q = 0.0 ; float R = 1.0 ; vec4 V ( const in float S ) { vec4 T , U ; T = vec4 ( P * P * P , P * P , P , R ) ; U = vec4 ( Q , R / P , R / P , R / P ) ; T = fract ( S * T ) ; T -= T . xxyz * U ; return T ; } float Z ( const in vec4 W ) { vec4 X ; float Y ; X = vec4 ( R / ( P * P * P ) , R / ( P * P ) , R / P , R ) ; Y = dot ( W , X ) ; return Y ; } vec4 V ( const in vec2 _ ) { vec4 aa ; vec2 ab , ac ; ab = vec2 ( P , R ) ; ac = vec2 ( Q , R / P ) ; aa = fract ( _ . xxyy * ab . xyxy ) ; aa -= aa . xxzz * ac . xyxy ; if ( _ . r == R ) aa . rg = vec2 ( Q , R ) ; if ( _ . g == R ) aa . ba = vec2 ( Q , R ) ; return aa ; } vec2 ag ( const in vec4 ad ) { vec2 ae , af ; af = vec2 ( R / P , R ) ; ae . r = dot ( ad . rg , af ) ; ae . g = dot ( ad . ba , af ) ; return ae ; }".split(" ")}]};
a["include/procedural.glslf"]={type:"group",parts:[{type:"textline",tokens:"float ah = 0.0 ; float ai = 1.0 ; vec4 ak ( vec4 aj ) { return aj - floor ( aj * ( ai / 289.0 ) ) * 289.0 ; } vec3 ak ( vec3 al ) { return al - floor ( al * ( ai / 289.0 ) ) * 289.0 ; } vec2 ak ( vec2 am ) { return am - floor ( am * ( ai / 289.0 ) ) * 289.0 ; } vec4 ao ( vec4 an ) { return an - floor ( an * ( ai / 7.0 ) ) * 7.0 ; } vec4 aq ( vec4 ap ) { return ak ( ( 34.0 * ap + 5.0 ) * ap ) ; }".split(" ")},{type:"define",
name:"K",tokens:["0.142857142857"]},{type:"define",name:"K2",tokens:["0.0714285714285"]},{type:"define",name:"JITTER",tokens:["0.7"]},{type:"textline",tokens:"vec2 ay ( vec2 ar ) { vec4 as , at , au , av ; vec2 aw , ax ; aw = ak ( floor ( ar ) ) ; ax = fract ( ar ) ; as = ax . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; at = ax . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; au = aq ( aw . x + vec4 ( ah , ai , ah , ai ) ) ; au = aq ( au + aw . y + vec4 ( ah , ah , ai , ai ) ) ; av = ao ( au ) * K + K2 ; au = ao ( floor ( au * K ) ) * K + K2 ; av = as + JITTER * av ; au = at + JITTER * au ; au = av * av + au * au ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:[1],group:{type:"group",parts:[{type:"textline",tokens:"au . xy = min ( au . xy , au . zw ) ; au . x = min ( au . x , au . y ) ; return au . xx ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"au . xy = ( au . x < au . y ) ? au . xy : au . yx ; au . xz = ( au . x < au . z ) ? au . xz : au . zx ; au . xw = ( au . x < au . w ) ? au . xw : au . wx ; au . y = min ( au . y , au . z ) ; au . y = min ( au . y , au . w ) ; return sqrt ( au . xy ) ;".split(" ")}]}}]},
{type:"textline",tokens:"} vec3 aH ( vec2 az , float aA ) { vec4 aB , aC , aD , aE ; vec2 aF , aG ; aF = ak ( floor ( az ) ) ; aG = fract ( az ) ; aB = aG . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; aC = aG . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; aD = aq ( aF . x + vec4 ( ah , ai , ah , ai ) ) ; aD = aq ( aD + aF . y + vec4 ( ah , ah , ai , ai ) ) ; aE = ao ( aD ) * K + K2 ; aD = ao ( floor ( aD * K ) ) * K + K2 ; aE = aB + JITTER * aE ; aD = aC + JITTER * aD ; aC = aE * aE + aD * aD ; aE += aA ; aD += aA ; aB = aE * aE + aD * aD ; aE += aA ; aD += aA ; aD = aE * aE + aD * aD ; aC . xy = min ( aC . xy , aC . zw ) ; aC . x = min ( aC . x , aC . y ) ; aB . xy = min ( aB . xy , aB . zw ) ; aB . x = min ( aB . x , aB . y ) ; aD . xy = min ( aD . xy , aD . zw ) ; aD . x = min ( aD . x , aD . y ) ; return vec3 ( aC . x , aB . x , aD . x ) ; } vec3 aJ ( vec3 aI ) { return ak ( ( ( aI * 34.0 ) + ai ) * aI ) ; } float aU ( vec2 aK ) { vec3 aL , aM , aN , aO ; vec4 aP ; vec2 aQ , aR , aS ; const vec4 aT = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; aQ = floor ( aK + dot ( aK , aT . yy ) ) ; aR = aK - aQ + dot ( aQ , aT . xx ) ; aS = ( aR . x > aR . y ) ? vec2 ( ai , ah ) : vec2 ( ah , ai ) ; aP = aR . xyxy + aT . xxzz ; aP . xy -= aS ; aQ = ak ( aQ ) ; aL = aJ ( aJ ( aQ . y + vec3 ( ah , aS . y , ai ) ) + aQ . x + vec3 ( ah , aS . x , ai ) ) ; aM = max ( 0.5 - vec3 ( dot ( aR , aR ) , dot ( aP . xy , aP . xy ) , dot ( aP . zw , aP . zw ) ) , ah ) ; aM = aM * aM ; aM = aM * aM ; aL = 2.0 * fract ( aL * aT . www ) - ai ; aN = abs ( aL ) - 0.5 ; aO = floor ( aL + 0.5 ) ; aO = aL - aO ; aM *= 1.79284291400159 - 0.85373472095314 * ( aO * aO + aN * aN ) ; aL . x = aO . x * aR . x + aN . x * aR . y ; aL . yz = aO . yz * aP . xz + aN . yz * aP . yw ; return 130.0 * dot ( aM , aL ) ; } vec2 aY ( vec2 aV ) { float aW , aX ; aW = dot ( aV , vec2 ( 12.9898 , 78.233 ) ) ; aX = dot ( aV , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; aW = fract ( sin ( aW ) * 43758.5453 ) * 2.0 - ai ; aX = fract ( sin ( aX ) * 43758.5453 ) * 2.0 - ai ; return vec2 ( aW , aX ) ; }".split(" ")}]};
a["include/caustics.glslf"]={type:"group",parts:[{type:"var",name:"CAUST_SPEED",tokens:["vec2","(","0.0",")"]},{type:"var",name:"CAUST_SCALE",tokens:["0.0"]},{type:"var",name:"CAUST_BRIGHT",tokens:["0.0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",tokens:["100.0"]},{type:"textline",tokens:"void bp ( inout vec3 aZ , float a_ , float ba , float bb , vec3 bc , vec3 bd , vec3 be , vec4 bf , vec3 bg , float bh ) { float bi , bj , bk ; vec2 bl , bm ; vec3 bn ; vec4 bo ; if ( bh > CAUSTICS_VIEW_DISTANCE ) return ; bo = bf ; bn = bg + bc ; bn . xz = 10.0 * sin ( 0.1 * bn . xz ) ; bn = bn + 2.0 * cross ( - bo . xyz , cross ( - bo . xyz , bn ) + bo . w * bn ) ; bl = bn . xz ; bn = bd ; bi = max ( dot ( bc , bn ) , 0.0 ) ; bj = 0.025 ; bm = CAUST_SPEED * ba ; bl . s += 0.25 * sin ( dot ( bg + ba , vec3 ( 1.0 ) ) ) ; bl . t += 0.35 * ( - sin ( dot ( bg - ba , vec3 ( - 0.7 ) ) ) ) ; bl . st += 0.15 * cos ( 4.0 * a_ - bm . x ) + 1.5 * sin ( a_ - 0.3 * bm . y ) ; bk = CAUST_SCALE * ( 1.0 + max ( 0.1 * a_ , 0.0 ) ) ; bn = aH ( ( bl / bk ) , bj ) ; bn *= CAUST_BRIGHT ; bn *= bn ; bj = min ( 0.25 * a_ , - a_ ) + 1.0 ; bj = max ( bj , 0.0 ) ; bi = bb * bi ; bk = max ( sign ( a_ ) , 0.0 ) ; bi = bi + max ( 0.5 * sign ( - bc . y ) * bk , 0.0 ) ; bi = min ( bi , 1.0 ) ; aZ += be * bn * bj * bi ; }".split(" ")}]};
a["include/color_util.glslf"]={type:"group",parts:[{type:"define",name:"GAMMA",tokens:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",tokens:["1"]},{type:"textline",tokens:"void br ( inout vec3 bq ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["GAMMA"],group:{type:"group",parts:[{type:"textline",tokens:"bq = max ( vec3 ( 0.0 ) , bq ) ; bq = pow ( bq , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"} void br ( inout float bs ) {".split(" ")},{type:"condition",parts:[{type:"if",
expression:["GAMMA"],group:{type:"group",parts:[{type:"textline",tokens:"bs = pow ( max ( 0.0 , bs ) , 2.2 ) ;".split(" ")}]}}]},{type:"textline",tokens:"} void bu ( inout vec3 bt ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["GAMMA"],group:{type:"group",parts:[{type:"textline",tokens:"bt = max ( vec3 ( 0.0 ) , bt ) ; bt = pow ( bt , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"} void bx ( inout vec3 bv , in float bw ) {".split(" ")},{type:"condition",parts:[{type:"if",
expression:["PREMULTIPLY_ALPHA"],group:{type:"group",parts:[{type:"textline",tokens:"bv = bv * bw ;".split(" ")}]}}]},{type:"textline",tokens:"} float bB ( vec4 by ) { float bz ; vec3 bA ; bA = vec3 ( 0.299 , 0.587 , 0.114 ) ; bz = dot ( by . rgb , bA ) ; return bz ; }".split(" ")}]};a["include/shadow.glslf"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",tokens:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",tokens:["1.0"]},{type:"var",
name:"SHADOW_TEX_RES",tokens:["0.0"]},{type:"define",name:"M_PI",tokens:["3.14159265359"]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["vec4","bN",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:"const float bO = 0.1 ; const float bP = 0.1 ; const float bQ = - 0.01 ; const float bR = 0.05 ; vec4 bS = vec4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 ) ; vec4 bT = vec4 ( 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 ) ; vec4 bU = vec4 ( - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 ) ; vec4 bV = vec4 ( - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; vec4 bW = vec4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 ) ; vec4 bX = vec4 ( - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 ) ; vec4 bY = vec4 ( - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 ) ; vec4 bZ = vec4 ( - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ; bool cb ( vec2 b_ , float ca ) { return all ( lessThanEqual ( b_ , vec2 ( 1.0 + ca ) ) ) && all ( greaterThanEqual ( b_ , vec2 ( 0.0 - ca ) ) ) ; } float ck ( float cc , float cd , mat2 ce , vec3 cf , float cg , PRECISION sampler2D ch ) { vec2 ci , cj ; cj . x = cc ; cj . y = cd ; cj = ce * cj ; ci = cf . xy + cj * cg / SHADOW_TEX_RES ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"if ( ! cb ( ci , bQ ) ) return 1.0 ; else".split(" ")}]}}]},{type:"textline",tokens:"return step ( cf . z , texture2D ( ch , ci ) . r ) ; } float ct ( vec3 cl , PRECISION sampler2D cm , float cn ) { mat2 co ; float cp , cq , cr ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",parts:[{type:"textline",
tokens:"if ( cl . z > u_perspective_cast_far_bound ) return 1.0 ; else {".split(" ")}]}}]},{type:"textline",tokens:"cl . z = clamp ( cl . z , 0.0 , 1.0 ) ; cp = 0.0 ; cq = aY ( cl . xy ) . x * M_PI ; cr = cos ( cq ) ; cq = sin ( cq ) ; co = mat2 ( cr , cq , - cq , cr ) ; for ( int cs = 0 ; cs < 4 ; cs ++ ) { cp += ck ( bS [ cs ] , bW [ cs ] , co , cl , cn , cm ) ; cp += ck ( bT [ cs ] , bX [ cs ] , co , cl , cn , cm ) ; cp += ck ( bU [ cs ] , bY [ cs ] , co , cl , cn , cm ) ; cp += ck ( bV [ cs ] , bZ [ cs ] , co , cl , cn , cm ) ; } cp /= 16.0 ; return clamp ( cp , 0.0 , 1.0 ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",parts:[{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:"return 1.0 ; } float cI ( vec3 cu , PRECISION sampler2D cv , vec3 cw , PRECISION sampler2D cx , float cy , float cz , float cA ) { mat2 cB ; float cC , cD , cE , cF ; cu . z = clamp ( cu . z , 0.0 , 1.0 ) ; cw . z = clamp ( cw . z , 0.0 , 1.0 ) ; cC = 0.0 ; cD = 0.0 ; cE = aY ( cu . xy ) . x * M_PI ; cF = cos ( cE ) ; cE = sin ( cE ) ; cB = mat2 ( cF , cE , - cE , cF ) ; for ( int cG = 0 ; cG < 4 ; cG ++ ) { cC += ck ( bS [ cG ] , bW [ cG ] , cB , cu , cy , cv ) ; cC += ck ( bT [ cG ] , bX [ cG ] , cB , cu , cy , cv ) ; cC += ck ( bU [ cG ] , bY [ cG ] , cB , cu , cy , cv ) ; cC += ck ( bV [ cG ] , bZ [ cG ] , cB , cu , cy , cv ) ; } for ( int cH = 0 ; cH < 4 ; cH ++ ) { cD += ck ( bS [ cH ] , bW [ cH ] , cB , cw , cz , cx ) ; cD += ck ( bT [ cH ] , bX [ cH ] , cB , cw , cz , cx ) ; cD += ck ( bU [ cH ] , bY [ cH ] , cB , cw , cz , cx ) ; cD += ck ( bV [ cH ] , bZ [ cH ] , cB , cw , cz , cx ) ; } cC = mix ( cC , cD , cA ) ; cC /= 16.0 ; return clamp ( cC , 0.0 , 1.0 ) ; } float cM ( vec2 cJ ) { float cK , cL ; cK = min ( cJ . x , cJ . y ) ; cL = min ( 1.0 - cJ . x , 1.0 - cJ . y ) ; return min ( cK , cL ) ; } float cP ( float cN , float cO ) { if ( cO >= 0.0 && cO <= bP ) cN = ( cN - 1.0 ) / bP * cO + 1.0 ; return cN ; } float c_ ( vec3 cQ , vec3 cR , PRECISION sampler2D cS , PRECISION sampler2D cT , float cU , float cV , float cW , float cX ) { float cY , cZ ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",parts:[{type:"textline",tokens:"cZ = cM ( cQ . xy ) ; if ( - cX > cW && cZ >= 0.0 && cZ <= bO && cb ( cR . xy , 0.0 ) ) { cZ = 1.0 - cZ / bO ; cY = cI ( cQ , cS , cR , cT , cU , cV , cZ ) ; } else".split(" ")}]}}]},{type:"textline",tokens:"cY = ct ( cQ , cS , cU ) ; return cY ; } float dh ( vec3 da , PRECISION sampler2D db , float dc , float dd , float de ) { float df , dg ; df = ct ( da , db , dc ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["CSM_FADE_LAST_CASCADE"],group:{type:"group",parts:[{type:"textline",tokens:"if ( - de > dd ) { dg = cM ( da . xy ) ; df = cP ( df , dg ) ; }".split(" ")}]}}]},{type:"textline",tokens:"return df ; } float dp ( float di ) { vec3 dj , dk , dl , dm ; float dn ; dn = 1.0 ; dj = bI . xyz / bI . w ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:"dk = bJ . xyz / bJ . w ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:"dl = bK . xyz / bK . w ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:"dm = bL . xyz / bL . w ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:"if ( cb ( dj . xy , 0.0 ) ) { dn = c_ ( dj , dk , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , di ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"if ( cb ( dj . xy , bR ) ) { dn = dh ( dj , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , di ) ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:"else { if ( cb ( dk . xy , 0.0 ) ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:"dn = c_ ( dk , dl , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , di ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"dn = dh ( dk , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , di ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:"else { if ( cb ( dl . xy , 0.0 ) ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:"dn = c_ ( dl , dm , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , di ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"dn = dh ( dl , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , di ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:"else { if ( cb ( dm . xy , 0.0 ) ) dn = dh ( dm , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , di ) ; }".split(" ")}]}}]},{type:"textline",tokens:["}"]}]}}]},
{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["return","dn",";","}"]}]}}]},{type:"textline",tokens:"float du ( inout vec3 dq ) { float dr ; vec3 ds ; vec2 dt ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"dt = texture2DProj ( u_shadow_mask , bG ) . rg ; ds = vec3 ( dt . r ) ; dr = dt . g ; bN = vec4 ( ds , dr ) ; dq *= bN . a ; return bN . r ;".split(" ")}]}},
{type:"elif",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return dp ( bD . z ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["return","1.0",";"]}]}}]},{type:"textline",tokens:["}"]}]};a["include/mirror.glslf"]={type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE",
"REFL_PLANE",{type:"equal_expr",places:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2},"REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"define",name:"REFL_BUMP",tokens:["0.1"]},{type:"textline",tokens:"float dB ( in vec3 dv , vec3 dw , float dx , float dy ) { float dz ; vec3 dA ; dA = normalize ( dw + dv ) ; dz = 1.0 - dot ( dv , dA ) ; dz = dy + ( 1.0 - dy ) * pow ( dz , dx ) ; return dz ; } void dP ( inout vec3 dC , vec3 dD , vec3 dE , float dF , mat4 dG ) { vec2 dH , dI ; float dJ , dK , dL ; vec3 dM , dN , dO ; dM = reflect ( - dD , dE ) ; dJ = u_fresnel_params [ 2 ] ; dK = u_fresnel_params [ 3 ] ; dL = 1.0 ; if ( dJ != 0.0 ) dL = dB ( dD , dM , dJ , dK ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"dN = textureCube ( u_cube_reflection , dM ) . xyz ;".split(" ")}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"dO = u_refl_plane . xyz * dot ( dE , u_refl_plane . xyz ) ; dO = dE - dO ; dH = ( dG * vec4 ( dO , 0.0 ) ) . xy ; dI = bG . xy / bG . z ; dI += dH * REFL_BUMP ; dN = texture2D ( u_plane_reflection , dI ) . rgb ;".split(" ")}]}},
{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"dN = textureCube ( u_mirrormap , dM ) . xyz ; dF = u_mirror_factor ;".split(" ")}]}}]},{type:"textline",tokens:"br ( dN . rgb ) ; dC = mix ( dC , dN , dF * dL ) ; }".split(" ")}]}}]}]};a["include/environment.glslf"]={type:"group",parts:[{type:"textline",tokens:"vec3 dS ( vec3 dQ ) { float dR ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT"],
group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["SKY_TEXTURE"],group:{type:"group",parts:[{type:"textline",tokens:"return textureCube ( u_sky_texture , dQ ) . rgb ;".split(" ")}]}},{type:"elif",expression:["SKY_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"dR = 0.5 * dQ . y + 0.5 ; return mix ( u_horizon_color , u_zenith_color , dR ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"return vec3 ( 1.0 ) ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"return vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["include/refraction.glslf"]={type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION_CORRECTION"],group:{type:"group",parts:[{type:"textline",tokens:"float dY ( in float dT , inout vec2 dU , in vec2 dV ) { float dW ; vec4 dX ; dX = texture2D ( u_scene_depth , dU ) ; dW = Z ( dX ) ; if ( dW < bH ) { dU = dV ; return dT ; } else { return dW ; } return dT ; }".split(" ")}]}}]},
{type:"textline",tokens:"vec3 ef ( in vec3 dZ , in vec2 d_ ) { vec3 ea ; float eb ; vec4 ec ; vec2 ed , ee ; ed = dZ . xy / dZ . z ; ee = ed + d_ ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION_CORRECTION"],group:{type:"group",parts:[{type:"textline",tokens:"ec = texture2DProj ( u_scene_depth , dZ ) ; eb = Z ( ec ) ; dY ( eb , ee , ed ) ;".split(" ")}]}}]},{type:"textline",tokens:"ea = texture2D ( u_refractmap , ee ) . rgb ; br ( ea ) ; return ea ; }".split(" ")}]}}]}]};
a["include/nodes.glslf"]={type:"group",parts:[{type:"var",name:"MAPPING_TRS_MATRIX",tokens:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",tokens:["0.0"]},{type:"var",name:"RGB_IND",tokens:["0"]},{type:"var",name:"VALUE_IND",
tokens:["0"]},{type:"var",name:"LAMP_INDEX",tokens:["0"]},{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"define",name:"M_PI",tokens:["3.14159265359"]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","eg",";"]}]}}]},{type:"textline",tokens:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; float eh = 0.5 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 el ( in vec3 ei , in float ej ) { vec3 ek ; ek = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:"ek = ef ( bG , ei . xz * ej ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"ek = texture2D ( u_refractmap , bG . xy / bG . z ) . rgb ; br ( ek ) ;".split(" ")}]}}]},{type:"textline",tokens:["return","ek",";","}"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE",
"USE_NODE_MIX_RGB_COLOR","USE_NODE_SEPHSV",{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 eq ( vec3 em ) { float en , eo ; vec4 ep ; ep = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; ep = mix ( vec4 ( em . bg , ep . wz ) , vec4 ( em . gb , ep . xy ) , step ( em . b , em . g ) ) ; ep = mix ( vec4 ( ep . xyw , em . r ) , vec4 ( em . r , ep . yzx ) , step ( ep . x , em . r ) ) ; en = ep . x - min ( ep . w , ep . y ) ; eo = 1.0e-10 ; return vec3 ( abs ( ep . z + ( ep . w - ep . y ) / ( 6.0 * en + eo ) ) , en / ( ep . x + eo ) , ep . x ) ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_COMBHSV",{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 eu ( vec3 er ) { vec3 es ; vec4 et ; et = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; es = abs ( fract ( vec3 ( er . r , er . r , er . r ) + et . xyz ) * 6.0 - et . www ) ; return er . b * mix ( et . xxx , clamp ( es - et . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , er . g ) ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_GEOMETRY_UV","USE_NODE_B4W_PARALLAX","USE_NODE_UV_MERGED",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 ew ( vec2 ev ) { return vec3 ( ev * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_TEXTURE_COLOR","USE_NODE_TEXTURE_NORMAL","USE_NODE_B4W_PARALLAX",{type:"logical_or_expr",places:3}],group:{type:"group",
parts:[{type:"textline",tokens:"vec2 ey ( vec3 ex ) { return vec2 ( ex . xy * eh + vec2 ( eh , eh ) ) ; }".split(" ")}]}}]},{type:"node",name:"CAMERA",declarations:[{type:"node_out",name:"fm",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"fn",qualifier:["float"],is_optional:!0},{type:"node_out",name:"fo",qualifier:["float"],is_optional:!0}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_fm"],statements:[{type:"textline",tokens:"fm = normalize ( fd . xyz ) ;".split(" ")}]}]},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_fn"],statements:[{type:"textline",tokens:"fn = abs ( fd . z ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_fo"],statements:[{type:"textline",tokens:"fo = length ( fd . xyz ) ;".split(" ")}]}]}]},{type:"node",name:"COMBRGB",declarations:[{type:"node_in",name:"fp",qualifier:["float"],is_optional:!1},{type:"node_in",name:"fq",qualifier:["float"],is_optional:!1},{type:"node_in",name:"fr",qualifier:["float"],
is_optional:!1},{type:"node_out",name:"fs",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fs = vec3 ( fp , fq , fr ) ;".split(" ")}]},{type:"node",name:"COMBHSV",declarations:[{type:"node_in",name:"ft",qualifier:["float"],is_optional:!1},{type:"node_in",name:"fu",qualifier:["float"],is_optional:!1},{type:"node_in",name:"fv",qualifier:["float"],is_optional:!1},{type:"node_out",name:"fw",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fw = eu ( vec3 ( ft , fu , fv ) ) ;".split(" ")}]},
{type:"node",name:"EMPTY_UV",declarations:[{type:"node_out",name:"fx",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fx = vec3 ( - UNITY_VALUE_NODES , - UNITY_VALUE_NODES , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"EMPTY_VC",declarations:[{type:"node_out",name:"fy",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fy = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_UV",declarations:[{type:"node_out",name:"fz",qualifier:["vec3"],
is_optional:!1},{type:"node_param",name:"ez",qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:"fz = ew ( ez ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_OR",declarations:[{type:"node_out",name:"fA",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fA = 2.0 * eg - vec3 ( UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC",declarations:[{type:"node_out",name:"fB",qualifier:["vec3"],is_optional:!1},{type:"node_param",name:"eA",qualifier:["varying",
"vec3"]}],statements:[{type:"textline",tokens:"fB = eA ; br ( fB ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC1",declarations:[{type:"node_out",name:"fC",qualifier:["float"],is_optional:!1},{type:"node_param",name:"eB",qualifier:["varying","float"]}],statements:[{type:"textline",tokens:"fC = eB ; br ( fC ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC2",declarations:[{type:"node_out",name:"fD",qualifier:["float"],is_optional:!1},{type:"node_out",name:"fE",qualifier:["float"],is_optional:!1},
{type:"node_param",name:"eC",qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:"fD = eC [ 0 ] ; fE = eC [ 1 ] ; br ( fD ) ; br ( fE ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC3",declarations:[{type:"node_out",name:"fF",qualifier:["float"],is_optional:!1},{type:"node_out",name:"fG",qualifier:["float"],is_optional:!1},{type:"node_out",name:"fH",qualifier:["float"],is_optional:!1},{type:"node_param",name:"eD",qualifier:["varying","vec3"]}],statements:[{type:"textline",tokens:"fF = eD [ 0 ] ; fG = eD [ 1 ] ; fH = eD [ 2 ] ; br ( fF ) ; br ( fG ) ; br ( fH ) ;".split(" ")}]},
{type:"node",name:"GEOMETRY_NO",declarations:[{type:"node_out",name:"fI",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["fI","=","fg",";"]}]},{type:"node",name:"GEOMETRY_FB",declarations:[{type:"node_out",name:"fJ",qualifier:["float"],is_optional:!1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["INVERT_FRONTFACING"],statements:[{type:"textline",tokens:"fJ = ( gl_FrontFacing ) ? ZERO_VALUE_NODES : UNITY_VALUE_NODES ;".split(" ")}]},{type:"node_else",
statements:[{type:"textline",tokens:"fJ = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]}]}]},{type:"node",name:"GEOMETRY_VW",declarations:[{type:"node_out",name:"fK",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["fK","=","eM",";"]}]},{type:"node",name:"GEOMETRY_LO",declarations:[{type:"node_out",name:"fL",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fL [ 0 ] = fd [ 0 ] ; fL [ 1 ] = fd [ 1 ] ; fL [ 2 ] = fd [ 2 ] ;".split(" ")}]},
{type:"node",name:"GEOMETRY_GL",declarations:[{type:"node_out",name:"fM",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fM = vec3 ( fh . r , - fh . b , fh . g ) ;".split(" ")}]},{type:"node",name:"NEW_GEOMETRY",declarations:[{type:"node_out",name:"fN",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"fO",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"fP",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"fQ",qualifier:["vec3"],is_optional:!1},{type:"node_out",
name:"fR",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"fS",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"fT",qualifier:["float"],is_optional:!1},{type:"node_out",name:"fU",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"fN = vec3 ( ZERO_VALUE_NODES ) ; fO = vec3 ( ZERO_VALUE_NODES ) ; fP = vec3 ( ZERO_VALUE_NODES ) ; fQ = vec3 ( ZERO_VALUE_NODES ) ; fR = vec3 ( ZERO_VALUE_NODES ) ; fS = vec3 ( ZERO_VALUE_NODES ) ; fT = ZERO_VALUE_NODES ; fU = ZERO_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"HUE_SAT",declarations:[{type:"node_in",name:"fV",qualifier:["float"],is_optional:!1},{type:"node_in",name:"fW",qualifier:["float"],is_optional:!1},{type:"node_in",name:"fX",qualifier:["float"],is_optional:!1},{type:"node_in",name:"fY",qualifier:["float"],is_optional:!1},{type:"node_in",name:"fZ",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"f_",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fj = eq ( fZ ) ; fj [ 0 ] += ( fV - eh ) ; if ( fj [ 0 ] > UNITY_VALUE_NODES ) fj [ 0 ] -= UNITY_VALUE_NODES ; else if ( fj [ 0 ] < ZERO_VALUE_NODES ) fj [ 0 ] += UNITY_VALUE_NODES ; fj *= vec3 ( UNITY_VALUE_NODES , fW , fX ) ; fj = mix ( vec3 ( UNITY_VALUE_NODES ) , mix ( vec3 ( ZERO_VALUE_NODES ) , fj , step ( vec3 ( ZERO_VALUE_NODES ) , fj ) ) , step ( fj , vec3 ( UNITY_VALUE_NODES ) ) ) ; f_ = mix ( fZ , eu ( fj ) , fY ) ;".split(" ")}]},
{type:"node",name:"INVERT",declarations:[{type:"node_in",name:"ga",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gb",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gc",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"gc = mix ( gb , vec3 ( UNITY_VALUE_NODES ) - gb , ga ) ;".split(" ")}]},{type:"node",name:"LAMP",declarations:[{type:"node_out",name:"gd",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"ge",qualifier:["vec3"],is_optional:!1},{type:"node_out",
name:"gf",qualifier:["float"],is_optional:!1},{type:"node_out",name:"gg",qualifier:["float"],is_optional:!0}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_gd"],statements:[{type:"textline",tokens:"gd = u_lamp_light_color_intensities [ LAMP_INDEX ] ;".split(" ")}]}]},{type:"textline",tokens:"fe = u_lamp_light_factors [ LAMP_INDEX ] ; fj = u_lamp_light_directions [ LAMP_INDEX ] ; fk = u_lamp_light_positions [ LAMP_INDEX ] ; eX = fe . z ; if ( eX != - UNITY_VALUE_NODES ) {".split(" ")},
{type:"textline",tokens:"ge = fk - bC ; gf = length ( ge ) ; ge = normalize ( ge ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_gg"],statements:[{type:"textline",tokens:"gg = eX / ( eX + gf * gf ) ; eX = fe . x ; eY = fe . y ; if ( eX > - UNITY_VALUE_NODES ) { eZ = dot ( ge , fj ) ; eZ *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( eZ - eX ) / eY ) ; gg *= eZ ; }".split(" ")}]}]},{type:"textline",tokens:["}","else","{"]},{type:"node_condition",parts:[{type:"node_if",
expression:["USE_OUT_ge"],statements:[{type:"textline",tokens:["ge","=","fj",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_gf"],statements:[{type:"textline",tokens:"gf = length ( fk - bC ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_gg"],statements:[{type:"textline",tokens:["gg","=","UNITY_VALUE_NODES",";"]}]}]},{type:"textline",tokens:["}"]}]},{type:"node",name:"NORMAL",declarations:[{type:"node_in",name:"gh",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"gi",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"gj",qualifier:["float"],is_optional:!0},{type:"node_param",name:"eE",qualifier:["vec3"]}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_gi"],statements:[{type:"textline",tokens:["gi","=","eE",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_gj"],statements:[{type:"textline",tokens:"gj = - dot ( gh , eE ) ;".split(" ")}]}]}]},{type:"node",
name:"B4W_VECTOR_VIEW",declarations:[{type:"node_in",name:"gk",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gl",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"gl = - ( eN * vec4 ( gk , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]},{type:"node",name:"BSDF_ANISOTROPIC",declarations:[{type:"node_in",name:"gm",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gn",qualifier:["float"],is_optional:!1},{type:"node_in",name:"go",qualifier:["float"],is_optional:!1},
{type:"node_in",name:"gp",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gq",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gr",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gs",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["gs","=","gm",";"]},{type:"textline",tokens:"gn ; go ; gp ; gq ; gr ;".split(" ")}]},{type:"node",name:"BSDF_DIFFUSE",declarations:[{type:"node_in",name:"gt",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gu",
qualifier:["float"],is_optional:!1},{type:"node_in",name:"gv",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gw",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["gw","=","gt",";"]},{type:"textline",tokens:["gu",";","gv",";"]}]},{type:"node",name:"BSDF_GLASS",declarations:[{type:"node_in",name:"gx",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gy",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gz",qualifier:["float"],is_optional:!1},{type:"node_in",
name:"gA",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gB",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["gB","=","gx",";"]},{type:"textline",tokens:"gy ; gz ; gA ;".split(" ")}]},{type:"node",name:"BSDF_GLOSSY",declarations:[{type:"node_in",name:"gC",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gD",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gE",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gF",qualifier:["vec3"],is_optional:!1}],
statements:[{type:"textline",tokens:["gF","=","gC",";"]},{type:"textline",tokens:["gD",";","gE",";"]}]},{type:"node",name:"BSDF_HAIR",declarations:[{type:"node_in",name:"gG",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gH",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gI",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gJ",qualifier:["float"],is_optional:!1},{type:"node_out",name:"gK",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["gK","=",
"gG",";"]},{type:"textline",tokens:"gH ; gI ; gJ ;".split(" ")}]},{type:"node",name:"BSDF_TRANSPARENT",declarations:[{type:"node_in",name:"gL",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gM",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["gM","=","gL",";"]}]},{type:"node",name:"BSDF_TRANSLUCENT",declarations:[{type:"node_in",name:"gN",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gO",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gP",qualifier:["vec3"],
is_optional:!1}],statements:[{type:"textline",tokens:["gP","=","gN",";"]},{type:"textline",tokens:["gO",";"]}]},{type:"node",name:"BSDF_REFRACTION",declarations:[{type:"node_in",name:"gQ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gR",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gS",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gT",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gU",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"gU [ 0 ] = gU [ 1 ] = gU [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",tokens:"gQ ; gR ; gS ; gT ;".split(" ")}]},{type:"node",name:"BSDF_TOON",declarations:[{type:"node_in",name:"gV",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gW",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gX",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gY",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gZ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["gZ","=","gV",";"]},{type:"textline",tokens:"gW ; gX ; gY ;".split(" ")}]},
{type:"node",name:"BSDF_VELVET",declarations:[{type:"node_in",name:"g_",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ha",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hb",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"hc",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["hc","=","g_",";"]},{type:"textline",tokens:["ha",";","hb",";"]}]},{type:"node",name:"SUBSURFACE_SCATTERING",declarations:[{type:"node_in",name:"hd",qualifier:["vec3"],is_optional:!1},
{type:"node_in",name:"he",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hf",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"hg",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hh",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hi",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"hj",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"hj [ 0 ] = hj [ 1 ] = hj [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"hd ; hf ; hg ; hh ; hi ; he ;".split(" ")}]},
{type:"node",name:"EMISSION",declarations:[{type:"node_in",name:"hk",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"hl",qualifier:["float"],is_optional:!1},{type:"node_out",name:"hm",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["hm","=","hk",";"]},{type:"textline",tokens:["hl",";"]}]},{type:"node",name:"AMBIENT_OCCLUSION",declarations:[{type:"node_in",name:"hn",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"ho",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"ho [ 0 ] = ho [ 1 ] = ho [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["hn",";"]}]},{type:"node",name:"HOLDOUT",declarations:[{type:"node_out",name:"hp",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"hp [ 0 ] = hp [ 1 ] = hp [ 2 ] = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"VOLUME_ABSORPTION",declarations:[{type:"node_in",name:"hq",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"hr",qualifier:["float"],is_optional:!1},{type:"node_out",
name:"hs",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"hs [ 0 ] = hs [ 1 ] = hs [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["hq",";","hr",";"]}]},{type:"node",name:"VOLUME_SCATTER",declarations:[{type:"node_in",name:"ht",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"hu",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hv",qualifier:["float"],is_optional:!1},{type:"node_out",name:"hw",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"hw [ 0 ] = hw [ 1 ] = hw [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"ht ; hu ; hv ;".split(" ")}]},{type:"node",name:"BUMP",declarations:[{type:"node_in",name:"hx",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hy",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hz",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hA",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"hB",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:["hB","=","hA",";"]},{type:"textline",tokens:"hx ; hy ; hz ;".split(" ")}]},{type:"node",name:"NORMAL_MAP",declarations:[{type:"node_in",name:"hC",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hD",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"hE",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["hE","=","hD",";"]},{type:"textline",tokens:["hC",";"]}]},{type:"node",name:"VECT_TRANSFORM",declarations:[{type:"node_in",name:"hF",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"hG",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"hG [ 0 ] = hG [ 1 ] = hG [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["hF",";"]}]},{type:"node",name:"BLACKBODY",declarations:[{type:"node_in",name:"hH",qualifier:["float"],is_optional:!1},{type:"node_out",name:"hI",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"hI [ 0 ] = hI [ 1 ] = hI [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",
tokens:["hH",";"]}]},{type:"node",name:"WAVELENGTH",declarations:[{type:"node_in",name:"hJ",qualifier:["float"],is_optional:!1},{type:"node_out",name:"hK",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"hK [ 0 ] = hK [ 1 ] = hK [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["hJ",";"]}]},{type:"node",name:"SEPXYZ",declarations:[{type:"node_in",name:"hL",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"hM",qualifier:["float"],is_optional:!1},{type:"node_out",
name:"hN",qualifier:["float"],is_optional:!1},{type:"node_out",name:"hO",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"hM = hL [ 0 ] ; hN = hL [ 1 ] ; hO = hL [ 2 ] ;".split(" ")}]},{type:"node",name:"COMBXYZ",declarations:[{type:"node_in",name:"hP",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hQ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hR",qualifier:["float"],is_optional:!1},{type:"node_out",name:"hS",qualifier:["vec3"],is_optional:!1}],
statements:[{type:"textline",tokens:"hS [ 0 ] = hP ; hS [ 1 ] = hQ ; hS [ 2 ] = hR ;".split(" ")}]},{type:"node",name:"BRIGHTCONTRAST",declarations:[{type:"node_in",name:"hT",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"hU",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hV",qualifier:["float"],is_optional:!1},{type:"node_out",name:"hW",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = hU - hV * eh ; hW = max ( ( UNITY_VALUE_NODES + hV ) * hT + eZ , vec3 ( ZERO_VALUE_NODES ) ) ;".split(" ")}]},
{type:"node",name:"LIGHT_FALLOFF",declarations:[{type:"node_in",name:"hX",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hY",qualifier:["float"],is_optional:!1},{type:"node_out",name:"hZ",qualifier:["float"],is_optional:!1},{type:"node_out",name:"h_",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ia",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"hZ = h_ = ia = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["hX",";","hY",";"]}]},{type:"node",
name:"TEX_IMAGE",declarations:[{type:"node_in",name:"ib",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"ic",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"id",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ic [ 0 ] = ic [ 1 ] = ic [ 2 ] = ZERO_VALUE_NODES ; id = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["ib",";"]}]},{type:"node",name:"TEX_ENVIRONMENT",declarations:[{type:"node_in",name:"ie",qualifier:["vec3"],is_optional:!1},{type:"node_out",
name:"ig",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"ig [ 0 ] = ig [ 1 ] = ig [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["ie",";"]}]},{type:"node",name:"TEX_SKY",declarations:[{type:"node_in",name:"ih",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"ii",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"ii [ 0 ] = ii [ 1 ] = ii [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["ih",";"]}]},{type:"node",
name:"TEX_NOISE",declarations:[{type:"node_in",name:"ij",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ik",qualifier:["float"],is_optional:!1},{type:"node_in",name:"il",qualifier:["float"],is_optional:!1},{type:"node_in",name:"im",qualifier:["float"],is_optional:!1},{type:"node_out",name:"io",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"ip",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"io [ 0 ] = io [ 1 ] = io [ 2 ] = ZERO_VALUE_NODES ; ip = UNITY_VALUE_NODES ;".split(" ")},
{type:"textline",tokens:"ij ; ik ; il ; im ;".split(" ")}]},{type:"node",name:"TEX_WAVE",declarations:[{type:"node_in",name:"iq",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ir",qualifier:["float"],is_optional:!1},{type:"node_in",name:"is",qualifier:["float"],is_optional:!1},{type:"node_in",name:"it",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iu",qualifier:["float"],is_optional:!1},{type:"node_out",name:"iv",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"iw",
qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"iv [ 0 ] = iv [ 1 ] = iv [ 2 ] = ZERO_VALUE_NODES ; iw = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"iq ; ir ; is ; it ; iu ;".split(" ")}]},{type:"node",name:"TEX_VORONOI",declarations:[{type:"node_in",name:"ix",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"iy",qualifier:["float"],is_optional:!1},{type:"node_out",name:"iz",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"iA",qualifier:["float"],
is_optional:!1}],statements:[{type:"textline",tokens:"iz [ 0 ] = iz [ 1 ] = iz [ 2 ] = ZERO_VALUE_NODES ; iA = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["ix",";","iy",";"]}]},{type:"node",name:"TEX_MUSGRAVE",declarations:[{type:"node_in",name:"iB",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"iC",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iD",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iE",qualifier:["float"],is_optional:!1},{type:"node_in",
name:"iF",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iG",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iH",qualifier:["float"],is_optional:!1},{type:"node_out",name:"iI",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"iJ",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"iI [ 0 ] = iI [ 1 ] = iI [ 2 ] = ZERO_VALUE_NODES ; iJ = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"iB ; iC ; iD ; iE ; iF ; iG ; iH ;".split(" ")}]},{type:"node",
name:"TEX_GRADIENT",declarations:[{type:"node_in",name:"iK",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"iL",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"iM",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"iL [ 0 ] = iL [ 1 ] = iL [ 2 ] = ZERO_VALUE_NODES ; iM = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["iK",";"]}]},{type:"node",name:"TEX_MAGIC",declarations:[{type:"node_in",name:"iN",qualifier:["vec3"],is_optional:!1},{type:"node_in",
name:"iO",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iP",qualifier:["float"],is_optional:!1},{type:"node_out",name:"iQ",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"iR",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"iQ [ 0 ] = iQ [ 1 ] = iQ [ 2 ] = ZERO_VALUE_NODES ; iR = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"iN ; iO ; iP ;".split(" ")}]},{type:"node",name:"TEX_CHECKER",declarations:[{type:"node_in",name:"iS",qualifier:["vec3"],
is_optional:!1},{type:"node_in",name:"iT",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"iU",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"iV",qualifier:["float"],is_optional:!1},{type:"node_out",name:"iW",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"iX",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"iW [ 0 ] = iW [ 1 ] = iW [ 2 ] = ZERO_VALUE_NODES ; iX = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"iS ; iT ; iU ; iV ;".split(" ")}]},
{type:"node",name:"TEX_BRICK",declarations:[{type:"node_in",name:"iY",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"iZ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"i_",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ja",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"jb",qualifier:["float"],is_optional:!1},{type:"node_in",name:"jc",qualifier:["float"],is_optional:!1},{type:"node_in",name:"jd",qualifier:["float"],is_optional:!1},{type:"node_in",name:"je",qualifier:["float"],
is_optional:!1},{type:"node_in",name:"jf",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jg",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jh",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"jg [ 0 ] = jg [ 1 ] = jg [ 2 ] = ZERO_VALUE_NODES ; jh = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"iY ; iZ ; i_ ; ja ; jb ; jc ; jd ; je ; jf ;".split(" ")}]},{type:"node",name:"ADD_SHADER",declarations:[{type:"node_in",name:"ji",qualifier:["vec3"],
is_optional:!1},{type:"node_in",name:"jj",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jk",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"jk = clamp ( ji + jj , vec3 ( ZERO_VALUE_NODES ) , vec3 ( UNITY_VALUE_NODES ) ) ;".split(" ")}]},{type:"node",name:"MIX_SHADER",declarations:[{type:"node_in",name:"jl",qualifier:["float"],is_optional:!1},{type:"node_in",name:"jm",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"jn",qualifier:["vec3"],is_optional:!1},
{type:"node_out",name:"jo",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( jl , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; jo = eZ * jm + ( UNITY_VALUE_NODES - eZ ) * jn ;".split(" ")}]},{type:"node",name:"UV_MERGED",declarations:[{type:"node_out",name:"jp",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jq",qualifier:["vec3"],is_optional:!1},{type:"node_param",name:"eF",qualifier:["varying","vec2"]}],statements:[{type:"node_condition",parts:[{type:"node_if",
expression:["USE_OUT_jp"],statements:[{type:"textline",tokens:"jp = ew ( eF ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_jq"],statements:[{type:"textline",tokens:"jq = vec3 ( eF , ZERO_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"TEX_COORD_UV",declarations:[{type:"node_out",name:"jr",qualifier:["vec3"],is_optional:!1},{type:"node_param",name:"eG",qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:"jr = vec3 ( eG , ZERO_VALUE_NODES ) ;".split(" ")}]},
{type:"node",name:"TEX_COORD_NO",declarations:[{type:"node_out",name:"js",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["js","=","fi",";"]}]},{type:"node",name:"TEX_COORD_GE",declarations:[{type:"node_out",name:"jt",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["jt","=","eg",";"]}]},{type:"node",name:"TEX_COORD_OB",declarations:[{type:"node_out",name:"ju",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"ju [ 0 ] = ju [ 1 ] = ju [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"TEX_COORD_CA",declarations:[{type:"node_out",name:"jv",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"jv [ 0 ] = fd [ 0 ] ; jv [ 1 ] = fd [ 1 ] ; jv [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_WI",declarations:[{type:"node_out",name:"jw",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"jw [ 0 ] = jw [ 1 ] = jw [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_RE",declarations:[{type:"node_out",
name:"jx",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"jx [ 0 ] = jx [ 1 ] = jx [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"UVMAP",declarations:[{type:"node_out",name:"jy",qualifier:["vec3"],is_optional:!1},{type:"node_param",name:"eH",qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:"jy = vec3 ( eH , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"PARTICLE_INFO",declarations:[{type:"node_out",name:"jz",qualifier:["float"],is_optional:!1},
{type:"node_out",name:"jA",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jB",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jC",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jD",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jE",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jF",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"jz = ZERO_VALUE_NODES ; jA = ZERO_VALUE_NODES ; jB = ZERO_VALUE_NODES ; jC = vec3 ( ZERO_VALUE_NODES ) ; jD = ZERO_VALUE_NODES ; jE = jC ; jF = jC ;".split(" ")}]},
{type:"node",name:"HAIR_INFO",declarations:[{type:"node_out",name:"jG",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jH",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jI",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jJ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"jG = ZERO_VALUE_NODES ; jH = ZERO_VALUE_NODES ; jI = ZERO_VALUE_NODES ; jJ = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"OBJECT_INFO",declarations:[{type:"node_out",
name:"jK",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jL",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jM",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jN",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"jL = ZERO_VALUE_NODES ; jM = ZERO_VALUE_NODES ; jN = ZERO_VALUE_NODES ; jK = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"WIREFRAME",declarations:[{type:"node_in",name:"jO",qualifier:["float"],is_optional:!1},{type:"node_out",
name:"jP",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:["jP","=","jO",";"]}]},{type:"node",name:"TANGENT",declarations:[{type:"node_out",name:"jQ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"jQ = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LAYER_WEIGHT",declarations:[{type:"node_in",name:"jR",qualifier:["float"],is_optional:!1},{type:"node_in",name:"jS",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jT",qualifier:["float"],
is_optional:!1},{type:"node_out",name:"jU",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"jT = jU = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["jS",";","jR",";"]}]},{type:"node",name:"LIGHT_PATH",declarations:[{type:"node_out",name:"jV",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jW",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jX",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jY",qualifier:["float"],is_optional:!1},
{type:"node_out",name:"jZ",qualifier:["float"],is_optional:!1},{type:"node_out",name:"j_",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ka",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kb",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kc",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kd",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"jV = jW = jX = ZERO_VALUE_NODES ; jY = jZ = j_ = ZERO_VALUE_NODES ; ka = ka = kc = kd = ZERO_VALUE_NODES ; kb = ZERO_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"ATTRIBUTE",declarations:[{type:"node_out",name:"ke",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"kf",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"kg",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ke = kf = vec3 ( ZERO_VALUE_NODES ) ; kg = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"SCRIPT",declarations:[],statements:[]},{type:"node",name:"CURVE_VEC",declarations:[{type:"node_in",name:"kh",qualifier:["float"],is_optional:!1},
{type:"node_in",name:"ki",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"kj",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["kj","=","ki",";"]},{type:"textline",tokens:["kh",";"]}]},{type:"node",name:"CURVE_RGB",declarations:[{type:"node_in",name:"kk",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kl",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"km",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["km","=","kl",";"]},
{type:"textline",tokens:["kk",";"]}]},{type:"node",name:"VALTORGB",declarations:[{type:"node_in",name:"kn",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ko",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"kp",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ko [ 0 ] = ko [ 1 ] = ko [ 2 ] = clamp ( kn , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; kp = ko [ 0 ] ;".split(" ")}]},{type:"node",name:"MAPPING",declarations:[{type:"node_in",name:"kq",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"kr",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["kr","=","kq",";"]},{type:"node_condition",parts:[{type:"node_ifdef",name:"MAPPING_TRS_MATRIX",statements:[{type:"textline",tokens:"kr = ( MAPPING_TRS_MATRIX * vec4 ( kr , UNITY_VALUE_NODES ) ) . xyz ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_ifdef",name:"MAPPING_SCALE",statements:[{type:"textline",tokens:"kr = kr * MAPPING_SCALE ;".split(" ")}]}]},{type:"node_condition",
parts:[{type:"node_ifdef",name:"MAPPING_TRANSLATION",statements:[{type:"textline",tokens:"kr = kr + MAPPING_TRANSLATION ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_ifdef",name:"MAPPING_MIN_CLIP",statements:[{type:"textline",tokens:"kr = max ( kr , MAPPING_MIN_CLIP ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_ifdef",name:"MAPPING_MAX_CLIP",statements:[{type:"textline",tokens:"kr = min ( kr , MAPPING_MAX_CLIP ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",
expression:["MAPPING_IS_NORMAL"],statements:[{type:"textline",tokens:"kr = normalize ( kr ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ADD",declarations:[{type:"node_in",name:"ks",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kt",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ku",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ku = ks + kt ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",
tokens:"ku = clamp ( ku , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SUBTRACT",declarations:[{type:"node_in",name:"kv",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kw",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kx",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kx = kv - kw ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"kx = clamp ( kx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_MULTIPLY",declarations:[{type:"node_in",name:"ky",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kz",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kA",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kA = ky * kz ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"kA = clamp ( kA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",
name:"MATH_DIVIDE",declarations:[{type:"node_in",name:"kB",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kC",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kD",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kD = ( kC != ZERO_VALUE_NODES ) ? kB / kC : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"kD = clamp ( kD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_SINE",declarations:[{type:"node_in",name:"kE",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kF",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kG",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kG = sin ( kE ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"kG = clamp ( kG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",
tokens:["kF",";"]}]},{type:"node",name:"MATH_COSINE",declarations:[{type:"node_in",name:"kH",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kI",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kJ",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kJ = cos ( kH ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"kJ = clamp ( kJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",tokens:["kI",";"]}]},{type:"node",name:"MATH_TANGENT",declarations:[{type:"node_in",name:"kK",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kL",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kM",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kM = tan ( kK ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"kM = clamp ( kM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",tokens:["kL",";"]}]},{type:"node",name:"MATH_ARCSINE",declarations:[{type:"node_in",name:"kN",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kO",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kP",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kP = ( kN <= UNITY_VALUE_NODES && kN >= - UNITY_VALUE_NODES ) ? asin ( kN ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",
tokens:"kP = clamp ( kP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["kO",";"]}]},{type:"node",name:"MATH_ARCCOSINE",declarations:[{type:"node_in",name:"kQ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kR",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kS",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kS = ( kQ <= UNITY_VALUE_NODES && kQ >= - UNITY_VALUE_NODES ) ? acos ( kQ ) : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"kS = clamp ( kS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["kR",";"]}]},{type:"node",name:"MATH_ARCTANGENT",declarations:[{type:"node_in",name:"kT",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kU",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kV",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kV = atan ( kT ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"kV = clamp ( kV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["kU",";"]}]},{type:"node",name:"MATH_POWER",declarations:[{type:"node_in",name:"kW",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kX",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kY",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"if ( kW < ZERO_VALUE_NODES && kX != floor ( kX ) ) kY = ZERO_VALUE_NODES ; else if ( kX == ZERO_VALUE_NODES )".split(" ")},
{type:"textline",tokens:"kY = UNITY_VALUE_NODES ; else if ( kW < ZERO_VALUE_NODES ) kY = mix ( UNITY_VALUE_NODES , - UNITY_VALUE_NODES , sign ( mod ( - kX , 2.0 ) ) ) * pow ( - kW , kX ) ; else if ( kW == ZERO_VALUE_NODES ) kY = ZERO_VALUE_NODES ; else kY = pow ( kW , kX ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"kY = clamp ( kY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_LOGARITHM",
declarations:[{type:"node_in",name:"kZ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"k_",qualifier:["float"],is_optional:!1},{type:"node_out",name:"la",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"la = ( kZ > ZERO_VALUE_NODES && k_ > ZERO_VALUE_NODES ) ? log2 ( kZ ) / log2 ( k_ ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"la = clamp ( la , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_MINIMUM",declarations:[{type:"node_in",name:"lb",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lc",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ld",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ld = min ( lb , lc ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"ld = clamp ( ld , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",
name:"MATH_MAXIMUM",declarations:[{type:"node_in",name:"le",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lf",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lg",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lg = max ( le , lf ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lg = clamp ( lg , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ROUND",
declarations:[{type:"node_in",name:"lh",qualifier:["float"],is_optional:!1},{type:"node_in",name:"li",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lj",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lj = floor ( lh + eh ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lj = clamp ( lj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["li",";"]}]},
{type:"node",name:"MATH_LESS_THAN",declarations:[{type:"node_in",name:"lk",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ll",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lm",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lm = ( lk < ll ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lm = clamp ( lm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_GREATER_THAN",declarations:[{type:"node_in",name:"ln",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lo",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lp",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lp = ( ln > lo ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lp = clamp ( lp , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_MODULO",declarations:[{type:"node_in",name:"lq",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lr",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ls",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ls = abs ( lr ) > 0.000001 ? mod ( lq , lr ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"ls = clamp ( ls , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_ABSOLUTE",declarations:[{type:"node_in",name:"lt",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lu",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lv",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lv = abs ( lt ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lv = clamp ( lv , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",
tokens:["lu",";"]}]},{type:"node",name:"MIX_RGB_MIX",declarations:[{type:"node_in",name:"lw",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lx",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ly",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"lz",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( lw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lz = mix ( lx , ly , eZ ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],
statements:[{type:"textline",tokens:"lz = clamp ( lz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_ADD",declarations:[{type:"node_in",name:"lA",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lB",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"lC",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"lD",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( lA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lD = mix ( lB , lB + lC , eZ ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"lD = clamp ( lD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_MULTIPLY",declarations:[{type:"node_in",name:"lE",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lF",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"lG",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"lH",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"eZ = clamp ( lE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lH = mix ( lF , lF * lG , eZ ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"lH = clamp ( lH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SUBTRACT",declarations:[{type:"node_in",name:"lI",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lJ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"lK",
qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"lL",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( lI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lL = mix ( lJ , lJ - lK , eZ ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"lL = clamp ( lL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SCREEN",declarations:[{type:"node_in",name:"lM",
qualifier:["float"],is_optional:!1},{type:"node_in",name:"lN",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"lO",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"lP",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( lM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = UNITY_VALUE_NODES - eZ ; lP = vec3 ( UNITY_VALUE_NODES ) - ( vec3 ( eY ) + eZ * ( vec3 ( UNITY_VALUE_NODES ) - lO ) ) * ( vec3 ( UNITY_VALUE_NODES ) - lN ) ;".split(" ")},{type:"node_condition",
parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"lP = clamp ( lP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIVIDE",declarations:[{type:"node_in",name:"lQ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lR",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"lS",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"lT",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( lQ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = UNITY_VALUE_NODES - eZ ; lS += step ( lS , vec3 ( ZERO_VALUE_NODES ) ) ; lT = eY * lR + eZ * lR / lS ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"lT = clamp ( lT , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIFFERENCE",declarations:[{type:"node_in",name:"lU",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lV",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"lW",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"lX",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"eZ = clamp ( lU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lX = mix ( lV , abs ( lV - lW ) , eZ ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"lX = clamp ( lX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DARKEN",declarations:[{type:"node_in",name:"lY",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lZ",qualifier:["vec3"],is_optional:!1},{type:"node_in",
name:"l_",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"ma",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( lY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; ma = min ( lZ . rgb , l_ . rgb * eZ ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"ma = clamp ( ma , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LIGHTEN",declarations:[{type:"node_in",
name:"mb",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mc",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"md",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"me",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( mb , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; me = max ( mc . rgb , md . rgb * eZ ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"me = clamp ( me , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_OVERLAY",declarations:[{type:"node_in",name:"mf",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mg",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mh",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mi",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( mf , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fk = vec3 ( UNITY_VALUE_NODES - eZ ) ; mi = mix ( mg * ( fk + 2.0 * eZ * mh ) , vec3 ( UNITY_VALUE_NODES ) - ( fk + 2.0 * eZ * ( vec3 ( UNITY_VALUE_NODES ) - mh ) ) * ( vec3 ( UNITY_VALUE_NODES ) - mg ) , step ( eh , mg ) ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mi = clamp ( mi , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DODGE",declarations:[{type:"node_in",name:"mj",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mk",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ml",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mm",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"eZ = clamp ( mj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fk = vec3 ( UNITY_VALUE_NODES ) - eZ * ml ; fj = clamp ( mk / fk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mm = mix ( mix ( fj , vec3 ( UNITY_VALUE_NODES ) , step ( fk , vec3 ( ZERO_VALUE_NODES ) ) ) , mk , step ( mk , vec3 ( ZERO_VALUE_NODES ) ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mm = clamp ( mm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_BURN",declarations:[{type:"node_in",name:"mn",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mo",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mp",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mq",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( mn , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fk = vec3 ( UNITY_VALUE_NODES - eZ ) ; fk = fk + eZ * mp ; fj = clamp ( vec3 ( UNITY_VALUE_NODES ) - ( vec3 ( UNITY_VALUE_NODES ) - mo ) / fk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mq = mix ( fj , vec3 ( ZERO_VALUE_NODES ) , step ( fk , vec3 ( ZERO_VALUE_NODES ) ) ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mq = clamp ( mq , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_HUE",declarations:[{type:"node_in",name:"mr",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ms",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mt",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mu",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"eZ = clamp ( mr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mu = ms ; fj = eq ( mt ) ; if ( fj . y != ZERO_VALUE_NODES ) { fk = eq ( mu ) ; fk . x = fj . x ; fl = eu ( fk ) ; mu = mix ( mu , fl , eZ ) ; }".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mu = clamp ( mu , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SATURATION",declarations:[{type:"node_in",name:"mv",qualifier:["float"],
is_optional:!1},{type:"node_in",name:"mw",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mx",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"my",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( mv , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = UNITY_VALUE_NODES - eZ ; my = mw ; fl = eq ( my ) ; if ( fl . y != ZERO_VALUE_NODES ) { fk = eq ( mx ) ; fl . y = eY * fl . y + eZ * fk . y ; my = eu ( fl ) ; }".split(" ")},{type:"node_condition",parts:[{type:"node_if",
expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"my = clamp ( my , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_VALUE",declarations:[{type:"node_in",name:"mz",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mA",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mB",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mC",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( mz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = UNITY_VALUE_NODES - eZ ; fl = eq ( mA ) ; fk = eq ( mB ) ; fl . z = eY * fl . z + eZ * fk . z ; mC = eu ( fl ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mC = clamp ( mC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_COLOR",declarations:[{type:"node_in",name:"mD",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mE",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mF",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mG",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"eZ = clamp ( mD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mG = mE ; fk = eq ( mF ) ; if ( fk . y != ZERO_VALUE_NODES ) { fl = eq ( mG ) ; fl . x = fk . x ; fl . y = fk . y ; fj = eu ( fl ) ; mG = mix ( mG , fj , eZ ) ; }".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mG = clamp ( mG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SOFT_LIGHT",declarations:[{type:"node_in",
name:"mH",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mI",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mJ",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mK",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( mH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = UNITY_VALUE_NODES - eZ ; fj = mJ + mI - mJ * mI ; mK = mI * ( vec3 ( eY ) + vec3 ( eZ ) * ( ( vec3 ( UNITY_VALUE_NODES ) - mI ) * mJ + fj ) ) ;".split(" ")},{type:"node_condition",
parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mK = clamp ( mK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",declarations:[{type:"node_in",name:"mL",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mM",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mN",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mO",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"eZ = clamp ( mL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mO = mM + eZ * ( 2.0 * mN - vec3 ( UNITY_VALUE_NODES ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mO = clamp ( mO , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"OUTPUT",declarations:[{type:"node_in",name:"mP",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mQ",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",
tokens:"eO = mP ; eS = mQ ;".split(" ")}]},{type:"node",name:"MATERIAL_BEGIN",declarations:[{type:"node_in",name:"mR",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mS",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mT",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mU",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"mV",qualifier:["float"],is_optional:!0},{type:"node_out",name:"mW",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mX",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"mY",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mZ",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"m_",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"na",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"nb",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"nc",qualifier:["float"],is_optional:!1},{type:"node_param",name:"eI",qualifier:["const","vec2"]},{type:"node_param",name:"eJ",qualifier:["const","vec3"]}],
statements:[{type:"textline",tokens:"mY = clamp ( mR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",tokens:"mZ = eJ [ 0 ] * clamp ( mS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_NORMAL"],statements:[{type:"textline",tokens:"m_ = normalize ( mU ) ;".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:["m_","=","fi",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["SHADELESS_MAT",
{type:"logic_negative_expr",places:1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["MATERIAL_EXT"],statements:[{type:"textline",tokens:"mW = mV * mY ;".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:"mW = eV * mY ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_DIFFUSE"],statements:[{type:"textline",tokens:["mY","*=","mT",";"]}]}]},{type:"textline",tokens:"mX = eW * u_environment_energy * dS ( m_ ) ; nc = du ( mY ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],statements:[{type:"textline",tokens:"na = vec2 ( eI [ 0 ] , eI [ 1 ] ) ;".split(" ")},{type:"textline",tokens:"nb = vec2 ( eJ [ 1 ] , eJ [ 2 ] ) ;".split(" ")}]}]},{type:"textline",tokens:["eR","=","nc",";"]}]},{type:"node_else",statements:[{type:"textline",tokens:"mW = vec3 ( ZERO_VALUE_NODES ) ; mX = vec3 ( UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATERIAL_END",declarations:[{type:"node_in",
name:"nd",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"ne",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nf",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ng",qualifier:["float"],is_optional:!0},{type:"node_in",name:"nh",qualifier:["float"],is_optional:!0},{type:"node_in",name:"ni",qualifier:["float"],is_optional:!0},{type:"node_out",name:"nj",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"nk",qualifier:["float"],is_optional:!0},{type:"node_out",name:"nl",
qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"nm",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"nn",qualifier:["vec3"],is_optional:!0},{type:"node_param",name:"eK",qualifier:["float"]},{type:"node_param",name:"eL",qualifier:["float"]}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_nj"],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_DIFFUSE"],statements:[{type:"textline",tokens:"nj = nd . rgb ;".split(" ")}]},
{type:"node_else",statements:[{type:"textline",tokens:"nj = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["MATERIAL_EXT","REFLECTION_TYPE","REFL_NONE",{type:"non_equal_expr",places:2},{type:"logical_and_expr",places:2}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:"dP ( nj , eM , nf , ng , eN ) ;".split(" ")}]},{type:"node_else",
statements:[{type:"textline",tokens:"dP ( nj , eM , nf , ng , mat4 ( ZERO_VALUE_NODES ) ) ;".split(" ")}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_SPECULAR"],statements:[{type:"textline",tokens:["nj","+=","ne",";"]}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_nl"],statements:[{type:"textline",tokens:["nl","=","nf",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["MATERIAL_EXT"],statements:[{type:"node_condition",
parts:[{type:"node_if",expression:["USE_OUT_nm"],statements:[{type:"textline",tokens:"nm = nd . rgb ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_nn"],statements:[{type:"textline",tokens:["nn","=","ne",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_nk"],statements:[{type:"textline",tokens:"nk = clamp ( ni , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_SPECULAR"],
statements:[{type:"textline",tokens:"eZ = max ( max ( ne . r , ne . g ) , ne . b ) * nh ; nk = clamp ( ni * ( UNITY_VALUE_NODES - eZ ) + eZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]}]},{type:"node_else",statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_nk"],statements:[{type:"textline",tokens:"nk = clamp ( eK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_SPECULAR"],statements:[{type:"textline",
tokens:"eZ = max ( max ( ne . r , ne . g ) , ne . b ) * eL ; nk = eK * ( UNITY_VALUE_NODES - eZ ) + eZ ;".split(" ")}]}]}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_SPECULAR"],statements:[{type:"textline",tokens:["eP","=","ne",";"]}]},{type:"node_else",statements:[{type:"textline",tokens:"eP = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["eQ","=","nf",";"]}]},{type:"node",name:"LIGHTING_AMBIENT",declarations:[{type:"node_in",name:"no",
qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"np",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nq",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"nr",qualifier:["vec4"],is_optional:!1},{type:"node_out",name:"ns",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"nr = vec4 ( no + nq * np , ZERO_VALUE_NODES ) ; ns = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LIGHTING_LAMP",declarations:[{type:"node_in",name:"nt",qualifier:["float"],
is_optional:!1},{type:"node_out",name:"nu",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"nv",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"nw",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"nx",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"nv = u_light_factors [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE","HEMI",{type:"equal_expr",places:2}],statements:[{type:"textline",
tokens:["nx","=","eh",";"]}]},{type:"node_else",statements:[{type:"textline",tokens:["nx","=","ZERO_VALUE_NODES",";"]}]}]},{type:"textline",tokens:"nw = u_light_color_intensities [ LAMP_IND ] ; if ( LAMP_SHADOW_MAP_IND != - 1 ) nw *= nt ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE","SPOT",{type:"equal_expr",places:2},"LAMP_TYPE","POINT",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],statements:[{type:"textline",tokens:"fj = u_light_positions [ LAMP_IND ] ; nu = fj - fh ;".split(" ")},
{type:"textline",tokens:"eZ = length ( nu ) ; nw *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + eZ * eZ ) ; nu = normalize ( nu ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE","SPOT",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:"fj = u_light_directions [ LAMP_IND ] ; eZ = dot ( nu , fj ) ; eZ *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( eZ - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; nw *= eZ ;".split(" ")}]}]}]},{type:"node_else",statements:[{type:"textline",
tokens:"nu = u_light_directions [ LAMP_IND ] ;".split(" ")}]}]}]},{type:"node",name:"DIFFUSE_FRESNEL",declarations:[{type:"node_in",name:"ny",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nz",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"nA",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nB",qualifier:["float"],is_optional:!1},{type:"node_in",name:"nC",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"nD",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",
tokens:"nD = ZERO_VALUE_NODES ; if ( nz . r != ZERO_VALUE_NODES ) { eZ = ( UNITY_VALUE_NODES - nB ) * dot ( nA , ny ) + nB ; if ( nC [ 0 ] == ZERO_VALUE_NODES ) { nD = UNITY_VALUE_NODES ; } else { eZ = UNITY_VALUE_NODES + abs ( eZ ) ; eZ = nC [ 1 ] + ( UNITY_VALUE_NODES - nC [ 1 ] ) * pow ( eZ , nC [ 0 ] ) ; nD = clamp ( eZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; } nD = max ( nD , ZERO_VALUE_NODES ) ; }".split(" ")}]},{type:"node",name:"DIFFUSE_LAMBERT",declarations:[{type:"node_in",name:"nE",
qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nF",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"nG",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nH",qualifier:["float"],is_optional:!1},{type:"node_out",name:"nI",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"nI = ZERO_VALUE_NODES ; if ( nF . r != ZERO_VALUE_NODES ) { eZ = ( UNITY_VALUE_NODES - nH ) * dot ( nG , nE ) + nH ; nI = max ( eZ , ZERO_VALUE_NODES ) ; }".split(" ")}]},{type:"node",
name:"DIFFUSE_OREN_NAYAR",declarations:[{type:"node_in",name:"nJ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nK",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"nL",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nM",qualifier:["float"],is_optional:!1},{type:"node_in",name:"nN",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"nO",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"nO = ZERO_VALUE_NODES ; if ( nK . r != ZERO_VALUE_NODES ) { eZ = ( UNITY_VALUE_NODES - nM ) * dot ( nL , nJ ) + nM ; if ( nN [ 0 ] > ZERO_VALUE_NODES ) { eY = max ( dot ( nL , eM ) , ZERO_VALUE_NODES ) ; eX = nN [ 0 ] * nN [ 0 ] ; e_ = UNITY_VALUE_NODES - eh * ( eX / ( eX + 0.33 ) ) ; fj = nJ - eZ * nL ; fl = eM - eY * nL ;".split(" ")},
{type:"textline",tokens:"if ( length ( fj ) == ZERO_VALUE_NODES || length ( fl ) == ZERO_VALUE_NODES || abs ( eZ ) > UNITY_VALUE_NODES || abs ( eY ) > UNITY_VALUE_NODES )".split(" ")},{type:"textline",tokens:"nO = eZ * e_ ; else { fa = acos ( eZ ) ; eY = acos ( eY ) ; fj = normalize ( fj ) ; fl = normalize ( fl ) ; fb = max ( fa , eY ) ; fc = min ( fa , eY ) ; fc *= 0.95 ; eY = max ( dot ( fj , fl ) , ZERO_VALUE_NODES ) ; eX = 0.45 * ( eX / ( eX + 0.09 ) ) ; nO = eZ * ( e_ + ( eX * eY * sin ( fb ) * tan ( fc ) ) ) ; } } else nO = eZ ; nO = max ( nO , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_MINNAERT",declarations:[{type:"node_in",name:"nP",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nQ",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"nR",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nS",qualifier:["float"],is_optional:!1},{type:"node_in",name:"nT",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"nU",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"nU = ZERO_VALUE_NODES ; if ( nQ . r != ZERO_VALUE_NODES ) { eZ = ( UNITY_VALUE_NODES - nS ) * dot ( nR , nP ) + nS ; fc = max ( dot ( nR , eM ) , ZERO_VALUE_NODES ) ; if ( nT [ 0 ] <= UNITY_VALUE_NODES ) nU = eZ * pow ( max ( fc * eZ , 0.1 ) , nT [ 0 ] - UNITY_VALUE_NODES ) ; else nU = eZ * pow ( 1.0001 - fc , nT [ 0 ] - UNITY_VALUE_NODES ) ; nU = max ( nU , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_TOON",declarations:[{type:"node_in",name:"nV",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nW",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"nX",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nY",qualifier:["float"],is_optional:!1},{type:"node_in",name:"nZ",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"n_",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"n_ = ZERO_VALUE_NODES ; if ( nW . r != ZERO_VALUE_NODES ) { fc = ( UNITY_VALUE_NODES - nY ) * dot ( nX , nV ) + nY ; fc = acos ( fc ) ; if ( fc < nZ [ 0 ] ) n_ = UNITY_VALUE_NODES ; else if ( fc > ( nZ [ 0 ] + nZ [ 1 ] ) || nZ [ 1 ] == ZERO_VALUE_NODES ) n_ = ZERO_VALUE_NODES ; else n_ = UNITY_VALUE_NODES - ( ( fc - nZ [ 0 ] ) / nZ [ 1 ] ) ; n_ = max ( n_ , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_PHONG",declarations:[{type:"node_in",name:"oa",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ob",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"oc",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"od",qualifier:["float"],is_optional:!1},{type:"node_in",name:"oe",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"of",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"of = ZERO_VALUE_NODES ; if ( ob . g == UNITY_VALUE_NODES ) { fl = normalize ( oa + eM ) ; of = ( UNITY_VALUE_NODES - od ) * max ( dot ( oc , fl ) , ZERO_VALUE_NODES ) + od ; of = pow ( of , oe [ 0 ] ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_WARDISO",declarations:[{type:"node_in",name:"og",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oh",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"oi",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oj",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"ok",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ok = ZERO_VALUE_NODES ; if ( oh . g == UNITY_VALUE_NODES ) { fl = normalize ( og + eM ) ; fc = max ( dot ( oi , fl ) , 0.001 ) ;".split(" ")},
{type:"textline",tokens:"eZ = max ( dot ( oi , eM ) , 0.01 ) ; fb = max ( dot ( oi , og ) , 0.01 ) ; fc = tan ( acos ( fc ) ) ; eY = max ( oj [ 0 ] , 0.001 ) ; ok = fb * ( UNITY_VALUE_NODES / ( 4.0 * M_PI * eY * eY ) ) * ( exp ( - ( fc * fc ) / ( eY * eY ) ) / ( sqrt ( eZ * fb ) ) ) ; }".split(" ")}]},{type:"node",name:"SPECULAR_TOON",declarations:[{type:"node_in",name:"ol",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"om",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"on",qualifier:["vec3"],
is_optional:!1},{type:"node_in",name:"oo",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"op",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"op = ZERO_VALUE_NODES ; if ( om . g == UNITY_VALUE_NODES ) { fl = normalize ( ol + eM ) ; fb = acos ( dot ( fl , on ) ) ; if ( fb < oo [ 0 ] ) op = UNITY_VALUE_NODES ; else if ( fb >= oo [ 0 ] + oo [ 1 ] || oo [ 1 ] == ZERO_VALUE_NODES ) op = ZERO_VALUE_NODES ; else op = UNITY_VALUE_NODES - ( fb - oo [ 0 ] ) / oo [ 1 ] ; }".split(" ")}]},
{type:"node",name:"SPECULAR_BLINN",declarations:[{type:"node_in",name:"oq",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"or",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"os",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ot",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ou",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"ov",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ov = ZERO_VALUE_NODES ; if ( or . g == UNITY_VALUE_NODES ) { if ( ou [ 0 ] < UNITY_VALUE_NODES || ou [ 1 ] == ZERO_VALUE_NODES ) ov = ZERO_VALUE_NODES ; else { if ( ou [ 1 ] < 100.0 ) ou [ 1 ] = sqrt ( UNITY_VALUE_NODES / ou [ 1 ] ) ; else ou [ 1 ] = 10.0 / ou [ 1 ] ; fl = normalize ( eM + oq ) ; fb = ( UNITY_VALUE_NODES - ot ) * max ( dot ( os , fl ) , ZERO_VALUE_NODES ) + ot ; if ( fb < ZERO_VALUE_NODES ) ov = ZERO_VALUE_NODES ; else { eZ = max ( dot ( os , eM ) , 0.01 ) ; eY = dot ( os , oq ) ; if ( eY <= 0.01 ) ov = ZERO_VALUE_NODES ; else { fc = max ( dot ( eM , fl ) , 0.01 ) ; eX = UNITY_VALUE_NODES ; eZ = ( 2.0 * fb * eZ ) / fc ; eY = ( 2.0 * fb * eY ) / fc ; eY = min ( min ( eX , eZ ) , eY ) ; eZ = sqrt ( pow ( ou [ 0 ] , 2.0 ) + pow ( fc , 2.0 ) - UNITY_VALUE_NODES ) ; fc = pow ( eZ - fc , 2.0 ) / pow ( eZ + fc , 2.0 ) * ( UNITY_VALUE_NODES + pow ( fc * ( eZ + fc ) - UNITY_VALUE_NODES , 2.0 ) / pow ( fc * ( eZ - fc ) + UNITY_VALUE_NODES , 2.0 ) ) ; fb = acos ( fb ) ; ov = max ( fc * eY * exp ( - pow ( fb , 2.0 ) / ( 2.0 * pow ( ou [ 1 ] , 2.0 ) ) ) , ZERO_VALUE_NODES ) ; } } } }".split(" ")}]},
{type:"node",name:"LIGHTING_APPLY",declarations:[{type:"node_in",name:"ow",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"ox",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oy",qualifier:["float"],is_optional:!1},{type:"node_in",name:"oz",qualifier:["float"],is_optional:!1},{type:"node_in",name:"oA",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oB",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oC",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"oD",
qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oE",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oF",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oG",qualifier:["float"],is_optional:!1},{type:"node_out",name:"oH",qualifier:["vec4"],is_optional:!1},{type:"node_out",name:"oI",qualifier:["vec3"],is_optional:!1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_NODE_B4W_TRANSLUCENCY"],statements:[{type:"textline",tokens:"if ( dot ( oA , oB ) * dot ( eM , oB ) < ZERO_VALUE_NODES ) { fb = oC . x ; eY = oC . y ; fc = oC . z ; eZ = oC . w ;".split(" ")},
{type:"textline",tokens:"eX = clamp ( abs ( dot ( oA , oB ) ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; e_ = clamp ( dot ( eM , - oA ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = pow ( e_ , eY ) ;".split(" ")},{type:"textline",tokens:"oH = ow + oG * vec4 ( oF * eX * pow ( oD , vec3 ( fb ) ) , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",tokens:"oH += fc * mix ( vec4 ( oD , UNITY_VALUE_NODES ) , vec4 ( UNITY_VALUE_NODES ) , eZ ) * oG * vec4 ( oF * eX * vec3 ( eY ) , UNITY_VALUE_NODES ) ; oI = ox ; } else {".split(" ")},
{type:"textline",tokens:"oI = ox + oF * oE * oz ; oH = ow + vec4 ( oF * oD * oy , oz ) ; }".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:"oI = ox + oF * oE * oz ; oH = ow + vec4 ( oF * oD * oy , oz ) ;".split(" ")}]}]}]},{type:"node",name:"RGB",declarations:[{type:"node_out",name:"oJ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"oJ = u_node_rgbs [ RGB_IND ] ;".split(" ")}]},{type:"node",name:"RGBTOBW",declarations:[{type:"node_in",name:"oK",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"oL",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"oL = dot ( oK , vec3 ( 0.35 , 0.45 , 0.2 ) ) ;".split(" ")}]},{type:"node",name:"SEPRGB",declarations:[{type:"node_in",name:"oM",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"oN",qualifier:["float"],is_optional:!0},{type:"node_out",name:"oO",qualifier:["float"],is_optional:!0},{type:"node_out",name:"oP",qualifier:["float"],is_optional:!0}],statements:[{type:"node_condition",
parts:[{type:"node_if",expression:["USE_OUT_oN"],statements:[{type:"textline",tokens:"oN = oM . r ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_oO"],statements:[{type:"textline",tokens:"oO = oM . g ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_oP"],statements:[{type:"textline",tokens:"oP = oM . b ;".split(" ")}]}]}]},{type:"node",name:"SEPHSV",declarations:[{type:"node_in",name:"oQ",qualifier:["vec3"],is_optional:!1},
{type:"node_out",name:"oR",qualifier:["float"],is_optional:!0},{type:"node_out",name:"oS",qualifier:["float"],is_optional:!0},{type:"node_out",name:"oT",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"fl = eq ( oQ ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_oR"],statements:[{type:"textline",tokens:"oR = fl . r ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_oS"],statements:[{type:"textline",tokens:"oS = fl . g ;".split(" ")}]}]},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_oT"],statements:[{type:"textline",tokens:"oT = fl . b ;".split(" ")}]}]}]},{type:"node",name:"SQUEEZE",declarations:[{type:"node_in",name:"oU",qualifier:["float"],is_optional:!1},{type:"node_in",name:"oV",qualifier:["float"],is_optional:!1},{type:"node_in",name:"oW",qualifier:["float"],is_optional:!1},{type:"node_out",name:"oX",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"oX = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( oU - oW ) * oV ) ) ;".split(" ")}]},
{type:"node",name:"GAMMA",declarations:[{type:"node_in",name:"oY",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oZ",qualifier:["float"],is_optional:!1},{type:"node_out",name:"o_",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"o_ = oY ; if ( o_ . x > ZERO_VALUE_NODES ) o_ . x = pow ( oY . x , oZ ) ; if ( o_ . y > ZERO_VALUE_NODES ) o_ . y = pow ( oY . y , oZ ) ; if ( o_ . z > ZERO_VALUE_NODES ) o_ . z = pow ( oY . z , oZ ) ;".split(" ")}]},{type:"node",name:"B4W_SRGB_TO_LINEAR",
declarations:[{type:"node_in",name:"pa",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pb",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"pb = max ( vec3 ( ZERO_VALUE_NODES ) , pa ) ; pb = pow ( pb , vec3 ( 2.2 ) ) ;".split(" ")}]},{type:"node",name:"B4W_LINEAR_TO_SRGB",declarations:[{type:"node_in",name:"pc",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pd",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"pd = max ( vec3 ( ZERO_VALUE_NODES ) , pc ) ; pd = pow ( pd , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]},
{type:"node",name:"TEXTURE_EMPTY",declarations:[{type:"node_out",name:"pe",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pf",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pg",qualifier:["float"],is_optional:!1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pg"],statements:[{type:"textline",tokens:"pe [ 2 ] = pe [ 1 ] = pe [ 0 ] = ZERO_VALUE_NODES ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pg"],statements:[{type:"textline",
tokens:"pf [ 2 ] = pf [ 1 ] = pf [ 0 ] = ZERO_VALUE_NODES ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pg"],statements:[{type:"textline",tokens:["pg","=","ZERO_VALUE_NODES",";"]}]}]}]},{type:"node",name:"TEXTURE_ENVIRONMENT",declarations:[{type:"node_in",name:"ph",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pi",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pj",qualifier:["float"],is_optional:!0},{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",
qualifier:["uniform","samplerCube"]}],statements:[{type:"textline",tokens:"fe = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , ph ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pi"],statements:[{type:"textline",tokens:"pi = fe . xyz ; br ( pi ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pj"],statements:[{type:"textline",tokens:"pj = fe . w ;".split(" ")}]}]}]},{type:"node",name:"TEXTURE_COLOR",declarations:[{type:"node_in",
name:"pk",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"pl",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"pm",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"pn",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"po",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pp",qualifier:["float"],is_optional:!0},{type:"node_out",name:"pq",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pr",qualifier:["float"],is_optional:!0},{type:"node_out",name:"ps",
qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pt",qualifier:["float"],is_optional:!0},{type:"node_out",name:"pu",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pv",qualifier:["float"],is_optional:!0},{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"]}],statements:[{type:"textline",tokens:"fe = texture2D ( node_TEXTURE_COLOR_var_texture , ey ( pk ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_po"],
statements:[{type:"textline",tokens:"po = fe . xyz ; br ( po ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pp"],statements:[{type:"textline",tokens:"pp = fe . w ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv2"],statements:[{type:"textline",tokens:"fe = texture2D ( node_TEXTURE_COLOR_var_texture , ey ( pl ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pq"],statements:[{type:"textline",
tokens:"pq = fe . xyz ; br ( pq ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pr"],statements:[{type:"textline",tokens:"pr = fe . w ;".split(" ")}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv3"],statements:[{type:"textline",tokens:"fe = texture2D ( node_TEXTURE_COLOR_var_texture , ey ( pm ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_ps"],statements:[{type:"textline",tokens:"ps = fe . xyz ; br ( ps ) ;".split(" ")}]}]},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pt"],statements:[{type:"textline",tokens:"pt = fe . w ;".split(" ")}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv4"],statements:[{type:"textline",tokens:"fe = texture2D ( node_TEXTURE_COLOR_var_texture , ey ( pn ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pu"],statements:[{type:"textline",tokens:"pu = fe . xyz ; br ( pu ) ;".split(" ")}]}]},{type:"node_condition",
parts:[{type:"node_if",expression:["USE_OUT_pv"],statements:[{type:"textline",tokens:"pv = fe . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"TEXTURE_NORMAL",declarations:[{type:"node_in",name:"pw",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"px",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"py",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"pz",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pA",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pB",
qualifier:["float"],is_optional:!0},{type:"node_out",name:"pC",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pD",qualifier:["float"],is_optional:!0},{type:"node_out",name:"pE",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pF",qualifier:["float"],is_optional:!0},{type:"node_out",name:"pG",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pH",qualifier:["float"],is_optional:!0},{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"]}],
statements:[{type:"textline",tokens:"fe = texture2D ( node_TEXTURE_NORMAL_var_texture , ey ( pw ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pA"],statements:[{type:"textline",tokens:"pA = normalize ( ff * ( fe . xyz - eh ) ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pB"],statements:[{type:"textline",tokens:"pB = fe . w ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv2"],statements:[{type:"textline",
tokens:"fe = texture2D ( node_TEXTURE_NORMAL_var_texture , ey ( px ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pC"],statements:[{type:"textline",tokens:"pC = normalize ( ff * ( fe . xyz - eh ) ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pD"],statements:[{type:"textline",tokens:"pD = fe . w ;".split(" ")}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv3"],statements:[{type:"textline",tokens:"fe = texture2D ( node_TEXTURE_NORMAL_var_texture , ey ( py ) ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pE"],statements:[{type:"textline",tokens:"pE = normalize ( ff * ( fe . xyz - eh ) ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pF"],statements:[{type:"textline",tokens:"pF = fe . w ;".split(" ")}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv4"],statements:[{type:"textline",tokens:"fe = texture2D ( node_TEXTURE_NORMAL_var_texture , ey ( pz ) ) ;".split(" ")},{type:"node_condition",
parts:[{type:"node_if",expression:["USE_OUT_pG"],statements:[{type:"textline",tokens:"pG = normalize ( ff * ( fe . xyz - eh ) ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pH"],statements:[{type:"textline",tokens:"pH = fe . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"VALUE",declarations:[{type:"node_out",name:"pI",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"pI = u_node_values [ VALUE_IND ] ;".split(" ")}]},{type:"node",name:"VECT_MATH_ADD",
declarations:[{type:"node_in",name:"pJ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"pK",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pL",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pM",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"pL = pJ + pK ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pM"],statements:[{type:"textline",tokens:"pM = ( abs ( pL [ 0 ] ) + abs ( pL [ 1 ] ) + abs ( pL [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},
{type:"node",name:"VECT_MATH_SUBTRACT",declarations:[{type:"node_in",name:"pN",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"pO",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pP",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pQ",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"pP = pN - pO ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pQ"],statements:[{type:"textline",tokens:"pQ = ( abs ( pP [ 0 ] ) + abs ( pP [ 1 ] ) + abs ( pP [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},
{type:"node",name:"VECT_MATH_AVERAGE",declarations:[{type:"node_in",name:"pR",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"pS",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pT",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pU",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"pT = pR + pS ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pU"],statements:[{type:"textline",tokens:"pU = length ( pT ) ;".split(" ")}]}]},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pT"],statements:[{type:"textline",tokens:"pT = normalize ( pT ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_DOT_PRODUCT",declarations:[{type:"node_in",name:"pV",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"pW",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pX",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pY",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"pX = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pY"],statements:[{type:"textline",tokens:"pY = dot ( pV , pW ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",declarations:[{type:"node_in",name:"pZ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"p_",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"qa",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"qb",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"qa = cross ( pZ , p_ ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_qb"],statements:[{type:"textline",tokens:"qb = length ( qa ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_NORMALIZE",declarations:[{type:"node_in",name:"qc",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"qd",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"qe",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"qf",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"qe = normalize ( qc ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_qf"],statements:[{type:"textline",tokens:"qf = length ( qc ) ;".split(" ")}]}]},{type:"textline",tokens:["qd",";"]}]},{type:"node",name:"B4W_REFLECT",declarations:[{type:"node_in",name:"qg",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"qh",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"qi",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"qi = reflect ( - qg , qh ) ;".split(" ")}]},{type:"node",
name:"B4W_PARALLAX",declarations:[{type:"node_in",name:"qj",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"qk",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ql",qualifier:["const","float"],is_optional:!1},{type:"node_in",name:"qm",qualifier:["const","float"],is_optional:!1},{type:"node_out",name:"qn",qualifier:["vec3"],is_optional:!1},{type:"node_param",name:"node_B4W_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]}],statements:[{type:"textline",tokens:"eY = length ( fd ) ; if ( eY < qm ) { eT = ey ( qj ) ; eY = clamp ( eh * ( qm - eY ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = qk * eY ;".split(" ")},
{type:"textline",tokens:"fl = normalize ( eM * ff ) ;".split(" ")},{type:"textline",tokens:"eX = UNITY_VALUE_NODES / ql ;".split(" ")},{type:"textline",tokens:"eU = fl . xy * eY / ( ql * fl . z ) ; eY = UNITY_VALUE_NODES ; eZ = texture2D ( node_B4W_PARALLAX_var_texture , eT ) . a ;".split(" ")},{type:"textline",tokens:"for ( float qo = 1.0 ; qo <= ql ; qo ++ ) { if ( eZ < eY ) { eY -= eX ; eT -= eU ; eZ = texture2D ( node_B4W_PARALLAX_var_texture , eT ) . a ; } }".split(" ")},{type:"textline",tokens:"eU = eT + eU ; eX = texture2D ( node_B4W_PARALLAX_var_texture , eU ) . a - ( eY + eX ) ; eY = eZ - eY ; eX = eY / ( eY - eX ) ;".split(" ")},
{type:"textline",tokens:"eT = eX * eU + ( UNITY_VALUE_NODES - eX ) * eT ; qn = ew ( eT ) ; } else qn = qj ;".split(" ")}]},{type:"node",name:"B4W_CLAMP",declarations:[{type:"node_in",name:"qp",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"qq",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"qq = clamp ( qp , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"B4W_REFRACTION",declarations:[{type:"node_in",name:"qr",qualifier:["vec3"],is_optional:!1},
{type:"node_in",name:"qs",qualifier:["float"],is_optional:!1},{type:"node_out",name:"qt",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"qt = el ( qr , qs ) ;".split(" ")}]},{type:"node",name:"B4W_TRANSLUCENCY",declarations:[{type:"node_in",name:"qu",qualifier:["float"],is_optional:!1},{type:"node_in",name:"qv",qualifier:["float"],is_optional:!1},{type:"node_in",name:"qw",qualifier:["float"],is_optional:!1},{type:"node_in",name:"qx",qualifier:["float"],is_optional:!1},{type:"node_in",
name:"qy",qualifier:["float"],is_optional:!1},{type:"node_out",name:"qz",qualifier:["float"],is_optional:!0},{type:"node_out",name:"qA",qualifier:["vec4"],is_optional:!0}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_qz"],statements:[{type:"textline",tokens:["qz","=","qu",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_qA"],statements:[{type:"textline",tokens:"qA = vec4 ( qv , qw , qx , qy ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_TIME",
declarations:[{type:"node_out",name:"qB",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:["qB","=","u_time",";"]}]},{type:"node",name:"B4W_SMOOTHSTEP",declarations:[{type:"node_in",name:"qC",qualifier:["float"],is_optional:!1},{type:"node_in",name:"qD",qualifier:["float"],is_optional:!1},{type:"node_in",name:"qE",qualifier:["float"],is_optional:!1},{type:"node_out",name:"qF",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"qF = smoothstep ( qD , qE , qC ) ;".split(" ")}]},
{type:"node",name:"B4W_GLOW_OUTPUT",declarations:[{type:"node_in",name:"qG",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"qH",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"eO = qG ; eS = qH ;".split(" ")}]},{type:"node",name:"B4W_VECTOSCAL",declarations:[{type:"node_in",name:"qI",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"qJ",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"qJ = ( qI . r + qI . g + qI . b ) / 3.0 ;".split(" ")}]},
{type:"node",name:"B4W_SCALTOVEC",declarations:[{type:"node_in",name:"qK",qualifier:["float"],is_optional:!1},{type:"node_out",name:"qL",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"qL [ 0 ] = qK ; qL [ 1 ] = qK ; qL [ 2 ] = qK ;".split(" ")}]},{type:"nodes_global"},{type:"textline",tokens:"void qM ( in vec3 eM , in mat4 eN , out vec3 eO , out vec3 eP , out vec3 eQ , out float eR , out float eS ) { vec2 eT , eU ; float eV , eW , eX , eY , eZ , e_ , fa , fb , fc ; vec4 fd , fe ; mat3 ff ; vec3 fg , fh , fi , fj , fk , fl ; eO = vec3 ( ZERO_VALUE_NODES ) ; eP = vec3 ( ZERO_VALUE_NODES ) ; eQ = vec3 ( ZERO_VALUE_NODES ) ; eR = ZERO_VALUE_NODES ; eS = ZERO_VALUE_NODES ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",places:5}],group:{type:"group",parts:[{type:"textline",tokens:"fg = normalize ( bE ) ; fh = fg ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DOUBLE_SIDED_LIGHTING","USE_NODE_GEOMETRY_NO",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["INVERT_FRONTFACING"],
group:{type:"group",parts:[{type:"textline",tokens:["if","(","!","gl_FrontFacing",")"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["if","(","gl_FrontFacing",")"]}]}}]},{type:"textline",tokens:"fh = fh ; else fh = - fh ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",parts:[{type:"textline",tokens:["fi","=","fh",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["fi","=","fg",";"]}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_GEOMETRY_NO"],group:{type:"group",parts:[{type:"textline",tokens:["fg","=","fh",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"fj = cross ( fh , bF . xyz ) * bF . w ; ff = mat3 ( bF . xyz , fj , fh ) ; ff = ff ;".split(" ")}]}}]},{type:"textline",tokens:"fh = bC ; fd = bD ; eV = u_emit ; eW = u_ambient ;".split(" ")},{type:"nodes_main"},{type:"textline",
tokens:["}"]}]};a["include/to_world.glslv"]={type:"group",parts:[{type:"define",name:"M_PI",tokens:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",tokens:["(","M_PI","/","4.0",")"]},{type:"textline",tokens:"const vec3 qN = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_SPHERICAL","BILLBOARD",{type:"logic_negative_expr",places:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2},
{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"mat4 qT ( vec3 qO , mat4 qP ) { vec3 qQ , qR , qS ; qQ = vec3 ( qP [ 0 ] [ 0 ] , qP [ 1 ] [ 0 ] , qP [ 2 ] [ 0 ] ) ; qR = vec3 ( qP [ 0 ] [ 1 ] , qP [ 1 ] [ 1 ] , qP [ 2 ] [ 1 ] ) ; qS = vec3 ( qP [ 0 ] [ 2 ] , qP [ 1 ] [ 2 ] , qP [ 2 ] [ 2 ] ) ; qR = cross ( qS , qQ ) ; qQ = normalize ( qQ ) ; qR = normalize ( qR ) ; qS = normalize ( qS ) ; return mat4 ( vec4 ( qQ , 0.0 ) , vec4 ( qR , 0.0 ) , vec4 ( qS , 0.0 ) , vec4 ( qO , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"mat4 qZ ( vec3 qU , vec3 qV ) { vec3 qW , qX , qY ; qW = qU - qV ; qW . y = 0.0 ; qX = cross ( qN , qW ) ; qY = cross ( qW , qX ) ; qX = normalize ( qX ) ; qY = normalize ( qY ) ; qW = normalize ( qW ) ; return mat4 ( vec4 ( qX , 0.0 ) , vec4 ( qY , 0.0 ) , vec4 ( qW , 0.0 ) , vec4 ( qV , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_JITTERED"],group:{type:"group",parts:[{type:"textline",tokens:"mat4 rg ( in vec3 q_ , float ra , float rb , float rc , vec3 rd ) { float re , rf ; re = fract ( length ( rd ) / 0.17 ) ; rf = rc + re / 10.0 ; re = re ; if ( rc != 0.0 ) re /= rc ; q_ *= 1.0 + 0.5 * sin ( ra ) ; re = length ( q_ ) * rb * sin ( 2.0 * 3.14 * ra * rf + re ) ; return C ( re ) ; }".split(" ")}]}}]},
{type:"textline",tokens:"mat4 ro ( in vec3 rh , in vec3 ri , in mat4 rj ) { vec3 rk ; float rl , rm ; mat4 rn ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_SPHERICAL","BILLBOARD",{type:"logic_negative_expr",places:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"rn = qT ( ri , rj ) ;".split(" ")}]}},{type:"elif",expression:["BILLBOARD_RANDOM"],
group:{type:"group",parts:[{type:"textline",tokens:"rl = fract ( ( ri . x * 1.43 + ri . y * 0.123 + ri . z * 6.1 ) ) ; rl = 2.0 * M_PI * rl ; rk = normalize ( vec3 ( rj [ 0 ] [ 2 ] , 0.0 , rj [ 2 ] [ 2 ] ) ) ; rm = acos ( rk [ 2 ] ) ; if ( rk [ 0 ] < 0.0 ) rm = 2.0 * M_PI - rm ; rm = rm - rl ; if ( rm < 0.0 ) rm = 2.0 * M_PI + rm ; rl = rl ; if ( rm <= MAX_BILLBOARD_ANGLE ) rl += rm ; else if ( rm <= M_PI - MAX_BILLBOARD_ANGLE ) rl += MAX_BILLBOARD_ANGLE * ( 2.0 * rm - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( rm <= M_PI + MAX_BILLBOARD_ANGLE ) rl += rm - M_PI ; else if ( rm <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) rl += MAX_BILLBOARD_ANGLE * ( 2.0 * rm - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else rl += rm - 2.0 * M_PI ; rn = A ( rl ) ; rn [ 3 ] = vec4 ( ri , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"rn = qZ ( rh , ri ) ;".split(" ")}]}}]},{type:"textline",tokens:["return","rn",";","}"]},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"mat4 ru ( in vec3 rp , in vec3 rq , in mat4 rr , mat4 rs ) { mat4 rt ; rt = ro ( rp , rq , rr ) ; rs [ 3 ] = vec4 ( 0.0 , 0.0 , 0.0 , 1.0 ) ; rt = rt * rs ; return rt ; }".split(" ")}]}}]},
{type:"textline",tokens:"c rB ( in vec3 rv , in vec3 rw , in vec3 rx , in vec3 ry , in vec3 rz , in mat4 rA ) { rv = ( rA * vec4 ( rv , 1.0 ) ) . xyz ; rw = ( rA * vec4 ( rw , 1.0 ) ) . xyz ; rx = ( rA * vec4 ( rx , 0.0 ) ) . xyz ; ry = ( rA * vec4 ( ry , 0.0 ) ) . xyz ; rz = ( rA * vec4 ( rz , 0.0 ) ) . xyz ; return E ( c ( rv , rw , rx , ry , rz , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};a["include/scale_texcoord.glslv"]={type:"group",parts:[{type:"textline",tokens:"vec2 rE ( vec2 rC , vec3 rD ) { return ( rC + 0.5 ) * rD . xy - 0.5 ; }".split(" ")}]};
a["include/skin.glslv"]={type:"group",parts:[{type:"define",name:"SKIN_SLERP",tokens:["0"]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["SKIN_SLERP"],group:{type:"group",parts:[{type:"textline",tokens:"vec4 rL ( in vec4 rF , in vec4 rG , in float rH ) { float rI , rJ , rK ; rI = rF [ 0 ] * rG [ 0 ] + rF [ 1 ] * rG [ 1 ] + rF [ 2 ] * rG [ 2 ] + rF [ 3 ] * rG [ 3 ] ; if ( rI < 0.0 ) { rG *= - 1.0 ; rI = - rI ; } if ( abs ( rI ) >= 1.0 ) return rF ; rJ = acos ( rI ) ; rI = sqrt ( 1.0 - rI * rI ) ; if ( abs ( rI ) < 0.001 ) return vec4 ( rF * 0.5 + rG * 0.5 ) ; rK = sin ( ( 1.0 - rH ) * rJ ) / rI ; rI = sin ( rH * rJ ) / rI ; return rF * rK + rG * rI ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 rX ( in vec3 rM , in vec4 rN , in vec4 rO , in vec4 rP , in vec4 rQ , in float rR ) { vec4 rS , rT ; vec3 rU , rV , rW ; rU = p ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( rM , 1.0 ) ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SKIN_SLERP"],group:{type:"group",parts:[{type:"textline",tokens:"rS = rL ( rN , rO , rR ) ; rT = mix ( rP , rQ , rR ) ; rV = i ( rS , rU ) ; rV = rV * rT . w + rT . xyz ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"rW = i ( rN , rU ) ; rU = i ( rO , rU ) ; rW = rW * rP . w + rP . xyz ; rU = rU * rQ . w + rQ . xyz ; rV = mix ( rW , rU , rR ) ;".split(" ")}]}}]},{type:"textline",tokens:"return v ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( rV , 1.0 ) ) ; } vec3 sf ( in vec3 rY , in vec4 rZ , in vec4 r_ , in float sa ) { vec4 sb ; vec3 sc , sd , se ; sc = p ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( rY , 0.0 ) ) ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["SKIN_SLERP"],group:{type:"group",parts:[{type:"textline",tokens:"sb = rL ( rZ , r_ , sa ) ; sd = i ( sb , sc ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"se = i ( rZ , sc ) ; sc = i ( r_ , sc ) ; sd = mix ( se , sc , sa ) ;".split(" ")}]}}]},{type:"textline",tokens:"return v ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sd , 0.0 ) ) ; }".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 rX ( in vec3 sg , in vec4 sh , in vec4 si ) { vec3 sj ; sj = p ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sg , 1.0 ) ) ; sj = i ( sh , sj ) ; sj = sj * si . w + si . xyz ; return v ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sj , 1.0 ) ) ; } vec3 sf ( in vec3 sk , in vec4 sl ) { vec3 sm ; sm = p ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sk , 0.0 ) ) ; sm = i ( sl , sm ) ; return v ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sm , 0.0 ) ) ; }".split(" ")}]}}]},
{type:"textline",tokens:"void sB ( inout vec3 sn , inout vec3 so , inout vec3 sp , inout vec3 sq ) { int sr , ss ; vec4 st ; vec3 su , sv , sw , sx ; float sy , sz ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:["sy","=","u_frame_factor",";"]}]}}]},{type:"textline",tokens:"if ( a_influence . y > 0.0 ) { su = vec3 ( 0.0 , 0.0 , 0.0 ) ; sv = vec3 ( 0.0 , 0.0 , 0.0 ) ; sw = vec3 ( 0.0 , 0.0 , 0.0 ) ; sx = vec3 ( 0.0 , 0.0 , 0.0 ) ; st = a_influence ; for ( int sA = 0 ; sA < 4 ; sA ++ ) { sr = int ( st [ sA ] ) ; sz = fract ( st [ sA ] ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"su += sz * rX ( sn , u_quatsb [ sr ] , u_quatsa [ sr ] , u_transb [ sr ] , u_transa [ sr ] , sy ) ; sv += sz * sf ( so , u_quatsb [ sr ] , u_quatsa [ sr ] , sy ) ; sw += sz * sf ( sp , u_quatsb [ sr ] , u_quatsa [ sr ] , sy ) ; sx += sz * sf ( sq , u_quatsb [ sr ] , u_quatsa [ sr ] , sy ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"su += sz * rX ( sn , u_quatsb [ sr ] , u_transb [ sr ] ) ; sx += sz * sf ( sq , u_quatsb [ sr ] ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DISABLE_TANGENT_SKINNING",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"sv += sz * sf ( so , u_quatsb [ sr ] ) ; sw += sz * sf ( sp , u_quatsb [ sr ] ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"} sn = su ; sq = sx ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DISABLE_TANGENT_SKINNING",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"so = sv ; sp = sw ;".split(" ")}]}}]},
{type:"textline",tokens:"} if ( ! ( a_influence . y > 0.0 ) ) { ss = int ( a_influence [ 0 ] - 1.0 ) ; if ( ss > - 1 ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"sn = rX ( sn , u_quatsb [ ss ] , u_quatsa [ ss ] , u_transb [ ss ] , u_transa [ ss ] , sy ) ; so = sf ( so , u_quatsb [ ss ] , u_quatsa [ ss ] , sy ) ; sp = sf ( sp , u_quatsb [ ss ] , u_quatsa [ ss ] , sy ) ; sq = sf ( sq , u_quatsb [ ss ] , u_quatsa [ ss ] , sy ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"sn = rX ( sn , u_quatsb [ ss ] , u_transb [ ss ] ) ; sq = sf ( sq , u_quatsb [ ss ] ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DISABLE_TANGENT_SKINNING",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"so = sf ( so , u_quatsb [ ss ] ) ; sp = sf ( sp , u_quatsb [ ss ] ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]=
{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"void sM ( inout vec3 sC , in vec3 sD , in float sE , in float sF , in float sG , in vec3 sH , in float sI ) { vec3 sJ ; float sK , sL ; sK = length ( sD ) ; sL = sF * ( 1.0 + 0.1 * fract ( sK ) ) ; sK = sE * sI * ( 1.0 + sin ( 2.0 * 3.14 * sG * sL + sK ) ) ; sL = ( sC . y - sD . y ) * abs ( sK ) ; sL += 1.0 ; sL *= sL ; sL = sL * sL - sL ; sJ = sC ; sJ . xz += sH . xz * sL * sign ( sK ) ; sJ = sJ - sD ; if ( all ( equal ( sJ , vec3 ( 0.0 ) ) ) ) sC = sD ; else { sK = length ( sC - sD ) ; sC = sD + normalize ( sJ ) * sK ; } }".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"vec4 sO ( vec4 sN ) { return sN * sN * ( 3.0 - 2.0 * sN ) ; } vec4 sQ ( vec4 sP ) { return abs ( fract ( sP + 0.5 ) * 2.0 - 1.0 ) ; } vec4 sS ( vec4 sR ) { return sO ( sQ ( sR ) ) ; } void ti ( inout vec3 sT , in float sU , in vec3 sV , in vec3 sW , in vec3 sX , in float sY , in float sZ , in float s_ , in vec3 ta ) { vec3 tb ; vec4 tc ; vec2 td , te ; float tf , tg , th ; tf = dot ( sX , vec3 ( 1.0 ) ) ; tg = tf + ta . g ; th = dot ( sT , vec3 ( ta . g ) ) ; td = ( sU + vec2 ( th , tg ) ) ; tc = ( ( fract ( ( td . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( sW ) * sY ; tc = sS ( tc ) ; te = tc . xz + tc . yw ; te . y = 0.5 - te . y ; tb = te . xyx * ta . rbr * vec3 ( sZ * sV . x , s_ , sZ * sV . z ) ; sT += tb ; }".split(" ")}]}}]},
{type:"textline",tokens:"void tp ( inout vec3 tj , inout vec3 tk , in vec3 tl ) { vec3 tm , tn , to ; tm = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],group:{type:"group",parts:[{type:"textline",tokens:"tn = tk ; to = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"tn = tj ; to = tk ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL"],group:{type:"group",
parts:[{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"ti ( tn , u_time , tl , tm , to , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",tokens:"sM ( tn , to , au_wind_bending_amp , au_wind_bending_freq , u_time , tm , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"sM ( tn , to , au_wind_bending_amp , au_wind_bending_freq , u_time , tm , 1.0 ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],group:{type:"group",parts:[{type:"textline",tokens:"tj += tn - tk ; tk = tn ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"tj = tn ; tk = to ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]}}]}]};a["include/nodes.glslv"]={type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"attribute vec3 a_orco_tex_coord ; varying vec3 eg ;".split(" ")}]}}]},{type:"node",name:"TEX_COORD_UV",declarations:[{type:"node_param",name:"node_TEX_COORD_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"eG",qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:["eG","=","node_TEX_COORD_UV_var_a_uv",";"]}]},{type:"node",name:"UV_MERGED",declarations:[{type:"node_param",name:"node_UV_MERGED_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"eF",
qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:["eF","=","node_UV_MERGED_var_a_uv",";"]}]},{type:"node",name:"UVMAP",declarations:[{type:"node_param",name:"node_UVMAP_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"eH",qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:["eH","=","node_UVMAP_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_UV",declarations:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",
name:"ez",qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:["ez","=","node_GEOMETRY_UV_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_VC",declarations:[{type:"node_param",name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"tq",qualifier:["varying","vec3"]}],statements:[{type:"textline",tokens:["tq","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC1",declarations:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",
qualifier:["attribute","float"]},{type:"node_param",name:"tr",qualifier:["varying","float"]}],statements:[{type:"textline",tokens:["tr","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC2",declarations:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"ts",qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:["ts","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC3",
declarations:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"tt",qualifier:["varying","vec3"]}],statements:[{type:"textline",tokens:["tt","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]},{type:"nodes_global"},{type:"textline",tokens:["void","tu","(",")","{"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:["eg","=","a_orco_tex_coord",";"]}]}}]},{type:"nodes_main"},{type:"textline",tokens:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"vec2 tz ( vec3 tv , float tw , vec2 tx ) { vec2 ty ; ty = vec2 ( ( tv . x - tx . x ) / tw , - ( tv . z - tx . y ) / tw ) ; return fract ( ty ) ; } vec2 tD ( vec2 tA , float tB , vec2 tC ) { return vec2 ( tA . x * tB , - tA . y * tB ) + tC ; } c tE ( ) { return c ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } c t_ ( vec3 tF , vec3 tG , vec3 tH , vec3 tI , vec3 tJ , PRECISION sampler2D tK , sampler2D tL , vec3 tM , float tN , vec3 tO , vec4 tP , mat4 tQ ) { mat4 tR ; vec4 tS ; vec2 tT , tU , tV ; float tW , tX ; vec3 tY ; tY = i ( tP , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; tW = - tY . x ; tX = - tY . z ; tT = vec2 ( tO . x + tN * ( - 1.0 - tW ) / 2.0 , tO . z + tN * ( 1.0 - tX ) / 2.0 ) ; tU = tz ( tJ , tN , tT ) ; tX = tN / 2.0 ; tV = abs ( tD ( tU - vec2 ( 0.5 ) , tN , vec2 ( 0.0 ) ) ) ; tX = tX * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( tV ) > tX ) return tE ( ) ; tX = tN / tM . z ; tV = ( tU - vec2 ( 0.5 ) ) * tX + vec2 ( 0.5 ) ; tY = tY * ( tN / tM . z - 1.0 ) / 2.0 ; tV . x += tY . x ; tV . y -= tY . z ; tS = texture2D ( tL , tV ) ; tX = tS . r ; if ( tX < u_scale_threshold ) return tE ( ) ; tW = tM . y - tM . x ; tW = tM . y - texture2D ( tK , tV ) . r * tW ; tV = tF . xz - tJ . xz ; tJ . xz = tD ( tU , tN , tT ) ; tJ . y = tW ; tF . xz = tJ . xz + tV ; tF . y *= tX ; tF . y += tW ; tY = tS . gba ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:"tF -= tJ ; tR = ro ( tO , tJ , tQ ) ; c tZ = rB ( tF , tJ , tG , tH , tI , tR ) ; tZ . b = tJ ; tZ . f = tY ; return E ( tZ ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"return E ( c ( tF , tJ , tG , tH , tI , tY ) ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",parts:[{type:"var",name:"SHADOW_TEX_RES",
tokens:["0.0"]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec4 ug ( mat4 ua , vec4 ub , mat4 uc ) { vec4 ud ; float ue ; vec2 uf ; uf = ( ua * uc [ 3 ] ) . xy ; ue = SHADOW_TEX_RES / 2.0 ; uf = floor ( uf * ue + 0.5 ) / ue - uf ; ud = ua * ub ; ud . xy += uf ; ud . xyz = 0.5 * ( ud . xyz + ud . w ) ; return ud ; } void ul ( vec3 uh , vec3 ui ) { vec4 uj ; mat4 uk ; uk = O ( u_v_light_tsr ) ; uj = uk * vec4 ( uh + u_normal_offset * ui , 1.0 ) ; bI = ug ( u_p_light_matrix0 , uj , uk ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:"bJ = ug ( u_p_light_matrix1 , uj , uk ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:"bK = ug ( u_p_light_matrix2 , uj , uk ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:"bL = ug ( u_p_light_matrix3 , uj , uk ) ;".split(" ")}]}}]},
{type:"textline",tokens:["}"]}]}}]}]};a["include/fog.glslf"]={type:"group",parts:[{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"textline",tokens:"void uv ( inout vec3 up , in float uq , in float ur , in vec4 us ) { float ut , uu ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_FOG"],group:{type:"group",parts:[{type:"textline",tokens:"ut = clamp ( ( uq - u_fog_params . z ) / u_fog_params . y , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["FOG_TYPE",
"QUADRATIC",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["ut","*=","ut",";"]}]}},{type:"elif",expression:["FOG_TYPE","LINEAR",{type:"equal_expr",places:2}],group:{type:"group",parts:[]}},{type:"elif",expression:["FOG_TYPE","INVERSE_QUADRATIC",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"ut = sqrt ( ut ) ;".split(" ")}]}}]},{type:"textline",tokens:"if ( u_fog_params . w > 0.0 ) { if ( ur > u_fog_params . w ) ut = 0.0 ; else if ( ur > 0.0 ) { uu = ( u_fog_params . w - ur ) / u_fog_params . w ; ut *= uu * uu ; } } ut = 1.0 - ( 1.0 - ut ) * ( 1.0 - u_fog_params . x ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["ut","=","0.0",";"]}]}}]},{type:"textline",tokens:"up = mix ( up , us . rgb , ut ) ; }".split(" ")},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_FOG"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 uB ( in mat4 uw , in vec3 ux ) { vec3 uy , uz , uA ; uy = mix ( uw [ 0 ] . rgb , uw [ 1 ] . rgb , max ( sign ( ux . x ) , 0.0 ) ) ; uz = mix ( uw [ 2 ] . rgb , uw [ 3 ] . rgb , max ( sign ( ux . z ) , 0.0 ) ) ; uA = vec3 ( uw [ 0 ] . a , uw [ 1 ] . a , uw [ 2 ] . a ) ; uz = mix ( uy , uz , abs ( ux . z ) ) ; uz = mix ( uz , uA , abs ( ux . y ) ) ; br ( uz ) ; return uz ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"void uD ( inout float uC ) { uC -= 0.5 ; uC = 4.0 * ( uC * uC * uC ) + 0.5 ; } void uQ ( inout vec3 uE , in float uF , in vec3 uG , in float uH , in vec4 uI , in vec4 uJ , in float uK ) { vec3 uL , uM ; float uN , uO , uP ; uN = uJ . w * uF ; uN = exp ( - uN * uN ) ; uN = clamp ( uN , 0.0 , 1.0 ) ; uO = max ( uG . y , 0.0 ) ; uF = max ( uF - max ( uH / uO , 0.0 ) , 0.0 ) ; uP = uI . w * uF ; uP = 1.0 - uP ; uP = max ( uP , 0.0 ) ; uD ( uP ) ; uP += max ( uK - 0.5 , 0.0 ) ; if ( uP < uN ) { uL = vec3 ( 0.0 , 0.02 , 0.05 ) ; uM = uI . rgb ; uH = clamp ( - uH * 0.03 , 0.0 , 0.8 ) ; uL = mix ( uM , uL , min ( uO , 1.0 ) ) ; uL = mix ( uL , vec3 ( 0.0 ) , uH ) ; uE = mix ( uL , uE , uP ) ; } if ( uP >= uN ) { uE = mix ( uJ . rgb , uE , uN ) ; } } void uW ( inout vec3 uR , in float uS , in float uT ) { vec3 uU ; float uV ; uV = u_underwater_fog_color_density . w * uS ; uV = 1.0 - uV ; uV = clamp ( uV , 0.0 , 1.0 ) ; uD ( uV ) ; uT = clamp ( - uT * 0.03 , 0.0 , 0.8 ) ; uU = mix ( u_underwater_fog_color_density . rgb , vec3 ( 0.0 ) , uT ) ; uR = mix ( uU , uR , uV ) ; }".split(" ")}]}}]},
{type:"textline",tokens:"void vc ( inout vec3 uX , float uY , vec3 uZ , float u_ ) { vec4 va ; vec3 vb ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_FOG"],group:{type:"group",parts:[{type:"textline",tokens:"vb = uB ( u_cube_fog , uZ ) ; va = vec4 ( vb , u_fog_color_density . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["va","=","u_fog_color_density",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",
parts:[{type:"textline",tokens:"uQ ( uX , uY , uZ , u_cam_water_depth , u_underwater_fog_color_density , va , u_ ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"uv ( uX , uY , bC . y , va ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["include/lighting_nodes.glslf"]={type:"group",parts:[{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",
tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"define",name:"M_PI",tokens:["3.14159265359"]},{type:"textline",tokens:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; float vf = 0.5 ;".split(" ")},{type:"node",name:"LIGHTING_BEGIN",declarations:[{type:"node_out",name:"vD",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"vE",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"vF",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"vG",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"vH",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"vI",qualifier:["vec2"],is_optional:!0},{type:"node_out",name:"vJ",qualifier:["vec2"],is_optional:!0},{type:"node_out",name:"vK",qualifier:["float"],is_optional:!0},{type:"node_out",name:"vL",qualifier:["float"],is_optional:!0},{type:"node_out",name:"vM",qualifier:["vec4"],is_optional:!0}],
statements:[{type:"textline",tokens:"vD = vg ; vE = vh ; vF = vi ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_vG"],statements:[{type:"textline",tokens:["vG","=","vj",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_vH"],statements:[{type:"textline",tokens:["vH","=","vl",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_vJ"],statements:[{type:"textline",tokens:["vJ","=","vn",";"]}]}]},{type:"node_condition",
parts:[{type:"node_if",expression:["USE_OUT_vI"],statements:[{type:"textline",tokens:["vI","=","vo",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_vK"],statements:[{type:"textline",tokens:["vK","=","vp",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_vL"],statements:[{type:"textline",tokens:["vL","=","vq",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_vM"],statements:[{type:"textline",tokens:["vM","=","vr",";"]}]}]}]},
{type:"node",name:"LIGHTING_AMBIENT",declarations:[{type:"node_in",name:"vN",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"vO",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"vP",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"vQ",qualifier:["vec4"],is_optional:!1},{type:"node_out",name:"vR",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"vQ = vec4 ( vN + vP * vO , ZERO_VALUE_NODES ) ; vR = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",
name:"LIGHTING_LAMP",declarations:[{type:"node_in",name:"vS",qualifier:["float"],is_optional:!1},{type:"node_out",name:"vT",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"vU",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"vV",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"vW",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"vU = u_light_factors [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",
expression:["LAMP_TYPE","HEMI",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:["vW","=","vf",";"]}]},{type:"node_else",statements:[{type:"textline",tokens:["vW","=","ZERO_VALUE_NODES",";"]}]}]},{type:"textline",tokens:"vV = u_light_color_intensities [ LAMP_IND ] ; if ( LAMP_SHADOW_MAP_IND != - 1 ) vV *= vS ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE","SPOT",{type:"equal_expr",places:2},"LAMP_TYPE","POINT",{type:"equal_expr",places:2},{type:"logical_or_expr",
places:2}],statements:[{type:"textline",tokens:"vB = u_light_positions [ LAMP_IND ] ; vT = vB - vk ;".split(" ")},{type:"textline",tokens:"vu = length ( vT ) ; vV *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + vu * vu ) ; vT = normalize ( vT ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE","SPOT",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:"vB = u_light_directions [ LAMP_IND ] ; vu = dot ( vT , vB ) ; vu *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( vu - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; vV *= vu ;".split(" ")}]}]}]},
{type:"node_else",statements:[{type:"textline",tokens:"vT = u_light_directions [ LAMP_IND ] ;".split(" ")}]}]}]},{type:"node",name:"DIFFUSE_FRESNEL",declarations:[{type:"node_in",name:"vX",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"vY",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"vZ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"v_",qualifier:["float"],is_optional:!1},{type:"node_in",name:"wa",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"wb",qualifier:["float"],
is_optional:!1}],statements:[{type:"textline",tokens:"wb = ZERO_VALUE_NODES ; if ( vY . r != ZERO_VALUE_NODES ) { vu = ( UNITY_VALUE_NODES - v_ ) * dot ( vZ , vX ) + v_ ; if ( wa [ 0 ] == ZERO_VALUE_NODES ) { wb = UNITY_VALUE_NODES ; } else { vu = UNITY_VALUE_NODES + abs ( vu ) ; vu = wa [ 1 ] + ( UNITY_VALUE_NODES - wa [ 1 ] ) * pow ( vu , wa [ 0 ] ) ; wb = clamp ( vu , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; } wb = max ( wb , ZERO_VALUE_NODES ) ; }".split(" ")}]},{type:"node",name:"DIFFUSE_LAMBERT",
declarations:[{type:"node_in",name:"wc",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wd",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"we",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wf",qualifier:["float"],is_optional:!1},{type:"node_out",name:"wg",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"wg = ZERO_VALUE_NODES ; if ( wd . r != ZERO_VALUE_NODES ) { vu = ( UNITY_VALUE_NODES - wf ) * dot ( we , wc ) + wf ; wg = max ( vu , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_OREN_NAYAR",declarations:[{type:"node_in",name:"wh",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wi",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"wj",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wk",qualifier:["float"],is_optional:!1},{type:"node_in",name:"wl",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"wm",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"wm = ZERO_VALUE_NODES ; if ( wi . r != ZERO_VALUE_NODES ) { vu = ( UNITY_VALUE_NODES - wk ) * dot ( wj , wh ) + wk ; if ( wl [ 0 ] > ZERO_VALUE_NODES ) { vv = max ( dot ( wj , vm ) , ZERO_VALUE_NODES ) ; vw = wl [ 0 ] * wl [ 0 ] ; vx = UNITY_VALUE_NODES - vf * ( vw / ( vw + 0.33 ) ) ; vB = wh - vu * wj ; vC = vm - vv * wj ;".split(" ")},
{type:"textline",tokens:"if ( length ( vB ) == ZERO_VALUE_NODES || length ( vC ) == ZERO_VALUE_NODES || abs ( vu ) > UNITY_VALUE_NODES || abs ( vv ) > UNITY_VALUE_NODES )".split(" ")},{type:"textline",tokens:"wm = vu * vx ; else { vy = acos ( vu ) ; vv = acos ( vv ) ; vB = normalize ( vB ) ; vC = normalize ( vC ) ; vz = max ( vy , vv ) ; vA = min ( vy , vv ) ; vA *= 0.95 ; vv = max ( dot ( vB , vC ) , ZERO_VALUE_NODES ) ; vw = 0.45 * ( vw / ( vw + 0.09 ) ) ; wm = vu * ( vx + ( vw * vv * sin ( vz ) * tan ( vA ) ) ) ; } } else wm = vu ; wm = max ( wm , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_MINNAERT",declarations:[{type:"node_in",name:"wn",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wo",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"wp",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wq",qualifier:["float"],is_optional:!1},{type:"node_in",name:"wr",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"ws",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ws = ZERO_VALUE_NODES ; if ( wo . r != ZERO_VALUE_NODES ) { vu = ( UNITY_VALUE_NODES - wq ) * dot ( wp , wn ) + wq ; vA = max ( dot ( wp , vm ) , ZERO_VALUE_NODES ) ; if ( wr [ 0 ] <= UNITY_VALUE_NODES ) ws = vu * pow ( max ( vA * vu , 0.1 ) , wr [ 0 ] - UNITY_VALUE_NODES ) ; else ws = vu * pow ( 1.0001 - vA , wr [ 0 ] - UNITY_VALUE_NODES ) ; ws = max ( ws , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_TOON",declarations:[{type:"node_in",name:"wt",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wu",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"wv",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ww",qualifier:["float"],is_optional:!1},{type:"node_in",name:"wx",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"wy",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"wy = ZERO_VALUE_NODES ; if ( wu . r != ZERO_VALUE_NODES ) { vA = ( UNITY_VALUE_NODES - ww ) * dot ( wv , wt ) + ww ; vA = acos ( vA ) ; if ( vA < wx [ 0 ] ) wy = UNITY_VALUE_NODES ; else if ( vA > ( wx [ 0 ] + wx [ 1 ] ) || wx [ 1 ] == ZERO_VALUE_NODES ) wy = ZERO_VALUE_NODES ; else wy = UNITY_VALUE_NODES - ( ( vA - wx [ 0 ] ) / wx [ 1 ] ) ; wy = max ( wy , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_PHONG",declarations:[{type:"node_in",name:"wz",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wA",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"wB",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wC",qualifier:["float"],is_optional:!1},{type:"node_in",name:"wD",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"wE",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"wE = ZERO_VALUE_NODES ; if ( wA . g != ZERO_VALUE_NODES ) { vC = normalize ( wz + vm ) ; wE = ( UNITY_VALUE_NODES - wC ) * max ( dot ( wB , vC ) , ZERO_VALUE_NODES ) + wC ; wE = pow ( wE , wD [ 0 ] ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_WARDISO",declarations:[{type:"node_in",name:"wF",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wG",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"wH",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wI",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"wJ",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"wJ = ZERO_VALUE_NODES ; if ( wG . g != ZERO_VALUE_NODES ) { vC = normalize ( wF + vm ) ; vA = max ( dot ( wH , vC ) , 0.001 ) ;".split(" ")},
{type:"textline",tokens:"vu = max ( dot ( wH , vm ) , 0.01 ) ; vz = max ( dot ( wH , wF ) , 0.01 ) ; vA = tan ( acos ( vA ) ) ; vv = max ( wI [ 0 ] , 0.001 ) ; wJ = vz * ( UNITY_VALUE_NODES / ( 4.0 * M_PI * vv * vv ) ) * ( exp ( - ( vA * vA ) / ( vv * vv ) ) / ( sqrt ( vu * vz ) ) ) ; }".split(" ")}]},{type:"node",name:"SPECULAR_TOON",declarations:[{type:"node_in",name:"wK",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wL",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"wM",qualifier:["vec3"],
is_optional:!1},{type:"node_in",name:"wN",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"wO",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"wO = ZERO_VALUE_NODES ; if ( wL . g != ZERO_VALUE_NODES ) { vC = normalize ( wK + vm ) ; vz = acos ( dot ( vC , wM ) ) ; if ( vz < wN [ 0 ] ) wO = UNITY_VALUE_NODES ; else if ( vz >= wN [ 0 ] + wN [ 1 ] || wN [ 1 ] == ZERO_VALUE_NODES ) wO = ZERO_VALUE_NODES ; else wO = UNITY_VALUE_NODES - ( vz - wN [ 0 ] ) / wN [ 1 ] ; }".split(" ")}]},
{type:"node",name:"SPECULAR_BLINN",declarations:[{type:"node_in",name:"wP",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wQ",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"wR",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wS",qualifier:["float"],is_optional:!1},{type:"node_in",name:"wT",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"wU",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"wU = ZERO_VALUE_NODES ; if ( wQ . g != ZERO_VALUE_NODES ) { if ( wT [ 0 ] < 1.0 || wT [ 1 ] == ZERO_VALUE_NODES ) wU = ZERO_VALUE_NODES ; else { if ( wT [ 1 ] < 100.0 ) wT [ 1 ] = sqrt ( 1.0 / wT [ 1 ] ) ; else wT [ 1 ] = 10.0 / wT [ 1 ] ; vC = normalize ( vm + wP ) ; vz = ( UNITY_VALUE_NODES - wS ) * max ( dot ( wR , vC ) , ZERO_VALUE_NODES ) + wS ; if ( vz < ZERO_VALUE_NODES ) wU = ZERO_VALUE_NODES ; else { vu = max ( dot ( wR , vm ) , 0.01 ) ; vv = dot ( wR , wP ) ; if ( vv <= 0.01 ) wU = ZERO_VALUE_NODES ; else { vA = max ( dot ( vm , vC ) , 0.01 ) ; vw = UNITY_VALUE_NODES ; vu = ( 2.0 * vz * vu ) / vA ; vv = ( 2.0 * vz * vv ) / vA ; vv = min ( min ( vw , vu ) , vv ) ; vu = sqrt ( pow ( wT [ 0 ] , 2.0 ) + pow ( vA , 2.0 ) - UNITY_VALUE_NODES ) ; vA = pow ( vu - vA , 2.0 ) / pow ( vu + vA , 2.0 ) * ( UNITY_VALUE_NODES + pow ( vA * ( vu + vA ) - UNITY_VALUE_NODES , 2.0 ) / pow ( vA * ( vu - vA ) + UNITY_VALUE_NODES , 2.0 ) ) ; vz = acos ( vz ) ; wU = max ( vA * vv * exp ( - pow ( vz , 2.0 ) / ( 2.0 * pow ( wT [ 1 ] , 2.0 ) ) ) , ZERO_VALUE_NODES ) ; } } } }".split(" ")}]},
{type:"node",name:"LIGHTING_APPLY",declarations:[{type:"node_in",name:"wV",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"wW",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wX",qualifier:["float"],is_optional:!1},{type:"node_in",name:"wY",qualifier:["float"],is_optional:!1},{type:"node_in",name:"wZ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"w_",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"xa",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"xb",
qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"xc",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"xd",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"xe",qualifier:["float"],is_optional:!1},{type:"node_out",name:"xf",qualifier:["vec4"],is_optional:!1},{type:"node_out",name:"xg",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"xg = wW + xd * xc * wY ; xf = wV + vec4 ( xd * xb * wX , wY ) ;".split(" ")}]},{type:"node",name:"LIGHTING_END",declarations:[{type:"node_in",
name:"xh",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"xi",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"vs = xh . rgb ; vt = xi ;".split(" ")}]},{type:"nodes_global"},{type:"textline",tokens:"void xj ( vec3 vg , vec3 vh , vec3 vi , vec3 vj , vec3 vk , vec3 vl , vec3 vm , vec2 vn , vec2 vo , float vp , float vq , vec4 vr , out vec3 vs , out vec3 vt ) { float vu , vv , vw , vx , vy , vz , vA ; vec3 vB , vC ;".split(" ")},{type:"nodes_main"},{type:"textline",tokens:["}"]}]};
a["include/particles.glslv"]={type:"group",parts:[{type:"var",name:"EPSILON",tokens:["0.0001"]},{type:"textline",tokens:"struct xm { float a ; vec3 b ; float c ; vec3 d ; float e ; } ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SIZE_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"void xs ( inout float xn , float xo , vec2 xp , vec2 xq ) { float xr ; xr = xq . x - xp . x ; xr = ( xo - xp . x ) / xr ; xn = mix ( xn , xq . y , clamp ( xr , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"void xy ( inout vec3 xt , float xu , vec4 xv , vec4 xw ) { float xx ; xx = xw . x - xv . x ; xx = ( xu - xv . x ) / xx ; xt = mix ( xt , xw . yzw , clamp ( xx , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SIZE_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"float xE ( float xz , float xA , vec2 xB [ SIZE_RAMP_LENGTH ] ) { float xC , xD ; xC = xz / xA ; xD = xB [ 0 ] . y ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SIZE_RAMP_LENGTH",1,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xs ( xD , xC , xB [ 0 ] , xB [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SIZE_RAMP_LENGTH",2,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xs ( xD , xC , xB [ 1 ] , xB [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SIZE_RAMP_LENGTH",3,{type:"g_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:"xs ( xD , xC , xB [ 2 ] , xB [ 3 ] ) ;".split(" ")}]}}]},{type:"textline",tokens:["return","xD",";","}"]}]}}]},{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 xK ( float xF , float xG , vec4 xH [ COLOR_RAMP_LENGTH ] ) { vec3 xI ; float xJ ; xJ = xF / xG ; xI = xH [ 0 ] . yzw ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",
1,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xy ( xI , xJ , xH [ 0 ] , xH [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",2,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xy ( xI , xJ , xH [ 1 ] , xH [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",3,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xy ( xI , xJ , xH [ 2 ] , xH [ 3 ] ) ;".split(" ")}]}}]},
{type:"textline",tokens:["return","xI",";","}"]}]}}]},{type:"textline",tokens:"float xS ( float xL , float xM , float xN , float xO ) { float xP , xQ , xR ; xP = max ( 0.01 , min ( xM , xN ) ) ; xQ = max ( 0.01 , min ( xM , xO ) ) ; xR = xM - xQ ; xQ = clamp ( xL / xP , 0.0 , 1.0 ) - step ( xR , xL ) * ( xL - xR ) / xQ ; return xQ ; } xm xZ ( ) { mat4 xT ; vec3 xU , xV ; float xW , xX ; xm xY ; if ( u_p_cyclic == 1 ) { xW = mod ( u_p_time , u_p_length ) - a_p_delay ; if ( xW < 0.0 ) xW += u_p_length ; } if ( u_p_cyclic != 1 ) { xW = u_p_time - a_p_delay ; } if ( xW < 0.0 || xW >= a_p_lifetime ) { xY . a = 0.0001 ; xY . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( xW < 0.0 || xW >= a_p_lifetime ) ) {".split(" ")},
{type:"condition",parts:[{type:"if",expression:["WORLD_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"xU = a_position ; xV = a_normal ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"xT = O ( u_model_tsr ) ; xU = ( xT * vec4 ( a_position , 1.0 ) ) . xyz ; xV = ( xT * vec4 ( a_normal , 0.0 ) ) . xyz ;".split(" ")}]}}]},{type:"textline",tokens:"xU += u_p_nfactor * xW * xV ; xU += a_p_vels . xyz * xW ; xU . y -= u_p_gravity * xW * xW / 2.0 ; xX = max ( u_p_mass , EPSILON ) ; xU += ( u_p_wind_fac * u_wind / xX ) * xW * xW / 2.0 ; xY . b = xU ; xY . e = a_p_vels . w * xW ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SIZE_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xY . a = xE ( xW , u_p_max_lifetime , u_p_size_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"xY . a = 1.0 ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xY . d = xK ( xW , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"xY . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"xY . c = xS ( xW , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; } return xY ; }".split(" ")}]};a["include/blending.glslf"]={type:"group",parts:[{type:"textline",tokens:"float ya = 0.0 ; float yb = 1.0 ; vec3 yg ( vec3 yc ) { float yd , ye ; vec4 yf ; yf = vec4 ( ya , - yb / 3.0 , 2.0 / 3.0 , - yb ) ; yf = mix ( vec4 ( yc . bg , yf . wz ) , vec4 ( yc . gb , yf . xy ) , step ( yc . b , yc . g ) ) ; yf = mix ( vec4 ( yf . xyw , yc . r ) , vec4 ( yc . r , yf . yzx ) , step ( yf . x , yc . r ) ) ; yd = yf . x - min ( yf . w , yf . y ) ; ye = 1.0e-10 ; return vec3 ( abs ( yf . z + ( yf . w - yf . y ) / ( 6.0 * yd + ye ) ) , yd / ( yf . x + ye ) , yf . x ) ; } vec3 yk ( vec3 yh ) { vec3 yi ; vec4 yj ; yj = vec4 ( yb , 2.0 / 3.0 , yb / 3.0 , 3.0 ) ; yi = abs ( fract ( vec3 ( yh . r , yh . r , yh . r ) + yj . xyz ) * 6.0 - yj . www ) ; return yh . b * mix ( yj . xxx , clamp ( yi - yj . xxx , ya , yb ) , yh . g ) ; } vec3 yo ( vec3 yl , vec3 ym , float yn ) { return mix ( yl , ym , yn ) ; } vec3 ys ( vec3 yp , vec3 yq , float yr ) { return yr * yp + yq ; } vec3 yw ( vec3 yt , vec3 yu , float yv ) { return yu - yv * yt ; } vec3 yB ( vec3 yx , vec3 yy , float yz ) { float yA ; yA = yb - yz ; return ( vec3 ( yA ) + yz * yx ) * yy ; } vec3 yG ( vec3 yC , vec3 yD , float yE ) { vec3 yF ; yF = vec3 ( yb - yE ) ; return vec3 ( yb ) - ( yF + yE * ( vec3 ( yb ) - yC ) ) * ( vec3 ( yb ) - yD ) ; } vec3 yL ( vec3 yH , vec3 yI , float yJ ) { vec3 yK ; yK = vec3 ( yb - yJ ) ; return mix ( yI * ( yK + 2.0 * yJ * yH ) , vec3 ( yb ) - ( yK + 2.0 * yJ * ( vec3 ( yb ) - yH ) ) * ( vec3 ( yb ) - yI ) , step ( 0.5 , yI ) ) ; } vec3 yP ( vec3 yM , vec3 yN , float yO ) { return mix ( yN , abs ( yM - yN ) , yO ) ; } vec3 yT ( vec3 yQ , vec3 yR , float yS ) { return mix ( yR , yR / ( yQ + step ( yQ , vec3 ( ya ) ) ) , yS ) ; } vec3 yX ( vec3 yU , vec3 yV , float yW ) { return mix ( yV , min ( yU , yV ) , yW ) ; } vec3 za ( vec3 yY , vec3 yZ , float y_ ) { return max ( y_ * yY , yZ ) ; } vec3 zg ( vec3 zb , vec3 zc , float zd ) { vec3 ze , zf ; ze = yg ( zc ) ; if ( ze . y != ya ) { zf = yg ( zb ) ; zf = yk ( vec3 ( ze . x , zf . yz ) ) ; return mix ( zb , zf , zd ) ; } return zb ; } vec3 zm ( vec3 zh , vec3 zi , float zj ) { vec3 zk , zl ; zk = yg ( zh ) ; if ( zk . y != ya ) { zl = yg ( zi ) ; return yk ( vec3 ( zk . x , mix ( zk . y , zl . y , zj ) , zk . z ) ) ; } return zh ; } vec3 zs ( vec3 zn , vec3 zo , float zp ) { vec3 zq , zr ; zq = yg ( zn ) ; zr = yg ( zo ) ; return yk ( vec3 ( zq . xy , mix ( zq . z , zr . z , zp ) ) ) ; } vec3 zy ( vec3 zt , vec3 zu , float zv ) { vec3 zw , zx ; zw = yg ( zu ) ; if ( zw . y != ya ) { zx = yg ( zt ) ; zx = yk ( vec3 ( zw . xy , zx . z ) ) ; return mix ( zt , zx , zv ) ; } return zt ; } vec3 zD ( vec3 zz , vec3 zA , float zB ) { vec3 zC ; zC = vec3 ( yb ) - ( vec3 ( yb ) - zA ) * ( vec3 ( yb ) - zz ) ; return mix ( zz , ( ( vec3 ( yb ) - zz ) * zA * zz ) + zz * zC , zB ) ; } vec3 zH ( vec3 zE , vec3 zF , float zG ) { return zE + zG * ( 2.0 * zF - yb ) ; } float zN ( float zI , float zJ , float zK , float zL ) { float zM ; zM = yb - zL ; return ( zM + zK * zI ) * zJ ; } float zT ( float zO , float zP , float zQ , float zR ) { float zS ; zS = yb - zR ; return yb - ( zS + zQ * ( yb - zO ) ) * ( yb - zP ) ; } float zZ ( float zU , float zV , float zW , float zX ) { float zY ; zY = yb - zX ; return mix ( zV * ( zY + 2.0 * zW * zU ) , yb - ( zY + 2.0 * zW * ( yb - zU ) ) * ( yb - zV ) , step ( 0.5 , zV ) ) ; }".split(" ")}]};
a["include/fxaa.glslf"]={type:"group",parts:[{type:"condition",parts:[{type:"ifndef",name:"FXAA_PS3",group:{type:"group",parts:[{type:"define",name:"FXAA_PS3",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_360",group:{type:"group",parts:[{type:"define",name:"FXAA_360",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_360_OPT",group:{type:"group",parts:[{type:"define",name:"FXAA_360_OPT",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_PC",
group:{type:"group",parts:[{type:"define",name:"FXAA_PC",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_PC_CONSOLE",group:{type:"group",parts:[{type:"define",name:"FXAA_PC_CONSOLE",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_GLSL_120",group:{type:"group",parts:[{type:"define",name:"FXAA_GLSL_120",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_GLSL_130",group:{type:"group",parts:[{type:"define",name:"FXAA_GLSL_130",tokens:["0"]}]}}]},
{type:"condition",parts:[{type:"ifndef",name:"FXAA_HLSL_3",group:{type:"group",parts:[{type:"define",name:"FXAA_HLSL_3",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_HLSL_4",group:{type:"group",parts:[{type:"define",name:"FXAA_HLSL_4",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_HLSL_5",group:{type:"group",parts:[{type:"define",name:"FXAA_HLSL_5",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_GREEN_AS_LUMA",group:{type:"group",
parts:[{type:"define",name:"FXAA_GREEN_AS_LUMA",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_EARLY_EXIT",group:{type:"group",parts:[{type:"define",name:"FXAA_EARLY_EXIT",tokens:["1"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_DISCARD",group:{type:"group",parts:[{type:"define",name:"FXAA_DISCARD",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_FAST_PIXEL_OFFSET",group:{type:"group",parts:[{type:"condition",parts:[{type:"ifdef",name:"GL_EXT_gpu_shader4",
group:{type:"group",parts:[{type:"define",name:"FXAA_FAST_PIXEL_OFFSET",tokens:["1"]}]}}]},{type:"condition",parts:[{type:"ifdef",name:"GL_NV_gpu_shader5",group:{type:"group",parts:[{type:"define",name:"FXAA_FAST_PIXEL_OFFSET",tokens:["1"]}]}}]},{type:"condition",parts:[{type:"ifdef",name:"GL_ARB_gpu_shader5",group:{type:"group",parts:[{type:"define",name:"FXAA_FAST_PIXEL_OFFSET",tokens:["1"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_FAST_PIXEL_OFFSET",group:{type:"group",parts:[{type:"define",
name:"FXAA_FAST_PIXEL_OFFSET",tokens:["0"]}]}}]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_GATHER4_ALPHA",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["FXAA_HLSL_5",1,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_GATHER4_ALPHA",tokens:["1"]}]}}]},{type:"condition",parts:[{type:"ifdef",name:"GL_ARB_gpu_shader5",group:{type:"group",parts:[{type:"define",name:"FXAA_GATHER4_ALPHA",tokens:["1"]}]}}]},{type:"condition",parts:[{type:"ifdef",
name:"GL_NV_gpu_shader5",group:{type:"group",parts:[{type:"define",name:"FXAA_GATHER4_ALPHA",tokens:["1"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_GATHER4_ALPHA",group:{type:"group",parts:[{type:"define",name:"FXAA_GATHER4_ALPHA",tokens:["0"]}]}}]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:[1],group:{type:"group",parts:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",
tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:[0],group:{type:"group",parts:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",tokens:["4.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:[0],group:{type:"group",parts:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",tokens:["2.0"]}]}}]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_CONSOLE_PS3_EDGE_THRESHOLD",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:[1],group:{type:"group",
parts:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_THRESHOLD",tokens:["0.125"]}]}},{type:"else",group:{type:"group",parts:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_THRESHOLD",tokens:["0.25"]}]}}]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_QUALITY_PRESET",group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PRESET",tokens:["12"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",10,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",
name:"FXAA_QUALITY_PS",tokens:["3"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["3.0"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["12.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",11,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["4"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",
name:"FXAA_QUALITY_P2",tokens:["3.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["12.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",12,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["5"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["4.0"]},{type:"define",
name:"FXAA_QUALITY_P4",tokens:["12.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",13,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["6"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["4.0"]},{type:"define",
name:"FXAA_QUALITY_P5",tokens:["12.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",14,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["7"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",
name:"FXAA_QUALITY_P5",tokens:["4.0"]},{type:"define",name:"FXAA_QUALITY_P6",tokens:["12.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",15,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["8"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",
name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",tokens:["4.0"]},{type:"define",name:"FXAA_QUALITY_P7",tokens:["12.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",20,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["3"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["2.0"]},{type:"define",
name:"FXAA_QUALITY_P2",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",21,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["4"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",
22,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["5"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",23,{type:"equal_expr",places:2}],group:{type:"group",
parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["6"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",24,{type:"equal_expr",places:2}],group:{type:"group",
parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["7"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",tokens:["3.0"]},{type:"define",name:"FXAA_QUALITY_P6",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",
25,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["8"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",tokens:["4.0"]},{type:"define",
name:"FXAA_QUALITY_P7",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",26,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["9"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",
name:"FXAA_QUALITY_P5",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",tokens:["4.0"]},{type:"define",name:"FXAA_QUALITY_P8",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",27,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["10"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",
name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P8",tokens:["4.0"]},{type:"define",name:"FXAA_QUALITY_P9",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",28,{type:"equal_expr",
places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["11"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",
tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P8",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P9",tokens:["4.0"]},{type:"define",name:"FXAA_QUALITY_P10",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",29,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["12"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",
tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P8",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P9",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P10",tokens:["4.0"]},{type:"define",name:"FXAA_QUALITY_P11",tokens:["8.0"]}]}}]},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",39,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["12"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P5",tokens:["1.5"]},
{type:"define",name:"FXAA_QUALITY_P6",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P8",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P9",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P10",tokens:["4.0"]},{type:"define",name:"FXAA_QUALITY_P11",tokens:["8.0"]}]}}]},{type:"var",name:"FXAA_QUALITY_P12",tokens:["0.0"]},{type:"textline",tokens:"float Av ( float Au ) { return clamp ( Au , 0.0 , 1.0 ) ; }".split(" ")},{type:"condition",parts:[{type:"if",
expression:["FXAA_BLEND4WEB",1,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec4 Ay ( sampler2D Aw , vec2 Ax ) { return texture2D ( Aw , Ax ) ; } vec4 AD ( sampler2D Az , vec2 AA , vec2 AB , vec2 AC ) { return texture2D ( Az , AA + ( AB * AC ) ) ; }".split(" ")}]}}]},{type:"textline",tokens:"vec4 Bj ( vec2 AE , sampler2D AF , vec2 AG , float AH , float AI , float AJ ) { bool AK , AL , AM , AN , AO ; float AP , AQ , AR , AS , AT , AU , AV , AW , AX , AY , AZ , A_ , Ba , Bb , Bc ; vec4 Bd ; vec2 Be , Bf , Bg , Bh , Bi ; Be . x = AE . x ; Be . y = AE . y ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_GATHER4_ALPHA",1,{type:"equal_expr",places:2}],group:{type:"group",parts:[]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Bd = Ay ( AF , Be ) ; AP = bB ( Bd ) ; AQ = bB ( AD ( AF , Be , vec2 ( 0 , 1 ) , AG . xy ) ) ; AR = bB ( AD ( AF , Be , vec2 ( 1 , 0 ) , AG . xy ) ) ; AS = bB ( AD ( AF , Be , vec2 ( 0 , - 1 ) , AG . xy ) ) ; AT = bB ( AD ( AF , Be , vec2 ( - 1 , 0 ) , AG . xy ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"AU = max ( AQ , AP ) ; AV = min ( AQ , AP ) ; AU = max ( AR , AU ) ; AV = min ( AR , AV ) ; AW = max ( AS , AT ) ; AX = min ( AS , AT ) ; AU = max ( AW , AU ) ; AV = min ( AX , AV ) ; AX = AU * AI ; AV = AU - AV ; AX = max ( AJ , AX ) ; AK = AV < AX ; if ( AK ) return Bd ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_GATHER4_ALPHA",0,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"AX = bB ( AD ( AF , Be , vec2 ( - 1 , - 1 ) , AG . xy ) ) ; AU = bB ( AD ( AF , Be , vec2 ( 1 , 1 ) , AG . xy ) ) ; AW = bB ( AD ( AF , Be , vec2 ( 1 , - 1 ) , AG . xy ) ) ; AY = bB ( AD ( AF , Be , vec2 ( - 1 , 1 ) , AG . xy ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[]}}]},{type:"textline",tokens:"AZ = AS + AQ ; A_ = AT + AR ; AV = 1.0 / AV ; Ba = AZ + A_ ; AZ = ( - 2.0 * AP ) + AZ ; A_ = ( - 2.0 * AP ) + A_ ; Bb = AW + AU ; AW = AX + AW ; Bc = ( - 2.0 * AR ) + Bb ; AW = ( - 2.0 * AS ) + AW ; AX = AX + AY ; AU = AY + AU ; Bc = ( abs ( AZ ) * 2.0 ) + abs ( Bc ) ; AW = ( abs ( A_ ) * 2.0 ) + abs ( AW ) ; A_ = ( - 2.0 * AT ) + AX ; AU = ( - 2.0 * AQ ) + AU ; Bc = abs ( A_ ) + Bc ; AW = abs ( AU ) + AW ; Bb = AX + Bb ; AX = AG . x ; AK = Bc >= AW ; Bb = Ba * 2.0 + Bb ; if ( ! AK ) AS = AT ; if ( ! AK ) AQ = AR ; if ( AK ) AX = AG . y ; Bb = ( Bb * ( 1.0 / 12.0 ) ) - AP ; AR = AS - AP ; AT = AQ - AP ; AS = AS + AP ; AQ = AQ + AP ; AL = abs ( AR ) >= abs ( AT ) ; AT = max ( abs ( AR ) , abs ( AT ) ) ; if ( AL ) AX = - AX ; AV = Av ( abs ( Bb ) * AV ) ; Bf . x = Be . x ; Bf . y = Be . y ; Bg . x = ( ! AK ) ? 0.0 : AG . x ; Bg . y = ( AK ) ? 0.0 : AG . y ; if ( ! AK ) Bf . x += AX * 0.5 ; if ( AK ) Bf . y += AX * 0.5 ; Bh . x = Bf . x - Bg . x * FXAA_QUALITY_P0 ; Bh . y = Bf . y - Bg . y * FXAA_QUALITY_P0 ; Bi . x = Bf . x + Bg . x * FXAA_QUALITY_P0 ; Bi . y = Bf . y + Bg . y * FXAA_QUALITY_P0 ; Bb = ( ( - 2.0 ) * AV ) + 3.0 ; AR = bB ( Ay ( AF , Bh ) ) ; AV = AV * AV ; Ba = bB ( Ay ( AF , Bi ) ) ; if ( ! AL ) AS = AQ ; AT = AT * 1.0 / 4.0 ; AQ = AP - AS * 0.5 ; AV = Bb * AV ; AL = AQ < 0.0 ; AR -= AS * 0.5 ; Ba -= AS * 0.5 ; AM = abs ( AR ) >= AT ; AN = abs ( Ba ) >= AT ; if ( ! AM ) Bh . x -= Bg . x * FXAA_QUALITY_P1 ; if ( ! AM ) Bh . y -= Bg . y * FXAA_QUALITY_P1 ; AO = ( ! AM ) || ( ! AN ) ; if ( ! AN ) Bi . x += Bg . x * FXAA_QUALITY_P1 ; if ( ! AN ) Bi . y += Bg . y * FXAA_QUALITY_P1 ; if ( AO ) { if ( ! AM ) AR = bB ( Ay ( AF , Bh . xy ) ) ; if ( ! AN ) Ba = bB ( Ay ( AF , Bi . xy ) ) ; if ( ! AM ) AR = AR - AS * 0.5 ; if ( ! AN ) Ba = Ba - AS * 0.5 ; AM = abs ( AR ) >= AT ; AN = abs ( Ba ) >= AT ; if ( ! AM ) Bh . x -= Bg . x * FXAA_QUALITY_P2 ; if ( ! AM ) Bh . y -= Bg . y * FXAA_QUALITY_P2 ; AO = ( ! AM ) || ( ! AN ) ; if ( ! AN ) Bi . x += Bg . x * FXAA_QUALITY_P2 ; if ( ! AN ) Bi . y += Bg . y * FXAA_QUALITY_P2 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",3,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( AO ) { if ( ! AM ) AR = bB ( Ay ( AF , Bh . xy ) ) ; if ( ! AN ) Ba = bB ( Ay ( AF , Bi . xy ) ) ; if ( ! AM ) AR = AR - AS * 0.5 ; if ( ! AN ) Ba = Ba - AS * 0.5 ; AM = abs ( AR ) >= AT ; AN = abs ( Ba ) >= AT ; if ( ! AM ) Bh . x -= Bg . x * FXAA_QUALITY_P3 ; if ( ! AM ) Bh . y -= Bg . y * FXAA_QUALITY_P3 ; AO = ( ! AM ) || ( ! AN ) ; if ( ! AN ) Bi . x += Bg . x * FXAA_QUALITY_P3 ; if ( ! AN ) Bi . y += Bg . y * FXAA_QUALITY_P3 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",4,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( AO ) { if ( ! AM ) AR = bB ( Ay ( AF , Bh . xy ) ) ; if ( ! AN ) Ba = bB ( Ay ( AF , Bi . xy ) ) ; if ( ! AM ) AR = AR - AS * 0.5 ; if ( ! AN ) Ba = Ba - AS * 0.5 ; AM = abs ( AR ) >= AT ; AN = abs ( Ba ) >= AT ; if ( ! AM ) Bh . x -= Bg . x * FXAA_QUALITY_P4 ; if ( ! AM ) Bh . y -= Bg . y * FXAA_QUALITY_P4 ; AO = ( ! AM ) || ( ! AN ) ; if ( ! AN ) Bi . x += Bg . x * FXAA_QUALITY_P4 ; if ( ! AN ) Bi . y += Bg . y * FXAA_QUALITY_P4 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",5,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( AO ) { if ( ! AM ) AR = bB ( Ay ( AF , Bh . xy ) ) ; if ( ! AN ) Ba = bB ( Ay ( AF , Bi . xy ) ) ; if ( ! AM ) AR = AR - AS * 0.5 ; if ( ! AN ) Ba = Ba - AS * 0.5 ; AM = abs ( AR ) >= AT ; AN = abs ( Ba ) >= AT ; if ( ! AM ) Bh . x -= Bg . x * FXAA_QUALITY_P5 ; if ( ! AM ) Bh . y -= Bg . y * FXAA_QUALITY_P5 ; AO = ( ! AM ) || ( ! AN ) ; if ( ! AN ) Bi . x += Bg . x * FXAA_QUALITY_P5 ; if ( ! AN ) Bi . y += Bg . y * FXAA_QUALITY_P5 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",6,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( AO ) { if ( ! AM ) AR = bB ( Ay ( AF , Bh . xy ) ) ; if ( ! AN ) Ba = bB ( Ay ( AF , Bi . xy ) ) ; if ( ! AM ) AR = AR - AS * 0.5 ; if ( ! AN ) Ba = Ba - AS * 0.5 ; AM = abs ( AR ) >= AT ; AN = abs ( Ba ) >= AT ; if ( ! AM ) Bh . x -= Bg . x * FXAA_QUALITY_P6 ; if ( ! AM ) Bh . y -= Bg . y * FXAA_QUALITY_P6 ; AO = ( ! AM ) || ( ! AN ) ; if ( ! AN ) Bi . x += Bg . x * FXAA_QUALITY_P6 ; if ( ! AN ) Bi . y += Bg . y * FXAA_QUALITY_P6 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",7,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( AO ) { if ( ! AM ) AR = bB ( Ay ( AF , Bh . xy ) ) ; if ( ! AN ) Ba = bB ( Ay ( AF , Bi . xy ) ) ; if ( ! AM ) AR = AR - AS * 0.5 ; if ( ! AN ) Ba = Ba - AS * 0.5 ; AM = abs ( AR ) >= AT ; AN = abs ( Ba ) >= AT ; if ( ! AM ) Bh . x -= Bg . x * FXAA_QUALITY_P7 ; if ( ! AM ) Bh . y -= Bg . y * FXAA_QUALITY_P7 ; AO = ( ! AM ) || ( ! AN ) ; if ( ! AN ) Bi . x += Bg . x * FXAA_QUALITY_P7 ; if ( ! AN ) Bi . y += Bg . y * FXAA_QUALITY_P7 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",8,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( AO ) { if ( ! AM ) AR = bB ( Ay ( AF , Bh . xy ) ) ; if ( ! AN ) Ba = bB ( Ay ( AF , Bi . xy ) ) ; if ( ! AM ) AR = AR - AS * 0.5 ; if ( ! AN ) Ba = Ba - AS * 0.5 ; AM = abs ( AR ) >= AT ; AN = abs ( Ba ) >= AT ; if ( ! AM ) Bh . x -= Bg . x * FXAA_QUALITY_P8 ; if ( ! AM ) Bh . y -= Bg . y * FXAA_QUALITY_P8 ; AO = ( ! AM ) || ( ! AN ) ; if ( ! AN ) Bi . x += Bg . x * FXAA_QUALITY_P8 ; if ( ! AN ) Bi . y += Bg . y * FXAA_QUALITY_P8 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",9,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( AO ) { if ( ! AM ) AR = bB ( Ay ( AF , Bh . xy ) ) ; if ( ! AN ) Ba = bB ( Ay ( AF , Bi . xy ) ) ; if ( ! AM ) AR = AR - AS * 0.5 ; if ( ! AN ) Ba = Ba - AS * 0.5 ; AM = abs ( AR ) >= AT ; AN = abs ( Ba ) >= AT ; if ( ! AM ) Bh . x -= Bg . x * FXAA_QUALITY_P9 ; if ( ! AM ) Bh . y -= Bg . y * FXAA_QUALITY_P9 ; AO = ( ! AM ) || ( ! AN ) ; if ( ! AN ) Bi . x += Bg . x * FXAA_QUALITY_P9 ; if ( ! AN ) Bi . y += Bg . y * FXAA_QUALITY_P9 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",10,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( AO ) { if ( ! AM ) AR = bB ( Ay ( AF , Bh . xy ) ) ; if ( ! AN ) Ba = bB ( Ay ( AF , Bi . xy ) ) ; if ( ! AM ) AR = AR - AS * 0.5 ; if ( ! AN ) Ba = Ba - AS * 0.5 ; AM = abs ( AR ) >= AT ; AN = abs ( Ba ) >= AT ; if ( ! AM ) Bh . x -= Bg . x * FXAA_QUALITY_P10 ; if ( ! AM ) Bh . y -= Bg . y * FXAA_QUALITY_P10 ; AO = ( ! AM ) || ( ! AN ) ; if ( ! AN ) Bi . x += Bg . x * FXAA_QUALITY_P10 ; if ( ! AN ) Bi . y += Bg . y * FXAA_QUALITY_P10 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",11,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( AO ) { if ( ! AM ) AR = bB ( Ay ( AF , Bh . xy ) ) ; if ( ! AN ) Ba = bB ( Ay ( AF , Bi . xy ) ) ; if ( ! AM ) AR = AR - AS * 0.5 ; if ( ! AN ) Ba = Ba - AS * 0.5 ; AM = abs ( AR ) >= AT ; AN = abs ( Ba ) >= AT ; if ( ! AM ) Bh . x -= Bg . x * FXAA_QUALITY_P11 ; if ( ! AM ) Bh . y -= Bg . y * FXAA_QUALITY_P11 ; AO = ( ! AM ) || ( ! AN ) ; if ( ! AN ) Bi . x += Bg . x * FXAA_QUALITY_P11 ; if ( ! AN ) Bi . y += Bg . y * FXAA_QUALITY_P11 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",12,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( AO ) { if ( ! AM ) AR = bB ( Ay ( AF , Bh . xy ) ) ; if ( ! AN ) Ba = bB ( Ay ( AF , Bi . xy ) ) ; if ( ! AM ) AR = AR - AS * 0.5 ; if ( ! AN ) Ba = Ba - AS * 0.5 ; AM = abs ( AR ) >= AT ; AN = abs ( Ba ) >= AT ; if ( ! AM ) Bh . x -= Bg . x * FXAA_QUALITY_P12 ; if ( ! AM ) Bh . y -= Bg . y * FXAA_QUALITY_P12 ; AO = ( ! AM ) || ( ! AN ) ; if ( ! AN ) Bi . x += Bg . x * FXAA_QUALITY_P12 ; if ( ! AN ) Bi . y += Bg . y * FXAA_QUALITY_P12 ; }".split(" ")}]}}]},
{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:"} AT = Be . x - Bh . x ; AS = Bi . x - Be . x ; if ( ! AK ) AT = Be . y - Bh . y ; if ( ! AK ) AS = Bi . y - Be . y ; AN = ( AR < 0.0 ) != AL ; AR = ( AS + AT ) ; AL = ( Ba < 0.0 ) != AL ; AR = 1.0 / AR ; AM = AT < AS ; AS = min ( AT , AS ) ; AL = AM ? AN : AL ; AV = AV * AV ; AR = ( AS * ( - AR ) ) + 0.5 ; AV = AV * AH ; AR = AL ? AR : 0.0 ; AV = max ( AR , AV ) ; if ( ! AK ) Be . x += AV * AX ; if ( AK ) Be . y += AV * AX ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_DISCARD",1,{type:"equal_expr",places:2},"FXAA_BLEND4WEB",1,{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return Ay ( AF , Be ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"return vec4 ( Ay ( AF , Be ) . xyz , AP ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["include/depth_fetch.glslf"]={type:"group",parts:[{type:"textline",tokens:"float Bq ( in sampler2D Bk , in vec2 Bl , in vec2 Bm ) { float Bn , Bo , Bp ; Bn = texture2D ( Bk , Bl ) . r ; Bo = Bm . x ; Bp = Bm . y ; Bo = 2.0 * Bo / ( Bo + Bp - ( 2.0 * Bn - 1.0 ) * ( Bp - Bo ) ) ; return Bo ; }".split(" ")}]}};b4w.module.animation=function(a,t){var v=t("__animation"),c=t("__armature"),b=t("__obj_util"),e=t("__print"),d=t("__tsr");a.SLOT_0=v.SLOT_0;a.SLOT_1=v.SLOT_1;a.SLOT_2=v.SLOT_2;a.SLOT_3=v.SLOT_3;a.SLOT_4=v.SLOT_4;a.SLOT_5=v.SLOT_5;a.SLOT_6=v.SLOT_6;a.SLOT_7=v.SLOT_7;a.SLOT_ALL=v.SLOT_ALL;a.OBJ_ANIM_TYPE_NONE=v.OBJ_ANIM_TYPE_NONE;a.OBJ_ANIM_TYPE_ARMATURE=v.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_OBJECT=v.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=v.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=v.OBJ_ANIM_TYPE_SOUND;
a.OBJ_ANIM_TYPE_PARTICLES=v.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_MATERIAL=v.OBJ_ANIM_TYPE_MATERIAL;a.AB_CYCLIC=v.AB_CYCLIC;a.AB_FINISH_RESET=v.AB_FINISH_RESET;a.AB_FINISH_STOP=v.AB_FINISH_STOP;var l=d.create();a.is_animated=function(a){return v.is_animated(a)};a.get_actions=function(){e.error_deprecated("get_actions","get_anim_names");for(var a=[],b=v.get_all_actions(),c=0;c<b.length;c++)a.push(v.strip_baked_suffix(b[c].name));return a};a.get_current_action=function(b,c){e.error_deprecated("get_current_action",
"get_current_anim_name");return a.get_current_anim_name(b,c)};a.get_anim_names=function(a){return v.obj_is_animatable(a)?v.get_anim_names(a):[]};a.get_current_anim_name=function(a,b){if(!v.is_animated(a))return null;b=b||v.SLOT_0;return v.get_anim_by_slot_num(a,b)};a.apply=function(a,b,c){if(c>v.SLOT_7)e.error("Can't apply animation to slot "+c+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{c=c||v.SLOT_0;if(v.is_animated(a)){var d=v.get_slot_num_by_anim(a,b);if(-1!=
d&&d!=c){e.error('Animation "'+b+'" is already applied to object "'+a.name+'" (slot "'+d+'").');return}}v.validate_action_by_name(a,b)?v.apply(a,b,c):e.error('No fcurves in action "'+b+'"')}};a.remove=function(a){v.remove(a)};a.remove_slot_animation=function(a,b){v.is_animated(a)&&(b=b||v.SLOT_0,v.remove_slot_animation(a,b))};a.apply_def=function(a){v.apply_def(a)};a.play=function(a,b,c){v.is_animated(a)?(c=c||v.SLOT_0,v.play(a,b,c),v.update_object_animation(a,0,c,!0)):e.error('Object "'+a.name+'" has no applied animation')};
a.stop=function(a,b){v.is_animated(a)&&(b=b||v.SLOT_0,v.stop(a,b))};a.is_play=function(a,b){if(!v.is_animated(a))return!1;b=b||v.SLOT_0;return v.is_play(a,b)};a.set_current_frame_float=function(b,c,d){e.error_deprecated("set_current_frame_float","set_frame");a.set_frame(b,c,d)};a.get_current_frame_float=function(b,c){e.error_deprecated("get_current_frame_float","use get_frame");return a.get_frame(b,c)};a.set_frame=function(a,b,c){v.is_animated(a)&&(c=c||v.SLOT_0,v.set_frame(a,b,c))};a.set_first_frame=
function(a,b){v.is_animated(a)&&v.set_first_frame(a,b)};a.set_last_frame=function(a,b){if(v.is_animated(a)){b=b||v.SLOT_0;var c=v.get_anim_start_frame(a,b),d=v.get_anim_length(a,b);v.set_frame(a,c+d-v.LAST_FRAME_EPSILON,b)}};a.get_frame=function(a,b){if(!v.is_animated(a))return 0;b=b||v.SLOT_0;return v.get_current_frame_float(a,b)};a.set_speed=function(a,b,c){v.is_animated(a)&&(c=c||v.SLOT_0,v.set_speed(a,b||1,c))};a.get_speed=function(a,b){if(!v.is_animated(a))return 0;b=b||v.SLOT_0;return a.anim_slots[b]?
v.get_speed(a,b):0};a.get_frame_range=function(a,b){e.error_once("get_frame_range() deprecated, use get_anim_start_frame() and get_anim_length() instead");if(v.is_animated(a)){b=b||v.SLOT_0;var c=a.anim_slots[b];if(c)return[c.start,c.start+c.length]}return null};a.get_anim_start_frame=function(a,b){return v.is_animated(a)&&(b=b||v.SLOT_0,a.anim_slots[b])?v.get_anim_start_frame(a,b):-1};a.get_anim_length=function(a,b){return v.is_animated(a)&&(b=b||v.SLOT_0,a.anim_slots[b])?v.get_anim_length(a,b):
-1};a.cyclic=function(b,c,d){e.error_deprecated("cyclic","set_behavior");a.set_behavior(b,c?v.AB_CYCLIC:v.AB_FINISH_RESET,d)};a.is_cyclic=function(a,b){e.error_deprecated("is_cyclic","get_behavior");if(!v.is_animated(a))return!1;b=b||v.SLOT_0;return v.is_cyclic(a,b)};a.set_behavior=function(a,b,c){v.is_animated(a)&&(c=c||v.SLOT_0,v.set_behavior(a,b,c))};a.get_behavior=function(a,b){if(!v.is_animated(a))return null;b=b||v.SLOT_0;return v.get_behavior(a,b)};a.apply_smoothing=function(a,b,c,d){d=d||
v.SLOT_0;v.is_animated(a)&&v.apply_smoothing(a,b,c,d)};a.update_object_animation=function(a,b,c,d){e.error_deprecated("update_object_animation","set_frame");v.is_animated(a)&&(c=c||v.SLOT_0,v.update_object_animation(a,b||0,c,d||!1))};a.frame_to_sec=function(a){return v.frame_to_sec(a)};a.get_bone_translation=function(a,d,g){e.error_deprecated("get_bone_translation","armature.get_bone_tsr");if(!b.is_armature(a))return null;if(!c.check_bone(a,d))return e.error('There is no bone: "',d,'" in "',a.name,
'".'),null;g||(g=new Float32Array(3));c.get_bone_tsr(a,d,!1,!1,l);g[0]=l[0];g[1]=l[1];g[2]=l[2];return g};a.get_first_armature_object=function(a){e.error_once("get_first_armature_object() deprecated");return null};a.get_slot_num_by_anim=function(a,b){return v.is_animated(a)&&b?v.get_slot_num_by_anim(a,b):null};a.get_anim_type=function(a,b){return v.is_animated(a)?v.get_anim_type(a,b):null};a.apply_to_first_empty_slot=function(a,b){return v.apply_to_first_empty_slot(a,b)};a.get_skel_mix_factor=function(a){return a.render.anim_mix_factor};
a.set_skel_mix_factor=function(a,c,d){b.is_armature(a)?(c=Math.min(Math.max(c,0),1),a.render.anim_mix_factor!=c&&v.set_skel_mix_factor(a,c,d||0)):e.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.anchors=function(a,t){var v=t("__anchors");t("__print");a.attach_move_cb=v.attach_move_cb;a.detach_move_cb=v.detach_move_cb;a.is_anchor=v.is_anchor;a.get_element_id=v.get_element_id};b4w.module.armature=function(a,t){var v=t("__armature"),c=t("__obj_util"),b=t("__transform"),e=t("__print");a.get_bone_tsr=function(a,b,n){if(!c.is_armature(a))return null;if(!v.check_bone(a,b))return e.error('There is no bone: "',b,'" in "',a.name,'".'),null;n||(n=new Float32Array(8));v.get_bone_tsr(a,b,!1,!1,n);return n};a.get_bone_tsr_rel=function(a,b,n){if(!c.is_armature(a))return null;if(!v.check_bone(a,b))return e.error('There is no bone: "',b,'" in "',a.name,'".'),null;n||(n=new Float32Array(8));
v.get_bone_tsr(a,b,!1,!0,n);return n};a.set_bone_tsr=function(a,l,n){c.is_armature(a)&&(v.check_bone(a,l)?(v.set_bone_tsr(a,l,n,!1),b.update_transform(a)):e.error('There is no bone: "',l,'" in "',a.name,'".'))};a.set_bone_tsr_rel=function(a,l,n){c.is_armature(a)&&(v.check_bone(a,l)?(v.set_bone_tsr(a,l,n,!0),b.update_transform(a)):e.error('There is no bone: "',l,'" in "',a.name,'".'))}};b4w.module.assets=function(a,t){var v=t("__assets");a.AT_ARRAYBUFFER=v.AT_ARRAYBUFFER;a.AT_JSON=v.AT_JSON;a.AT_TEXT=v.AT_TEXT;a.AT_AUDIOBUFFER=v.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=v.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=v.AT_AUDIO_ELEMENT;a.enqueue=function(a,b,e,d){if(a.length)if(a.id)v.enqueue(a,b,e,d);else{for(var l=[],n=0;n<a.length;n++){var q=a[n];l.push({id:q[0],type:q[1],url:q[2],request:q.request?q.request:"GET",post_type:null,post_data:null,param:q[3]})}v.enqueue(l,b,e,d)}}};b4w.module.camera=function(a,t){function v(a,b){q.error_deprecated("camera.set_pivot","camera.target_set_trans_pivot");c.is_target_camera(a)?(f.copy(b,a.render.pivot),g.update_transform(a),n.sync_transform(a)):q.error("set_pivot(): Wrong object or camera move style")}var c=t("__camera");t("__config");var b=t("__constraints"),e=t("__container");t("__mat3");var d=t("__mat4"),l=t("__obj_util"),n=t("__physics"),q=t("__print"),g=t("__transform"),u=t("__tsr"),k=t("__util"),f=t("__vec3");t("__vec4");var p=
new Float32Array(2),K=new Float32Array(3),D=new Float32Array(3);new Float32Array(4);new Float32Array(9);var A={};a.MS_STATIC=c.MS_STATIC;a.MS_TARGET_CONTROLS=c.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=c.MS_EYE_CONTROLS;a.MS_HOVER_CONTROLS=c.MS_HOVER_CONTROLS;a.static_set_look_at=function(a,b,d){c.is_static_camera(a)?(b=b||u.get_trans_view(a.render.world_tsr),c.set_look_at(a,b,d),g.update_transform(a),n.sync_transform(a)):q.error("static_set_look_at(): Wrong camera object or camera move style")};a.static_set_rotation=
function(a,b){c.is_static_camera(a)?(g.set_rotation(a,b),g.update_transform(a),n.sync_transform(a)):q.error("static_set_rotation(): Wrong camera object or camera move style")};a.static_get_rotation=function(a,b){if(!c.is_static_camera(a))return q.error("static_get_rotation(): Wrong camera object or camera move style"),null;b=b||new Float32Array(4);return g.get_rotation(a,b)};a.eye_set_look_at=function(a,d,e){c.is_eye_camera(a)?(d=d||u.get_trans_view(a.render.world_tsr),c.set_look_at(a,d,e),b.correct_up(a,
k.AXIS_Y,!0),g.update_transform(a),n.sync_transform(a)):q.error("eye_set_look_at(): Wrong camera object or camera move style")};a.eye_rotate=function(a,b,d,e,f){c.is_eye_camera(a)?(c.rotate_eye_camera(a,b,d,e||!1,f||!1),g.update_transform(a),n.sync_transform(a)):q.error("eye_rotate(): Wrong camera object or camera move style")};a.eye_set_vertical_limits=function(a,b){if(c.is_eye_camera(a)){var d=a.render;b?"number"!=typeof b.down||"number"!=typeof b.up?q.error("eye_set_vertical_limits(): Incorrect limits object."):
(d.vertical_limits=d.vertical_limits||{},d.vertical_limits.down=b.down,d.vertical_limits.up=b.up,d.vertical_limits.down_local=b.down,d.vertical_limits.up_local=b.up,d.vertical_limits.camera_space=Boolean(b.camera_space),c.prepare_vertical_limits(a),g.update_transform(a),n.sync_transform(a)):d.vertical_limits=null}else q.error("eye_set_vertical_limits(): Wrong camera object or camera move style")};a.eye_get_vertical_limits=function(a,b){if(!c.is_eye_camera(a))return q.error("eye_get_vertical_limits(): Wrong camera object or camera move style"),
null;var d=a.render;return d.vertical_limits?(b=b||{},d.vertical_limits.camera_space?(b.down=d.vertical_limits.down_local,b.up=d.vertical_limits.up_local):(b.down=d.vertical_limits.down,b.up=d.vertical_limits.up),b.camera_space=d.vertical_limits.camera_space,b):null};a.eye_set_horizontal_limits=function(a,b){if(c.is_eye_camera(a)){var d=a.render;b?"number"!=typeof b.left||"number"!=typeof b.right?q.error("eye_set_horizontal_limits(): Incorrect limits object."):(d.horizontal_limits=d.horizontal_limits||
{},d.horizontal_limits.left=b.left,d.horizontal_limits.right=b.right,d.horizontal_limits.left_local=b.left,d.horizontal_limits.right_local=b.right,d.horizontal_limits.camera_space=Boolean(b.camera_space),c.prepare_horizontal_limits(a),g.update_transform(a),n.sync_transform(a)):d.horizontal_limits=null}else q.error("eye_set_horizontal_limits(): Wrong camera object or camera move style")};a.eye_get_horizontal_limits=function(a,b){if(!c.is_eye_camera(a))return q.error("eye_get_horizontal_limits(): Wrong camera object or camera move style"),
null;var d=a.render;return d.horizontal_limits?(b=b||{},d.horizontal_limits.camera_space?(b.left=d.horizontal_limits.left_local,b.right=d.horizontal_limits.right_local):(b.left=d.horizontal_limits.left,b.right=d.horizontal_limits.right),b.camera_space=d.horizontal_limits.camera_space,b):null};a.target_rotate=function(a,b,d,e,f){c.is_target_camera(a)?(c.rotate_target_camera(a,b,d,e||!1,f||!1),g.update_transform(a),n.sync_transform(a)):q.error("target_rotate(): Wrong camera object or camera move style")};
a.target_set_trans_pivot=function(a,b,d){c.is_target_camera(a)?(b=b||u.get_trans_view(a.render.world_tsr),d=d||a.render.pivot,c.set_trans_pivot(a,b,d),g.update_transform(a),n.sync_transform(a)):q.error("target_set_trans_pivot(): Wrong camera object or camera move style")};a.target_set_distance=function(a,b){if(c.is_target_camera(a)){var d=g.obj_point_distance(a,a.render.pivot),e=Math.max(0,b);g.move_local(a,0,e-d,0);g.update_transform(a);n.sync_transform(a)}else q.error("target_set_distance(): Wrong camera object or camera move style")};
a.target_get_distance=function(a){return c.is_target_camera(a)?g.obj_point_distance(a,a.render.pivot):(q.error("target_get_distance(): Wrong camera object or camera move style"),0)};a.target_zoom_object=function(a,b){if(c.is_target_camera(a)){var d=g.get_object_center(b,!1,K),e=g.get_object_size(b),f=c.get_angular_diameter(a)/2,e=e/Math.sin(f),f=g.obj_point_distance(a,d);c.set_trans_pivot(a,u.get_trans_view(a.render.world_tsr),d);g.update_transform(a);g.move_local(a,0,e-f,0);g.update_transform(a);
n.sync_transform(a)}else q.error("target_zoom_object(): Wrong camera object or camera move style")};a.target_get_pivot=function(a,b){if(!c.is_target_camera(a))return q.error("target_get_pivot(): Wrong camera object or camera move style"),null;b=b||new Float32Array(3);f.copy(a.render.pivot,b);return b};a.target_set_distance_limits=function(a,b){c.is_target_camera(a)?b&&("number"!=typeof b.min||"number"!=typeof b.max||b.min>b.max)?q.error("target_set_distance_limits(): Wrong limits object"):(c.apply_distance_limits(a,
b),g.update_transform(a),n.sync_transform(a)):q.error("target_set_distance_limits(): Wrong camera object or camera move style")};a.target_get_distance_limits=function(a,b){if(!c.is_target_camera(a))return q.error("target_get_distance_limits(): Wrong camera object or camera move style"),null;var d=a.render;return d.distance_limits?(b=b||{},b.min=d.distance_limits.min,b.max=d.distance_limits.max,b):null};a.target_set_vertical_limits=function(a,b){if(c.is_target_camera(a)){var d=a.render;b?"number"!=
typeof b.down||"number"!=typeof b.up?q.error("target_set_vertical_limits(): Wrong limits object"):(d.vertical_limits=d.vertical_limits||{},d.vertical_limits.down=b.down,d.vertical_limits.up=b.up,d.vertical_limits.down_local=b.down,d.vertical_limits.up_local=b.up,d.vertical_limits.camera_space=Boolean(b.camera_space),c.prepare_vertical_limits(a),g.update_transform(a),n.sync_transform(a)):d.vertical_limits=null}else q.error("target_set_vertical_limits(): Wrong camera object or camera move style")};
a.target_get_vertical_limits=function(a,b){if(!c.is_target_camera(a))return q.error("target_get_vertical_limits(): Wrong camera object or camera move style"),null;var d=a.render;return d.vertical_limits?(b=b||{},d.vertical_limits.camera_space?(b.down=d.vertical_limits.down_local,b.up=d.vertical_limits.up_local):(b.down=d.vertical_limits.down,b.up=d.vertical_limits.up),b.camera_space=d.vertical_limits.camera_space,b):null};a.target_set_horizontal_limits=function(a,b){if(c.is_target_camera(a)){var d=
a.render;b?"number"!=typeof b.left||"number"!=typeof b.right?q.error("target_set_horizontal_limits(): Wrong limits object"):(d.horizontal_limits=d.horizontal_limits||{},d.horizontal_limits.left=b.left,d.horizontal_limits.right=b.right,d.horizontal_limits.left_local=b.left,d.horizontal_limits.right_local=b.right,d.horizontal_limits.camera_space=Boolean(b.camera_space),c.prepare_horizontal_limits(a),g.update_transform(a),n.sync_transform(a)):d.horizontal_limits=null}else q.error("target_set_horizontal_limits(): Wrong camera object or camera move style")};
a.target_get_horizontal_limits=function(a,b){if(!c.is_target_camera(a))return q.error("target_get_horizontal_limits(): Wrong camera object or camera move style"),null;var d=a.render;return d.horizontal_limits?(b=b||{},d.horizontal_limits.camera_space?(b.left=d.horizontal_limits.left_local,b.right=d.horizontal_limits.right_local):(b.left=d.horizontal_limits.left,b.right=d.horizontal_limits.right),b.camera_space=d.horizontal_limits.camera_space,b):null};a.hover_rotate=function(a,b,d,e,f){c.is_hover_camera(a)?
(c.rotate_hover_camera(a,b,d,e||!1,f||!1),g.update_transform(a),n.sync_transform(a)):q.error("hover_rotate(): Wrong camera object or camera move style")};a.hover_set_pivot_translation=function(a,b){c.is_hover_camera(a)?(c.set_hover_pivot(a,b),g.update_transform(a),n.sync_transform(a)):q.error("hover_set_pivot_translation(): Wrong camera object or camera move style")};a.hover_get_pivot=function(a,b){if(!c.is_hover_camera(a))return q.error("hover_get_pivot(): Wrong camera object or camera move style"),
null;b=b||new Float32Array(3);f.copy(a.render.hover_pivot,b);return b};a.hover_get_distance=function(a){return c.is_hover_camera(a)?g.obj_point_distance(a,a.render.hover_pivot):(q.error("hover_get_distance(): Wrong camera object or camera move style"),0)};a.hover_set_vertical_limits=function(a,b){c.is_hover_camera(a)?"number"!=typeof b.down||"number"!=typeof b.up||b.down<b.up?q.error("hover_set_vertical_limits(): Wrong limits object"):(c.hover_set_vertical_limits(a,b),g.update_transform(a),n.sync_transform(a)):
q.error("hover_set_vertical_limits(): Wrong camera object or camera move style")};a.hover_get_vertical_limits=function(a,b){if(!c.is_hover_camera(a))return q.error("hover_get_vertical_limits(): Wrong camera object or camera move style"),null;var d=a.render;b=b||{};b.down=d.vertical_limits.down;b.up=d.vertical_limits.up;return b};a.hover_set_distance_limits=function(a,b){c.is_hover_camera(a)?"number"!=typeof b.min||"number"!=typeof b.max||b.min>b.max?q.error("hover_set_distance_limits(): Wrong limits object"):
(c.apply_distance_limits(a,b),g.update_transform(a),n.sync_transform(a)):q.error("hover_set_distance_limits(): Wrong camera object or camera move style")};a.hover_get_distance_limits=function(a,b){if(!c.is_hover_camera(a))return q.error("hover_get_distance_limits(): Wrong camera object or camera move style"),null;var d=a.render;b=b||{};b.min=d.distance_limits.min;b.max=d.distance_limits.max;return b};a.hover_set_vert_trans_limits=function(a,b){if(c.is_hover_camera(a)){var d=a.render;b?"number"!=typeof b.min||
"number"!=typeof b.max||b.min>b.max?q.error("hover_set_vert_trans_limits(): Wrong limits object"):(d.hover_vert_trans_limits=d.hover_vert_trans_limits||{},d.hover_vert_trans_limits.min=b.min,d.hover_vert_trans_limits.max=b.max,g.update_transform(a),n.sync_transform(a)):d.hover_vert_trans_limits=null}else q.error("hover_set_vert_trans_limits(): Wrong camera object or camera move style")};a.hover_get_vert_trans_limits=function(a,b){if(!c.is_hover_camera(a))return q.error("hover_get_vert_trans_limits(): Wrong camera object or camera move style"),
null;var d=a.render;return d.hover_vert_trans_limits?(b=b||{},b.min=d.hover_vert_trans_limits.min,b.max=d.hover_vert_trans_limits.max,b):null};a.hover_set_horiz_trans_limits=function(a,b){if(c.is_hover_camera(a)){var d=a.render;b?"number"!=typeof b.min||"number"!=typeof b.max||b.min>b.max?q.error("hover_set_horiz_trans_limits(): Wrong limits object"):(d.hover_horiz_trans_limits=d.hover_horiz_trans_limits||{},d.hover_horiz_trans_limits.min=b.min,d.hover_horiz_trans_limits.max=b.max,g.update_transform(a),
n.sync_transform(a)):d.hover_horiz_trans_limits=null}else q.error("hover_set_horiz_trans_limits(): Wrong camera object or camera move style")};a.hover_get_horiz_trans_limits=function(a,b){if(!c.is_hover_camera(a))return q.error("hover_get_horiz_trans_limits(): Wrong camera object or camera move style"),null;var d=a.render;return d.hover_horiz_trans_limits?(b=b||{},b.min=d.hover_horiz_trans_limits.min,b.max=d.hover_horiz_trans_limits.max,b):null};a.is_static_camera=c.is_static_camera;a.is_target_camera=
c.is_target_camera;a.is_eye_camera=c.is_eye_camera;a.is_hover_camera=c.is_hover_camera;a.set_move_style=function(a,b){if(!l.is_camera(a))return q.error("set_move_style(): Wrong camera object"),!1;if(b!=c.MS_STATIC&&b!=c.MS_EYE_CONTROLS&&b!=c.MS_TARGET_CONTROLS&&b!=c.MS_HOVER_CONTROLS)return q.error("set_move_style(): Wrong move style"),!1;c.set_move_style(a,b);g.update_transform(a);n.sync_transform(a);return!0};a.get_move_style=function(a){return l.is_camera(a)?c.get_move_style(a):(q.error("get_move_style(): Wrong camera object"),
null)};a.set_translation=function(a,b){if(l.is_camera(a)){var d=a.render;if(c.is_target_camera(a)){var e=u.get_trans_view(d.world_tsr),e=f.subtract(b,e,K);f.add(e,d.pivot,d.pivot)}else c.is_hover_camera(a)&&(e=u.get_trans_view(d.world_tsr),e=f.subtract(b,e,K),f.add(e,d.hover_pivot,d.hover_pivot));g.set_translation(a,b);g.update_transform(a);n.sync_transform(a)}else q.error("set_translation(): Wrong camera object")};a.get_translation=function(a,b){if(!l.is_camera(a))return q.error("get_translation(): Wrong camera object"),
null;b=b||new Float32Array(3);return g.get_translation(a,b)};a.rotate_camera=function(a,b,d,e,f){l.is_camera(a)?(e=e||!1,f=f||!1,c.is_target_camera(a)?c.rotate_target_camera(a,b,d,e,f):c.is_eye_camera(a)?c.rotate_eye_camera(a,b,d,e,f):c.is_hover_camera(a)?c.rotate_hover_camera(a,b,d,e,f):c.is_static_camera(a)||q.error("rotate_camera(): Wrong camera move style"),g.update_transform(a),n.sync_transform(a)):q.error("rotate_camera(): Wrong camera object")};a.set_velocities=function(a,b){if(l.is_camera(a)){var c=
a.render;"number"==typeof b.trans&&(c.velocity_trans=k.clamp(b.trans,0,Infinity));"number"==typeof b.rot&&(c.velocity_rot=k.clamp(b.rot,0,Infinity));"number"==typeof b.zoom&&(c.velocity_zoom=k.clamp(b.zoom,0,1))}else q.error("set_velocities(): Wrong camera object")};a.get_velocities=function(a,b){if(!l.is_camera(a))return q.error("get_velocities(): Wrong camera object"),null;var c=a.render;b=b||{};b.trans=c.velocity_trans;b.rot=c.velocity_rot;b.zoom=c.velocity_zoom;return b};a.is_look_up=function(a){if(!l.is_camera(a))return q.error("is_look_up(): Wrong camera object"),
!1;a=u.get_quat_view(a.render.world_tsr);return 0<=k.quat_to_dir(a,k.AXIS_MY,K)[1]};a.get_camera_angles=function(a,b){if(!l.is_camera(a))return q.error("get_camera_angles(): Wrong camera object"),null;b=b||new Float32Array(2);c.get_camera_angles(a,b);return b};a.get_camera_angles_char=function(a,b){if(!l.is_camera(a))return q.error("get_camera_angles_char(): Wrong camera object"),null;b=b||new Float32Array(2);c.get_camera_angles_char(a,b);return b};a.set_stereo_distance=function(a,b){if(l.is_camera(a))for(var d=
a.render.cameras,e=0;e<d.length;e++){var f=d[e];f.type!=c.TYPE_STEREO_LEFT&&f.type!=c.TYPE_STEREO_RIGHT||c.set_stereo_params(f,b,f.stereo_eye_dist)}else q.error("set_stereo_distance(): Wrong camera object")};a.get_stereo_distance=function(a){if(!l.is_camera(a))return q.error("get_stereo_distance(): Wrong camera object"),0;a=a.render.cameras;for(var b=0;b<a.length;b++){var d=a[b];if(d.type==c.TYPE_STEREO_LEFT||d.type==c.TYPE_STEREO_RIGHT)return d.stereo_conv_dist}return 0};a.translate_view=function(a,
b,e,f){if(l.is_camera(a)){a=a.render.cameras;for(var k=0;k<a.length;k++){var g=a[k];g.reflection_plane||c.set_projection(g,g.aspect);var n=K;n[0]=-b;n[1]=-e;n[2]=0;d.translate(g.proj_matrix,n,g.proj_matrix);d.rotateZ(g.proj_matrix,f,g.proj_matrix);c.calc_view_proj_inverse(g);c.calc_sky_vp_inverse(g)}}else q.error("translate_view(): Wrong camera object")};a.get_fov=function(a){return l.is_camera(a)?k.rad(a.render.cameras[0].fov):(q.error("get_fov(): Wrong camera object"),0)};a.set_fov=function(a,b){if(l.is_camera(a))for(var d=
a.render.cameras,e=0;e<d.length;e++){var f=d[e];f.fov=k.deg(b);f.reflection_plane||c.set_projection(f,f.aspect);c.calc_view_proj_inverse(f);c.calc_sky_vp_inverse(f)}else q.error("set_fov(): Wrong camera object")};a.correct_up=function(a,c){l.is_camera(a)?(c=c||k.AXIS_Y,b.correct_up(a,c),g.update_transform(a),n.sync_transform(a)):q.error("correct_up(): Wrong camera object")};a.set_ortho_scale=function(a,b){if(l.is_camera(a)&&c.is_ortho_camera(a)){var d=a.render;if(c.is_target_camera(a)){var e=u.get_trans_view(d.world_tsr),
e=f.dist(e,d.pivot);d.init_top=b/2*d.init_dist/e}else c.is_hover_camera(a)?(e=u.get_trans_view(d.world_tsr),e=f.distance(e,d.hover_pivot),d.init_top=b/2*d.init_dist/e):a.render.cameras[0].top=b/2;c.update_ortho_scale(a)}else q.error("set_ortho_scale(): Wrong camera object")};a.get_ortho_scale=function(a){return l.is_camera(a)&&c.is_ortho_camera(a)?2*a.render.cameras[0].top:(q.error("get_ortho_scale(): Wrong camera object"),0)};a.is_ortho_camera=function(a){return l.is_camera(a)?c.is_ortho_camera(a):
(q.error("is_ortho_camera(): Wrong camera object"),!1)};a.calc_ray=function(a,b,d,k){if(!l.is_camera(a))return q.error("calc_ray(): Wrong camera object"),null;k=k||new Float32Array(3);var g=a.render.cameras[0];switch(g.type){case c.TYPE_PERSP:case c.TYPE_PERSP_ASPECT:case c.TYPE_STEREO_LEFT:case c.TYPE_STEREO_RIGHT:var n=Math.tan(g.fov*Math.PI/360),t=n*g.aspect;b=e.canvas_to_viewport_coords(b,d,p,g);K[0]=(2*b[0]/g.width-1)*t;K[1]=-1;K[2]=(2*b[1]/g.height-1)*n;u.transform_dir_vec3(K,a.render.world_tsr,
K);k[0]=K[0];k[1]=K[1];k[2]=K[2];f.normalize(k,k);return k;default:return q.error("calc_ray(): Non-compatible camera"),k}};a.project_point=function(a,b,d){if(!l.is_camera(a))return q.error("project_point(): Wrong camera object"),null;d=d||new Float32Array(2);return c.project_point(a,b,d)};a.has_distance_limits=function(a){return c.is_target_camera(a)||c.is_hover_camera(a)?null!==a.render.distance_limits:(q.error("has_distance_limits(): wrong object"),!1)};a.has_vertical_limits=function(a){return c.is_target_camera(a)||
c.is_eye_camera(a)?null!==a.render.vertical_limits:(q.error("has_vertical_limits(): Wrong camera object"),!1)};a.has_horizontal_limits=function(a){return c.is_target_camera(a)||c.is_eye_camera(a)?null!==a.render.horizontal_limits:(q.error("has_horizontal_limits(): Wrong camera object"),!1)};a.move_pivot=function(a,b,d){if(c.is_target_camera(a)){var e=a.render;if(e.use_panning){var k=u.get_trans_view(e.world_tsr),k=f.subtract(k,e.pivot,D);K[0]=b;K[1]=0;K[2]=d;f.scale(K,f.len(k),K);u.transform_dir_vec3(K,
e.world_tsr,K);f.add(e.pivot,K,e.pivot);k=u.get_trans_view(e.world_tsr);f.add(k,K,k);g.update_transform(a);n.sync_transform(a)}}else q.error("move_pivot(): wrong object")};a.set_velocity_params=function(a,b){q.error_deprecated("set_velocity_params","set_velocities");if(l.is_camera(a)){var c=a.render;c.velocity_trans=k.clamp(b[0],0,Infinity);c.velocity_rot=k.clamp(b[1],0,Infinity);c.velocity_zoom=k.clamp(b[2],0,1)}else q.error("set_velocity_params(): Wrong camera object")};a.get_velocity_params=function(a,
b){q.error_deprecated("get_velocity_params","get_velocities");if(!l.is_camera(a))return q.error("get_velocity_params(): Wrong camera object"),null;b=b||new Float32Array(3);var c=a.render;b[0]=c.velocity_trans;b[1]=c.velocity_rot;b[2]=c.velocity_zoom;return b};a.clear_horizontal_limits=function(a){q.error_once('camera.clear_horizontal_limits() deprecated, use camera.target_set_horizontal_limits(), camera.eye_set_horizontal_limits() or camera.hover_set_horiz_trans_limits() with passing NULL as the "limits" argument.');
l.is_camera(a)?c.is_target_camera(a)||c.is_eye_camera(a)?a.render.horizontal_limits=null:c.is_hover_camera(a)&&(a.render.hover_horiz_trans_limits=null):q.error("clear_horizontal_limits(): Wrong camera object")};a.clear_vertical_limits=function(a){q.error_once('camera.clear_vertical_limits() deprecated, use camera.target_set_vertical_limits(), camera.eye_set_vertical_limits() or camera.hover_set_vert_trans_limits() with passing NULL as the "limits" argument.');l.is_camera(a)?c.is_target_camera(a)||
c.is_eye_camera(a)?a.render.vertical_limits=null:c.is_hover_camera(a)&&(a.render.hover_vert_trans_limits=null):q.error("clear_vertical_limits(): Wrong camera object")};a.clear_hover_angle_limits=function(a){q.error_once("camera.clear_hover_angle_limits() deprecated, HOVER camera always has hover angle limits")};a.set_look_at=function(a,d,e,f){q.error_deprecated_arr("camera.set_look_at",["camera.static_set_look_at","camera.eye_set_look_at"]);f=f||k.AXIS_Y;c.set_look_at(a,d,e);b.correct_up(a,f,!0);
g.update_transform(a);n.sync_transform(a)};a.rotate_eye_camera=function(a,b,d,e,f){q.error_deprecated_arr("camera.rotate_eye_camera",["camera.eye_rotate","camera.rotate_camera"]);c.is_eye_camera(a)?(c.rotate_eye_camera(a,b,d,e,f),g.update_transform(a),n.sync_transform(a)):q.error("rotate_eye_camera(): wrong object")};a.rotate_target_camera=function(a,b,d,e,f){q.error_deprecated_arr("camera.rotate_target_camera",["camera.target_rotate","camera.rotate_camera"]);c.is_target_camera(a)?(c.rotate_target_camera(a,
b,d,e,f),g.update_transform(a),n.sync_transform(a)):q.error("rotate_target_camera(): wrong object")};a.set_trans_pivot=function(a,b,d){q.error_deprecated("camera.set_trans_pivot","camera.target_set_trans_pivot");c.is_target_camera(a)?(c.set_trans_pivot(a,b,d),g.update_transform(a),n.sync_transform(a)):q.error("set_trans_pivot(): Wrong object or camera move style")};a.zoom_object=function(a,b){q.error_deprecated("camera.zoom_object","camera.target_zoom_object");if(c.is_target_camera(a)){g.get_object_center(b,
!1,K);v(a,K);g.update_transform(a);var d=g.get_object_size(b),e=c.get_angular_diameter(a)/2,d=d/Math.sin(e),e=g.obj_point_distance(a,K);g.move_local(a,0,d-e,0);g.update_transform(a);n.sync_transform(a)}else q.error("zoom_object(): wrong object")};a.set_pivot=v;a.rotate_hover_camera=function(a,b,d,e,f){q.error_deprecated("camera.rotate_hover_camera","camera.hover_rotate");c.is_hover_camera(a)?(c.rotate_hover_camera(a,b,d,e,f),g.update_transform(a),n.sync_transform(a)):q.error("rotate_hover_camera(): wrong object")};
a.get_hover_cam_pivot=function(a,b){q.error_deprecated("camera.get_hover_cam_pivot","camera.hover_get_pivot");if(!c.is_hover_camera(a))return q.error("get_hover_cam_pivot(): wrong object"),null;b||(b=new Float32Array(3));f.copy(a.render.hover_pivot,b);return b};a.get_eye=function(a,b){q.error_deprecated("camera.get_eye","camera.get_translation");return l.is_camera(a)?c.get_eye(a,b):(q.error("get_eye(): Wrong object"),null)};a.get_pivot=function(a,b){q.error_deprecated("camera.get_pivot","camera.target_get_pivot");
if(!c.is_target_camera(a))return q.error("get_pivot(): Wrong object or camera move style"),null;b||(b=new Float32Array(3));f.copy(a.render.pivot,b);return b};a.hover_cam_set_translation=function(a,b){q.error_deprecated("camera.hover_cam_set_translation","camera.set_translation");if(c.is_hover_camera(a)){var d=a.render,e=u.get_trans_view(d.world_tsr),e=f.subtract(b,e,K);f.add(e,d.hover_pivot,d.hover_pivot);g.set_translation(a,b);g.update_transform(a);n.sync_transform(a)}else q.error("hover_cam_set_translation(): wrong object")};
a.set_hover_pivot=function(a,b){q.error_deprecated("camera.set_hover_pivot","camera.hover_set_pivot_translation");c.is_hover_camera(a)?(c.set_hover_pivot(a,b),g.update_transform(a),n.sync_transform(a)):q.error("set_hover_pivot(): Wrong object or camera move style")};a.get_hover_angle_limits=function(a,b){q.error_deprecated("camera.get_hover_angle_limits","camera.hover_get_vertical_limits");if(!c.is_hover_camera(a))return q.error("get_hover_angle_limits(): wrong object"),null;b=b||new Float32Array(2);
b[0]=a.render.vertical_limits.down;b[1]=a.render.vertical_limits.up;return b};a.get_cam_dist_limits=function(a,b){q.error_deprecated_arr("camera.get_cam_dist_limits",["camera.hover_get_distance_limits","camera.target_get_distance_limits"]);if(!c.is_hover_camera(a)&&!c.is_target_camera(a))return q.error("get_cam_dist_limits(): wrong object"),null;if(a.render.distance_limits)b=b||new Float32Array(2),b[0]=a.render.distance_limits.max,b[1]=a.render.distance_limits.min;else return null;return b};a.apply_vertical_limits=
function(b,d,e,f){q.error_deprecated_arr("camera.apply_vertical_limits",["camera.eye_set_vertical_limits","camera.target_set_vertical_limits","camera.hover_set_vert_trans_limits"]);if(c.is_target_camera(b)){var k=A;k.down=d;k.up=e;k.camera_space=f==g.SPACE_LOCAL;a.target_set_vertical_limits(b,k)}else c.is_eye_camera(b)?(k=A,k.down=d,k.up=e,k.camera_space=f==g.SPACE_LOCAL,a.eye_set_vertical_limits(b,k)):c.is_hover_camera(b)?(k=A,k.min=d,k.max=e,a.hover_set_vert_trans_limits(b,k)):q.error("apply_vertical_limits(): wrong object")};
a.apply_hover_angle_limits=function(b,c,d){q.error_deprecated("camera.apply_hover_angle_limits","camera.hover_set_vertical_limits");A.down=c;A.up=d;a.hover_set_vertical_limits(b,A)};a.apply_distance_limits=function(b,d,e){q.error_deprecated_arr("camera.apply_distance_limits",["camera.target_set_distance_limits","camera.hover_set_distance_limits"]);if(c.is_target_camera(b)){var f=A;f.min=d;f.max=e;a.target_set_distance_limits(b,f)}else c.is_hover_camera(b)?(f=A,f.min=d,f.max=e,a.hover_set_distance_limits(b,
f)):q.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(b){q.error_deprecated("camera.clear_distance_limits","camera.target_set_distance_limits");a.target_set_distance_limits(b,null)};a.get_vertical_limits=function(a,b){q.error_deprecated_arr("camera.get_vertical_limits",["camera.eye_get_vertical_limits","camera.target_get_vertical_limits","camera.hover_get_vert_trans_limits"]);if(!c.is_target_camera(a)&&!c.is_eye_camera(a)&&!c.is_hover_camera(a))return q.error("get_vertical_limits(): wrong object"),
null;var d=a.render;b=b||new Float32Array(2);if(c.is_eye_camera(a)||c.is_target_camera(a)){if(d.vertical_limits)return b[0]=d.vertical_limits.down,b[1]=d.vertical_limits.up,b}else if(c.is_hover_camera(a)&&d.hover_vert_trans_limits)return b[0]=d.hover_vert_trans_limits.min,b[1]=d.hover_vert_trans_limits.max,b;return null};a.apply_horizontal_limits=function(b,d,e,f){q.error_deprecated_arr("camera.apply_horizontal_limits",["camera.eye_set_horizontal_limits","camera.target_set_horizontal_limits","camera.hover_set_horiz_trans_limits"]);
if(c.is_target_camera(b)){var k=A;k.left=d;k.right=e;k.camera_space=f==g.SPACE_LOCAL;a.target_set_horizontal_limits(b,k)}else c.is_eye_camera(b)?(k=A,k.left=d,k.right=e,k.camera_space=f==g.SPACE_LOCAL,a.eye_set_horizontal_limits(b,k)):c.is_hover_camera(b)?(k=A,k.min=d,k.max=e,a.hover_set_horiz_trans_limits(b,k)):q.error("apply_horizontal_limits(): wrong object")};a.get_horizontal_limits=function(a,b){q.error_deprecated_arr("camera.get_horizontal_limits",["camera.eye_get_horizontal_limits","camera.target_get_horizontal_limits",
"camera.hover_get_horiz_trans_limits"]);if(!c.is_target_camera(a)&&!c.is_eye_camera(a)&&!c.is_hover_camera(a))return q.error("get_horizontal_limits(): wrong object"),null;var d=a.render;b=b||new Float32Array(2);if(c.is_eye_camera(a)||c.is_target_camera(a)){if(d.horizontal_limits)return b[0]=d.horizontal_limits.left,b[1]=d.horizontal_limits.right,b}else if(c.is_hover_camera(a)&&d.hover_horiz_trans_limits)return b[0]=d.hover_horiz_trans_limits.min,b[1]=d.hover_horiz_trans_limits.max,b;return null}};b4w.module.config=function(a,t){var v=t("__config");a.P_LOW=v.P_LOW;a.P_HIGH=v.P_HIGH;a.P_ULTRA=v.P_ULTRA;a.P_CUSTOM=v.P_CUSTOM;a.set=v.set;a.get=v.get;a.reset=v.reset;a.get_std_assets_path=v.get_std_assets_path};b4w.module.controls=function(a,t){var v=t("__controls"),c=t("__print");a.CT_CONTINUOUS=v.CT_CONTINUOUS;a.CT_TRIGGER=v.CT_TRIGGER;a.CT_SHOT=v.CT_SHOT;a.CT_LEVEL=v.CT_LEVEL;a.CT_CHANGE=v.CT_CHANGE;a.KEY_BACKSPACE=8;a.KEY_TAB=9;a.KEY_ENTER=13;a.KEY_SHIFT=16;a.KEY_CTRL=17;a.KEY_ALT=18;a.KEY_PAUSE=19;a.KEY_CAPSLOCK=20;a.KEY_ESC=27;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;a.KEY_8=56;a.KEY_9=57;a.KEY_A=
65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;a.KEY_NUM9=105;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=187;a.KEY_COMMA=188;
a.KEY_DASH=189;a.KEY_PERIOD=190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=221;a.KEY_SINGLE_QUOTE=222;a.PL_SINGLE_TOUCH_MOVE=v.PL_SINGLE_TOUCH_MOVE;a.PL_MULTITOUCH_MOVE_ZOOM=v.PL_MULTITOUCH_MOVE_ZOOM;a.PL_MULTITOUCH_MOVE_PAN=v.PL_MULTITOUCH_MOVE_PAN;a.create_custom_sensor=v.create_custom_sensor;a.create_keyboard_sensor=v.create_keyboard_sensor;a.create_collision_sensor=function(a,c,d){return v.create_collision_sensor(a,c||"ANY",
d||!1)};a.create_collision_impulse_sensor=v.create_collision_impulse_sensor;a.create_ray_sensor=function(a,c,d,l,n,q,g){return v.create_ray_sensor(a,c,d,l||"ANY",n||!1,q||!1,g||!1)};a.create_mouse_click_sensor=v.create_mouse_click_sensor;a.create_mouse_wheel_sensor=v.create_mouse_wheel_sensor;a.create_mouse_move_sensor=v.create_mouse_move_sensor;a.create_touch_move_sensor=v.create_touch_move_sensor;a.create_touch_zoom_sensor=v.create_touch_zoom_sensor;a.create_motion_sensor=v.create_motion_sensor;
a.create_vertical_velocity_sensor=v.create_vertical_velocity_sensor;a.create_gyro_angles_sensor=v.create_gyro_angles_sensor;a.create_gyro_delta_sensor=v.create_gyro_delta_sensor;a.create_timer_sensor=function(a,c){return v.create_timer_sensor(a,c||!1)};a.reset_timer_sensor=v.reset_timer_sensor;a.create_elapsed_sensor=v.create_elapsed_sensor;a.create_timeline_sensor=v.create_timeline_sensor;a.create_selection_sensor=function(a,c){return v.create_selection_sensor(a,c||!1)};a.set_custom_sensor=function(a,
c){v.sensor_set_value(a,c)};a.get_custom_sensor=function(a){return a.value};a.get_sensor_value=v.get_sensor_value;a.get_sensor_payload=v.get_sensor_payload;a.create_sensor_manifold=function(a,c,d,l,n,q,g){n=n||v.default_AND_logic_fun;v.create_sensor_manifold(a,c,d,l,n,q,void 0===g?null:g)};a.create_kb_sensor_manifold=function(a,c,d,l,n,q){l=v.create_keyboard_sensor(l);v.create_sensor_manifold(a,c,d,[l],v.default_AND_logic_fun,n,void 0===q?null:q)};a.check_sensor_manifolds=function(a){return v.check_sensor_manifold(a,
null)};a.check_sensor_manifold=v.check_sensor_manifold;a.remove_sensor_manifolds=function(a){c.error_deprecated("remove_sensor_manifolds","remove_sensor_manifold");v.remove_sensor_manifold(a,null)};a.remove_sensor_manifold=v.remove_sensor_manifold;a.reset=v.reset;a.register_keyboard_events=v.register_keyboard_events;a.register_mouse_events=function(a,c,d){v.register_mouse_events(a,c,!!d)};a.register_wheel_events=v.register_wheel_events;a.register_touch_events=v.register_touch_events;a.register_device_orientation=
v.register_device_orientation;a.unregister_keyboard_events=v.unregister_keyboard_events;a.unregister_mouse_events=v.unregister_mouse_events;a.unregister_wheel_events=v.unregister_wheel_events;a.unregister_touch_events=v.unregister_touch_events;a.unregister_device_orientation=v.unregister_device_orientation};b4w.module.constraints=function(a,t){var v=t("__camera"),c=t("__constraints"),b=t("__obj_util"),e=t("__physics"),d=t("__print"),l=t("__transform");a.append_stiff=function(a,b,d,u,k){k=k||1;b instanceof Array&&2==b.length?c.append_stiff_bone(a,b[0],b[1],d,u,k):c.append_stiff_obj(a,b,d,u,k);l.update_transform(a);e.sync_transform(a)};a.append_semi_stiff=function(a,b,d,u){c.append_semi_stiff_obj(a,b,d,u);l.update_transform(a);e.sync_transform(a)};a.append_semi_stiff_cam=function(a,b,g,u,k,f,p,t){v.is_eye_camera(a)?
(c.append_semi_stiff_cam_obj(a,b,g,u,k,f,p,t),l.update_transform(a),e.sync_transform(a)):d.error("append_semi_stiff_cam(): wrong object type, only EYE camera objects can be parented.")};a.append_semi_soft_cam=function(a,b,g,u){if(v.is_eye_camera(a)){if(!u||0>u)u=.25;c.append_semi_soft_cam_obj(a,b,g,u);l.update_transform(a);e.sync_transform(a)}else d.error("append_semi_soft_cam(): wrong object type, only EYE camera objects can be parented.")};a.append_stiff_trans=function(a,b,d){c.append_stiff_trans_obj(a,
b,d);l.update_transform(a);e.sync_transform(a)};a.append_copy_trans=function(a,b,d){c.append_copy_trans_obj(a,b,d);l.update_transform(a);e.sync_transform(a)};a.append_stiff_trans_rot=function(a,b,d,u){c.append_stiff_trans_rot_obj(a,b,d,u,1);l.update_transform(a);e.sync_transform(a)};a.append_track=function(a,b){3==b.length?c.append_track_point(a,b):c.append_track_obj(a,b);l.update_transform(a);e.sync_transform(a)};a.append_follow=function(a,b,d,u){3==b.length?c.append_follow_point(a,b,d,u):c.append_follow_obj(a,
b,d,u);l.update_transform(a);e.sync_transform(a)};a.append_stiff_viewport=function(a,b,d){c.append_stiff_viewport(a,b,d);l.update_transform(a);e.sync_transform(a)};a.remove=function(a){a.constraint&&c.remove(a)};a.get_parent=function(a){d.error_deprecated("constraints.get_parent","objects.get_parent");return b.get_parent(a)}};b4w.module.container=function(a,t){var v=t("__container"),c=t("__print");a.get_canvas=v.get_canvas;a.get_canvas_hud=v.get_canvas_hud;a.get_container=v.get_container;a.insert_to_container=function(a,e){2!=arguments.length?c.error("insert_to_container(): two arguments required"):a&&e&&v.insert_to_container(a,e)};a.set_canvas_offsets=v.set_canvas_offsets;a.update_canvas_offsets=v.update_canvas_offsets;a.client_to_canvas_coords=v.client_to_canvas_coords;a.force_offsets_updating=v.force_offsets_updating;
a.resize=function(a,e,d){a&&e||c.warn("Wrong canvas container dimensions: "+a+"x"+e+". Zero dimensions aren't allowed. Resized to: "+v.DEFAULT_CANVAS_W+"x"+v.DEFAULT_CANVAS_H+".");v.resize(a,e,d)}};b4w.module.data=function(a,t){var v=t("__data");t("__print");t("__util");a.load=v.load;a.unload=function(a){v.unload(a|0)};a.set_debug_resources_root=v.set_debug_resources_root;a.is_primary_loaded=v.is_primary_loaded;a.load_and_add_new=v.load;a.cleanup=a.unload};b4w.module.debug=function(a,t){function v(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(new RegExp(/^[A-Z.]+ /))){var e=d.split(" ")[0];e in b||(b[e]=0);b[e]++}}c=a=0;for(e in b)switch(e){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[e];break;default:a+=b[e]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function c(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);c.send(b);
if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function b(a){a.sort(function(a,b){return b.fstats.ALU_OPS-a.fstats.ALU_OPS});for(var b=0;b<a.length;b++){var c=a[b],d=c.fstats,k=c.vstats,g=e(c.cshader),g=g?"\t\t("+g.join(", ")+")":"\t\t(NA)";f.groupCollapsed("FRAG --\x3e","ALU",d.ALU_OPS,"TEX",d.TEX_OPS,"\t\tVERT --\x3e","ALU",k.ALU_OPS,"TEX",k.TEX_OPS,g);f.groupCollapsed("directives");for(var g=c.shaders_info.directives,h=0;h<g.length;h++){var l=g[h];f.log(l[0],l[1])}f.groupEnd();
f.groupCollapsed("vert src");f.log(c.vsrc);f.groupEnd();f.groupCollapsed("vert stats");for(var n in k)"ALU_OPS"!=n&&"TEX_OPS"!=n&&f.log(n,k[n]);f.groupEnd();f.groupCollapsed("frag src");f.log(c.fsrc);f.groupEnd();f.groupCollapsed("frag stats");for(n in d)"ALU_OPS"!=n&&"TEX_OPS"!=n&&f.log(n,d[n]);f.groupEnd();f.groupEnd()}}function e(a){for(var b=p.get_all_scenes(),c=0;c<b.length;c++)for(var d=b[c],e=g.get_scene_objs(d,"MESH",g.DATA_ID_ALL),f=0;f<e.length;f++){var k=u.get_scene_data(e[f],d);if(k&&
k.batches.length)for(var k=k.batches,h=0;h<k.length;h++){var l=k[h];if(l.shader==a&&l.material_names.length)return l.material_names}}return null}t("__batch");t("__config");var d=t("__controls"),l=t("__debug"),n=t("__extensions"),q=t("__loader"),g=t("__objects"),u=t("__obj_util"),k=t("__physics"),f=t("__print"),p=t("__scenes"),K=t("__scenegraph"),D=t("__sfx"),A=t("__shaders"),h=t("__textures"),x=t("__util"),w=t("vec3");a.WM_NONE=l.WM_NONE;a.WM_OPAQUE_WIREFRAME=l.WM_OPAQUE_WIREFRAME;a.WM_TRANSPARENT_WIREFRAME=
l.WM_TRANSPARENT_WIREFRAME;a.WM_FRONT_BACK_VIEW=l.WM_FRONT_BACK_VIEW;a.WM_DEBUG_SPHERES=l.WM_DEBUG_SPHERES;a.physics_stats=function(){k.debug_workers()};a.physics_id=function(a){f.log("O",k.find_obj_by_body_id(a));for(var b=k.get_active_scene()._physics.bundles,c=0;c<b.length;c++){var d=b[c];d.physics.body_id==a&&f.log("B",d)}};a.visible_objects=function(){for(var a=p.get_active(),b=g.get_scene_objs(a,"MESH",g.DATA_ID_ALL),a=[p.get_subs(a,"MAIN_OPAQUE"),p.get_subs(a,"MAIN_BLEND")],c=0;c<a.length;c++){var d=
a[c],e=d.bundles;if(e.length){f.group(d.type,"DYNAMIC");for(var k=0;k<b.length;k++){var h=b[k],l=h.render;if("DYNAMIC"==l.type)for(var n=0;n<e.length;n++){var q=e[n];if(q.do_render&&q.obj_render==l){f.log_raw(h.name,h);break}}}f.groupEnd();f.groupCollapsed(d.type,"STATIC");for(k=0;k<b.length;k++)if(h=b[k],l=h.render,"DYNAMIC"!=l.type)for(n=0;n<e.length;n++)if(q=e[n],q.do_render&&q.obj_render==l){f.log_raw(h.name,h);break}f.groupEnd()}}};a.object_info=function(a){for(var b=p.get_active(),c=g.get_scene_objs(b,
"MESH",g.DATA_ID_ALL),d=0;d<c.length;d++){var e=c[d];if(e.name==a){f.log("Object",e);for(var k=p.get_all_subscenes(b),h=0;h<k.length;h++){for(var l=k[h],n=l.bundles,q=[],u=0;u<n.length;u++)n[u].obj_render==e.render&&q.push(n[u]);f.log("Subscene "+l.type,q)}}}};a.objects_stat=function(){var a=p.get_active();console.log("Armatures: "+g.get_scene_objs(a,"ARMATURE",g.DATA_ID_ALL).length);console.log("Cameras: "+g.get_scene_objs(a,"CAMERA",g.DATA_ID_ALL).length);console.log("Curves: "+g.get_scene_objs(a,
"CURVE",g.DATA_ID_ALL).length);console.log("Empties: "+g.get_scene_objs(a,"EMPTY",g.DATA_ID_ALL).length);console.log("Lamps: "+g.get_scene_objs(a,"LAMP",g.DATA_ID_ALL).length);console.log("Meshes: "+g.get_scene_objs(a,"MESH",g.DATA_ID_ALL).length);console.log("Speakers: "+g.get_scene_objs(a,"SPEAKER",g.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=0,b=p.get_active(),b=[p.get_subs(b,"MAIN_OPAQUE"),p.get_subs(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.bundles,e=0;e<
d.length;e++){var f=d[e].batch;f&&(a+=f.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=p.get_active(),b=[p.get_subs(b,"MAIN_OPAQUE"),p.get_subs(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.bundles,e=0;e<d.length;e++){var f=d[e].batch;f&&(a+=f.num_triangles)}}return a};a.num_draw_calls=function(){for(var a=p.get_active(),b=[p.get_subs(a,"MAIN_OPAQUE"),p.get_subs(a,"MAIN_BLEND")],b=b[0].bundles.length+b[1].bundles.length,a=p.subs_array(a,["MAIN_PLANE_REFLECT",
"MAIN_CUBE_REFLECT"]),c=0;c<a.length;c++)var d=a[c],b="MAIN_PLANE_REFLECT"==d.type?b+d.bundles.length:b+6*d.bundles.length;return b};a.num_shaders=function(){var a=A.get_compiled_shaders();return x.get_dict_length(a)};a.geometry_stats=function(){for(var a=p.get_active(),b=p.get_all_subscenes(a),a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var e=d.bundles,f=0;f<e.length;f++){var k=e[f].batch,g=e[f].obj_render;k&&("COLOR_PICKING"!=d.type&&"OUTLINE_MASK"!=d.type||g.origin_selectable||
g.origin_outlining)&&(a[k.id]=k)}}var e=d=c=b=0,h;for(h in a)k=a[h],k=k.bufs_data,k.debug_ibo_bytes&&(d++,e+=k.debug_ibo_bytes/1048576),b++,c+=k.debug_vbo_bytes/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:e}};a.num_textures=function(){for(var a=[],b=0,c=p.get_active(),c=[p.get_subs(c,"MAIN_OPAQUE"),p.get_subs(c,"MAIN_BLEND")],d=0;d<c.length;d++){var e=c[d];if(e)for(var e=e.bundles,f=0;f<e.length;f++){var k=e[f].batch;if(k)for(var k=k.textures,g=0;g<k.length;g++){var h=k[g];if("IMAGE"===
h.source||"ENVIRONMENT_MAP"===h.source){var l=h.w_texture;-1===a.indexOf(l)&&(a.push(l),h=h.width*h.height*4/1048576/h.compress_ratio,h*=1.3333,b+=h)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=p.get_active(),c=p.get_all_subscenes(c),d=0;d<c.length;d++){var e=c[d];if("SINK"!=e.type){var f=e.camera,k=[f.color_attachment,f.depth_attachment];k.push.apply(k,e.textures_internal);for(e=0;e<k.length;e++){var g=k[e];h.is_texture(g)&&-1==a.indexOf(g)&&(a.push(g),
b+=f.width*f.height*h.get_texture_texel_size(g))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=p.get_active();(a=p.get_subs(a,"MAIN_OPAQUE"))&&p.make_frustum_shot(a.camera,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=p.get_active(),b=p.get_subs(a,"MAIN_OPAQUE"),a=p.subs_array(a,["SHADOW_CAST"]);if(b)for(var c=0;c<a.length;c++){var d=a[c],e;switch(c){case 0:e=[1,0,0];break;case 1:e=[0,1,0];break;case 2:e=[0,0,1];break;default:e=[1,0,1]}p.make_frustum_shot(d.camera,
b,e)}};a.scenegraph_to_dot=function(){for(var a=p.get_all_scenes(),b=0;b<a.length;b++){var c=p.get_graph(a[b]);f.log("\n"+K.debug_convert_to_dot(c))}};a.scenes_to_dot=function(){};a.loading_graph_to_dot=function(a){f.log("\n"+q.graph_to_dot(a|0))};a.controls_info=d.debug;a.object_distance=function(a,b){var c=m_tsr.get_trans_view(a.render.world_tsr),d=m_tsr.get_trans_view(b.render.world_tsr);return w.dist(c,d)};a.msg=l.msg;a.fbmsg=l.fbmsg;a.print_telemetry=l.print_telemetry;a.plot_telemetry=l.plot_telemetry;
a.fbres=function(a,b){b||(b=16);var c=function(){l.fbmsg("FBRES",a());setTimeout(c,b)};c()};a.assert_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),e=new Float32Array([0,0,1]),f=new Float32Array([-1,0,0]),k=new Float32Array([0,-1,0]),g=new Float32Array([0,0,-1]);if(!x.cmp_arr(a,x.VEC3_IDENT))throw"Wrong VEC3_IDENT";if(!x.cmp_arr(b,x.QUAT4_IDENT))throw"Wrong QUAT4_IDENT";if(!x.cmp_arr(c,x.AXIS_X))throw"Wrong AXIS_X";
if(!x.cmp_arr(d,x.AXIS_Y))throw"Wrong AXIS_Y";if(!x.cmp_arr(e,x.AXIS_Z))throw"Wrong AXIS_Z";if(!x.cmp_arr(f,x.AXIS_MX))throw"Wrong AXIS_MX";if(!x.cmp_arr(k,x.AXIS_MY))throw"Wrong AXIS_MY";if(!x.cmp_arr(g,x.AXIS_MZ))throw"Wrong AXIS_MZ";};a.mute_music=function(){for(var a=D.get_speaker_objects(),b=0;b<a.length;b++){var c=a[b];"BACKGROUND_MUSIC"==D.get_spk_behavior(c)&&D.mute(c,!0)}};a.check_finite=function(a){l.check_finite(a)};a.set_debug_params=function(a){var b=p.get_active();if(b=p.get_subs(b,
"WIREFRAME")){if("number"==typeof a.wireframe_mode)switch(a.wireframe_mode){case l.WM_NONE:case l.WM_OPAQUE_WIREFRAME:case l.WM_TRANSPARENT_WIREFRAME:case l.WM_FRONT_BACK_VIEW:case l.WM_DEBUG_SPHERES:p.set_wireframe_mode(b,a.wireframe_mode);break;default:f.error("set_debug_params(): Wrong wireframe mode")}"object"==typeof a.wireframe_edge_color&&p.set_wireframe_edge_color(b,a.wireframe_edge_color)}else throw"Wireframe subscene not found.";};a.get_error_quantity=function(){return f.get_error_count()};
a.get_warning_quantity=function(){return f.get_warning_count()};a.clear_errors_warnings=function(){return f.clear_errors_warnings()};a.analyze_shaders=function(a){var d=A.get_compiled_shaders(),e=0,k;for(k in d)a&&-1===k.indexOf(a)||e++;var e="of "+e+" analyzing...",g={};for(k in d)if(!a||-1!==k.indexOf(a)){var h=d[k],l;var p=h.vshader;l=h.fshader;var q=n.get_debug_shaders();if(q){p=q.getTranslatedShaderSource(p);l=q.getTranslatedShaderSource(l);p=p.replace("#version","#version 400 //");l=l.replace("#version",
"#version 400 //");var q=c("/nvidia_vert",p),u=v(q),t=c("/nvidia_frag",l),w=v(t);l={vsrc:p,vout:q,vstats:u,fsrc:l,fout:t,fstats:w}}else f.error("WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),l=void 0;q=h.shaders_info;p=q.vert+" + "+q.frag;l.cshader=h;l.shaders_info=q;h=g[p]=g[p]||[];h.push(l);f.log(e)}for(p in g)f.group("%c"+p,"color: #800"),h=g[p],b(h),f.groupEnd()};a.fake_load=l.fake_load};b4w.module.geometry=function(a,t){var v=t("__batch"),c=t("__geometry"),b=t("__print"),e=t("__renderer");a.extract_vertex_array=function(a,e,n){if(!c.has_dyn_geom(a))return b.error("Wrong object:",a.name),null;if(a=v.find_batch_material(a,e,"MAIN")){if((e=a.bufs_data)&&e.pointers&&e.pointers[n])return c.extract_array(e,n);b.error("Attribute not found:"+n);return null}b.error("Wrong material:",e);return null};a.extract_index_array=function(a,e){if(!c.has_dyn_geom(a))return b.error("Wrong object:",a.name),
null;var n=v.find_batch_material(a,e,"MAIN");if(n){if((n=n.bufs_data)&&n.pointers)return n.ibo_array;b.error("Buffer data not found");return null}b.error("Wrong material:",e);return null};a.update_vertex_array=function(a,e,n,q){var g=["MAIN","DEPTH","COLOR_ID"];if(c.has_dyn_geom(a))for(var u=0;u<g.length;u++){var k=v.find_batch_material(a,e,g[u]);k&&(k=k.bufs_data)&&k.pointers&&k.pointers[n]&&c.update_bufs_data_array(k,n,0,q)}else b.error("Wrong object:",a.name)};a.override_geometry=function(a,l,
n,q,g){var u=["MAIN","DEPTH","COLOR_ID"];if(c.has_dyn_geom(a))if(n instanceof Uint16Array||n instanceof Uint32Array)if(q instanceof Float32Array)for(var k=0;k<u.length;k++){var f=v.find_batch_material(a,l,u[k]);if(f){var p=f.bufs_data;if(p){c.update_bufs_data_index_array(p,f.draw_mode,n);var t=0,D;for(D in p.pointers)var A=p.pointers[D],t=t+q.length/3*A.num_comp;p.vbo_array=new Float32Array(t);var t=p.vbo_array,h=0;for(D in p.pointers)switch(A=p.pointers[D],D){case "a_position":t.set(q,h);A.offset=
h;A.length=q.length;h+=A.length;break;case "a_normal":var x;g&&(x=c.calc_shared_indices(n,q,q));var w=c.calc_normals(n,q,x);t.set(w,h);A.offset=h;A.length=q.length;h+=A.length;break;case "a_tangent":A.offset=h;A.length=q.length/3*A.num_comp;for(var w=new Float32Array(A.length),r=0;r<w.length;r+=4)w[r]=1,w[r+3]=1;t.set(w,h);h+=A.length;break;default:A.offset=h,A.length=q.length/3*A.num_comp,w=new Float32Array(A.length),t.set(w,h),h+=A.length}c.update_gl_buffers(p);e.assign_attribute_setters(f);(f=
v.find_batch_material_forked(a,f))&&f.bufs_data&&(f.bufs_data=p)}}}else b.error("Wrong positions_array type");else b.error("Wrong ibo_array type");else b.error("Wrong object:",a.name)};a.set_shape_key_value=function(a,e,n){c.check_shape_keys(a)?c.has_shape_key(a,e)?(n=parseFloat(n),c.apply_shape_key(a,e,n)):b.error("Wrong key name:",e):b.error("Wrong object:",a.name)};a.check_shape_keys=function(a){return c.check_shape_keys(a)};a.get_shape_keys_names=function(a){return c.check_shape_keys(a)?c.get_shape_keys_names(a):
(b.error("Wrong object:",a.name),null)};a.get_shape_key_value=function(a,e){return c.check_shape_keys(a)?c.has_shape_key(a,e)?c.get_shape_key_value(a,e):(b.error("Wrong key name:",e),null):(b.error("Wrong object:",a.name),null)}};b4w.module.hud=function(a,t){var v=t("__hud");t("__print");a.draw_mixer_strip=v.draw_mixer_strip;a.plot_array=v.plot_array};b4w.module.lights=function(a,t){function v(a){for(var c=n.get_active(),d=e.get_scene_objs(c,"LAMP",e.DATA_ID_ALL),p=0;p<d.length;p++){var m=d[p];if("SUN"==m.light.type){var t=m;break}}t?"number"==typeof a.hor_position&&"number"==typeof a.vert_position&&(d=(90-a.vert_position)/180*Math.PI,p=t.render,q.set_rotation_euler(t,[d,(180-a.hor_position)/180*Math.PI,0]),a=new Float32Array(3),m=g.get_quat_view(p.world_tsr),u.quat_to_dir(m,u.AXIS_Y,a),p=g.get_trans_view(p.world_tsr),p=k.length(p),k.copy(a,f),
k.scale(f,p,f),q.set_translation(t,f),q.update_transform(t),a=t.light,a.dynamic_intensity&&(p=c.world.light_settings.environment_energy,m=Math.cos(Math.abs(d)),d=Math.max(Math.min(3*m,1),0)*a.default_energy,p*=Math.max(m,.1),b.set_light_energy(a,d),n.set_environment_colors(c,p,null,null)),n.update_lamp_scene(t,c)):l.error("There is no sun on the scene")}function c(a){if(d.is_lamp(a))return a.light.type;l.error("get_light_type(): Wrong object");return!1}var b=t("__lights"),e=t("__objects"),d=t("__obj_util"),
l=t("__print"),n=t("__scenes"),q=t("__transform"),g=t("__tsr"),u=t("__util"),k=t("__vec3"),f=new Float32Array(3),p,K,D,A=60;a.get_lamps=function(a){var b=n.get_active(),b=e.get_scene_objs(b,"LAMP",e.DATA_ID_ALL);if(!a)return b;for(var c=[],d=0;d<b.length;d++){var f=b[d];f.light.type===a&&c.push(f)}return c};a.get_sun_params=function(){for(var a=n.get_active(),a=e.get_scene_objs(a,"LAMP",e.DATA_ID_ALL),b=null,c=0;c<a.length;c++){var d=a[c];if("SUN"==d.light.type){b=d;break}}return b?(b=b.light.direction,
a=180*Math.atan2(b[2],b[0])/Math.PI+90,180<a&&(a-=360),b=180*Math.atan2(b[1],Math.sqrt(b[0]*b[0]+b[2]*b[2]))/Math.PI,c={},c.hor_position=a,c.vert_position=b,c):null};a.set_sun_params=v;a.set_day_time=function(a){for(var b=n.get_active(),b=e.get_scene_objs(b,"LAMP",e.DATA_ID_ALL),c=0;c<b.length;c++){var d=b[c];if("SUN"==d.light.type){var f=d;break}}f?(f=12>a?15*a:15*(a-24),a=-Math.cos(a/12*Math.PI)*A,b={},b.hor_position=f,b.vert_position=a,v(b)):l.error("There is no sun on the scene")};a.set_date=
function(a){p=a.getDate();K=a.getMonth();D=a.getFullYear();if(p)if(1582==p&&10==a.m&&4<a.d&&15>a.d)l.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!");else{a=p;var b=K,c=D,d,e;2<b?(d=a,e=b+1):(d=a-1,e=b+13);e=Math.floor(Math.floor(365.25*d)+Math.floor(30.6001*e)+c+1720995);588829<=c+31*(b+12*a)&&(a=Math.floor(.01*d),e+=2-a+Math.floor(.25*a));a=1E5*e;b=Math.floor(a);.5<a-b&&++b}else l.error("There is no year 0 in the Julian system!")};a.set_max_sun_angle=function(a){A=
Math.min(Math.max(a,0),90)};a.get_light_params=function(a){if(d.is_lamp(a))var b=a.light;else return l.error("get_light_params(): Wrong object"),!1;if(a=c(a))switch(a){case "SPOT":var e={light_type:a,light_color:b.color,light_energy:b.energy,light_spot_blend:b.spot_blend,light_spot_size:b.spot_size,light_distance:b.distance};break;case "POINT":e={light_type:a,light_color:b.color,light_energy:b.energy,light_distance:b.distance};break;default:e={light_type:a,light_color:b.color,light_energy:b.energy}}return e?
e:!1};a.get_light_type=c;a.set_light_params=function(a,c){if(d.is_lamp(a)){var f=a.light,k=n.get_active();"number"==typeof c.light_energy&&b.set_light_energy(f,c.light_energy);"object"==typeof c.light_color&&b.set_light_color(f,c.light_color);"number"==typeof c.light_spot_blend&&b.set_light_spot_blend(f,c.light_spot_blend);"number"==typeof c.light_spot_size&&b.set_light_spot_size(f,c.light_spot_size);"number"==typeof c.light_distance&&b.set_light_distance(f,c.light_distance);n.update_lamp_scene(a,
k);e.update_all_mesh_shaders(k)}else l.error("set_light_params(): Wrong object")}};b4w.module.material=function(a,t){function v(a,b){for(var c=a.scenes_data[0].batches,d=0;d<c.length;d++){var e=c[d];if(-1<e.material_names.indexOf(b))return"MAIN"==e.type}return!1}function c(a,b){var c=e.find_batch_material(a,b,"MAIN");return Boolean(c&&c.specular_params[0])}function b(a,b){var c=e.find_batch_material(a,b,"MAIN");return Boolean(c&&c.specular_params[1])}var e=t("__batch"),d=t("__config"),l=t("__obj_util"),n=t("__print"),q=t("__shaders"),g=d.defaults;a.inherit_material=function(a,b,
c,d){l.is_dynamic_mesh(c)&&l.is_dynamic_mesh(a)?e.inherit_material(a,b,c,d):n.error("Wrong or batched object(s)")};a.get_materials_names=function(a){var b=[];a=a.scenes_data;for(var c=0;c<a.length;c++)for(var d=a[c].batches,e=0;e<d.length;e++)for(var g=0;g<d[e].material_names.length;g++)-1==b.indexOf(d[e].material_names[g])&&b.push(d[e].material_names[g]);return b};a.set_diffuse_color=function(a,b,c){var d=e.find_batch_material(a,b,"MAIN");d?(d.diffuse_color.set(c),(a=e.find_batch_material_forked(a,
b,"MAIN"))&&a.diffuse_color.set(c)):n.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,b){var c=e.find_batch_material(a,b,"MAIN");if(c){var d=new Float32Array(4);d.set(c.diffuse_color);return d}n.error('Couldn\'t get property "diffuse_color"!')};a.set_diffuse_intensity=function(a,b,c){var d=e.find_batch_material(a,b,"MAIN");if(d){if(d.diffuse_intensity=c,a=e.find_batch_material_forked(a,b,"MAIN"))a.diffuse_intensity=c}else n.error('Couldn\'t set property "diffuse_color"!')};
a.get_diffuse_intensity=function(a,b){var c=e.find_batch_material(a,b,"MAIN");if(c)return c.diffuse_intensity;n.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,b,c){var d=e.find_batch_material(a,b,"MAIN");d?(d.specular_color.set(c),(a=e.find_batch_material_forked(a,b,"MAIN"))&&a.specular_color.set(c)):n.error('Couldn\'t set property "specular_color"!')};a.get_specular_color=function(a,b){var c=e.find_batch_material(a,b,"MAIN");if(c){var d=Array(3);d[0]=c.specular_color[0];
d[1]=c.specular_color[1];d[2]=c.specular_color[2];return d}n.error('Couldn\'t get property "specular_color"!')};a.set_specular_color_factor=function(a,b,c){var d=e.find_batch_material(a,b,"MAIN");if(d){if(d.specular_color_factor=c,a=e.find_batch_material_forked(a,b,"MAIN"))a.specular_color_factor=c}else n.error('Couldn\'t set property "specular_color_factor"!')};a.get_specular_color_factor=function(a,b){var c=e.find_batch_material(a,b,"MAIN");if(c)return c.specular_color_factor;n.error('Couldn\'t get property "specular_color_factor"!')};
a.set_specular_intensity=function(a,b,d){c(a,b)||n.error('Property "specular_intensity" is missing!');e.find_batch_material(a,b,"MAIN").specular_params[0]=d;(a=e.find_batch_material_forked(a,b,"MAIN"))&&(a.specular_params[0]=d)};a.get_specular_intensity=function(a,b){c(a,b)||n.error('Property "specular_intensity" is missing!');return e.find_batch_material(a,b,"MAIN").specular_params[0]};a.check_specular_intensity=c;a.set_specular_hardness=function(a,c,d){b(a,c)||n.error('Property "specular_hardness" is missing!');
e.find_batch_material(a,c,"MAIN").specular_params[1]=d;(a=e.find_batch_material_forked(a,c,"MAIN"))&&(a.specular_params[1]=d)};a.get_specular_hardness=function(a,c){b(a,c)||n.error('Property "specular_hardness" is missing!');return e.find_batch_material(a,c,"MAIN").specular_params[1]};a.check_specular_hardness=b;a.set_emit_factor=function(a,b,c){var d=e.find_batch_material(a,b,"MAIN");if(d){if(d.emit=c,a=e.find_batch_material_forked(a,b,"MAIN"))a.emit=c}else n.error('Couldn\'t set property "emit_factor"!')};
a.get_emit_factor=function(a,b){var c=e.find_batch_material(a,b,"MAIN");if(c)return c.emit;n.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=function(a,b,c){var d=e.find_batch_material(a,b,"MAIN");if(d){if(d.ambient=c,a=e.find_batch_material_forked(a,b,"MAIN"))a.ambient=c}else n.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,b){var c=e.find_batch_material(a,b,"MAIN");if(c)return c.ambient;n.error('Couldn\'t get property "ambient_factor"!')};
a.set_diffuse_color_factor=function(a,b,c){var d=e.find_batch_material(a,b,"MAIN");if(d){if(d.diffuse_color_factor=c,a=e.find_batch_material_forked(a,b,"MAIN"))a.diffuse_color_factor=c}else n.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,b){var c=e.find_batch_material(a,b,"MAIN");if(c)return c.diffuse_color_factor;n.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,b,c){var d=e.find_batch_material(a,b,"MAIN");if(d){if(d.alpha_factor=
c,a=e.find_batch_material_forked(a,b,"MAIN"))a.alpha_factor=c}else n.error('Couldn\'t set property "alpha_factor"!')};a.get_alpha_factor=function(a,b){var c=e.find_batch_material(a,b,"MAIN");if(c)return c.alpha_factor;n.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,b){if(!a||!b)return n.error("missing arguments in get_material_params"),null;if(!v(a,b))return null;var c=e.find_batch_material(a,b,"MAIN");if(!c)return null;var d={};"MAIN"==c.type&&(d.reflect_factor=
c.reflect_factor,d.fresnel=c.fresnel_params[2],d.fresnel_factor=5*(1-c.fresnel_params[3]),d.parallax_scale=c.parallax_scale,d.parallax_steps=e.get_batch_directive(c,"PARALLAX_STEPS")[1]);return d};a.get_water_material_params=function(a,b){if(!a||!b)return n.error("missing arguments in get_water_material_params"),null;if(!v(a,b))return null;var c=e.find_batch_material(a,b,"MAIN");if(!c||!c.water)return null;if(!c)return n.error("material not found"),null;var d={};if("MAIN"==c.type){if(g.shore_distance){var l=
d.shallow_water_col=Array(3);l[0]=c.shallow_water_col[0];l[1]=c.shallow_water_col[1];l[2]=c.shallow_water_col[2];l=d.shore_water_col=Array(3);l[0]=c.shore_water_col[0];l[1]=c.shore_water_col[1];l[2]=c.shore_water_col[2];d.shallow_water_col_fac=c.shallow_water_col_fac;d.shore_water_col_fac=c.shore_water_col_fac}d.foam_factor=c.foam_factor;d.norm_uv_velocity=c.water_norm_uv_velocity;d.absorb_factor=e.get_batch_directive(c,"ABSORB")[1];d.sss_strength=e.get_batch_directive(c,"SSS_STRENGTH")[1];d.sss_width=
e.get_batch_directive(c,"SSS_WIDTH")[1];d.dst_noise_scale0=e.get_batch_directive(c,"DST_NOISE_SCALE_0")[1];d.dst_noise_scale1=e.get_batch_directive(c,"DST_NOISE_SCALE_1")[1];d.dst_noise_freq0=e.get_batch_directive(c,"DST_NOISE_FREQ_0")[1];d.dst_noise_freq1=e.get_batch_directive(c,"DST_NOISE_FREQ_1")[1];d.dir_min_shore_fac=e.get_batch_directive(c,"DIR_MIN_SHR_FAC")[1];d.dir_freq=e.get_batch_directive(c,"DIR_FREQ")[1];d.dir_noise_scale=e.get_batch_directive(c,"DIR_NOISE_SCALE")[1];d.dir_noise_freq=
e.get_batch_directive(c,"DIR_NOISE_FREQ")[1];d.dir_min_noise_fac=e.get_batch_directive(c,"DIR_MIN_NOISE_FAC")[1];d.dst_min_fac=e.get_batch_directive(c,"DST_MIN_FAC")[1];d.waves_hor_fac=e.get_batch_directive(c,"WAVES_HOR_FAC")[1]}return d};a.set_material_extended_params=function(a,b,c){if(a&&b&&c)if(v(a,b)){var d=e.find_batch_material(a,b,"MAIN");if(d){var g=[d];(d=e.find_batch_material_forked(a,b,"MAIN"))&&g.push(d);for(a=0;a<g.length;a++)d=g[a],"number"==typeof c.material_reflectivity&&(d.reflect_factor=
c.material_reflectivity),"number"==typeof c.material_fresnel&&(d.fresnel_params[2]=c.material_fresnel),"number"==typeof c.material_fresnel_factor&&(d.fresnel_params[3]=1-c.material_fresnel_factor/5),"number"==typeof c.material_parallax_scale&&(d.parallax_scale=c.material_parallax_scale),"number"==typeof c.material_parallax_steps&&(b=q.glsl_value(parseFloat(c.material_parallax_steps)),e.set_batch_directive(d,"PARALLAX_STEPS",b),e.update_shader(d,!0))}else n.error("material not found")}else n.error("setting material params is not possible");
else n.error("missing arguments in set_material_params")};a.set_water_material_params=function(a,b,c){if(a&&b&&c)if(v(a,b)){var d=e.find_batch_material(a,b,"MAIN");if(d){var l=[d];(d=e.find_batch_material_forked(a,b,"MAIN"))&&l.push(d);for(a=0;a<l.length;a++)d=l[a],g.shore_distance&&("object"==typeof c.shallow_water_col&&d.shallow_water_col.set(c.shallow_water_col),"number"==typeof c.shallow_water_col_fac&&(d.shallow_water_col_fac=c.shallow_water_col_fac),"object"==typeof c.shore_water_col&&d.shore_water_col.set(c.shore_water_col),
"number"==typeof c.shore_water_col_fac&&(d.shore_water_col_fac=c.shore_water_col_fac)),g.shore_smoothing&&d.water_shore_smoothing&&("boolean"==typeof c.shore_smoothing&&(c.shore_smoothing?e.set_batch_directive(d,"SHORE_SMOOTHING",1):e.set_batch_directive(d,"SHORE_SMOOTHING",0)),"number"==typeof c.absorb_factor&&(b=q.glsl_value(parseFloat(c.absorb_factor)),e.set_batch_directive(d,"ABSORB",b))),"number"==typeof c.foam_factor&&g.foam&&(d.foam_factor=c.foam_factor),"number"==typeof c.norm_uv_velocity&&
(d.water_norm_uv_velocity=c.norm_uv_velocity),g.water_dynamic&&d.water_dynamic&&("boolean"==typeof c.water_dynamic&&(c.water_dynamic?e.set_batch_directive(d,"DYNAMIC",1):e.set_batch_directive(d,"DYNAMIC",0)),"number"==typeof c.waves_height&&(b=q.glsl_value(parseFloat(c.waves_height)),e.set_batch_directive(d,"WAVES_HEIGHT",b)),"number"==typeof c.waves_length&&(b=q.glsl_value(parseFloat(c.waves_length)),e.set_batch_directive(d,"WAVES_LENGTH",b)),"number"==typeof c.sss_strength&&(b=q.glsl_value(parseFloat(c.sss_strength)),
e.set_batch_directive(d,"SSS_STRENGTH",b)),"number"==typeof c.sss_width&&(b=q.glsl_value(parseFloat(c.sss_width)),e.set_batch_directive(d,"SSS_WIDTH",b)),"number"==typeof c.dst_noise_scale0&&(b=q.glsl_value(parseFloat(c.dst_noise_scale0)),e.set_batch_directive(d,"DST_NOISE_SCALE_0",b)),"number"==typeof c.dst_noise_scale1&&(b=q.glsl_value(parseFloat(c.dst_noise_scale1)),e.set_batch_directive(d,"DST_NOISE_SCALE_1",b)),"number"==typeof c.dst_noise_freq0&&(b=q.glsl_value(parseFloat(c.dst_noise_freq0)),
e.set_batch_directive(d,"DST_NOISE_FREQ_0",b)),"number"==typeof c.dst_noise_freq1&&(b=q.glsl_value(parseFloat(c.dst_noise_freq1)),e.set_batch_directive(d,"DST_NOISE_FREQ_1",b)),"number"==typeof c.dir_min_shore_fac&&(b=q.glsl_value(parseFloat(c.dir_min_shore_fac)),e.set_batch_directive(d,"DIR_MIN_SHR_FAC",b)),"number"==typeof c.dir_freq&&(b=q.glsl_value(parseFloat(c.dir_freq)),e.set_batch_directive(d,"DIR_FREQ",b)),"number"==typeof c.dir_noise_scale&&(b=q.glsl_value(parseFloat(c.dir_noise_scale)),
e.set_batch_directive(d,"DIR_NOISE_SCALE",b)),"number"==typeof c.dir_noise_freq&&(b=q.glsl_value(parseFloat(c.dir_noise_freq)),e.set_batch_directive(d,"DIR_NOISE_FREQ",b)),"number"==typeof c.dir_min_noise_fac&&(b=q.glsl_value(parseFloat(c.dir_min_noise_fac)),e.set_batch_directive(d,"DIR_MIN_NOISE_FAC",b)),"number"==typeof c.dst_min_fac&&(b=q.glsl_value(parseFloat(c.dst_min_fac)),e.set_batch_directive(d,"DST_MIN_FAC",b)),"number"==typeof c.waves_hor_fac&&(b=q.glsl_value(parseFloat(c.waves_hor_fac)),
e.set_batch_directive(d,"WAVES_HOR_FAC",b))),e.update_shader(d,!0)}else n.error("material not found")}else n.error("setting water material params is not possible");else n.error("missing arguments in set_water_material_params")}};b4w.module.particles=function(a,t){var v=t("__particles"),c=t("__print");a.set_size=function(a,e,d){v.obj_has_particles(a)?v.set_size(a,e,d):c.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,e,d){v.obj_has_particles(a)?v.set_normal_factor(a,e,d):c.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,e,d){v.obj_has_particles(a)?(d=Math.min(d,1),d=Math.max(d,0),v.set_factor(a,e,d)):c.error('"',a.name,'" has no particle systems')}};b4w.module.physics=function(a,t){t("__config");var v=t("__ipc"),c=t("__physics"),b=t("__print"),e=t("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){c.obj_has_physics(a)?c.enable_simulation(a):b.error("No physics for object "+a.name)};a.disable_simulation=function(a){c.obj_has_physics(a)?c.disable_simulation(a):b.error("No physics for object "+a.name)};a.has_physics=function(a){return c.obj_has_physics(a)};a.has_simulated_physics=function(a){return c.has_simulated_physics(a)};
a.has_dynamic_physics=function(a){return c.has_dynamic_physics(a)};a.set_gravity=function(a,e){c.obj_has_physics(a)?c.set_gravity(a,e):b.error("No physics for object "+a.name)};a.set_damping=function(a,e,n){c.obj_has_physics(a)?c.post_msg("set_damping",a.physics.body_id,e,n):b.error("No physics for object "+a.name)};a.reset_damping=function(a){if(c.obj_has_physics(a)){var e=a.physics_settings;c.post_msg("set_damping",a.physics.body_id,e.damping,e.rotation_damping)}else b.error("No physics for object "+
a.name)};a.set_transform=function(a,e,n){c.obj_has_physics(a)?c.set_transform.apply(this,arguments):b.error("No physics for object "+a.name)};a.sync_transform=function(a){c.obj_has_physics(a)?c.sync_transform(a):b.error("No physics for object "+a.name)};a.apply_velocity=function(a){c.obj_has_physics(a)?c.apply_velocity.apply(this,arguments):b.error("No physics for object "+a.name)};a.apply_velocity_world=function(a){c.obj_has_physics(a)?c.apply_velocity_world.apply(this,arguments):b.error("No physics for object "+
a.name)};a.apply_force=function(a,e,n,q){c.obj_has_physics(a)?c.apply_force.apply(this,arguments):b.error("No physics for object "+a.name)};a.apply_torque=function(a,e,n,q){c.obj_has_physics(a)?c.apply_torque.apply(this,arguments):b.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,l){c.obj_has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),c.vehicle_throttle(a,e.clamp(l,-1,1))):b.error("No physics for object "+a.name)};a.vehicle_throttle_inc=
function(a,l,n){if(c.obj_has_physics(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object");l=e.clamp(l,0,1);var q=a.vehicle.engine_force;-1==n||1==n?q=Math.max(-1,Math.min(q+n*l,1)):0==n&&0<=q?(q-=l,q=Math.max(0,q)):0==n&&0>q?(q+=l,q=Math.min(0,q)):b.error("Wrong steering direction");c.vehicle_throttle(a,e.clamp(q,-1,1))}else b.error("No physics for object "+a.name)};a.vehicle_steer=function(a,l){c.obj_has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),
c.vehicle_steer(a,e.clamp(l,-1,1))):b.error("No physics for object "+a.name)};a.vehicle_steer_inc=function(a,l,n){if(c.obj_has_physics(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object");l=e.clamp(l,0,1);var q=a.vehicle.steering;-1==n||1==n?q=Math.max(-1,Math.min(q+n*l,1)):0==n&&0<=q?(q-=l,q=Math.max(0,q)):0==n&&0>q?(q+=l,q=Math.min(0,q)):b.error("Wrong steering direction");c.vehicle_steer(a,e.clamp(q,-1,1))}else b.error("No physics for object "+a.name)};a.vehicle_brake=function(a,
l){c.obj_has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),c.vehicle_brake(a,e.clamp(l,0,1))):b.error("No physics for object "+a.name)};a.vehicle_brake_inc=function(a,l){if(c.obj_has_physics(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object");l=e.clamp(l,-1,1);var n=a.vehicle.brake_force;c.vehicle_brake(a,e.clamp(n+n*l,0,1))}else b.error("No physics for object "+a.name)};a.is_vehicle_chassis=function(a){return c.is_vehicle_chassis(a)};a.is_vehicle_hull=
function(a){return c.is_vehicle_hull(a)};a.get_vehicle_name=function(a){if(!c.obj_has_physics(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.vehicle_settings.name;b.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(!c.obj_has_physics(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.vehicle.engine_force;b.error("Wrong object");return null};a.get_vehicle_steering=
function(a){if(!c.obj_has_physics(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.vehicle.steering;b.error("Wrong object")};a.get_vehicle_brake=function(a){if(!c.obj_has_physics(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.vehicle.brake_force;b.error("Wrong object")};a.get_vehicle_speed=function(a){if(!c.obj_has_physics(a))return b.error("No physics for object "+a.name),
null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return c.get_vehicle_speed(a);b.error("Wrong object")};a.is_character=function(a){return c.is_character(a)};a.set_character_move_dir=function(a,e,n){c.obj_has_physics(a)?c.set_character_move_dir(a,e,n):b.error("No physics for object "+a.name)};a.set_character_move_type=function(a,e){c.obj_has_physics(a)?c.set_character_move_type(a,e):b.error("No physics for object "+a.name)};a.set_character_walk_velocity=function(a,e){c.obj_has_physics(a)?c.set_character_walk_velocity(a,
e):b.error("No physics for object "+a.name)};a.set_character_run_velocity=function(a,e){c.obj_has_physics(a)?c.set_character_run_velocity(a,e):b.error("No physics for object "+a.name)};a.set_character_fly_velocity=function(a,e){c.obj_has_physics(a)?c.set_character_fly_velocity(a,e):b.error("No physics for object "+a.name)};a.character_jump=function(a){c.obj_has_physics(a)?c.character_jump(a):b.error("No physics for object "+a.name)};a.character_rotation_inc=function(a,e,n){c.obj_has_physics(a)?c.character_rotation_inc(a,
e,n):b.error("No physics for object "+a.name)};a.set_character_rotation_quat=function(a,e){c.obj_has_physics(a)?c.set_character_rotation_quat(a,e):b.error("No physics for object "+a.name)};a.set_character_rotation=function(a,e,n){c.obj_has_physics(a)?c.set_character_rotation(a,e,n):b.error("No physics for object "+a.name)};a.set_character_rotation_v=function(a,e){c.obj_has_physics(a)?c.set_character_rotation_v(a,e):b.error("No physics for object "+a.name)};a.set_character_rotation_h=function(a,e){c.obj_has_physics(a)?
c.set_character_rotation_h(a,e):b.error("No physics for object "+a.name)};a.append_collision_test=function(a,e,n,q){c.obj_has_physics(a)?c.append_collision_test(a,e,n,q||!1):b.error("No physics for object "+a.name)};a.remove_collision_test=function(a,e,n){c.obj_has_physics(a)?c.remove_collision_test(a,e||"ANY",n):b.error("No physics for object "+a.name)};a.apply_collision_impulse_test=function(a,e){c.obj_has_physics(a)?c.apply_collision_impulse_test(a,e):b.error("No physics for object "+a.name)};
a.clear_collision_impulse_test=function(a){c.obj_has_physics(a)?c.clear_collision_impulse_test(a):b.error("No physics for object "+a.name)};a.append_ray_test=function(a,e,n,q,g,t){if(c.obj_has_physics(a))return c.append_ray_test(a,e,n,q,g,t||!1,!1,!1,!1);b.error("No physics for object "+a.name)};a.append_ray_test_ext=function(a,e,n,q,g,t,k,f,p){if(c.obj_has_physics(a))return c.append_ray_test(a,e,n,q,g,t||!1,k||!1,f||!1,p||!1);b.error("No physics for object "+a.name)};a.remove_ray_test=function(a){c.is_ray_test(a)?
c.remove_ray_test(a):b.error("Wrong ray test ID")};a.change_ray_test_from_to=function(a,e,n){c.is_ray_test(a)?c.change_ray_test_from_to(a,e,n):b.error("Wrong ray test ID")};a.apply_constraint=function(a,e,n,q,g,t,k,f,p,v){c.obj_has_physics(e)&&c.obj_has_physics(g)?c.apply_constraint(a,e,n,q,g,t,k,f,p,v):b.error("Wrong objects")};a.clear_constraint=function(a){c.obj_has_physics(a)&&c.has_constraint(a)?c.clear_constraint(a):b.error("Wrong object")};a.pull_to_constraint_pivot=function(a,e,n,q,g,t){c.obj_has_physics(a)&&
c.obj_has_physics(q)?c.pull_to_constraint_pivot(a,e,n,q,g,t):b.error("Wrong objects")};a.get_worker_listeners=v.get_worker_listeners};b4w.module.rgb=function(a,t){t("__print");var v=t("__util"),c=new Float32Array(3);a.create=function(){return new Float32Array(3)};a.from_values=function(a,c,d){var l=new Float32Array(3);l[0]=a;l[1]=c;l[2]=d;return l};a.set=function(a,c,d,l){l[0]=a;l[1]=c;l[2]=d;return l};a.css_to_rgb=function(a,c,d,l){l=l||new Float32Array(3);l[0]=a/255;l[1]=c/255;l[2]=d/255;v.srgb_to_lin(l,l);return l};a.rgb_to_css=function(a){a=v.lin_to_srgb(a,c);return[Math.round(255*a[0]),Math.round(255*a[1]),Math.round(255*a[2])]};
a.rgb_to_css_hex=function(a){var e=function(a){a=Math.round(255*a).toString(16);return 1==a.length?"0"+a:a};a=v.lin_to_srgb(a,c);return"#"+e(a[0])+e(a[1])+e(a[2])}};
b4w.module.rgba=function(a,t){t("__print");var v=t("__util"),c=new Float32Array(3);a.create=function(){var a=new Float32Array(4);a[3]=1;return a};a.from_values=function(a,c,d,l){var n=new Float32Array(4);n[0]=a;n[1]=c;n[2]=d;n[3]=l;return n};a.set=function(a,c,d,l,n){n[0]=a;n[1]=c;n[2]=d;n[3]=l;return n};a.css_to_rgba=function(a,c,d,l,n){n=n||new Float32Array(4);n[0]=a/255;n[1]=c/255;n[2]=d/255;n[3]=l;v.srgb_to_lin(n,n);return n};a.rgba_to_css=function(a){var e=v.lin_to_srgb(a,c);return[Math.round(255*
e[0]),Math.round(255*e[1]),Math.round(255*e[2]),a[3]]}};b4w.module.scenes=function(a,t){var v=t("__batch"),c=t("__camera"),b=t("__data"),e=t("__graph"),d=t("__objects"),l=t("__obj_util"),n=t("__physics"),q=t("__print"),g=t("__scenes"),u=t("__util");a.DATA_ID_ALL=d.DATA_ID_ALL;a.set_active=function(a){var b=g.get_all_scenes();g.set_active(u.keysearch("name",a,b))};a.get_active=function(){return g.check_active()?g.get_active().name:""};a.get_scenes=function(){for(var a=g.get_all_scenes(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_active_camera=
function(){if(g.check_active())return g.get_camera(g.get_active());q.error("No active scene");return!1};a.get_object_by_name=function(a,b){var c=d.get_object(d.GET_OBJECT_BY_NAME,a,b|0);if(c)return c;q.error("get object "+a+": not found")};a.get_object_by_dupli_name=function(a,b,c){if(a=d.get_object(d.GET_OBJECT_BY_DUPLI_NAME,a,b,c|0))return a;q.error("get object "+b+": not found")};a.get_object_by_dupli_name_list=function(a,b){var c=d.get_object(d.GET_OBJECT_BY_DUPLI_NAME_LIST,a,b|0);if(c)return c;
q.error("get object "+a+": not found")};a.get_object_data_id=function(a){return g.get_object_data_id(a)};a.pick_object=d.pick_object;a.outlining_is_enabled=function(a){return a&&a.render&&a.render.outlining};a.set_outline_intensity=function(a,b){a&&a.render&&a.render.outlining?a.render.outline_intensity=b:q.error("set_outline_intensity(): wrong object")};a.get_outline_intensity=function(a){if(a&&a.render&&a.render.outlining)return a.render.outline_intensity;q.error("get_outline_intensity(): wrong object")};
a.apply_outline_anim=function(a,b,c,e){a&&a.render&&a.render.outlining?d.apply_outline_anim(a,b,c,e):q.error("apply_outline_anim(): wrong object")};a.apply_outline_anim_def=function(a){if(a&&a.render&&a.render.outlining){var b=a.render.outline_anim_settings_default;d.apply_outline_anim(a,b.outline_duration,b.outline_period,b.outline_relapses)}else q.error("apply_outline_anim_def(): wrong object")};a.clear_outline_anim=function(a){a&&a.render&&a.render.outlining?d.clear_outline_anim(a):q.error("clear_outline_anim(): wrong object")};
a.set_outline_color=g.set_outline_color;a.get_outline_color=function(a){var b=g.get_active();if(b=g.get_subs(b,"OUTLINE"))return a=a||new Float32Array(3),a.set(b.outline_color),a};a.set_glow_intensity=function(b,c){q.error_deprecated("set_glow_intensity","set_outline_intensity");a.set_outline_intensity(b,c)};a.get_glow_intensity=function(b){q.error_deprecated("get_glow_intensity","get_outline_intensity");a.get_outline_intensity(b)};a.apply_glow_anim=function(b,c,d,e){q.error_deprecated("apply_glow_anim",
"apply_outline_anim");a.apply_outline_anim(b,c,d,e)};a.apply_glow_anim_def=function(b){q.error_deprecated("apply_glow_anim_def","apply_outline_anim_def");a.apply_outline_anim_def(b)};a.clear_glow_anim=function(b){q.error_deprecated("clear_glow_anim","clear_outline_anim");a.clear_outline_anim(b)};a.set_glow_color=function(b){q.error_deprecated("set_glow_color","set_outline_color");a.set_outline_color(b)};a.get_glow_color=function(b){q.error_deprecated("get_glow_color, get_outline_color");a.get_outline_color(b)};
a.get_shadow_params=function(){if(!g.check_active())return q.error("No active scene"),!1;var a=g.get_active(),b=g.get_subs(a,"SHADOW_CAST");if(!b)return null;var c=a._render.shadow_params,d=g.get_subs(a,"MAIN_OPAQUE"),e=g.get_subs(a,"DEPTH"),l={};l.csm_resolution=c.csm_resolution;l.self_shadow_polygon_offset=b.self_shadow_polygon_offset;e&&(l.self_shadow_normal_offset=e.self_shadow_normal_offset);l.enable_csm=c.enable_csm;l.csm_num=c.csm_num;l.csm_first_cascade_border=c.csm_first_cascade_border;l.first_cascade_blur_radius=
c.first_cascade_blur_radius;l.csm_last_cascade_border=c.csm_last_cascade_border;l.last_cascade_blur_radius=c.last_cascade_blur_radius;l.fade_last_cascade=c.fade_last_cascade;l.blend_between_cascades=c.blend_between_cascades;c.enable_csm?(l.csm_borders=g.get_csm_borders(a,d.camera),l.blur_radii=new Float32Array(c.csm_num),l.blur_radii.set(d.camera.pcf_blur_radii.subarray(0,c.csm_num))):(l.csm_borders=null,l.blur_radii=null);return l};a.set_shadow_params=function(a){if(g.check_active()){var b=g.get_active();
"number"==typeof a.self_shadow_polygon_offset&&e.traverse(b._render.graph,function(b,c){"SHADOW_CAST"===c.type&&(c.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});var d=g.get_subs(b,"DEPTH");d&&("number"==typeof a.self_shadow_normal_offset&&(d.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(d.pcf_blur_radius=a.pcf_blur_radius));var l=g.get_subs(b,"MAIN_BLEND");l&&("number"==typeof a.self_shadow_normal_offset&&(l.self_shadow_normal_offset=a.self_shadow_normal_offset),
"number"==typeof a.pcf_blur_radius&&(l.pcf_blur_radius=a.pcf_blur_radius),l.need_perm_uniforms_update=!0);l=b._render.shadow_params;"number"==typeof a.csm_first_cascade_border&&(l.csm_first_cascade_border=a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(l.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(l.csm_last_cascade_border=a.csm_last_cascade_border);"number"==typeof a.last_cascade_blur_radius&&(l.last_cascade_blur_radius=
a.last_cascade_blur_radius);if(d){for(var n=d.bundles,t=0;t<n.length;t++){var h=n[t];h.obj_render.shadow_receive&&(h=h.batch,v.assign_shadow_receive_dirs(h,l),v.update_shader(h))}d.need_perm_uniforms_update=!0}d=b._camera.render.cameras;for(t=0;t<d.length;t++)c.update_camera_shadows(d[t],l);g.schedule_shadow_update(b)}else q.error("No active scene")};a.get_environment_colors=function(){if(!g.check_active())return q.error("No active scene"),!1;var a=g.get_active();return g.get_environment_colors(a)};
a.set_environment_colors=function(a,b,c){if(g.check_active()){var d=g.get_active();g.set_environment_colors(d,parseFloat(a),b,c)}else q.error("No active scene")};a.get_fog_color_density=function(a){if(!g.check_active())return q.error("No active scene"),!1;var b=g.get_active();return g.get_fog_color_density(b,a)};a.set_fog_color_density=function(a){if(g.check_active()){var b=g.get_active();g.set_fog_color_density(b,a)}else q.error("No active scene")};a.get_ssao_params=function(){if(!g.check_active())return q.error("No active scene"),
!1;var a=g.get_active();return g.get_ssao_params(a)};a.set_ssao_params=function(a){if(g.check_active()){var b=g.get_active();g.set_ssao_params(b,a)}else q.error("No active scene")};a.get_color_correction_params=function(){if(!g.check_active())return q.error("No active scene"),null;var a=g.get_active(),a=g.get_subs(a,"COMPOSITING");if(!a)return null;var b={};b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b};a.set_color_correction_params=function(a){if(g.check_active()){var b=
g.get_active();if(b=g.get_subs(b,"COMPOSITING"))"number"==typeof a.brightness&&(b.brightness=a.brightness),"number"==typeof a.contrast&&(b.contrast=a.contrast),"number"==typeof a.exposure&&(b.exposure=a.exposure),"number"==typeof a.saturation&&(b.saturation=a.saturation),b.need_perm_uniforms_update=!0}else q.error("No active scene")};a.get_sky_params=function(){if(!g.check_active())return q.error("No active scene"),!1;var a=g.get_active();return g.get_sky_params(a)};a.set_sky_params=function(a){if(g.check_active()){var b=
g.get_active();g.set_sky_params(b,a)}else q.error("No active scene")};a.get_dof_params=function(){if(!g.check_active())return q.error("No active scene"),!1;var a=g.get_active();return g.get_subs(a,"DOF")?g.get_dof_params(a):null};a.set_dof_params=function(a){if(g.check_active()){var b=g.get_active();g.set_dof_params(b,a)}else q.error("No active scene")};a.get_god_rays_params=function(){if(!g.check_active())return q.error("No active scene"),!1;var a=g.get_active();return g.get_subs(a,"GOD_RAYS")?g.get_god_rays_params(a):
null};a.set_god_rays_params=function(a){if(g.check_active()){var b=g.get_active();g.set_god_rays_params(b,a)}else q.error("No active scene")};a.get_bloom_params=function(){if(!g.check_active())return q.error("No active scene"),!1;var a=g.get_active();return g.get_subs(a,"BLOOM")?g.get_bloom_params(a):null};a.set_bloom_params=function(a){if(g.check_active()){var b=g.get_active();g.set_bloom_params(b,a)}else q.error("No active scene")};a.get_glow_material_params=function(){if(!g.check_active())return q.error("No active scene"),
!1;var a=g.get_active();return g.get_subs(a,"GLOW_COMBINE")?g.get_glow_material_params(a):null};a.set_glow_material_params=function(a){if(g.check_active()){var b=g.get_active();g.set_glow_material_params(b,a)}else q.error("No active scene")};a.get_wind_params=function(){if(!g.check_active())return q.error("No active scene"),!1;var a=g.get_active();return g.get_wind_params(a)};a.set_wind_params=function(a){if(g.check_active()){var b=g.get_active();d.set_wind_params(b,a)}else q.error("No active scene")};
a.get_water_surface_level=g.get_water_surface_level;a.set_water_params=function(a){if(g.check_active()){var b=g.get_active();g.set_water_params(b,a)}else q.error("No active scene")};a.get_water_mat_params=function(a){if(g.check_active()){var b=g.get_active();g.get_water_mat_params(b,a)}else q.error("No active scene")};a.update_scene_materials_params=function(){if(g.check_active()){var a=g.get_active();g.update_scene_permanent_uniforms(a)}else q.error("No active scene")};a.hide_object=function(a,b){b=
b||!1;!l.is_mesh(a)&&!l.is_empty(a)||l.is_dynamic(a)?b?g.change_visibility(a,!0):g.change_visibility_rec(a,!0):q.error("show/hide is only supported for dynamic objects.")};a.show_object=function(a,b){b=b||!1;!l.is_mesh(a)&&!l.is_empty(a)||l.is_dynamic(a)?b?g.change_visibility(a,!1):g.change_visibility_rec(a,!1):q.error("show/hide is only supported for dynamic objects.")};a.is_hidden=function(a){if(l.is_dynamic_mesh(a)||l.is_empty(a)||l.is_lamp(a))return g.is_hidden(a);q.error("show/hide is only supported for dynamic meshes/empties and lamps");
return!1};a.is_visible=function(a){return a.render.is_visible};a.check_object=function(a){return g.check_active()?d.objects_storage_check(a,g.get_active()):(q.error("No active scene"),!1)};a.check_object_by_name=function(a,b){return d.get_object(d.GET_OBJECT_BY_NAME,a,b|0)?!0:!1};a.check_object_by_dupli_name=function(a,b,c){return d.get_object(d.GET_OBJECT_BY_DUPLI_NAME,a,b,c|0)?!0:!1};a.check_object_by_dupli_name_list=function(a,b){return d.get_object(d.GET_OBJECT_BY_DUPLI_NAME_LIST,a,b|0)?!0:!1};
a.get_all_objects=function(a,b){var c=g.get_active();a||(a="ALL");b||0===b||(b=d.DATA_ID_ALL);return d.get_scene_objs(c,a,b)};a.get_object_name=function(a){return a?a.origin_name:(q.error("Wrong object name"),"")};a.get_object_name_hierarchy=function(a){if(!a)return q.error("Wrong object name"),null;for(var b=[];a;)b.push(a.origin_name),a=l.get_dg_parent(a);return b.reverse()};a.get_object_type=function(a){return a&&a.type?a.type:(q.error("Wrong object"),"UNDEFINED")};a.get_object_dg_parent=function(a){q.error_deprecated("scenes.get_object_dg_parent",
"objects.get_dg_parent");return l.get_dg_parent(a)};a.get_object_children=function(a){return a.cons_descends.slice(0)};a.get_first_character=function(){for(var a=d.get_scene_objs(g.get_active(),"MESH",d.DATA_ID_ALL),b=0;b<a.length;b++){var c=a[b];if(n.is_character(c))return c}return null};a.get_shore_dist=function(a,b){b||0===b||(b=1);return g.get_shore_dist(a,b)};a.get_cam_water_depth=function(){return g.get_cam_water_depth()};a.get_type_mesh_object=function(a){return l.is_mesh(a)?a.render.type:
null};a.get_meta_tags=function(){if(!g.check_active())return q.error("No active scene"),!1;var a=g.get_active();return g.get_meta_tags(a)};a.append_object=function(a,b){if(a.render.is_copied){if(b)var c=g.get_all_scenes(),c=u.keysearch("name",b,c);else c=g.get_active();g.append_object(c,a,!0)}else q.error('object "'+a.name+'" has been created not by coping.')};a.remove_object=function(a){if(a.render.is_copied){var c=g.get_active();b.prepare_object_unloading(c,a,!1);d.remove_object(a)}else q.error("Can't remove object \""+
a.name+'". It was not copied.')};a.marker_frame=function(a){var b=g.get_active();if(b.timeline_markers&&a in b.timeline_markers)return g.marker_frame(b,a);q.error('"'+a+'" marker not found.');return 0};a.get_mb_params=function(){var a=g.get_active();return(a=g.get_subs(a,"MOTION_BLUR"))?{mb_factor:a.mb_factor,mb_decay_threshold:a.mb_decay_threshold}:null};a.set_mb_params=function(a){var b=g.get_active();(b=g.get_subs(b,"MOTION_BLUR"))?("number"==typeof a.mb_decay_threshold&&(b.mb_decay_threshold=
a.mb_decay_threshold),"number"==typeof a.mb_factor&&(b.mb_factor=a.mb_factor)):q.error("The motion blur subscene doesn't exist.")};a.can_select_objects=function(){var a=g.get_active();return Boolean(g.get_subs(a,"COLOR_PICKING"))}};b4w.module.sfx=function(a,t){var v=t("__obj_util"),c=t("__scenes"),b=t("__sfx"),e=t("__print");a.play=function(a,c,e){b.play(a,c||0,e||0)};a.play_def=function(a){b.play_def(a)};a.is_play=function(a){return b.is_playing(a)};a.is_playing=function(a){return b.is_playing(a)};a.speaker_play=function(a,c,n,q){e.error_once("speaker_play() deprecated, use play() or play_def() instead");b.cyclic(a,c);q&&b.playrate(a,q);b.play(a,0,n)};a.speaker_stop=function(a){e.error_deprecated("speaker_stop","stop");b.stop(a)};
a.stop=function(a){b.stop(a)};a.pause=function(a){b.speaker_pause(a)};a.resume=function(a){b.speaker_resume(a)};a.speaker_playback_rate=function(a,c){e.error_deprecated("speaker_playback_rate","playrate");b.playrate(a,c)};a.playrate=function(a,c){b.playrate(a,c)};a.get_playrate=function(a){return b.get_playrate(a)};a.cyclic=function(a,c){b.cyclic(a,c)};a.is_cyclic=function(a){return b.is_cyclic(a)};a.listener_reset_speed=function(a,c){b.listener_reset_speed(a,c)};a.speaker_reset_speed=function(a,
c,e){b.speaker_reset_speed(a,c,e)};a.get_volume=function(a){return a&&"object"===typeof a?b.get_volume(a):b.get_master_volume()};a.set_volume=function(a,c){a&&"object"===typeof a?b.set_volume(a,c):b.set_master_volume(c)};a.mute=function(a,c){a&&"object"===typeof a?b.mute(a,c):b.mute_master(c)};a.is_muted=function(a){return a&&"object"===typeof a?b.is_muted(a):b.is_master_muted()};a.get_speaker_objects=function(){return b.get_speaker_objects().slice(0)};a.get_speakers=function(){e.error_deprecated("get_speakers",
"get_speaker_objects");return a.get_speaker_objects()};a.check_active_speakers=b.check_active_speakers;a.set_compressor_params=function(a){b.set_compressor_params(c.get_active(),a)};a.get_compressor_params=function(){return b.get_compressor_params(c.get_active())};a.duck=function(a,c,e){a&&"object"===typeof a?b.duck(a,c,e):b.duck_master(c,e)};a.unduck=function(a){a&&"object"===typeof a?b.unduck(a):b.unduck_master()};a.apply_playlist=b.apply_playlist;a.clear_playlist=b.clear_playlist;a.detect_audio_container=
b.detect_audio_container;a.detect_video_container=b.detect_video_container;a.set_positional_params=b.set_positional_params;a.get_positional_params=b.get_positional_params;a.set_filter_params=b.set_filter_params;a.get_filter_params=b.get_filter_params;a.get_filter_freq_response=b.get_filter_freq_response;a.get_duration=function(a){if(a&&v.is_speaker(a))return b.get_duration(a);e.error('Object "'+(a?a.name:void 0)+'" is not a valid speaker')}};b4w.module.textures=function(a,t){var v=t("__print"),c=t("__scenes"),b=t("__textures");a.get_canvas_texture_context=function(a,c){c||(c=0);var l=b.get_canvas_context(a,c);if(l)return l;v.error('Canvas texture with ID "'+a+'" not found!')};a.update_canvas_texture_context=function(a,c){c||(c=0);b.update_canvas_context(a,c)||v.error('Canvas texture with ID "'+a+'" not found!')};a.play_video=function(a,d){d||(d=0);c.get_active().b4w_use_nla&&b.video_allow_nla(a,d)?v.error("NLA texture can't be controlled directly through API."):
b.play_video(a,d)||v.error('Texture with name "'+a+'" not found!')};a.pause_video=function(a,d){d||(d=0);c.get_active().b4w_use_nla&&b.video_allow_nla(a,d)?v.error("NLA texture can't be controlled directly through API."):b.pause_video(a,d)||v.error('Texture with name "'+a+'" not found!')};a.reset_video=function(a,d){d||(d=0);c.get_active().b4w_use_nla&&b.video_allow_nla(a,d)?v.error("NLA texture can't be controlled directly through API."):b.reset_video(a,d)||v.error('Texture with name "'+a+'" not found!')}};b4w.module.time=function(a,t){var v=t("__time");a.set_timeout=v.set_timeout;a.clear_timeout=v.clear_timeout;a.get_timeline=v.get_timeline;a.animate=v.animate;a.clear_animation=v.clear_animation};b4w.module.transform=function(a,t){var v=t("__obj_util"),c=t("__physics"),b=t("__print"),e=t("__quat"),d=t("__transform"),l=t("__tsr"),n=t("__util"),q=new Float32Array(4),g=new Float32Array(3),u=new Float32Array(4);a.SPACE_LOCAL=d.SPACE_LOCAL;a.SPACE_WORLD=d.SPACE_WORLD;a.set_translation=function(a,e,l,n){v.is_dynamic(a)?(g[0]=e,g[1]=l,g[2]=n,d.set_translation(a,g),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_rel=function(a,e,
l,n){v.is_dynamic(a)?(g[0]=e,g[1]=l,g[2]=n,d.set_translation_rel(a,g),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_v=function(a,e){v.is_dynamic(a)?(d.set_translation(a,e),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_rel_v=function(a,e){v.is_dynamic(a)?(d.set_translation_rel(a,e),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};
a.set_translation_obj_rel=function(a,e,p,q,t){v.is_dynamic(a)?(g[0]=e,g[1]=p,g[2]=q,e=l.get_trans_view(t.render.world_tsr),t=l.get_quat_view(t.render.world_tsr),n.transform_vec3(g,1,t,e,g),d.set_translation(a,g),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_translation=function(a,b){b||(b=new Float32Array(3));d.get_translation(a,b);return b};a.get_translation_rel=function(a,b){b||(b=new Float32Array(3));d.get_translation_rel(a,b);return b};
a.set_rotation=function(a,e,g,l,n){v.is_dynamic(a)?(u[0]=e,u[1]=g,u[2]=l,u[3]=n,d.set_rotation(a,u),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_rel=function(a,e,g,l,n){v.is_dynamic(a)?(u[0]=e,u[1]=g,u[2]=l,u[3]=n,d.set_rotation_rel(a,u),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_quat=function(){b.error_deprecated("set_rotation_quat","set_rotation");return a.set_rotation};
a.set_rotation_v=function(a,e){v.is_dynamic(a)?(d.set_rotation(a,e),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_rel_v=function(a,e){v.is_dynamic(a)?(d.set_rotation_rel(a,e),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_quat_v=function(){b.error_deprecated("set_rotation_quat_v","set_rotation_v");return a.set_rotation_v};a.get_rotation=function(a,b){b||(b=new Float32Array(4));
d.get_rotation(a,b);return b};a.get_rotation_rel=function(a,b){b||(b=new Float32Array(4));d.get_rotation_rel(a,b);return b};a.get_rotation_quat=function(){b.error_deprecated("get_rotation_quat","get_rotation");return a.get_rotation};a.set_rotation_euler=function(a,e,l,n){v.is_dynamic(a)?(g[0]=e,g[1]=l,g[2]=n,d.set_rotation_euler(a,g),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_rel=function(a,e,l,n){v.is_dynamic(a)?(g[0]=e,
g[1]=l,g[2]=n,d.set_rotation_euler_rel(a,g),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_v=function(a,e){v.is_dynamic(a)?(d.set_rotation_euler(a,e),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_rel_v=function(a,e){v.is_dynamic(a)?(d.set_rotation_euler_rel(a,e),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};
a.set_scale=function(a,c){v.is_dynamic(a)?(d.set_scale(a,c),d.update_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale_rel=function(a,c){v.is_dynamic(a)?(d.set_scale_rel(a,c),d.update_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_scale=function(a){return d.get_scale(a)};a.get_scale_rel=function(a){return d.get_scale_rel(a)};a.empty_reset_transform=function(a){if("EMPTY"!=a.type)b.error("Wrong object: "+a.name);else{for(var e=0;e<a.cons_descends.length;e++)if(!v.is_dynamic(a.cons_descends[e])){b.error('Wrong object: "'+
a.cons_descends[e].name+'" is not dynamic.');return}d.set_translation(a,[0,0,0]);d.set_rotation(a,[0,0,0,1]);d.set_scale(a,1);d.update_transform(a);c.sync_transform(a)}};a.get_object_size=function(a){return v.is_mesh(a)?d.get_object_size(a):(b.error("Wrong object: "+a.name),0)};a.get_object_center=function(a,c,e){return v.is_mesh(a)?d.get_object_center(a,c,e):(b.error("Wrong object: "+a.name),null)};a.move_local=function(a,e,g,l){v.is_dynamic(a)?(d.move_local(a,e,g,l),d.update_transform(a),c.sync_transform(a)):
b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_x_local=function(a,f){if(v.is_dynamic(a)){var g=e.setAxisAngle(n.AXIS_X,f,u);d.rotate_local(a,g);d.update_transform(a);c.sync_transform(a)}else b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_y_local=function(a,f){if(v.is_dynamic(a)){var g=e.setAxisAngle(n.AXIS_Y,f,u);d.rotate_local(a,g);d.update_transform(a);c.sync_transform(a)}else b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_z_local=function(a,f){if(v.is_dynamic(a)){var g=
e.setAxisAngle(n.AXIS_Z,f,u);d.rotate_local(a,g);d.update_transform(a);c.sync_transform(a)}else b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_object_bounding_box=function(a){return d.get_object_bounding_box(a)};a.set_tsr=function(a,e){v.is_dynamic(a)?(d.set_tsr(a,e),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_tsr_rel=function(a,e){v.is_dynamic(a)?(d.set_tsr_rel(a,e),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+
a.name+'" is not dynamic.')};a.get_tsr=function(a,b){b||(b=new Float32Array(8));d.get_tsr(a,b);return b};a.get_tsr_rel=function(a,b){b||(b=new Float32Array(8));d.get_tsr_rel(a,b);return b};a.distance=function(a,b){return d.distance(a,b)};a.set_matrix=function(a,e){v.is_dynamic(a)?(l.from_mat4(e,q),d.set_tsr(a,q),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_matrix_rel=function(a,e){v.is_dynamic(a)?(l.from_mat4(e,q),d.set_tsr_rel(a,q),d.update_transform(a),
c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_matrix=function(a,b){b||(b=new Float32Array(16));d.get_tsr(a,q);l.to_mat4(q,b);return b};a.get_matrix_rel=function(a,b){b||(b=new Float32Array(16));d.get_tsr_rel(a,q);l.to_mat4(q,b);return b}};b4w.module.tsr=function(a,t){function v(a,b,c,q){q||(q=e.create());v(a,b,c,q);return q}t("__mat3");var c=t("__mat4"),b=t("__print"),e=t("__tsr");a.create=e.create;a.from_values=e.from_values;a.copy=e.copy;a.identity=e.identity;a.create_sep=function(a,c,e,q){b.error_deprecated("create_sep","set_sep");return v(a,c,e,q)};a.set_sep=e.set_sep;a.set_trans=e.set_trans;a.set_scale=e.set_scale;a.set_transcale=e.set_transcale;a.set_quat=e.set_quat;a.get_trans_view=e.get_trans_view;a.get_scale=e.get_scale;a.get_quat_view=
e.get_quat_view;a.invert=e.invert;a.to_mat4=function(a,b){b||(b=c.create());e.to_mat4(a,b);return b};a.from_mat4=e.from_mat4;a.multiply=e.multiply;a.transform_vec3=e.transform_vec3;a.transform_vec3_inv=e.transform_vec3_inv;a.transform_vectors=e.transform_vectors;a.transform_dir_vectors=e.transform_dir_vectors;a.transform_dir_vec3=e.transform_dir_vec3;a.transform_tangents=e.transform_tangents;a.translate=e.translate;a.interpolate=function(a,b,c,q){q||(q=e.create());e.interpolate(a,b,c,q);return q}};b4w.module.util=function(a,t){var v=t("__obj_util"),c=t("__print"),b=t("__util"),e=t("__vec3");a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.f32=function(a){return new Float32Array(a||0)};a.assert=b.assert;a.keyfind=b.keyfind;a.keysearch=b.keysearch;a.matrix_to_quat=function(a){return b.matrix_to_quat(a)};a.euler_to_quat=function(a,
c){c||(c=new Float32Array(4));return b.euler_to_quat(a,c)};a.quat_to_euler=function(a,c){c||(c=new Float32Array(3));return b.quat_to_euler(a,c)};a.sign=b.sign;a.clamp=b.clamp;a.quat_to_dir=b.quat_to_dir;a.ground_project_quat=function(a,c){return b.quat_project(a,b.AXIS_MY,b.AXIS_Y,b.AXIS_MZ,c)};a.cam_quat_to_mesh_quat=function(a,c){return b.cam_quat_to_mesh_quat(a,c)};a.quat_project=function(a,l,n,q,g){return 0!=e.dot(n,q)?(c.error("Wrong in-plane direction"),null):b.quat_project(a,l,n,q,g)};a.hash_code=
b.hash_code;a.smooth=b.smooth;a.smooth_v=b.smooth_v;a.is_vector=b.is_vector;a.correct_cam_quat_up=b.correct_cam_quat_up;a.quat_to_angle_axis=b.quat_to_angle_axis;a.random_from_array=b.random_from_array;a.xz_direction=b.xz_direction;a.line_plane_intersect=b.line_plane_intersect;a.is_mesh=function(a){c.error_deprecated("util.is_mesh","objects.is_mesh");return v.is_mesh(a)};a.is_armature=function(a){c.error_deprecated("util.is_armature","objects.is_armature");return v.is_armature(a)};a.angle_wrap_0_2pi=
b.angle_wrap_0_2pi;a.angle_wrap_periodic=b.angle_wrap_periodic;a.smooth_step=b.smooth_step;a.lerp=b.lerp};"object"==typeof module&&module.exports&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,t){t("__print");var v=t("__version");a.version=v.version;a.version_str=v.version_str;a.type=v.type;a.date=v.date;a.date_str=v.date_str};"object"==typeof module&&module.exports&&b4w.module.version(exports);b4w.module.objects=function(a,t){var v=t("__geometry"),c=t("__objects"),b=t("__obj_util"),e=t("__print"),d=t("__scenes");t("__util");a.get_meta_tags=function(a){if(a)return c.get_meta_tags(a)};a.copy=function(a,n,q){return b.is_mesh(a)?b.is_dynamic(a)?v.has_dyn_geom(a)||v.check_shape_keys(a)||!q?-1==c.get_scene_objs(d.get_active(),"MESH",c.DATA_ID_ALL).indexOf(a)?(e.error('object "'+a.name+'" does not belong to the active scene.'),!1):c.copy(a,n||"",q):(e.error('object "'+a.name+'" has not dynamic geometry for deep copying.'),
!1):(e.error('object "'+a.name+'" is not dynamic.'),!1):(e.error('object "'+a.name+'" is not of type "MESH".'),!1)};a.set_nodemat_value=function(a,d,q){b.is_mesh(a)?c.set_nodemat_value(a,d,q):e.error('The type of the object "'+a.name+'" is not "MESH".')};a.set_nodemat_rgb=function(a,d,q,g,t){b.is_mesh(a)?c.set_nodemat_rgb(a,d,q,g,t):e.error('The type of the object "'+a.name+'" is not "MESH".')};a.update_boundings=function(a){b.is_mesh(a)?v.has_dyn_geom(a)||v.check_shape_keys(a)?c.update_boundings(a):
e.error('object "'+a.name+'" has not dynamic geometry.'):e.error('The type of the object "'+a.name+'" is not "MESH".')};a.get_parent=b.get_parent;a.get_dg_parent=b.get_dg_parent;a.is_mesh=b.is_mesh;a.is_armature=b.is_armature;a.is_speaker=b.is_speaker;a.is_camera=b.is_camera;a.is_lamp=b.is_lamp;a.is_empty=b.is_empty};b4w.module.main=function(a,t){function v(){window.performance||(N.log("Apply performance workaround"),window.performance={});var a=Date.now();window.performance.now||(N.log("Apply performance.now() workaround"),window.performance.now=function(){return Date.now()-a});Q.set_timeline(0)}function c(a,b){for(var c=null,d=b?V:J,e=0;e<d.length;e++){var f=d[e];try{c=a.getContext(f,U)}catch(g){}if(c)break}c&&K.detect_tegra_invalid_enum_issue(c);return c}function b(a,b,c){a.addEventListener("webglcontextlost",
function(a){a.preventDefault();N.error("WebGL context lost");d()},!1);w.setup_context(c);var e=w.get_renderer_info();e&&N.log("%cRENDERER INFO:","color: #00a",c.getParameter(e.UNMASKED_VENDOR_WEBGL)+", "+c.getParameter(e.UNMASKED_RENDERER_WEBGL));B.setup_context(c);r.setup_context(c);I.setup_context(c);C.setup_context(c);x.setup_context(c);D.setup_context(c);h.setup_canvas(a);D.init(a,b);O.setup_dim(a.width,a.height,1);F.init();pa=g();n()}function e(){ga=function(){}}function d(){l()||(W=performance.now()/
1E3,F.pause(),L.pause(),I.pause(),u.pause())}function l(){return T<W}function n(){S(n);var a=performance.now()/1E3;aa||(aa=a);var b=a-aa;if(!(b<1/P.max_fps)){for(var c=Q.get_timeline(),d=0;d<Z.length;d++)Z[d](c,b);l()||(T>aa&&(b-=T-Math.max(W,aa)),c+=b,Q.set_timeline(c),x.update(),f.update(),h.update(),q(c,b),pa(b));aa=a}}function q(a,b){h.is_primary_loaded()&&(m.reset(),G.update(b),y.update(a,b),E.update(a,b),F.update(a,b),b&&k.update(b),h.is_primary_loaded()&&(L.update(a,b),h.is_primary_loaded()&&
(ga(b,a),h.is_primary_loaded()&&(A.update(a,b),h.is_primary_loaded()&&(u.update(),M.update(a,b),O.update(a,b),u.update_visibility(),ka&&(ka(da.toDataURL()),ka=null))))))}function g(){var a=60,b=0,c=P.fps_measurement_interval,d=P.fps_callback_interval;return function(e){e<1/P.max_fps||(a=z.smooth(1/e,a,e,c),e=L.get_fps(),b=(b+1)%d,0==b&&ba(Math.round(a),e))}}var u=t("__anchors"),k=t("__animation"),f=t("__assets"),p=t("__config"),K=t("__compat"),D=t("__container"),A=t("__controls"),h=t("__data"),x=
t("__debug"),w=t("__extensions"),r=t("__geometry"),m=t("__hud"),E=t("__nla"),y=t("__logic_nodes"),M=t("__objects"),L=t("__physics"),N=t("__print"),B=t("__renderer"),O=t("__scenes"),F=t("__sfx"),C=t("__shaders"),I=t("__textures"),Q=t("__time"),G=t("__transform");t("__armature");var z=t("__util"),Y=t("__version"),U=p.context,P=p.defaults,da=null,fa=null,aa=0,W=0,T=0,Z=[],ba=function(){},pa=function(){},ga=function(){},ka=null,J=["webgl","experimental-webgl"],V=["webgl2","experimental-webgl2"],S=function(){return window.requestAnimationFrame||
window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/P.max_fps)}}();a.init=function(a,d){p.set_paths();N.set_verbose(P.console_verbose);var e=Y.version_str()+" "+Y.type()+" ("+Y.date_str()+")";N.log("%cINIT ENGINE","color: #00a",e);if(!window.WebGLRenderingContext)return null;v();da=a;d?(m.init(d),fa=d):(p.defaults.show_hud_debug_info=!1,p.sfx.mix_mode=!1);K.apply_context_alpha_hack();
K.check_user_agent("Chrome")||(P.webgl2=!1);e=c(a,P.webgl2);!e&&P.webgl2&&(P.webgl2=!1,e=c(a,!1));if(!e)return null;N.log("%cINIT WEBGL "+(P.webgl2?"2":"1"),"color: #00a");window.gl=e;b(da,fa,e);p.apply_quality();K.set_hardware_defaults(e);C.load_shaders();P.ie11_edge_touchscreen_hack&&(a.style["touch-action"]="none");N.log("%cSET PRECISION:","color: #00a",P.precision);return e};a.set_check_gl_errors=function(a){x.set_check_gl_errors(a)};a.resize=function(a,b,c){N.error_deprecated("main.resize","container.resize");
D.resize(a,b,c)};a.set_fps_callback=function(a){ba=a};a.clear_fps_callback=function(){ba=function(){}};a.set_render_callback=function(a){ga=a};a.clear_render_callback=function(){e()};a.global_timeline=function(){return Q.get_timeline()};a.redraw=function(){N.error_once("redraw() deprecated");q(Q.get_timeline(),0)};a.pause=d;a.resume=function(){l()&&(T=performance.now()/1E3,F.resume(),L.resume(),I.play(!0),u.resume())};a.is_paused=l;a.reset=function(){h.unload(0);fa=da=null;T=W=aa=0;ba=function(){};
pa=function(){};ga=function(){};Z.length=0;Q.reset()};a.canvas_data_url=function(a){ka=a};a.get_canvas_elem=function(){return da};a.detect_mobile=function(){return K.detect_mobile()};a.append_loop_cb=function(a){for(var b=0;b<Z.length;b++)if(Z[b]==a)return;Z.push(a)};a.remove_loop_cb=function(a){for(var b=0;b<Z.length;b++)if(Z[b]==a){Z.splice(b,1);break}}};b4w.module.nla=function(a,t){var v=t("__nla"),c=t("__time"),b=t("__print"),e=t("__util");a.set_frame=function(a){a=e.clamp(a,v.get_frame_start(),v.get_frame_end());v.check_logic_nodes()?b.error("The active scene is using NLA script."):v.set_frame(a,c.get_timeline())};a.get_frame=function(){return v.get_frame(c.get_timeline())};a.stop=function(){v.check_logic_nodes()?b.error("The active scene is using NLA script."):v.stop_nla()};a.play=function(a){v.check_logic_nodes()?b.error("The active scene is using NLA script."):
v.play_nla(a)};a.is_play=function(){return v.is_play()};a.get_frame_start=function(){return v.get_frame_start()};a.get_frame_end=function(){return v.get_frame_end()};a.check_nla=function(){return v.check_nla()};a.check_nla_scripts=function(){return v.check_logic_nodes()};a.check_logic_nodes=function(){return v.check_logic_nodes()};a.set_range=function(a,c){v.check_logic_nodes()?b.error("The active scene is using NLA script."):(c=parseFloat(c)||v.get_frame_end(),a=parseFloat(a)||v.get_frame_end(),
c=e.clamp(c,v.get_frame_start(),v.get_frame_end()),a=e.clamp(a,v.get_frame_start(),c),v.set_range(a,c))};a.reset_range=function(){v.check_logic_nodes()?b.error("The active scene is using NLA script."):v.reset_range()};a.set_cyclic=function(a){v.check_logic_nodes()?b.error("The active scene is using NLA script."):v.set_cyclic(a)};a.clear_callback=function(){v.check_logic_nodes()?b.error("The active scene is using NLA script."):v.clear_callback()}};b4w.module.app=function(a,t){function v(){var a=M.is_paused();document.addEventListener("visibilitychange",function(){document.hidden?(a=M.is_paused(),M.pause()):a||M.resume()},!1)}function c(a,b,c,d){var e=document.createElement("canvas"),f=document.getElementById(a);e.style.position="absolute";e.style.left=0;e.style.top=0;e.style.width=f.offsetWidth+"px";e.style.height=f.offsetHeight+"px";e.width=f.offsetWidth*window.devicePixelRatio;e.height=f.offsetHeight*window.devicePixelRatio;b?(b=document.createElement("canvas"),
b.style.position="absolute",e.style.left=0,e.style.top=0,b.style.pointerEvents="none"):b=null;f||(N.error('Warning: canvas container "'+a+'" not found, appending to body'),f=document.body);f.appendChild(e);if(!M.init(e,b))return c&&D("Browser could not initialize WebGL","For more info visit","https://www.blend4web.com/troubleshooting",d),!1;b&&r.insert_to_container(b,"LAST");return!0}function b(a,b){a?(b&&(document.getElementById(b).style.display="block"),Q=document.getElementById(a)):(Q=document.createElement("div"),
Q.innerHTML=0,Q.style.cssText="position:absolute;top: 23px;right: 20px;font-size: 45px;line-height: 50px;font-weight: bold;color: #000;",r.insert_to_container(Q,"JUST_AFTER_CANVAS"))}function e(a,b){var c=String(a);b&&(c+="/"+String(b));Q.innerHTML=c}function d(a){a=document.getElementById(a);var b=a.cloneNode(!0);a.parentNode.replaceChild(b,a);return b}function l(){var a=r.get_container();r.resize(a.clientWidth,a.clientHeight,!0)}function n(a,b,c){var d=Math.max(h.hover_get_distance(a),1),e=O.get_rotation(a,
T);b=F.quat_to_dir(e,b,fa);b[1]=0;C.normalize(b,b);C.scale(b,d*c,b);c=O.get_translation(a,aa);C.add(c,b,c);h.set_translation(a,c)}function q(a,b){var c=h.hover_get_vertical_limits(a,ba);if(0>c.up-c.down){var d=h.get_camera_angles(a,da)[1],c=(c.down-d)/(c.down-c.up),d=h.hover_get_distance_limits(a,ba),c=Math.max(c,2/d.max);h.hover_rotate(a,0,c*b)}}function g(a,b,c,d){O.move_local(a,5*b,5*c,5*d)}function u(a,b,c){var d=O.get_translation(a,fa),e=h.target_get_pivot(a,aa),d=C.dist(d,e),e=Math.abs(b);c=
Math.pow(e*c,1-Math.pow(e*c,.15));O.move_local(a,0,0>b?.001<d?-d*c:0:c/(1-c)*d,0)}function k(a,b,c,d,e){for(a=d*c;0<b;--b)d+=a,e+=a,a=d*c;return e}function f(a,b,c,d,e,f){f?(e=h.target_get_pivot(a,fa),f=h.get_translation(a),e=C.dist(e,f)+d,d=0<b?k(a,b,-c,e,d):k(a,-b,c/(1-c),e,d)):d-=b*e*c;return d}function p(a,b,c){G=!0;z=a;Y=b;U=c;var d=B.get_active_camera(),e=!1,k=null,l=!1;switch(h.get_move_style(d)){case h.MS_TARGET_CONTROLS:e=!a;break;case h.MS_EYE_CONTROLS:k=B.get_first_character();break;case h.MS_STATIC:return;
case h.MS_HOVER_CONTROLS:l=!0}var p=h.get_velocities(d,Z);a=m.create_elapsed_sensor();if(L.has_simulated_physics(d)){var r=m.create_collision_sensor(d,null,!0);m.create_sensor_manifold(d,"CAMERA_COLLISION",m.CT_CONTINUOUS,[r],null,function(a,b,c){if(1==c&&(c=m.get_sensor_payload(a,b,0).coll_dist,0>c)){var d=m.get_sensor_payload(a,b,0).coll_norm;b=fa;C.scale(d,-.25*c,b);c=O.get_translation(a,aa);C.add(c,b,c);O.set_translation_v(a,c)}})}if(k){var r=O.get_translation(d),t=O.get_rotation(d),t=F.cam_quat_to_mesh_quat(t);
r[1]-=.5;L.set_transform(k,r,t);w.append_stiff_trans(d,k,[0,.5,0]);var v=new Float32Array(2),x=!0;L.set_character_move_type(k,L.CM_FLY);m.create_kb_sensor_manifold(d,"TOGGLE_CHAR_MOVE_TYPE",m.CT_SHOT,m.KEY_C,function(){x=!x;L.set_character_move_type(k,x?L.CM_FLY:L.CM_WALK)})}r=function(a,b,c){if(1==c)switch(c=m.get_sensor_value(a,b,0),h.get_velocities(a,p),b){case "FORWARD":k?v[0]=1:l?(b=h.get_camera_angles(a,da)[1],b=Math.abs(b)>=Math.PI/4?F.AXIS_MZ:F.AXIS_MY,n(a,b,.5*p.trans*c)):e?u(a,-p.zoom,c):
g(a,0,-p.trans*c,0);break;case "BACKWARD":k?v[0]=-1:l?(b=h.get_camera_angles(a,da)[1],b=Math.abs(b)>=Math.PI/4?F.AXIS_Z:F.AXIS_Y,n(a,b,.5*p.trans*c)):e?u(a,p.zoom,c):g(a,0,p.trans*c,0);break;case "UP":l?q(a,30*-p.zoom*c):k||g(a,0,0,-p.trans*c);break;case "DOWN":l?q(a,30*p.zoom*c):k||g(a,0,0,p.trans*c);break;case "LEFT":k?v[1]=1:l?n(a,F.AXIS_MX,.5*p.trans*c):g(a,-p.trans*c,0,0);break;case "RIGHT":k?v[1]=-1:l?n(a,F.AXIS_X,.5*p.trans*c):g(a,p.trans*c,0,0);break;case "ROT_LEFT":e?h.target_rotate(a,2*
-p.rot*c,0):h.eye_rotate(a,2*p.rot*c,0);break;case "ROT_RIGHT":e?h.target_rotate(a,2*p.rot*c,0):h.eye_rotate(a,2*-p.rot*c,0);break;case "ROT_UP":e?h.target_rotate(a,0,2*-p.rot*c):h.eye_rotate(a,0,2*p.rot*c);break;case "ROT_DOWN":e?h.target_rotate(a,0,2*p.rot*c):h.eye_rotate(a,0,2*-p.rot*c)}else switch(b){case "FORWARD":case "BACKWARD":k&&(v[0]=0);break;case "LEFT":case "RIGHT":k&&(v[1]=0)}k&&(L.set_character_move_dir(k,v[0],v[1]),a=h.get_camera_angles_char(a,P),L.set_character_rotation(k,a[0],a[1]))};
if(b)b=t=y=A=D=E=m.create_custom_sensor(0);else{b=m.create_keyboard_sensor(m.KEY_W);var t=m.create_keyboard_sensor(m.KEY_S),y=m.create_keyboard_sensor(m.KEY_A),A=m.create_keyboard_sensor(m.KEY_D),D=m.create_keyboard_sensor(m.KEY_R),E=m.create_keyboard_sensor(m.KEY_F)}var N=m.create_keyboard_sensor(m.KEY_UP),K=m.create_keyboard_sensor(m.KEY_DOWN),Q=m.create_keyboard_sensor(m.KEY_LEFT),M=m.create_keyboard_sensor(m.KEY_RIGHT),T=function(a){return a[0]&&(a[1]||a[2])};l||(m.create_sensor_manifold(d,"FORWARD",
m.CT_CONTINUOUS,[a,b],null,r),m.create_sensor_manifold(d,"BACKWARD",m.CT_CONTINUOUS,[a,t],null,r));e?(m.create_sensor_manifold(d,"ROT_UP",m.CT_CONTINUOUS,[a,N,D],T,r),m.create_sensor_manifold(d,"ROT_DOWN",m.CT_CONTINUOUS,[a,K,E],T,r),m.create_sensor_manifold(d,"ROT_LEFT",m.CT_CONTINUOUS,[a,Q,y],T,r),m.create_sensor_manifold(d,"ROT_RIGHT",m.CT_CONTINUOUS,[a,M,A],T,r)):l?(m.create_sensor_manifold(d,"LEFT",m.CT_CONTINUOUS,[a,Q,y],T,r),m.create_sensor_manifold(d,"RIGHT",m.CT_CONTINUOUS,[a,M,A],T,r),m.create_sensor_manifold(d,
"FORWARD",m.CT_CONTINUOUS,[a,N,b],T,r),m.create_sensor_manifold(d,"BACKWARD",m.CT_CONTINUOUS,[a,K,t],T,r),m.create_sensor_manifold(d,"UP",m.CT_CONTINUOUS,[a,E],T,r),m.create_sensor_manifold(d,"DOWN",m.CT_CONTINUOUS,[a,D],T,r)):(m.create_sensor_manifold(d,"UP",m.CT_CONTINUOUS,[a,D],T,r),m.create_sensor_manifold(d,"DOWN",m.CT_CONTINUOUS,[a,E],T,r),m.create_sensor_manifold(d,"LEFT",m.CT_CONTINUOUS,[a,y],T,r),m.create_sensor_manifold(d,"RIGHT",m.CT_CONTINUOUS,[a,A],T,r),m.create_sensor_manifold(d,"ROT_UP",
m.CT_CONTINUOUS,[a,N],T,r),m.create_sensor_manifold(d,"ROT_DOWN",m.CT_CONTINUOUS,[a,K],T,r),m.create_sensor_manifold(d,"ROT_LEFT",m.CT_CONTINUOUS,[a,Q],T,r),m.create_sensor_manifold(d,"ROT_RIGHT",m.CT_CONTINUOUS,[a,M],T,r));if(!c){var X=0;c=m.create_mouse_wheel_sensor();var ba=0,r=m.create_touch_zoom_sensor();m.create_sensor_manifold(d,"MOUSE_WHEEL",m.CT_LEVEL,[c],null,function(a,b,c){1==c&&(b=m.get_sensor_value(a,b,0),h.get_velocities(a,p),e||l?X=f(a,b,p.zoom,X,2,e):(p.trans*=1+b*p.zoom,h.set_velocities(a,
p)))});m.create_sensor_manifold(d,"TOUCH_ZOOM",m.CT_LEVEL,[r],null,function(a,b,c,d){1==c&&(c=m.get_sensor_value(a,b,0),h.get_velocities(a,p),m.get_sensor_payload(a,b,0)===m.PL_MULTITOUCH_MOVE_ZOOM&&(ba=f(a,c,.03*p.zoom,ba,2,e)))});m.create_sensor_manifold(d,"ZOOM_INTERPOL",m.CT_CONTINUOUS,[a],null,function(a,b,c){if(1==c&&(e||l))if(1E-5<Math.abs(X)||1E-5<Math.abs(ba)){b=m.get_sensor_value(a,b,0);c=F.smooth(X,0,b,.1*I);X-=c;var d=F.smooth(ba,0,b,.15*I);ba-=d;if(l)q(a,-(c+d));else{b=h.target_get_pivot(a,
fa);var f=h.get_translation(a,aa);.001<C.dist(b,f)+c+d?O.move_local(a,0,c+d,0):(c=C.subtract(f,b,aa),d=C.normalize(c,W),C.scale(d,.001,d),C.add(b,d,c),O.set_translation_v(a,c),ba=X=0)}}else ba=X=0})}var va=0,bb=0,ra=0,wa=0;c=m.create_mouse_move_sensor("X");r=m.create_mouse_move_sensor("Y");b=m.create_mouse_click_sensor();t=function(a,b,c,d){if(1==c){c=m.get_sensor_value(a,b,1);h.get_velocities(a,p);if(l)e=.003*p.trans,f=7.5E-4*p.rot;else var e=.003*p.rot,f=7.5E-4*p.trans;if(1===m.get_sensor_payload(a,
b,0))va+="X"==d?-c*e:0,bb+="Y"==d?-c*e:0;else if(2===m.get_sensor_payload(a,b,0)||3===m.get_sensor_payload(a,b,0))ra+="X"==d?-c*f:0,wa+="Y"==d?-c*f:0}};m.create_sensor_manifold(d,"MOUSE_X",m.CT_LEVEL,[b,c],null,t,"X");m.create_sensor_manifold(d,"MOUSE_Y",m.CT_LEVEL,[b,r],null,t,"Y");var ya=0,Wb=0,ic=0,zb=0;c=m.create_touch_move_sensor("X");r=m.create_touch_move_sensor("Y");b=function(a,b,c,d){if(1==c){var e=l?.003*p.trans:.003*p.rot;c=m.get_sensor_value(a,b,0);m.get_sensor_payload(a,b,0)===m.PL_SINGLE_TOUCH_MOVE?
(ya+="X"==d?-c*e:0,Wb+="Y"==d?-c*e:0):m.get_sensor_payload(a,b,0)===m.PL_MULTITOUCH_MOVE_PAN&&(a=l?.003*p.rot:7.5E-4*p.trans,ic+="X"==d?-c*a:0,zb+="Y"==d?-c*a:0)}};m.create_sensor_manifold(d,"TOUCH_X",m.CT_LEVEL,[c],null,b,"X");m.create_sensor_manifold(d,"TOUCH_Y",m.CT_LEVEL,[r],null,b,"Y");m.create_sensor_manifold(d,"ROT_TRANS_INTERPOL",m.CT_CONTINUOUS,[a],null,function(a,b,c){if(1==c&&(1E-5<Math.abs(va)||1E-5<Math.abs(bb)||1E-5<Math.abs(ya)||1E-5<Math.abs(Wb)||1E-5<Math.abs(ra)||1E-5<Math.abs(wa)||
1E-5<Math.abs(ic)||1E-5<Math.abs(zb))){var d=m.get_sensor_value(a,b,0),f=F.smooth(va,0,d,.08*I);b=F.smooth(bb,0,d,.08*I);va-=f;bb-=b;var g=F.smooth(ya,0,d,.12*I);c=F.smooth(Wb,0,d,.12*I);ya-=g;Wb-=c;var p=F.smooth(ra,0,d,.08*I),r=F.smooth(wa,0,d,.08*I);ra-=p;wa-=r;var q=F.smooth(ic,0,d,.12*I),d=F.smooth(zb,0,d,.12*I);ic-=q;zb-=d;e?(h.target_rotate(a,f+g,b+c),h.move_pivot(a,p+q,r+d)):l?(f+g&&n(a,F.AXIS_X,.2*(f+g)),b+c&&(f=h.get_camera_angles(a,da)[1],f=Math.abs(f)>Math.PI/4?F.AXIS_Z:F.AXIS_Y,n(a,f,
.2*(b+c))),h.hover_rotate(a,p+q,0)):(h.eye_rotate(a,.5*(f+g),.5*(b+c)),k&&(a=h.get_camera_angles_char(a,P),L.set_character_rotation(k,a[0],a[1])))}});m.create_kb_sensor_manifold(d,"DEC_STEREO_DIST",m.CT_SHOT,m.KEY_LEFT_SQ_BRACKET,function(a,b,c){b=h.get_stereo_distance(a);h.set_stereo_distance(a,.9*b)});m.create_kb_sensor_manifold(d,"INC_STEREO_DIST",m.CT_SHOT,m.KEY_RIGHT_SQ_BRACKET,function(a,b,c){b=h.get_stereo_distance(a);h.set_stereo_distance(a,1.1*b)})}function K(){var a=B.get_active_camera();
G=!1;for(var b="FORWARD BACKWARD ROT_UP ROT_DOWN ROT_LEFT ROT_RIGHT UP DOWN LEFT RIGHT MOUSE_WHEEL TOUCH_ZOOM ZOOM_INTERPOL MOUSE_X MOUSE_Y TOUCH_X TOUCH_Y ROT_TRANS_INTERPOL".split(" "),c=0;c<b.length;c++)m.remove_sensor_manifold(a,b[c]);h.get_move_style(a)==h.MS_EYE_CONTROLS&&B.get_first_character()&&w.remove(a)}function D(a,b,c,d){var e=document.createElement("div"),f=document.createElement("div"),g=document.createElement("div");if(d)for(var h=0;h<d.length;h++){var k=document.getElementById(d[h]);
k&&k.parentNode.removeChild(k)}e.style.cssText="z-index:10;width:100%;height:auto;position:absolute;top:50%;margin-top:150px;text-align:center;";f.style.cssText="color:#fff;font-size:24px;";g.style.cssText="color:#fff;font-size:20px;";f.innerHTML=a;g.innerHTML=b+'   <a style="color:#fff;font-size:20px;width:100%;" href="'+c+'">'+c.replace("https://www.","")+"</a>";e.appendChild(f);e.appendChild(g);document.body.appendChild(e)}function A(a,b,c,d,e){function f(){var h=performance.now()-g;e(b+h*(c-b)/
d);(h>=d||!a.parentNode)&&M.remove_loop_cb(f)}var g=performance.now();M.append_loop_cb(f)}t("animation");var h=t("camera"),x=t("config"),w=t("constraints"),r=t("container"),m=t("controls"),E=t("data"),y=t("debug"),M=t("main"),L=t("physics"),N=t("print"),B=t("scenes"),O=t("transform"),F=t("util"),C=t("vec3"),I=1,Q=null,G=!1,z=!1,Y=!1,U=!1,P=new Float32Array(2),da=new Float32Array(2),fa=new Float32Array(3),aa=new Float32Array(3),W=new Float32Array(3),T=new Float32Array(4),Z={},ba={};a.init=function(a){a=
a||{};var d=!1,f=null,g=function(){},h=null,k=null,n=0,p=null,q=!1,t=!0,u=!0,w=!0,B=!1,y=!1,z=!1,F=!1,C;for(C in a)switch(C){case "canvas_container_id":f=a.canvas_container_id;break;case "callback":g=a.callback;break;case "autoresize":d=a.autoresize;break;case "do_not_use_onload":break;case "gl_debug":q=a.gl_debug;break;case "show_hud_debug_info":z=a.show_hud_debug_info;break;case "sfx_mix_mode":B=a.sfx_mix_mode;break;case "show_fps":y=a.show_fps;break;case "track_container_position":F=a.track_container_position;
break;case "fps_wrapper_id":p=a.fps_wrapper_id;break;case "fps_elem_id":k=a.fps_elem_id;break;case "error_purge_elements":h=a.error_purge_elements;break;case "report_init_failure":w=a.report_init_failure;break;case "pause_invisible":u=a.pause_invisible;break;case "key_pause_enabled":t=a.key_pause_enabled;break;case "force_container_ratio":n=a.force_container_ratio;break;default:x.set(C,a[C])}a=function(a){a.keyCode==m.KEY_P&&(M.is_paused()?M.resume():M.pause())};t&&document.addEventListener("keydown",
a,!1);x.set("show_hud_debug_info",z);x.set("sfx_mix_mode",B);var A=z||B||null,t=function(){var a=c(f,A,w,h),m=r.get_canvas();if(a){var t=r.get_container();l();M.set_check_gl_errors(q);y&&(b(k,p),M.set_fps_callback(e));u&&v();n&&M.append_loop_cb(function(){t.style.height=t.clientWidth/n+"px"});d&&M.append_loop_cb(function(){var a=t.clientWidth,b=t.clientHeight;a==m.clientWidth&&b==m.clientHeight||r.resize(a,b,!0)});F&&M.append_loop_cb(function(){r.force_offsets_updating()});g(m,!0)}else g(m,!1)};"complete"==
document.readyState?window.setTimeout(t,0):window.addEventListener("load",t,!1);window.addEventListener("unload",function(){E.cleanup()},!1)};a.resize_to_container=l;a.set_onclick=function(a,b){var c=d(a);c.addEventListener("mouseup",function(a){b(c.value)},!1)};a.set_onchange=function(a,b){var c=d(a);c.addEventListener("change",function(a){a=c.checked;b(void 0!=a?a:c.value)},!1)};a.set_onkeypress=function(a,b){var c=d(a);c.addEventListener("keypress",function(a){b(a.keyCode,c.value)},!1)};a.enable_camera_controls=
p;a.disable_camera_controls=K;a.set_camera_move_style=function(a){var b=G;b&&K();var c=B.get_active_camera();h.set_move_style(c,a);b&&p(z,Y,U)};a.enable_object_controls=function(a){var b=L.is_vehicle_chassis(a)||L.is_vehicle_hull(a),c=function(a,c,d){if(1==d)switch(d=m.get_sensor_value(a,c,0),c){case "FORWARD":b?L.vehicle_throttle(a,1):O.move_local(a,0,0,1*d);break;case "BACKWARD":b?L.vehicle_throttle(a,-1):O.move_local(a,0,0,-1*d);break;case "LEFT":b?L.vehicle_steer(a,-1):O.move_local(a,1*d,0,0);
break;case "RIGHT":b?L.vehicle_steer(a,1):O.move_local(a,-1*d,0,0)}else switch(c){case "FORWARD":case "BACKWARD":b&&L.vehicle_throttle(a,0);break;case "LEFT":case "RIGHT":b&&L.vehicle_steer(a,0)}},d=m.create_elapsed_sensor(),e=m.create_keyboard_sensor(m.KEY_W),f=m.create_keyboard_sensor(m.KEY_S),g=m.create_keyboard_sensor(m.KEY_A),h=m.create_keyboard_sensor(m.KEY_D),k=m.create_keyboard_sensor(m.KEY_UP),l=m.create_keyboard_sensor(m.KEY_DOWN),n=m.create_keyboard_sensor(m.KEY_LEFT),p=m.create_keyboard_sensor(m.KEY_RIGHT),
r=function(a){return a[0]&&(a[1]||a[2])};m.create_sensor_manifold(a,"FORWARD",m.CT_CONTINUOUS,[d,e,k],r,c);m.create_sensor_manifold(a,"BACKWARD",m.CT_CONTINUOUS,[d,f,l],r,c);m.create_sensor_manifold(a,"LEFT",m.CT_CONTINUOUS,[d,g,n],r,c);m.create_sensor_manifold(a,"RIGHT",m.CT_CONTINUOUS,[d,h,p],r,c)};a.disable_object_controls=function(a){for(var b=["FORWARD","BACKWARD","LEFT","RIGHT"],c=0;c<b.length;c++)m.remove_sensor_manifold(a,b[c])};a.enable_controls=function(a){var b=r.get_container();a=a||!1;
m.register_keyboard_events(document,!1);m.register_mouse_events(b,!0,a);m.register_wheel_events(b,!0);m.register_touch_events(b,!0);m.register_device_orientation()};a.disable_controls=function(){var a=r.get_container();m.unregister_keyboard_events(document);m.unregister_mouse_events(a);m.unregister_wheel_events(a);m.unregister_touch_events(a);m.unregister_device_orientation()};a.enable_debug_controls=function(){m.create_kb_sensor_manifold(null,"CAMERA_SHOT",m.CT_SHOT,m.KEY_K,function(){y.make_camera_frustum_shot()});
m.create_kb_sensor_manifold(null,"LIGHT_SHOT",m.CT_SHOT,m.KEY_L,function(){y.make_light_frustum_shot()});m.create_kb_sensor_manifold(null,"TELEMETRY",m.CT_SHOT,m.KEY_T,function(){y.plot_telemetry()})};a.request_fullscreen=function(a,b,c){function d(){document.fullscreenElement===a||document.webkitFullScreenElement===a||document.mozFullScreenElement===a||document.webkitIsFullScreen||document.msFullscreenElement===a?b():(document.removeEventListener("fullscreenchange",d,!1),document.removeEventListener("webkitfullscreenchange",
d,!1),document.removeEventListener("mozfullscreenchange",d,!1),document.removeEventListener("MSFullscreenChange",d,!1),c())}b=b||function(){};c=c||function(){};document.addEventListener("fullscreenchange",d,!1);document.addEventListener("webkitfullscreenchange",d,!1);document.addEventListener("mozfullscreenchange",d,!1);document.addEventListener("MSFullscreenChange",d,!1);a.requestFullScreen=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullscreen;a.requestFullScreen==
a.webkitRequestFullScreen?a.requestFullScreen(Element.ALLOW_KEYBOARD_INPUT):a.requestFullScreen()};a.exit_fullscreen=function(){var a=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;if("function"!=typeof a)throw"B4W App: exit fullscreen method is not supported";a.apply(document)};a.check_fullscreen=function(){return window.document.fullscreenEnabled||window.document.mozFullScreenEnabled||window.document.msFullscreenEnabled||window.document.webkitFullscreenEnabled?
!0:!1};a.report_app_error=D;a.get_url_params=function(a){a=!!a;var b=location.href.toString();if(-1==b.indexOf("?"))return null;for(var b=b.split("?")[1].split("&"),c={},d=0;d<b.length;d++){var e=b[d].split("="),f=e[0];1<e.length?(e=e[1],a?f in c?c[f].push(e):c[f]=[e]:c[f]=e):a?f in c||(c[f]=[]):c[f]=""}return c};a.css_animate=function(a,b,c,d,e,f,g,h){function k(e){a&&(l[b]=f+e+g,c>d&&e<=d||c<d&&e>=d)&&(l[b]=f+d+g,h())}if(a&&b&&isFinite(c)&&isFinite(d)&&isFinite(e)){f=f||"";g=g||"";h=h||function(){};
var l=a.style,m=b.charAt(0).toUpperCase()+b.slice(1);if(void 0==l[b])if(void 0!=l["webkit"+m])b="webkit"+m;else if(void 0!=l["ms"+m])b="ms"+m;else if(void 0!=l["moz"+m])b="moz"+m;else return;A(a,c,d,e,k)}};a.attr_animate=function(a,b,c,d,e,f){function g(e){a&&(0<=e&&a.setAttribute(b,e),c>d&&e<=d||c<d&&e>=d)&&(a.setAttribute(b,d),f())}a&&b&&isFinite(c)&&isFinite(d)&&isFinite(e)&&(f=f||function(){},A(a,c,d,e,g))};a.queue_animate=function(b){if(b.length){var c=b.shift(),d=c.elem,e=c.prop,f=c.from,g=
c.to,h=c.duration,k=c.opt_prefix,l=c.opt_suffix,m=function(){c.cb&&c.cb();a.queue_animate(b)};"css"==c.type?a.css_animate(d,e,f,g,h,k,l,m):"attr"==c.type&&a.attr_animate(d,e,f,g,h,m)}};a.set_camera_smooth_factor=function(a){I=a};a.get_camera_smooth_factor=function(){return I}};b4w.module.camera_anim=function(a,t){function v(a,b,c,d){b=g.angle_wrap_0_2pi(a-b);a=g.angle_wrap_0_2pi(c-a);if(1E-6>Math.abs(b)||1E-6>2*Math.PI-Math.abs(b))b=0;if(1E-6>Math.abs(a)||1E-6>2*Math.PI-Math.abs(a))a=0;d[0]=b;d[1]=a;return d}var c=t("camera"),b=t("controls"),e=t("print"),d=t("scenes"),l=t("time"),n=t("transform"),q=t("tsr"),g=t("util"),u=t("vec3"),k=t("quat"),f=new Float32Array(2),p=new Float32Array(2),K=new Float32Array(3),D=new Float32Array(3),A=new Float32Array(3),h=new Float32Array(4),
x=q.create(),w=q.create(),r=q.create(),m={},E=!1,y=!1,M=!1,L=!1;a.track_to_target=function(a,d,l,m,p,r,q,t){if(!c.is_eye_camera(a))e.error("track_to_target(): wrong object");else if(a&&d){if(g.is_vector(d))var v=d;else v=A,n.get_object_center(d,!1,v);d=l||1;l=m||2;var w=p||1;p=r||1;D[0]=0;D[1]=-1;D[2]=0;var x=n.get_rotation(a);r=g.quat_to_dir(x,D);m=c.get_camera_angles(a,f);var y=n.get_translation(a);u.subtract(v,y,K);u.normalize(K,K);var E=k.rotationTo(r,K,k.create());k.multiply(E,x,h);g.correct_cam_quat_up(h,
!1);u.subtract(v,y,D);var L=u.length(D)*(1-1/l),v=Math.asin(K[1]);l=Math.acos(-K[2]/Math.abs(Math.cos(v)));0<K[0]&&(l=2*Math.PI-l);var M=l-m[0],W=v-m[1];A[0]=0;A[1]=0;A[2]=-1;l=n.get_rotation(a);0>g.quat_to_dir(l,A)[1]?(W=0<r[1]?v-Math.PI+m[1]:v+Math.PI+m[1],M=0<M?-Math.PI+M:Math.PI+M):Math.abs(M)>Math.PI&&(M=0<M?M-2*Math.PI:M+2*Math.PI);var T=0,v=b.create_elapsed_sensor();r=Math.abs(M/d);d=Math.abs(W/d);var Z=r>d?r:d,ba=Z+w,pa=ba+p,ga=pa+w,ka=M,J=W,V=L,S=function(){b.remove_sensor_manifold(a,"TRACK_TO_TARGET");
q&&q()};b.create_sensor_manifold(a,"TRACK_TO_TARGET",b.CT_CONTINUOUS,[v],null,function(a,d,e){if(e)if(c.is_eye_camera(a))if(e=b.get_sensor_value(a,d,0),T+=e,T<Z){var f=M/Z*e;e*=W/Z;d=T/Z;d=6*d*(1-d);f*=d;e*=d;ka-=f;J-=e;c.eye_rotate(a,f,e)}else T<ba?(ka&&(c.eye_rotate(a,ka,J),ka=0,t&&t()),d=(T-Z)/w,e=-L*e/w,V-=f,n.move_local(a,0,6*e*d*(1-d),0)):T<pa?V&&(n.move_local(a,0,V,0),V=0):T<ga?(d=(T-pa)/w,e=L*e/w,e=6*e*d*(1-d),n.move_local(a,0,e,0)):(n.set_translation_v(a,y),S());else S()})}};a.auto_rotate=
function(a,h,k){function l(d,e,h){if(1==h)if(h=c.get_move_style(d),h==c.MS_STATIC)n();else if(h!=c.MS_TARGET_CONTROLS&&h!=c.MS_EYE_CONTROLS||!c.has_horizontal_limits(d))q=null,e=b.get_sensor_value(d,e,0),c.rotate_camera(d,e*a,0);else{h=h==c.MS_EYE_CONTROLS?c.eye_get_horizontal_limits(d,m):c.target_get_horizontal_limits(d,m);if(null===q||h.left!=q.left||h.right!=q.right){q=q||{};q.left=h.left;q.right=h.right;t=Math.min(.2,g.angle_wrap_0_2pi(q.right-q.left)/2);h=q;var k=c.get_camera_angles(r,f)[0];
h=v(k,h.left,h.right,p);u=a*Math.min(1,h[0]/.2,h[1]/.2)}e=b.get_sensor_value(d,e,0);h=c.get_camera_angles(d,f)[0];h=v(h,q.left,q.right,p);h[1]>t&&h[0]>t?u=g.sign(u)*a:h[1]<t?u-=Math.pow(a,2)/.4*e:h[0]<t&&(u+=Math.pow(a,2)/.4*e);c.rotate_camera(d,e*u,0)}}function n(){b.remove_sensor_manifold(r,"AUTO_ROTATE");b.remove_sensor_manifold(r,"DISABLE_AUTO_ROTATE");h()}h=h||function(){};var r=d.get_active_camera();if(c.is_static_camera(r))e.error("auto_rotate(): Wrong camera move style");else{var q={},t=0,
u=0;if(b.check_sensor_manifold(r,"AUTO_ROTATE"))n();else{var w=b.create_mouse_move_sensor("X"),x=b.create_mouse_move_sensor("Y"),y=b.create_mouse_click_sensor(),A=b.create_touch_move_sensor(),D=b.create_touch_zoom_sensor(),E=b.create_elapsed_sensor();k=k?b.create_mouse_wheel_sensor():b.create_custom_sensor(0);b.create_sensor_manifold(r,"DISABLE_AUTO_ROTATE",b.CT_LEVEL,[w,x,y,A,D,k],function(a){return a[0]&&a[2]||a[1]&&a[2]||a[3]||a[4]||a[5]},n);b.create_sensor_manifold(r,"AUTO_ROTATE",b.CT_CONTINUOUS,
[E],function(a){return a[0]},l)}}};a.is_auto_rotate=function(){var a=d.get_active_camera();return b.check_sensor_manifold(a,"AUTO_ROTATE")};a.check_auto_rotate=function(){var a=d.get_active_camera();return c.get_move_style(a)==c.MS_STATIC?!1:!0};a.move_camera_to_point=function(a,b,d,f,h){if(c.get_move_style(a)!=c.MS_STATIC)e.error("move_camera_to_point(): wrong camera type");else if(!E)if(a)if(b){d=d||1;f=f||.01;var k=g.is_vector(a)?a:n.get_tsr(a,x),m=g.is_vector(b)?b:n.get_tsr(b,w);b=u.distance(q.get_trans_view(k),
q.get_trans_view(m))/d;d=g.quat_to_dir(q.get_quat_view(k),g.AXIS_MY,K);var p=g.quat_to_dir(q.get_quat_view(m),g.AXIS_MY,D);d=Math.min(Math.abs(u.dot(d,p)),1);f=Math.acos(d)/f;f=1E3*Math.max(b,f);E=!0;var t=l.animate(0,1,f,function(b){var c=q.interpolate(k,m,g.smooth_step(b),r);M?(l.clear_animation(t),E=M=!1):(n.set_tsr(a,c),1==b&&(E=!1,h&&h()))})}else e.error("move_camera_to_point(): you must specify the point object");else e.error("move_camera_to_point(): you must specify the camera object")};a.rotate_camera=
function(a,b,d,f,g){if(!y)if(a)if(b||d){y=!0;var h=0,k=0,m=0!=b?b:d,n=l.animate(0,m,f||1E3,function(e){L?(l.clear_animation(n),y=L=!1):(h-=e,k-=e,d&&b?c.rotate_camera(a,h,k):d?c.rotate_camera(a,0,k):b&&c.rotate_camera(a,h,0),k=h=e,e==m&&(y=!1,g&&g()))})}else e.error("rotate_camera(): you must specify the rotation angle");else e.error("rotate_camera(): you must specify the camera object")};a.stop_cam_moving=function(){M=!0};a.stop_cam_rotating=function(){L=!0};a.is_moving=function(){return E};a.is_rotating=
function(){return y}};b4w.module.gyroscope=function(a,t){function v(a){var b=c.create_gyro_angles_sensor(),p=!0;c.create_sensor_manifold(a,"CAMERA_ROTATE_GYRO",c.CT_CONTINUOUS,[b],null,function(a,b,f){if(0<f){l=c.get_sensor_payload(a,b,0);p&&(d[0]=l[0],d[1]=l[1],d[2]=l[2],p=!1);f=b=0;0==window.orientation&&(b=l[1]-d[1],f=l[0]-d[0],l[1]>q&&l[1]<n&&(f=0));if(180==window.orientation){b=l[1]-d[1];0>l[1]&&(b=-b);f=d[0]-l[0];if(b>Math.PI/2||b<-Math.PI/2)b=0;l[1]>-n&&l[1]<-q&&(f=0)}if(-90==window.orientation){b=l[0]-d[0];if(b>
Math.PI/2||b<-Math.PI/2)b=0;f=d[1]-l[1];if(l[0]>g||l[0]<u)f=0}if(90==window.orientation){b=d[0]-l[0];if(b>Math.PI/2||b<-Math.PI/2)b=0;f=l[1]-d[1];if(l[0]>g||l[0]<u)f=0}e.rotate_camera(a,f,b);d[0]=l[0];d[1]=l[1];d[2]=l[2]}})}var c=t("controls"),b=t("scenes"),e=t("camera"),d=new Float32Array(3),l=new Float32Array(3),n=110*Math.PI/180,q=70*Math.PI/180,g=70*Math.PI/180,u=70*-Math.PI/180;a.enable_camera_rotation=function(){var a=b.get_active_camera();v(a)}};b4w.module.mixer=function(a,t){function v(){A=D.length=0;h=c(100);x=new Float32Array(h.length);w=new Float32Array(h.length);var a=p.get_speaker_objects();if(a.length){D.push(b());for(var e=0;e<a.length;e++)D.push(d(a[e]));D.sort(function(a,b){return"MASTER"==a.id?-1:"MASTER"==b.id?1:"COMPRESSOR"==a.id?-1:"COMPRESSOR"==b.id?1:a.id.toUpperCase()<b.id.toUpperCase()?-1:a.id.toUpperCase()>b.id.toUpperCase()?1:0})}}function c(a){for(var b=new Float32Array(a),c=0,d=0;d<a;d++)b[d]=20*Math.pow(1E3,c),c+=1/
(a-1);return b}function b(){var a=e("MASTER");a.params.push(["VOLUME",p.get_volume(null),0,1,50,!1]);var b=p.get_compressor_params();b&&(a.params.push(["THRESHOLD",b.threshold,-100,0,100,!1]),a.params.push(["KNEE",b.knee,0,40,40,!1]),a.params.push(["RATIO",b.ratio,1,20,20,!1]),a.params.push(["ATTACK",b.attack,0,1,1E3,!1]),a.params.push(["RELEASE",b.release,0,1,1E3,!1]));a.mute=p.is_muted(null)?1:0;a.solo=-1;return a}function e(a){return{id:a,params:[],active_param:0,mute:-1,solo:-1,speaker:null}}
function d(a){var b=e(f.get_object_name(a));b.mute=p.is_muted(a)?1:0;b.solo=0;b.speaker=a;return b}function l(a){if(a.speaker){a.params.length=0;a.params.push(["VOLUME",p.get_volume(a.speaker),0,1,50,!1]);var b=p.get_positional_params(a.speaker);b&&(a.params.push(["DIST_REF",b.dist_ref,0,1E3,1E4,!1]),a.params.push(["ATTENUATION",b.attenuation,0,50,1E3,!1]),a.params.push(["DIST_MAX",b.dist_max,0,1E4,1E4,!1]));if(b=p.get_filter_params(a.speaker))a.params.push(["EQ_FREQ",b.freq,20,2E4,100,!0]),a.params.push(["EQ_Q",
b.Q,0,10,100,!1]),a.params.push(["EQ_GAIN",b.gain,-70,30,100,!1]);K.clamp(a.active_param,0,a.params.length-1)}}function n(a){for(var b=0;b<D.length;b++){var c=D[b];if(c!=a&&1==c.solo)return!0}return!1}function q(a){for(var b=0;b<D.length;b++){var c=D[b];c!=a&&0==c.mute&&0==c.solo&&p.mute(c.speaker,!1)}}function g(){if(0==D.length)return[0,-1];var a=8*Math.floor(A/8),b=a+7,a=K.clamp(a,0,D.length-1),b=K.clamp(b,0,D.length-1);return[a,b]}var u=t("controls");t("debug");var k=t("hud"),f=t("scenes"),p=
t("sfx"),K=t("util"),D=[],A=0,h=null,x=null,w=null;a.enable_mixer_controls=function(){v();var a=u.create_keyboard_sensor(u.KEY_LEFT_SQ_BRACKET),b=u.create_keyboard_sensor(u.KEY_RIGHT_SQ_BRACKET),c=u.create_keyboard_sensor(u.KEY_SEMI_COLON),d=u.create_keyboard_sensor(u.KEY_SINGLE_QUOTE),e=u.create_keyboard_sensor(u.KEY_SHIFT),f=u.create_timer_sensor(.15,!0),t=u.create_timer_sensor(.05,!0),a=[a,b,c,d,e,f,t],b=function(a,b,c){if(1==c){c=Boolean(u.get_sensor_value(a,b,0))?-1:1;if(D.length){1==c&&A<D.length-
1?A++:-1==c&&0<A&&A--;c=g();for(var d=c[0];d<=c[1];d++)l(D[d])}"SWITCH_STRIP"==b?u.reset_timer_sensor(a,b,5,.15+.3):u.reset_timer_sensor(a,b,5,.15)}else u.reset_timer_sensor(a,b,5,10)};u.create_sensor_manifold(null,"SWITCH_STRIP",u.CT_TRIGGER,a,function(a){return(a[0]||a[1])&&!a[4]},b);u.create_sensor_manifold(null,"SWITCH_STRIP_HOLD",u.CT_SHOT,a,function(a){return(a[0]||a[1])&&!a[4]&&a[5]},b);u.create_sensor_manifold(null,"SWITCH_PARAM",u.CT_SHOT,a,function(a){return(a[0]||a[1])&&a[4]},function(a,
b,c){a=Boolean(u.get_sensor_value(a,b,0))?-1:1;(b=D[A])&&(1==a&&b.active_param<b.params.length-1?b.active_param++:-1==a&&0<b.active_param&&b.active_param--)});b=function(a,b,c){if(1==c){var d=Boolean(u.get_sensor_value(a,b,2))?-1:1,e=D[A];if(e)switch(c=e.params[e.active_param],c[1]=c[5]?c[1]*Math.pow(c[3]/c[2],d/c[4]):c[1]+(c[3]-c[2])/c[4]*d,c[1]=K.clamp(c[1],c[2],c[3]),c[0]){case "VOLUME":"MASTER"!=e.id?p.set_volume(e.speaker,c[1]):p.set_volume(null,c[1]);break;case "DIST_REF":d=p.get_positional_params(e.speaker);
d.dist_ref=c[1];p.set_positional_params(e.speaker,d);break;case "ATTENUATION":d=p.get_positional_params(e.speaker);d.attenuation=c[1];p.set_positional_params(e.speaker,d);break;case "DIST_MAX":d=p.get_positional_params(e.speaker);d.dist_max=c[1];p.set_positional_params(e.speaker,d);break;case "EQ_FREQ":d=p.get_filter_params(e.speaker);d.freq=c[1];p.set_filter_params(e.speaker,d);break;case "EQ_Q":d=p.get_filter_params(e.speaker);d.Q=c[1];p.set_filter_params(e.speaker,d);break;case "EQ_GAIN":d=p.get_filter_params(e.speaker);
d.gain=c[1];p.set_filter_params(e.speaker,d);break;case "THRESHOLD":e=p.get_compressor_params();e.threshold=c[1];p.set_compressor_params(e);break;case "KNEE":e=p.get_compressor_params();e.knee=c[1];p.set_compressor_params(e);break;case "RATIO":e=p.get_compressor_params();e.ratio=c[1];p.set_compressor_params(e);break;case "ATTACK":e=p.get_compressor_params();e.attack=c[1];p.set_compressor_params(e);break;case "RELEASE":e=p.get_compressor_params();e.release=c[1];p.set_compressor_params(e);break;default:throw"Unknown strip param";
}"INC_DEC"==b?u.reset_timer_sensor(a,b,6,.35):u.reset_timer_sensor(a,b,6,.05)}else u.reset_timer_sensor(a,b,6,10)};u.create_sensor_manifold(null,"INC_DEC",u.CT_TRIGGER,a,function(a){return(a[2]||a[3])&&!a[4]},b);u.create_sensor_manifold(null,"INC_DEC_HOLD",u.CT_SHOT,a,function(a){return(a[2]||a[3])&&!a[4]&&a[6]},b);u.create_sensor_manifold(null,"MUTE_SOLO",u.CT_SHOT,a,function(a){return(a[2]||a[3])&&a[4]},function(a,b,c){if(Boolean(u.get_sensor_value(a,b,2)))(a=D[A])&&0<=a.mute&&("MASTER"!=a.id?0==
a.mute?(a.mute=1,p.mute(a.speaker,!0),1==a.solo&&(a.solo=0,n(a)||q(a))):(a.mute=0,n(a)||p.mute(a.speaker,!1)):0==a.mute?(a.mute=1,p.mute(null,!0)):(a.mute=0,p.mute(null,!1)));else if((a=D[A])&&0<=a.solo)if(0==a.solo)for(a.solo=1,p.mute(a.speaker,!1),1==a.mute&&(a.mute=0),b=0;b<D.length;b++)c=D[b],c!=a&&0==c.mute&&0==c.solo&&p.mute(c.speaker,!0);else a.solo=0,n(a)?p.mute(a.speaker,!0):q(a)});a=u.create_elapsed_sensor();u.create_sensor_manifold(null,"MIXER_DRAW",u.CT_CONTINUOUS,[a],null,function(){if(D[A])for(var a=
g(),b=a[0];b<=a[1];b++){var c=D[b];k.draw_mixer_strip(c.id,b==A,b%8,c.params,c.active_param,c.mute,c.solo);if(c.speaker&&p.get_filter_params(c.speaker)){p.get_filter_freq_response(c.speaker,h,x,w);for(c=0;c<x.length;c++)x[c]=20*Math.log(x[c])/Math.LN10;k.plot_array("EQ",b%8,x,20,2E4,-10,10)}}});a=u.create_timer_sensor(1,!0);u.create_sensor_manifold(null,"MIXER_UPDATE",u.CT_TRIGGER,[a],null,function(){for(var a=g(),b=a[0];b<=a[1];b++)l(D[b])})}};b4w.module.npc_ai=function(a,t){function v(a,b){var c=b.destination,d=A;f.get_translation(b.empty,d);var e=h;f.get_translation(b.collider,e);var g=0;b.y_cor_water?g=b.y_cor_water:b.y_correction&&(g=b.y_correction,b.type==y&&(g*=.5),b.type==L&&(g*=a));switch(b.type){case y:if(b.random&&b.reached){c[0]=(12*Math.random()-6)*b.speed+d[0];c[2]=(12*Math.random()-6)*b.speed+d[2];var k=m,d=x,q=b.speed,t=b.rot_speed;f.get_rotation(b.collider,k);K.transformQuat(p.AXIS_Z,k,d);d[1]=0;K.normalize(d,d);k=Math.sin(t/
2);q=.5*q/k;k=K.dist(c,e);k<2*q&&K.scaleAndAdd(c,d,2*q-k,c);b.reached=!1}c[1]=e[1];g&&(c[1]+=g);break;case M:case L:b.random&&b.reached&&(b.type==L?(b.speed=Math.random()+.1,q=b.max_depth-b.min_depth):q=b.max_height-b.min_height,c[0]=10*Math.random()-5+d[0],c[1]=e[1]+(Math.random()*q-.5*q),c[2]=10*Math.random()-5+d[2],b.reached=!1);g&&(c[1]=e[1]+g);break}var c=A,q=h,k=x,e=E,v=b.rig,d=b.collider,g=b.destination,D=b.speed,P=b.actions,da=n.get_current_anim_name(v);if(!n.is_play(v)||!P.idle||-1==P.idle.indexOf(da)){f.get_translation(d,
c);var t=g[0]-c[0],fa=g[2]-c[2],t=Math.sqrt(t*t+fa*fa);if(t>2*D*a)b.state=20,p.xz_direction(g,c,k),P=b.rig,n.is_animated(P)&&(v=b.speed,D=n.get_frame(P),P=n.get_anim_length(P),v*=P/24*(1-D/P),.9>t/v&&K.scaleAndAdd(g,k,v-t,g)),t=m,v=w,f.get_rotation(b.collider,t),K.transformQuat(p.AXIS_Z,t,q),v[0]=q[0],v[1]=0,v[2]=q[2],K.normalize(v,v),D=K.dot(v,k),P=Math.acos(D),P=Math.abs(P)/Math.PI,P=a/P*b.rot_speed*b.rotation_mult,u.rotationTo(v,k,e),u.rotationTo(p.AXIS_Z,v,t),1<=Math.abs(D)?u.copy(t,e):(u.multiply(e,
t,e),u.slerp(t,e,Math.min(P,1),e)),k=a,b.type!=M&&(k=Math.max(k,1/60),t=r,v=m,q=Math.asin(q[1]),u.setAxisAngle(p.AXIS_X,-q,v),q=Math.atan(b.y_correction/(b.speed*k)),u.setAxisAngle(p.AXIS_X,-q,t),u.slerp(v,t,k,t),u.multiply(e,t,e)),f.set_rotation_v(d,e),d=x,q=w,p.quat_to_dir(e,p.AXIS_Z,d),K.scale(d,b.speed*a,q),K.add(q,c,q),q[1]=b.type!=y?(g[1]-c[1])*a*.1+c[1]:g[1],f.set_translation_v(b.collider,q);else if(b.type==y)P.move?da&&-1!=P.move.indexOf(da)&&n.is_play(v)?b.state=20:(b.state=10,b.reached=
!0):(b.state=10,b.reached=!0);else if(b.type==L||b.type==M)b.reached=!0;if(l(b)&&(c=b.rig,!n.is_play(c))){e=null;switch(b.state){case 10:e=b.actions;e=e.idle?p.random_from_array(e.idle):null;break;case 20:e=n.get_current_anim_name(b.rig),d=g=b.actions,d.move_blends&&-1==d.move_blends.indexOf(e)&&d.move&&-1!=d.move.indexOf(e)&&.33<Math.random()?(g=b.actions,e=g.move.indexOf(e),e=g.move_blends[e]):(d=b.actions,d.move&&(-1!=d.move.indexOf(e)||!d.move_blends&&!d.move_start||!d.move_start&&!e||d.move_blends&&
-1!=d.move_blends.indexOf(e)||d.move_start&&-1!=d.move_start.indexOf(e))?(g=b.actions,g.move_blends?(d=g.move_blends.indexOf(e),-1!=d?(e=d+1,e=e<g.move.length?e:0,e=g.move[e]):e=-1!=g.move.indexOf(e)?e:p.random_from_array(g.move)):e=p.random_from_array(g.move)):(d=b.actions,e=d.move_start&&-1==d.move_start.indexOf(e)&&d.move&&-1==d.move.indexOf(e)?p.random_from_array(g.move_start):null))}e&&(n.apply(c,e),n.set_behavior(c,n.AB_FINISH_RESET),n.set_frame(c,0),n.play(c))}}}function c(a,b,c,d){if(d)if(1==
c)switch(d.type){case M:a:{for(c=0;3>c;c++){var e=q.get_sensor_payload(a,b,c).hit_fract;if(e){b=e;break a}}b=void 0}a=100*b;d.y_correction=a<d.min_height?10:a>d.max_height?-10:0;break;case y:a=q.get_sensor_payload(a,b,0).hit_fract;d.y_correction=d.prev_hit_pos==a?0:1-100*a;d.prev_hit_pos=a;break;case L:a=q.get_sensor_payload(a,b,0).hit_fract,"CLOSE_GROUND"==b?(d.y_correction=100*a-1,d.y_correction=.1>d.y_correction?.05:0):"CLOSE_WATER"==b&&(d.y_cor_water=100*a,d.y_cor_water=d.y_cor_water<d.min_depth?
-.02:d.y_cor_water>d.max_depth?.02:0)}else d.y_correction=0}function b(){for(var a=0;a<D.length;a++){var b=D[a];e(b);d(b);b.rig&&n.get_current_anim_name(b.rig)&&n.play(b.rig)}}function e(a){var b=K.create(),d=a.collider;switch(a.type){case M:var e=q.create_ray_sensor(d,b,[0,-100,0],"TERRAIN",!0),f=q.create_ray_sensor(d,b,[0,-100,0],"STONE",!0),b=q.create_ray_sensor(d,b,[0,-100,0],"WATER",!0),e=[e,f,b];q.create_sensor_manifold(d,"CLOSE_GROUND",q.CT_CONTINUOUS,e,function(a){return a[0]||a[1]||a[2]},
c,a);break;case y:e=q.create_ray_sensor(d,[0,1,0],[0,-99,0],"TERRAIN",!0);e=[e];q.create_sensor_manifold(d,"CLOSE_GROUND",q.CT_CONTINUOUS,e,null,c,a);break;case L:e=q.create_ray_sensor(d,[0,1,0],[0,-99,0],"TERRAIN",!0),b=q.create_ray_sensor(d,b,[0,100,0],"WATER",!0),e=[e],q.create_sensor_manifold(d,"CLOSE_WATER",q.CT_CONTINUOUS,[b],null,c,a),q.create_sensor_manifold(d,"CLOSE_GROUND",q.CT_CONTINUOUS,e,null,c,a)}}function d(a){function b(c,d,e){1==e?(f.get_translation(a.empty,a.destination),a.rotation_mult=
4):a.rotation_mult=1}var c=a.collider;if(a.type==y){var d=q.create_collision_sensor(c,"CONSTRUCTION",!1);q.create_sensor_manifold(c,"CONSTRUCTION_COLL",q.CT_CONTINUOUS,[d],null,b)}}function l(a){var b=a.rig;if(!n.is_play(b))return!0;b=n.get_current_anim_name(b);if(!b)return!0;var c=a.actions;switch(a.state){case 10:if(!c.idle)return!1;if(-1==c.idle.indexOf(b))break;break;case 20:if(!c.move||-1!=c.move.indexOf(b)||c.move_start&&-1!=c.move_start.indexOf(b)||c.move_blends&&-1!=c.move_blends.indexOf(b))return!1;
break;default:return!1}return!0}var n=t("animation"),q=t("controls"),g=t("main"),u=t("quat"),k=t("scenes"),f=t("transform"),p=t("util"),K=t("vec3"),D=[];new Float32Array(9);var A=new Float32Array(3),h=new Float32Array(3),x=new Float32Array(3),w=new Float32Array(3),r=new Float32Array(4),m=new Float32Array(4),E=new Float32Array(4),y=a.NT_WALKING=10,M=a.NT_FLYING=20,L=a.NT_SWIMMING=30;a.new_event_track=function(a){a.destination=new Float32Array(3);a.start=[];a.ended=[];a.fired=[];a.y_correction=null;
a.prev_hit_pos=null;a.y_cor_water=null;a.reached=!0;a.rotation_mult=1;if(!a.random)for(var b=0;b<a.path.length;b++)a.start[b]=-1,a.ended[b]=!1,a.fired[b]=!1;D.push(a)};a.enable_animation=function(){if(D.length){b();var a=q.create_elapsed_sensor();q.create_sensor_manifold(D[0].collider,"ELAPSED",q.CT_CONTINUOUS,[a],function(a){return a[0]},function(a,b,c){if(1==c)for(a=q.get_sensor_value(a,b,0),b=0;b<D.length;b++){c=D[b];var d=a;if(k.is_visible(c.obj))if(c.random)v(d,c);else{for(var e=g.global_timeline(),
f=0;f<c.path.length;f++)if(!c.ended[f]){c.fired[f]||(c.fired[f]=!0,c.destination[0]=c.path[f][0],c.destination[1]=c.path[f][1],c.destination[2]=c.path[f][2],c.start[f]=e+c.delay[f]);if(e<c.start[f])break;v(d,c);c.ended[f]=c.reached;break}d=void 0;a:{for(d=0;d<c.path.length;d++)if(0==c.ended[d]){d=!1;break a}d=!0}if(d)for(d=0;d<c.path.length;d++)c.fired[d]=!1,c.ended[d]=!1}}})}};a.disable_animation=function(){if(!(0>=D.length))for(var a=0;a<D.length;a++){var b=D[a];q.check_sensor_manifolds(b.collider)&&
q.remove_sensor_manifold(b.collider);n.is_play(b.rig)&&n.stop(b.rig)}}};b4w.module.mouse=function(a,t){function v(){1==N&&(N=0);var a=document.exitPointerLock||document.webkitExitPointerLock||document.mozExitPointerLock;"function"===typeof a&&a.apply(document);p.remove_sensor_manifold(A.get_active_camera(),"SMOOTH_PL")}function c(a){2==N&&(N=0);a.removeEventListener("mousedown",e,!1);a.removeEventListener("mouseup",d,!1);a.removeEventListener("mousemove",b,!1);p.remove_sensor_manifold(A.get_active_camera(),"SMOOTH_DRAG")}function b(a){M()&&(E[0]+=2*(a.clientX-r),E[1]+=
2*(a.clientY-m),r=a.clientX,m=a.clientY);a.preventDefault()}function e(a){r=a.clientX;m=a.clientY;a.currentTarget.addEventListener("mousemove",b,!1);a.preventDefault()}function d(a){a.currentTarget.removeEventListener("mousemove",b,!1);a.preventDefault()}function l(a,b,c,d){if(.01<Math.abs(E[0])||.01<Math.abs(E[1]))b=p.get_sensor_value(a,b,0),a=h.smooth(E[0],0,b,.1*w),b=h.smooth(E[1],0,b,.1*w),E[0]-=a,E[1]-=b,d(4E-4*-a,4E-4*-b)}function n(a,b){var c=A.get_first_character(),d=A.get_active_camera();
k.eye_rotate(d,a,b);c&&(d=k.get_camera_angles_char(d,y),K.set_character_rotation(c,d[0],d[1]))}function q(){x.detect_mobile()||x.get_canvas_elem().addEventListener("mousemove",u)}function g(){x.detect_mobile()||(x.get_canvas_elem().removeEventListener("mousemove",u),L&&A.set_outline_intensity(L,0))}function u(a){a=f.client_to_canvas_coords(a.clientX,a.clientY,y);(a=A.pick_object(a[0],a[1]))?(A.outlining_is_enabled(a)&&A.set_outline_intensity(a,1),A.outlining_is_enabled(L)&&a!=L&&A.set_outline_intensity(L,
0)):A.outlining_is_enabled(L)&&A.set_outline_intensity(L,0);L=a}var k=t("camera"),f=t("container"),p=t("controls"),K=t("physics"),D=t("print"),A=t("scenes"),h=t("util"),x=t("main"),w=1,r=0,m=0,E=new Float32Array(2),y=new Float32Array(2),M=null,L=null,N=0;a.request_pointerlock=function(a,b,d,e,f,g){function h(){if(document.pointerLockElement===a||document.webkitPointerLockElement===a||document.mozPointerLockElement===a){c(a);a.addEventListener("mousemove",e,!1);var f=A.get_active_camera();if(!p.check_sensor_manifold(f,
"SMOOTH_PL")){var k=p.create_elapsed_sensor();p.create_sensor_manifold(f,"SMOOTH_PL",p.CT_CONTINUOUS,[k],null,l,g)}b()}else a.removeEventListener("mousemove",e,!1),N=0,document.removeEventListener("pointerlockchange",h,!1),document.removeEventListener("webkitpointerlockchange",h,!1),document.removeEventListener("mozpointerlockchange",h,!1),d()}if(1!=N){N=1;b=b||function(){};d=d||function(){};g=g||n;f=f||function(){return!0};e=e||function(a){if(f()){if("number"==typeof a.movementX){var b=a.movementX;
a=a.movementY}else"number"==typeof a.webkitMovementX?(b=a.webkitMovementX,a=a.webkitMovementY):"number"==typeof a.mozMovementX?(b=a.mozMovementX,a=a.mozMovementY):a=b=0;E[0]+=b;E[1]+=a}};document.addEventListener("pointerlockchange",h,!1);document.addEventListener("webkitpointerlockchange",h,!1);document.addEventListener("mozpointerlockchange",h,!1);var k=a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock;"function"===typeof k?k.apply(a):D.error("Pointer lock is not available")}};
a.exit_pointerlock=v;a.check_pointerlock=function(a){return"function"===typeof(a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock)?!0:!1};a.request_mouse_drag=function(a,b,c){2!=N&&(N=2,v(),M=b||function(){return!0},c=c||n,a.addEventListener("mousedown",e,!1),a.addEventListener("mouseup",d,!1),a=A.get_active_camera(),p.check_sensor_manifold(a,"SMOOTH_DRAG")||(b=p.create_elapsed_sensor(),p.create_sensor_manifold(a,"SMOOTH_DRAG",p.CT_CONTINUOUS,[b],null,l,c)))};a.exit_mouse_drag=
c;a.enable_mouse_hover_outline=q;a.enable_mouse_hover_glow=function(){D.error("enable_mouse_hover_glow() deprecated, use enable_mouse_hover_outline() instead");q()};a.disable_mouse_hover_outline=g;a.disable_mouse_hover_glow=function(){D.error("disable_mouse_hover_glow() deprecated, use disable_mouse_hover_outline() instead");g()};a.get_coords_x=function(a){return"clientX"in a?a.clientX:a.touches&&"clientX"in a.touches[0]?a.touches[0].clientX:-1};a.get_coords_y=function(a){return"clientY"in a?a.clientY:
a.touches&&"clientY"in a.touches[0]?a.touches[0].clientY:-1};a.set_plock_smooth_factor=function(a){w=a};a.get_plock_smooth_factor=function(){return w}};b4w.module.preloader=function(a,t){var v=t("app"),c,b,e,d,l,n,q,g,u,k=null;a.create_simple_preloader=function(a){var g=null,q=null,t="#bf9221",u="#000",h;for(h in a)switch(h){case "canvas_container_id":g=a.canvas_container_id;break;case "background_container_id":q=a.background_container_id;break;case "bg_color":u=a.bg_color;break;case "bar_color":t=a.bar_color;break;case "preloader_fadeout":c=a.preloader_fadeout}a=document.createElement("div");h=document.createElement("div");a.id="simple_preloader_container";
var v=document.createElement("div"),w=document.createElement("div"),q=document.getElementById(q);k=document.getElementById(g);a.style.cssText="z-index: 4;background-color: "+u+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";h.style.cssText="position: absolute;left: 50%;top: 82%;width: 300px;height: 20px;margin-left: -150px;margin-top: -10px;border-style:solid;border-width:4px;border-color: #000;border-radius: 0px;";v.style.cssText="position: absolute;left: 0px;top: 1px;width: 0px;height: 18px;background-color: "+
t+";border-radius: 0px;";w.style.cssText="position: absolute;left: 50%;top: 50%;width: 100%;height: 100%;margin-left: -150px;margin-top: -10px;text-align: center;font-size: 17px;font-weight: bold;color: #000;font-family: Verdana;"+h.appendChild(v);h.appendChild(w);a.appendChild(h);document.body.appendChild(a);b="SIMPLE";e=a;d=v;l=w;n=q};a.create_rotation_preloader=function(a){var c=null,d=null,g="rgba(0,0,0,0)",t="",h="",u="rgba(0,0,0,0)",v;for(v in a)switch(v){case "canvas_container_id":c=a.canvas_container_id;
break;case "background_container_id":d=a.background_container_id;break;case "frame_bg_color":g=a.frame_bg_color;break;case "bg_color":u=a.bg_color;break;case "frame_class":t=a.frame_class;break;case "anim_elem_class":h=a.anim_elem_class}a=document.createElement("div");v=document.createElement("div");var r=document.createElement("div"),m=document.createElement("div"),d=document.getElementById(d);k=document.getElementById(c);a.style.cssText="z-index: 4;background-color: "+u+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";
v.style.cssText="position: absolute;left: 50%;top: 50%;width: 117px;height: 117px;margin-left: -58px;margin-top: -58px;background-color: "+g+";";r.style.cssText="position: absolute;left: 0px;top: 0px;width: 100%;height: 100%;background-position: center;background-repeat: no-repeat;";m.style.cssText="position: absolute;width: 100%;height: 100%;text-align: center;margin-top: 38px;font-size: 36px;color: #ffffff;font-family: Arial;font-weight: bold;";r.className=h;v.appendChild(r);v.className=t;v.appendChild(m);
a.appendChild(v);k.appendChild(a);b="ROTATION";e=a;q=r;l=m;n=d};a.create_advanced_preloader=function(a){var c=a.preloader_width,q=a.canvas_container_id,c=c/(c-a.img_width),t=document.getElementById(a.preloader_bar_id),v=document.getElementById(a.fill_band_id),h=document.getElementById(a.preloader_caption_id),x=document.getElementById(a.preloader_container_id);a=document.getElementById(a.background_container_id);k=document.getElementById(q);b="ADVANCED";d=t;g=v;u=c;l=h;e=x;n=a};a.update_preloader=
function(a){l.innerHTML=a+"%";"SIMPLE"==b&&(d.style.width=a+"%");"ADVANCED"==b&&(d.style.width=a/u+"%",g.style.width=100-a+"%");"ROTATION"==b&&(q.style.transform="rotate("+a+"deg)");100==a&&(c?(v.css_animate(n,"opacity",1,0,1500,null,null,function(){n.parentNode.removeChild(n)}),v.css_animate(e,"opacity",1,0,1E3,null,null,function(){e.parentNode.removeChild(e)})):(e.parentNode.removeChild(e),n&&n.parentNode.removeChild(n)))}};b4w.module.storage=function(a,t){function v(a){e=a;if(!d){try{d=window.localStorage;try{d.tmp=null,delete d.tmp}catch(c){b.warn("localStorage quota is limited. Disabling localStorage"),d=null}}catch(q){b.warn("Applying chrome localStorage bug workaround"),d=null}d||(b.warn("localStorage is not available, initializing temporary storage"),d={})}}function c(){return d[e]?JSON.parse(d[e]):{}}var b=t("__print"),e="",d=null;a.init=v;a.set=function(a,b){var q=c();q[a]=String(b);d[e]=JSON.stringify(q)};a.cleanup=
function(){delete d[e]};a.get=function(a){var b=c();return b[a]?b[a]:""};a.debug=function(){b.log(c())};v("b4w")};b4w.module.screenshooter=function(a,t){var v=t("main");a.shot=function(){v.canvas_data_url(function(a){var b=window.document.createElement("a");document.body.appendChild(b);b.style.display="none";b.href=a;b.download="screenshot.png";b.click();document.body.removeChild(b)})}};
